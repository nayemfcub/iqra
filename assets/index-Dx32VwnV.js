function Qx(a,l){for(var o=0;o<l.length;o++){const c=l[o];if(typeof c!="string"&&!Array.isArray(c)){for(const d in c)if(d!=="default"&&!(d in a)){const p=Object.getOwnPropertyDescriptor(c,d);p&&Object.defineProperty(a,d,p.get?p:{enumerable:!0,get:()=>c[d]})}}}return Object.freeze(Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}))}(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function o(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(d){if(d.ep)return;d.ep=!0;const p=o(d);fetch(d.href,p)}})();function sm(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Ho={exports:{}},fa={},Vo={exports:{}},Ne={};var mu;function Yx(){if(mu)return Ne;mu=1;var a=Symbol.for("react.element"),l=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),m=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),v=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),b=Symbol.iterator;function w(L){return L===null||typeof L!="object"?null:(L=b&&L[b]||L["@@iterator"],typeof L=="function"?L:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,N={};function j(L,H,re){this.props=L,this.context=H,this.refs=N,this.updater=re||E}j.prototype.isReactComponent={},j.prototype.setState=function(L,H){if(typeof L!="object"&&typeof L!="function"&&L!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,L,H,"setState")},j.prototype.forceUpdate=function(L){this.updater.enqueueForceUpdate(this,L,"forceUpdate")};function M(){}M.prototype=j.prototype;function I(L,H,re){this.props=L,this.context=H,this.refs=N,this.updater=re||E}var V=I.prototype=new M;V.constructor=I,S(V,j.prototype),V.isPureReactComponent=!0;var $=Array.isArray,P=Object.prototype.hasOwnProperty,q={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function D(L,H,re){var he,be={},we=null,je=null;if(H!=null)for(he in H.ref!==void 0&&(je=H.ref),H.key!==void 0&&(we=""+H.key),H)P.call(H,he)&&!k.hasOwnProperty(he)&&(be[he]=H[he]);var ye=arguments.length-2;if(ye===1)be.children=re;else if(1<ye){for(var Se=Array(ye),He=0;He<ye;He++)Se[He]=arguments[He+2];be.children=Se}if(L&&L.defaultProps)for(he in ye=L.defaultProps,ye)be[he]===void 0&&(be[he]=ye[he]);return{$$typeof:a,type:L,key:we,ref:je,props:be,_owner:q.current}}function _(L,H){return{$$typeof:a,type:L.type,key:H,ref:L.ref,props:L.props,_owner:L._owner}}function O(L){return typeof L=="object"&&L!==null&&L.$$typeof===a}function K(L){var H={"=":"=0",":":"=2"};return"$"+L.replace(/[=:]/g,function(re){return H[re]})}var Q=/\/+/g;function B(L,H){return typeof L=="object"&&L!==null&&L.key!=null?K(""+L.key):H.toString(36)}function G(L,H,re,he,be){var we=typeof L;(we==="undefined"||we==="boolean")&&(L=null);var je=!1;if(L===null)je=!0;else switch(we){case"string":case"number":je=!0;break;case"object":switch(L.$$typeof){case a:case l:je=!0}}if(je)return je=L,be=be(je),L=he===""?"."+B(je,0):he,$(be)?(re="",L!=null&&(re=L.replace(Q,"$&/")+"/"),G(be,H,re,"",function(He){return He})):be!=null&&(O(be)&&(be=_(be,re+(!be.key||je&&je.key===be.key?"":(""+be.key).replace(Q,"$&/")+"/")+L)),H.push(be)),1;if(je=0,he=he===""?".":he+":",$(L))for(var ye=0;ye<L.length;ye++){we=L[ye];var Se=he+B(we,ye);je+=G(we,H,re,Se,be)}else if(Se=w(L),typeof Se=="function")for(L=Se.call(L),ye=0;!(we=L.next()).done;)we=we.value,Se=he+B(we,ye++),je+=G(we,H,re,Se,be);else if(we==="object")throw H=String(L),Error("Objects are not valid as a React child (found: "+(H==="[object Object]"?"object with keys {"+Object.keys(L).join(", ")+"}":H)+"). If you meant to render a collection of children, use an array instead.");return je}function T(L,H,re){if(L==null)return L;var he=[],be=0;return G(L,he,"","",function(we){return H.call(re,we,be++)}),he}function ne(L){if(L._status===-1){var H=L._result;H=H(),H.then(function(re){(L._status===0||L._status===-1)&&(L._status=1,L._result=re)},function(re){(L._status===0||L._status===-1)&&(L._status=2,L._result=re)}),L._status===-1&&(L._status=0,L._result=H)}if(L._status===1)return L._result.default;throw L._result}var le={current:null},R={transition:null},X={ReactCurrentDispatcher:le,ReactCurrentBatchConfig:R,ReactCurrentOwner:q};function Y(){throw Error("act(...) is not supported in production builds of React.")}return Ne.Children={map:T,forEach:function(L,H,re){T(L,function(){H.apply(this,arguments)},re)},count:function(L){var H=0;return T(L,function(){H++}),H},toArray:function(L){return T(L,function(H){return H})||[]},only:function(L){if(!O(L))throw Error("React.Children.only expected to receive a single React element child.");return L}},Ne.Component=j,Ne.Fragment=o,Ne.Profiler=d,Ne.PureComponent=I,Ne.StrictMode=c,Ne.Suspense=h,Ne.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X,Ne.act=Y,Ne.cloneElement=function(L,H,re){if(L==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+L+".");var he=S({},L.props),be=L.key,we=L.ref,je=L._owner;if(H!=null){if(H.ref!==void 0&&(we=H.ref,je=q.current),H.key!==void 0&&(be=""+H.key),L.type&&L.type.defaultProps)var ye=L.type.defaultProps;for(Se in H)P.call(H,Se)&&!k.hasOwnProperty(Se)&&(he[Se]=H[Se]===void 0&&ye!==void 0?ye[Se]:H[Se])}var Se=arguments.length-2;if(Se===1)he.children=re;else if(1<Se){ye=Array(Se);for(var He=0;He<Se;He++)ye[He]=arguments[He+2];he.children=ye}return{$$typeof:a,type:L.type,key:be,ref:we,props:he,_owner:je}},Ne.createContext=function(L){return L={$$typeof:m,_currentValue:L,_currentValue2:L,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},L.Provider={$$typeof:p,_context:L},L.Consumer=L},Ne.createElement=D,Ne.createFactory=function(L){var H=D.bind(null,L);return H.type=L,H},Ne.createRef=function(){return{current:null}},Ne.forwardRef=function(L){return{$$typeof:f,render:L}},Ne.isValidElement=O,Ne.lazy=function(L){return{$$typeof:y,_payload:{_status:-1,_result:L},_init:ne}},Ne.memo=function(L,H){return{$$typeof:v,type:L,compare:H===void 0?null:H}},Ne.startTransition=function(L){var H=R.transition;R.transition={};try{L()}finally{R.transition=H}},Ne.unstable_act=Y,Ne.useCallback=function(L,H){return le.current.useCallback(L,H)},Ne.useContext=function(L){return le.current.useContext(L)},Ne.useDebugValue=function(){},Ne.useDeferredValue=function(L){return le.current.useDeferredValue(L)},Ne.useEffect=function(L,H){return le.current.useEffect(L,H)},Ne.useId=function(){return le.current.useId()},Ne.useImperativeHandle=function(L,H,re){return le.current.useImperativeHandle(L,H,re)},Ne.useInsertionEffect=function(L,H){return le.current.useInsertionEffect(L,H)},Ne.useLayoutEffect=function(L,H){return le.current.useLayoutEffect(L,H)},Ne.useMemo=function(L,H){return le.current.useMemo(L,H)},Ne.useReducer=function(L,H,re){return le.current.useReducer(L,H,re)},Ne.useRef=function(L){return le.current.useRef(L)},Ne.useState=function(L){return le.current.useState(L)},Ne.useSyncExternalStore=function(L,H,re){return le.current.useSyncExternalStore(L,H,re)},Ne.useTransition=function(){return le.current.useTransition()},Ne.version="18.3.1",Ne}var pu;function li(){return pu||(pu=1,Vo.exports=Yx()),Vo.exports}var xu;function Kx(){if(xu)return fa;xu=1;var a=li(),l=Symbol.for("react.element"),o=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,d=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function m(f,h,v){var y,b={},w=null,E=null;v!==void 0&&(w=""+v),h.key!==void 0&&(w=""+h.key),h.ref!==void 0&&(E=h.ref);for(y in h)c.call(h,y)&&!p.hasOwnProperty(y)&&(b[y]=h[y]);if(f&&f.defaultProps)for(y in h=f.defaultProps,h)b[y]===void 0&&(b[y]=h[y]);return{$$typeof:l,type:f,key:w,ref:E,props:b,_owner:d.current}}return fa.Fragment=o,fa.jsx=m,fa.jsxs=m,fa}var hu;function Jx(){return hu||(hu=1,Ho.exports=Kx()),Ho.exports}var e=Jx(),x=li();const oi=sm(x),Xx=Qx({__proto__:null,default:oi},[x]);var Fr={},Go={exports:{}},bt={},qo={exports:{}},Qo={};var fu;function Zx(){return fu||(fu=1,(function(a){function l(R,X){var Y=R.length;R.push(X);e:for(;0<Y;){var L=Y-1>>>1,H=R[L];if(0<d(H,X))R[L]=X,R[Y]=H,Y=L;else break e}}function o(R){return R.length===0?null:R[0]}function c(R){if(R.length===0)return null;var X=R[0],Y=R.pop();if(Y!==X){R[0]=Y;e:for(var L=0,H=R.length,re=H>>>1;L<re;){var he=2*(L+1)-1,be=R[he],we=he+1,je=R[we];if(0>d(be,Y))we<H&&0>d(je,be)?(R[L]=je,R[we]=Y,L=we):(R[L]=be,R[he]=Y,L=he);else if(we<H&&0>d(je,Y))R[L]=je,R[we]=Y,L=we;else break e}}return X}function d(R,X){var Y=R.sortIndex-X.sortIndex;return Y!==0?Y:R.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var p=performance;a.unstable_now=function(){return p.now()}}else{var m=Date,f=m.now();a.unstable_now=function(){return m.now()-f}}var h=[],v=[],y=1,b=null,w=3,E=!1,S=!1,N=!1,j=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function V(R){for(var X=o(v);X!==null;){if(X.callback===null)c(v);else if(X.startTime<=R)c(v),X.sortIndex=X.expirationTime,l(h,X);else break;X=o(v)}}function $(R){if(N=!1,V(R),!S)if(o(h)!==null)S=!0,ne(P);else{var X=o(v);X!==null&&le($,X.startTime-R)}}function P(R,X){S=!1,N&&(N=!1,M(D),D=-1),E=!0;var Y=w;try{for(V(X),b=o(h);b!==null&&(!(b.expirationTime>X)||R&&!K());){var L=b.callback;if(typeof L=="function"){b.callback=null,w=b.priorityLevel;var H=L(b.expirationTime<=X);X=a.unstable_now(),typeof H=="function"?b.callback=H:b===o(h)&&c(h),V(X)}else c(h);b=o(h)}if(b!==null)var re=!0;else{var he=o(v);he!==null&&le($,he.startTime-X),re=!1}return re}finally{b=null,w=Y,E=!1}}var q=!1,k=null,D=-1,_=5,O=-1;function K(){return!(a.unstable_now()-O<_)}function Q(){if(k!==null){var R=a.unstable_now();O=R;var X=!0;try{X=k(!0,R)}finally{X?B():(q=!1,k=null)}}else q=!1}var B;if(typeof I=="function")B=function(){I(Q)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,T=G.port2;G.port1.onmessage=Q,B=function(){T.postMessage(null)}}else B=function(){j(Q,0)};function ne(R){k=R,q||(q=!0,B())}function le(R,X){D=j(function(){R(a.unstable_now())},X)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(R){R.callback=null},a.unstable_continueExecution=function(){S||E||(S=!0,ne(P))},a.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<R?Math.floor(1e3/R):5},a.unstable_getCurrentPriorityLevel=function(){return w},a.unstable_getFirstCallbackNode=function(){return o(h)},a.unstable_next=function(R){switch(w){case 1:case 2:case 3:var X=3;break;default:X=w}var Y=w;w=X;try{return R()}finally{w=Y}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(R,X){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var Y=w;w=R;try{return X()}finally{w=Y}},a.unstable_scheduleCallback=function(R,X,Y){var L=a.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?L+Y:L):Y=L,R){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=Y+H,R={id:y++,callback:X,priorityLevel:R,startTime:Y,expirationTime:H,sortIndex:-1},Y>L?(R.sortIndex=Y,l(v,R),o(h)===null&&R===o(v)&&(N?(M(D),D=-1):N=!0,le($,Y-L))):(R.sortIndex=H,l(h,R),S||E||(S=!0,ne(P))),R},a.unstable_shouldYield=K,a.unstable_wrapCallback=function(R){var X=w;return function(){var Y=w;w=X;try{return R.apply(this,arguments)}finally{w=Y}}}})(Qo)),Qo}var gu;function eh(){return gu||(gu=1,qo.exports=Zx()),qo.exports}var yu;function th(){if(yu)return bt;yu=1;var a=li(),l=eh();function o(t){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)s+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=new Set,d={};function p(t,s){m(t,s),m(t+"Capture",s)}function m(t,s){for(d[t]=s,t=0;t<s.length;t++)c.add(s[t])}var f=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),h=Object.prototype.hasOwnProperty,v=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,y={},b={};function w(t){return h.call(b,t)?!0:h.call(y,t)?!1:v.test(t)?b[t]=!0:(y[t]=!0,!1)}function E(t,s,n,r){if(n!==null&&n.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function S(t,s,n,r){if(s===null||typeof s>"u"||E(t,s,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function N(t,s,n,r,i,u,g){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=s,this.sanitizeURL=u,this.removeEmptyString=g}var j={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){j[t]=new N(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var s=t[0];j[s]=new N(s,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){j[t]=new N(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){j[t]=new N(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){j[t]=new N(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){j[t]=new N(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){j[t]=new N(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){j[t]=new N(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){j[t]=new N(t,5,!1,t.toLowerCase(),null,!1,!1)});var M=/[\-:]([a-z])/g;function I(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var s=t.replace(M,I);j[s]=new N(s,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var s=t.replace(M,I);j[s]=new N(s,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var s=t.replace(M,I);j[s]=new N(s,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){j[t]=new N(t,1,!1,t.toLowerCase(),null,!1,!1)}),j.xlinkHref=new N("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){j[t]=new N(t,1,!1,t.toLowerCase(),null,!0,!0)});function V(t,s,n,r){var i=j.hasOwnProperty(s)?j[s]:null;(i!==null?i.type!==0:r||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(S(s,n,i,r)&&(n=null),r||i===null?w(s)&&(n===null?t.removeAttribute(s):t.setAttribute(s,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(s=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(s):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,s,n):t.setAttribute(s,n))))}var $=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,P=Symbol.for("react.element"),q=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),O=Symbol.for("react.provider"),K=Symbol.for("react.context"),Q=Symbol.for("react.forward_ref"),B=Symbol.for("react.suspense"),G=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),le=Symbol.for("react.offscreen"),R=Symbol.iterator;function X(t){return t===null||typeof t!="object"?null:(t=R&&t[R]||t["@@iterator"],typeof t=="function"?t:null)}var Y=Object.assign,L;function H(t){if(L===void 0)try{throw Error()}catch(n){var s=n.stack.trim().match(/\n( *(at )?)/);L=s&&s[1]||""}return`
`+L+t}var re=!1;function he(t,s){if(!t||re)return"";re=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(W){var r=W}Reflect.construct(t,[],s)}else{try{s.call()}catch(W){r=W}t.call(s.prototype)}else{try{throw Error()}catch(W){r=W}t()}}catch(W){if(W&&r&&typeof W.stack=="string"){for(var i=W.stack.split(`
`),u=r.stack.split(`
`),g=i.length-1,C=u.length-1;1<=g&&0<=C&&i[g]!==u[C];)C--;for(;1<=g&&0<=C;g--,C--)if(i[g]!==u[C]){if(g!==1||C!==1)do if(g--,C--,0>C||i[g]!==u[C]){var A=`
`+i[g].replace(" at new "," at ");return t.displayName&&A.includes("<anonymous>")&&(A=A.replace("<anonymous>",t.displayName)),A}while(1<=g&&0<=C);break}}}finally{re=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?H(t):""}function be(t){switch(t.tag){case 5:return H(t.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return t=he(t.type,!1),t;case 11:return t=he(t.type.render,!1),t;case 1:return t=he(t.type,!0),t;default:return""}}function we(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case k:return"Fragment";case q:return"Portal";case _:return"Profiler";case D:return"StrictMode";case B:return"Suspense";case G:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case K:return(t.displayName||"Context")+".Consumer";case O:return(t._context.displayName||"Context")+".Provider";case Q:var s=t.render;return t=t.displayName,t||(t=s.displayName||s.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case T:return s=t.displayName||null,s!==null?s:we(t.type)||"Memo";case ne:s=t._payload,t=t._init;try{return we(t(s))}catch{}}return null}function je(t){var s=t.type;switch(t.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=s.render,t=t.displayName||t.name||"",s.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return we(s);case 8:return s===D?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function ye(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Se(t){var s=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function He(t){var s=Se(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,s),r=""+t[s];if(!t.hasOwnProperty(s)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,u=n.set;return Object.defineProperty(t,s,{configurable:!0,get:function(){return i.call(this)},set:function(g){r=""+g,u.call(this,g)}}),Object.defineProperty(t,s,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(g){r=""+g},stopTracking:function(){t._valueTracker=null,delete t[s]}}}}function ie(t){t._valueTracker||(t._valueTracker=He(t))}function Me(t){if(!t)return!1;var s=t._valueTracker;if(!s)return!0;var n=s.getValue(),r="";return t&&(r=Se(t)?t.checked?"true":"false":t.value),t=r,t!==n?(s.setValue(t),!0):!1}function ze(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ut(t,s){var n=s.checked;return Y({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Js(t,s){var n=s.defaultValue==null?"":s.defaultValue,r=s.checked!=null?s.checked:s.defaultChecked;n=ye(s.value!=null?s.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function Xs(t,s){s=s.checked,s!=null&&V(t,"checked",s,!1)}function Ms(t,s){Xs(t,s);var n=ye(s.value),r=s.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}s.hasOwnProperty("value")?xe(t,s.type,n):s.hasOwnProperty("defaultValue")&&xe(t,s.type,ye(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(t.defaultChecked=!!s.defaultChecked)}function se(t,s,n){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var r=s.type;if(!(r!=="submit"&&r!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+t._wrapperState.initialValue,n||s===t.value||(t.value=s),t.defaultValue=s}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function xe(t,s,n){(s!=="number"||ze(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ke=Array.isArray;function rt(t,s,n,r){if(t=t.options,s){s={};for(var i=0;i<n.length;i++)s["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=s.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+ye(n),s=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}s!==null||t[i].disabled||(s=t[i])}s!==null&&(s.selected=!0)}}function Wt(t,s){if(s.dangerouslySetInnerHTML!=null)throw Error(o(91));return Y({},s,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Ps(t,s){var n=s.value;if(n==null){if(n=s.children,s=s.defaultValue,n!=null){if(s!=null)throw Error(o(92));if(ke(n)){if(1<n.length)throw Error(o(93));n=n[0]}s=n}s==null&&(s=""),n=s}t._wrapperState={initialValue:ye(n)}}function Pn(t,s){var n=ye(s.value),r=ye(s.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),s.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function ka(t){var s=t.textContent;s===t._wrapperState.initialValue&&s!==""&&s!==null&&(t.value=s)}function Ca(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function el(t,s){return t==null||t==="http://www.w3.org/1999/xhtml"?Ca(s):t==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ea,Ci=(function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(s,n,r,i)})}:t})(function(t,s){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=s;else{for(Ea=Ea||document.createElement("div"),Ea.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Ea.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;s.firstChild;)t.appendChild(s.firstChild)}});function An(t,s){if(s){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=s;return}}t.textContent=s}var Tn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Xm=["Webkit","ms","Moz","O"];Object.keys(Tn).forEach(function(t){Xm.forEach(function(s){s=s+t.charAt(0).toUpperCase()+t.substring(1),Tn[s]=Tn[t]})});function Ei(t,s,n){return s==null||typeof s=="boolean"||s===""?"":n||typeof s!="number"||s===0||Tn.hasOwnProperty(t)&&Tn[t]?(""+s).trim():s+"px"}function Di(t,s){t=t.style;for(var n in s)if(s.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Ei(n,s[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var Zm=Y({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function tl(t,s){if(s){if(Zm[t]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(o(137,t));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(o(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(o(61))}if(s.style!=null&&typeof s.style!="object")throw Error(o(62))}}function sl(t,s){if(t.indexOf("-")===-1)return typeof s.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nl=null;function al(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var rl=null,Zs=null,en=null;function Ii(t){if(t=ta(t)){if(typeof rl!="function")throw Error(o(280));var s=t.stateNode;s&&(s=Ka(s),rl(t.stateNode,t.type,s))}}function Mi(t){Zs?en?en.push(t):en=[t]:Zs=t}function Pi(){if(Zs){var t=Zs,s=en;if(en=Zs=null,Ii(t),s)for(t=0;t<s.length;t++)Ii(s[t])}}function Ai(t,s){return t(s)}function Ti(){}var ll=!1;function Li(t,s,n){if(ll)return t(s,n);ll=!0;try{return Ai(t,s,n)}finally{ll=!1,(Zs!==null||en!==null)&&(Ti(),Pi())}}function Ln(t,s){var n=t.stateNode;if(n===null)return null;var r=Ka(n);if(r===null)return null;n=r[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(o(231,s,typeof n));return n}var ol=!1;if(f)try{var Fn={};Object.defineProperty(Fn,"passive",{get:function(){ol=!0}}),window.addEventListener("test",Fn,Fn),window.removeEventListener("test",Fn,Fn)}catch{ol=!1}function ep(t,s,n,r,i,u,g,C,A){var W=Array.prototype.slice.call(arguments,3);try{s.apply(n,W)}catch(Z){this.onError(Z)}}var $n=!1,Da=null,Ia=!1,il=null,tp={onError:function(t){$n=!0,Da=t}};function sp(t,s,n,r,i,u,g,C,A){$n=!1,Da=null,ep.apply(tp,arguments)}function np(t,s,n,r,i,u,g,C,A){if(sp.apply(this,arguments),$n){if($n){var W=Da;$n=!1,Da=null}else throw Error(o(198));Ia||(Ia=!0,il=W)}}function As(t){var s=t,n=t;if(t.alternate)for(;s.return;)s=s.return;else{t=s;do s=t,(s.flags&4098)!==0&&(n=s.return),t=s.return;while(t)}return s.tag===3?n:null}function Fi(t){if(t.tag===13){var s=t.memoizedState;if(s===null&&(t=t.alternate,t!==null&&(s=t.memoizedState)),s!==null)return s.dehydrated}return null}function $i(t){if(As(t)!==t)throw Error(o(188))}function ap(t){var s=t.alternate;if(!s){if(s=As(t),s===null)throw Error(o(188));return s!==t?null:t}for(var n=t,r=s;;){var i=n.return;if(i===null)break;var u=i.alternate;if(u===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===u.child){for(u=i.child;u;){if(u===n)return $i(i),t;if(u===r)return $i(i),s;u=u.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=u;else{for(var g=!1,C=i.child;C;){if(C===n){g=!0,n=i,r=u;break}if(C===r){g=!0,r=i,n=u;break}C=C.sibling}if(!g){for(C=u.child;C;){if(C===n){g=!0,n=u,r=i;break}if(C===r){g=!0,r=u,n=i;break}C=C.sibling}if(!g)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(n.tag!==3)throw Error(o(188));return n.stateNode.current===n?t:s}function Ri(t){return t=ap(t),t!==null?zi(t):null}function zi(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var s=zi(t);if(s!==null)return s;t=t.sibling}return null}var _i=l.unstable_scheduleCallback,Oi=l.unstable_cancelCallback,rp=l.unstable_shouldYield,lp=l.unstable_requestPaint,Ve=l.unstable_now,op=l.unstable_getCurrentPriorityLevel,cl=l.unstable_ImmediatePriority,Bi=l.unstable_UserBlockingPriority,Ma=l.unstable_NormalPriority,ip=l.unstable_LowPriority,Ui=l.unstable_IdlePriority,Pa=null,Ht=null;function cp(t){if(Ht&&typeof Ht.onCommitFiberRoot=="function")try{Ht.onCommitFiberRoot(Pa,t,void 0,(t.current.flags&128)===128)}catch{}}var Tt=Math.clz32?Math.clz32:mp,dp=Math.log,up=Math.LN2;function mp(t){return t>>>=0,t===0?32:31-(dp(t)/up|0)|0}var Aa=64,Ta=4194304;function Rn(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function La(t,s){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,u=t.pingedLanes,g=n&268435455;if(g!==0){var C=g&~i;C!==0?r=Rn(C):(u&=g,u!==0&&(r=Rn(u)))}else g=n&~i,g!==0?r=Rn(g):u!==0&&(r=Rn(u));if(r===0)return 0;if(s!==0&&s!==r&&(s&i)===0&&(i=r&-r,u=s&-s,i>=u||i===16&&(u&4194240)!==0))return s;if((r&4)!==0&&(r|=n&16),s=t.entangledLanes,s!==0)for(t=t.entanglements,s&=r;0<s;)n=31-Tt(s),i=1<<n,r|=t[n],s&=~i;return r}function pp(t,s){switch(t){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xp(t,s){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,u=t.pendingLanes;0<u;){var g=31-Tt(u),C=1<<g,A=i[g];A===-1?((C&n)===0||(C&r)!==0)&&(i[g]=pp(C,s)):A<=s&&(t.expiredLanes|=C),u&=~C}}function dl(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Wi(){var t=Aa;return Aa<<=1,(Aa&4194240)===0&&(Aa=64),t}function ul(t){for(var s=[],n=0;31>n;n++)s.push(t);return s}function zn(t,s,n){t.pendingLanes|=s,s!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,s=31-Tt(s),t[s]=n}function hp(t,s){var n=t.pendingLanes&~s;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=s,t.mutableReadLanes&=s,t.entangledLanes&=s,s=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Tt(n),u=1<<i;s[i]=0,r[i]=-1,t[i]=-1,n&=~u}}function ml(t,s){var n=t.entangledLanes|=s;for(t=t.entanglements;n;){var r=31-Tt(n),i=1<<r;i&s|t[r]&s&&(t[r]|=s),n&=~i}}var Pe=0;function Hi(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var Vi,pl,Gi,qi,Qi,xl=!1,Fa=[],ls=null,os=null,is=null,_n=new Map,On=new Map,cs=[],fp="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Yi(t,s){switch(t){case"focusin":case"focusout":ls=null;break;case"dragenter":case"dragleave":os=null;break;case"mouseover":case"mouseout":is=null;break;case"pointerover":case"pointerout":_n.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":On.delete(s.pointerId)}}function Bn(t,s,n,r,i,u){return t===null||t.nativeEvent!==u?(t={blockedOn:s,domEventName:n,eventSystemFlags:r,nativeEvent:u,targetContainers:[i]},s!==null&&(s=ta(s),s!==null&&pl(s)),t):(t.eventSystemFlags|=r,s=t.targetContainers,i!==null&&s.indexOf(i)===-1&&s.push(i),t)}function gp(t,s,n,r,i){switch(s){case"focusin":return ls=Bn(ls,t,s,n,r,i),!0;case"dragenter":return os=Bn(os,t,s,n,r,i),!0;case"mouseover":return is=Bn(is,t,s,n,r,i),!0;case"pointerover":var u=i.pointerId;return _n.set(u,Bn(_n.get(u)||null,t,s,n,r,i)),!0;case"gotpointercapture":return u=i.pointerId,On.set(u,Bn(On.get(u)||null,t,s,n,r,i)),!0}return!1}function Ki(t){var s=Ts(t.target);if(s!==null){var n=As(s);if(n!==null){if(s=n.tag,s===13){if(s=Fi(n),s!==null){t.blockedOn=s,Qi(t.priority,function(){Gi(n)});return}}else if(s===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function $a(t){if(t.blockedOn!==null)return!1;for(var s=t.targetContainers;0<s.length;){var n=fl(t.domEventName,t.eventSystemFlags,s[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);nl=r,n.target.dispatchEvent(r),nl=null}else return s=ta(n),s!==null&&pl(s),t.blockedOn=n,!1;s.shift()}return!0}function Ji(t,s,n){$a(t)&&n.delete(s)}function yp(){xl=!1,ls!==null&&$a(ls)&&(ls=null),os!==null&&$a(os)&&(os=null),is!==null&&$a(is)&&(is=null),_n.forEach(Ji),On.forEach(Ji)}function Un(t,s){t.blockedOn===s&&(t.blockedOn=null,xl||(xl=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,yp)))}function Wn(t){function s(i){return Un(i,t)}if(0<Fa.length){Un(Fa[0],t);for(var n=1;n<Fa.length;n++){var r=Fa[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ls!==null&&Un(ls,t),os!==null&&Un(os,t),is!==null&&Un(is,t),_n.forEach(s),On.forEach(s),n=0;n<cs.length;n++)r=cs[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<cs.length&&(n=cs[0],n.blockedOn===null);)Ki(n),n.blockedOn===null&&cs.shift()}var tn=$.ReactCurrentBatchConfig,Ra=!0;function vp(t,s,n,r){var i=Pe,u=tn.transition;tn.transition=null;try{Pe=1,hl(t,s,n,r)}finally{Pe=i,tn.transition=u}}function bp(t,s,n,r){var i=Pe,u=tn.transition;tn.transition=null;try{Pe=4,hl(t,s,n,r)}finally{Pe=i,tn.transition=u}}function hl(t,s,n,r){if(Ra){var i=fl(t,s,n,r);if(i===null)Tl(t,s,r,za,n),Yi(t,r);else if(gp(i,t,s,n,r))r.stopPropagation();else if(Yi(t,r),s&4&&-1<fp.indexOf(t)){for(;i!==null;){var u=ta(i);if(u!==null&&Vi(u),u=fl(t,s,n,r),u===null&&Tl(t,s,r,za,n),u===i)break;i=u}i!==null&&r.stopPropagation()}else Tl(t,s,r,null,n)}}var za=null;function fl(t,s,n,r){if(za=null,t=al(r),t=Ts(t),t!==null)if(s=As(t),s===null)t=null;else if(n=s.tag,n===13){if(t=Fi(s),t!==null)return t;t=null}else if(n===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;t=null}else s!==t&&(t=null);return za=t,null}function Xi(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(op()){case cl:return 1;case Bi:return 4;case Ma:case ip:return 16;case Ui:return 536870912;default:return 16}default:return 16}}var ds=null,gl=null,_a=null;function Zi(){if(_a)return _a;var t,s=gl,n=s.length,r,i="value"in ds?ds.value:ds.textContent,u=i.length;for(t=0;t<n&&s[t]===i[t];t++);var g=n-t;for(r=1;r<=g&&s[n-r]===i[u-r];r++);return _a=i.slice(t,1<r?1-r:void 0)}function Oa(t){var s=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&s===13&&(t=13)):t=s,t===10&&(t=13),32<=t||t===13?t:0}function Ba(){return!0}function ec(){return!1}function Nt(t){function s(n,r,i,u,g){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=u,this.target=g,this.currentTarget=null;for(var C in t)t.hasOwnProperty(C)&&(n=t[C],this[C]=n?n(u):u[C]);return this.isDefaultPrevented=(u.defaultPrevented!=null?u.defaultPrevented:u.returnValue===!1)?Ba:ec,this.isPropagationStopped=ec,this}return Y(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ba)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ba)},persist:function(){},isPersistent:Ba}),s}var sn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yl=Nt(sn),Hn=Y({},sn,{view:0,detail:0}),jp=Nt(Hn),vl,bl,Vn,Ua=Y({},Hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wl,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Vn&&(Vn&&t.type==="mousemove"?(vl=t.screenX-Vn.screenX,bl=t.screenY-Vn.screenY):bl=vl=0,Vn=t),vl)},movementY:function(t){return"movementY"in t?t.movementY:bl}}),tc=Nt(Ua),wp=Y({},Ua,{dataTransfer:0}),Np=Nt(wp),Sp=Y({},Hn,{relatedTarget:0}),jl=Nt(Sp),kp=Y({},sn,{animationName:0,elapsedTime:0,pseudoElement:0}),Cp=Nt(kp),Ep=Y({},sn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Dp=Nt(Ep),Ip=Y({},sn,{data:0}),sc=Nt(Ip),Mp={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Pp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ap={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tp(t){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(t):(t=Ap[t])?!!s[t]:!1}function wl(){return Tp}var Lp=Y({},Hn,{key:function(t){if(t.key){var s=Mp[t.key]||t.key;if(s!=="Unidentified")return s}return t.type==="keypress"?(t=Oa(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Pp[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wl,charCode:function(t){return t.type==="keypress"?Oa(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Oa(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Fp=Nt(Lp),$p=Y({},Ua,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nc=Nt($p),Rp=Y({},Hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wl}),zp=Nt(Rp),_p=Y({},sn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Op=Nt(_p),Bp=Y({},Ua,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Up=Nt(Bp),Wp=[9,13,27,32],Nl=f&&"CompositionEvent"in window,Gn=null;f&&"documentMode"in document&&(Gn=document.documentMode);var Hp=f&&"TextEvent"in window&&!Gn,ac=f&&(!Nl||Gn&&8<Gn&&11>=Gn),rc=" ",lc=!1;function oc(t,s){switch(t){case"keyup":return Wp.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ic(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var nn=!1;function Vp(t,s){switch(t){case"compositionend":return ic(s);case"keypress":return s.which!==32?null:(lc=!0,rc);case"textInput":return t=s.data,t===rc&&lc?null:t;default:return null}}function Gp(t,s){if(nn)return t==="compositionend"||!Nl&&oc(t,s)?(t=Zi(),_a=gl=ds=null,nn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return ac&&s.locale!=="ko"?null:s.data;default:return null}}var qp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cc(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s==="input"?!!qp[t.type]:s==="textarea"}function dc(t,s,n,r){Mi(r),s=qa(s,"onChange"),0<s.length&&(n=new yl("onChange","change",null,n,r),t.push({event:n,listeners:s}))}var qn=null,Qn=null;function Qp(t){Dc(t,0)}function Wa(t){var s=cn(t);if(Me(s))return t}function Yp(t,s){if(t==="change")return s}var uc=!1;if(f){var Sl;if(f){var kl="oninput"in document;if(!kl){var mc=document.createElement("div");mc.setAttribute("oninput","return;"),kl=typeof mc.oninput=="function"}Sl=kl}else Sl=!1;uc=Sl&&(!document.documentMode||9<document.documentMode)}function pc(){qn&&(qn.detachEvent("onpropertychange",xc),Qn=qn=null)}function xc(t){if(t.propertyName==="value"&&Wa(Qn)){var s=[];dc(s,Qn,t,al(t)),Li(Qp,s)}}function Kp(t,s,n){t==="focusin"?(pc(),qn=s,Qn=n,qn.attachEvent("onpropertychange",xc)):t==="focusout"&&pc()}function Jp(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Wa(Qn)}function Xp(t,s){if(t==="click")return Wa(s)}function Zp(t,s){if(t==="input"||t==="change")return Wa(s)}function ex(t,s){return t===s&&(t!==0||1/t===1/s)||t!==t&&s!==s}var Lt=typeof Object.is=="function"?Object.is:ex;function Yn(t,s){if(Lt(t,s))return!0;if(typeof t!="object"||t===null||typeof s!="object"||s===null)return!1;var n=Object.keys(t),r=Object.keys(s);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(s,i)||!Lt(t[i],s[i]))return!1}return!0}function hc(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function fc(t,s){var n=hc(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=s&&r>=s)return{node:n,offset:s-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=hc(n)}}function gc(t,s){return t&&s?t===s?!0:t&&t.nodeType===3?!1:s&&s.nodeType===3?gc(t,s.parentNode):"contains"in t?t.contains(s):t.compareDocumentPosition?!!(t.compareDocumentPosition(s)&16):!1:!1}function yc(){for(var t=window,s=ze();s instanceof t.HTMLIFrameElement;){try{var n=typeof s.contentWindow.location.href=="string"}catch{n=!1}if(n)t=s.contentWindow;else break;s=ze(t.document)}return s}function Cl(t){var s=t&&t.nodeName&&t.nodeName.toLowerCase();return s&&(s==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||s==="textarea"||t.contentEditable==="true")}function tx(t){var s=yc(),n=t.focusedElem,r=t.selectionRange;if(s!==n&&n&&n.ownerDocument&&gc(n.ownerDocument.documentElement,n)){if(r!==null&&Cl(n)){if(s=r.start,t=r.end,t===void 0&&(t=s),"selectionStart"in n)n.selectionStart=s,n.selectionEnd=Math.min(t,n.value.length);else if(t=(s=n.ownerDocument||document)&&s.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,u=Math.min(r.start,i);r=r.end===void 0?u:Math.min(r.end,i),!t.extend&&u>r&&(i=r,r=u,u=i),i=fc(n,u);var g=fc(n,r);i&&g&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==g.node||t.focusOffset!==g.offset)&&(s=s.createRange(),s.setStart(i.node,i.offset),t.removeAllRanges(),u>r?(t.addRange(s),t.extend(g.node,g.offset)):(s.setEnd(g.node,g.offset),t.addRange(s)))}}for(s=[],t=n;t=t.parentNode;)t.nodeType===1&&s.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<s.length;n++)t=s[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var sx=f&&"documentMode"in document&&11>=document.documentMode,an=null,El=null,Kn=null,Dl=!1;function vc(t,s,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Dl||an==null||an!==ze(r)||(r=an,"selectionStart"in r&&Cl(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Kn&&Yn(Kn,r)||(Kn=r,r=qa(El,"onSelect"),0<r.length&&(s=new yl("onSelect","select",null,s,n),t.push({event:s,listeners:r}),s.target=an)))}function Ha(t,s){var n={};return n[t.toLowerCase()]=s.toLowerCase(),n["Webkit"+t]="webkit"+s,n["Moz"+t]="moz"+s,n}var rn={animationend:Ha("Animation","AnimationEnd"),animationiteration:Ha("Animation","AnimationIteration"),animationstart:Ha("Animation","AnimationStart"),transitionend:Ha("Transition","TransitionEnd")},Il={},bc={};f&&(bc=document.createElement("div").style,"AnimationEvent"in window||(delete rn.animationend.animation,delete rn.animationiteration.animation,delete rn.animationstart.animation),"TransitionEvent"in window||delete rn.transitionend.transition);function Va(t){if(Il[t])return Il[t];if(!rn[t])return t;var s=rn[t],n;for(n in s)if(s.hasOwnProperty(n)&&n in bc)return Il[t]=s[n];return t}var jc=Va("animationend"),wc=Va("animationiteration"),Nc=Va("animationstart"),Sc=Va("transitionend"),kc=new Map,Cc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function us(t,s){kc.set(t,s),p(s,[t])}for(var Ml=0;Ml<Cc.length;Ml++){var Pl=Cc[Ml],nx=Pl.toLowerCase(),ax=Pl[0].toUpperCase()+Pl.slice(1);us(nx,"on"+ax)}us(jc,"onAnimationEnd"),us(wc,"onAnimationIteration"),us(Nc,"onAnimationStart"),us("dblclick","onDoubleClick"),us("focusin","onFocus"),us("focusout","onBlur"),us(Sc,"onTransitionEnd"),m("onMouseEnter",["mouseout","mouseover"]),m("onMouseLeave",["mouseout","mouseover"]),m("onPointerEnter",["pointerout","pointerover"]),m("onPointerLeave",["pointerout","pointerover"]),p("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),p("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),p("onBeforeInput",["compositionend","keypress","textInput","paste"]),p("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),p("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),p("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Jn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rx=new Set("cancel close invalid load scroll toggle".split(" ").concat(Jn));function Ec(t,s,n){var r=t.type||"unknown-event";t.currentTarget=n,np(r,s,void 0,t),t.currentTarget=null}function Dc(t,s){s=(s&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var u=void 0;if(s)for(var g=r.length-1;0<=g;g--){var C=r[g],A=C.instance,W=C.currentTarget;if(C=C.listener,A!==u&&i.isPropagationStopped())break e;Ec(i,C,W),u=A}else for(g=0;g<r.length;g++){if(C=r[g],A=C.instance,W=C.currentTarget,C=C.listener,A!==u&&i.isPropagationStopped())break e;Ec(i,C,W),u=A}}}if(Ia)throw t=il,Ia=!1,il=null,t}function Le(t,s){var n=s[_l];n===void 0&&(n=s[_l]=new Set);var r=t+"__bubble";n.has(r)||(Ic(s,t,2,!1),n.add(r))}function Al(t,s,n){var r=0;s&&(r|=4),Ic(n,t,r,s)}var Ga="_reactListening"+Math.random().toString(36).slice(2);function Xn(t){if(!t[Ga]){t[Ga]=!0,c.forEach(function(n){n!=="selectionchange"&&(rx.has(n)||Al(n,!1,t),Al(n,!0,t))});var s=t.nodeType===9?t:t.ownerDocument;s===null||s[Ga]||(s[Ga]=!0,Al("selectionchange",!1,s))}}function Ic(t,s,n,r){switch(Xi(s)){case 1:var i=vp;break;case 4:i=bp;break;default:i=hl}n=i.bind(null,s,n,t),i=void 0,!ol||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(s,n,{capture:!0,passive:i}):t.addEventListener(s,n,!0):i!==void 0?t.addEventListener(s,n,{passive:i}):t.addEventListener(s,n,!1)}function Tl(t,s,n,r,i){var u=r;if((s&1)===0&&(s&2)===0&&r!==null)e:for(;;){if(r===null)return;var g=r.tag;if(g===3||g===4){var C=r.stateNode.containerInfo;if(C===i||C.nodeType===8&&C.parentNode===i)break;if(g===4)for(g=r.return;g!==null;){var A=g.tag;if((A===3||A===4)&&(A=g.stateNode.containerInfo,A===i||A.nodeType===8&&A.parentNode===i))return;g=g.return}for(;C!==null;){if(g=Ts(C),g===null)return;if(A=g.tag,A===5||A===6){r=u=g;continue e}C=C.parentNode}}r=r.return}Li(function(){var W=u,Z=al(n),ee=[];e:{var J=kc.get(t);if(J!==void 0){var oe=yl,de=t;switch(t){case"keypress":if(Oa(n)===0)break e;case"keydown":case"keyup":oe=Fp;break;case"focusin":de="focus",oe=jl;break;case"focusout":de="blur",oe=jl;break;case"beforeblur":case"afterblur":oe=jl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":oe=tc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":oe=Np;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":oe=zp;break;case jc:case wc:case Nc:oe=Cp;break;case Sc:oe=Op;break;case"scroll":oe=jp;break;case"wheel":oe=Up;break;case"copy":case"cut":case"paste":oe=Dp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":oe=nc}var me=(s&4)!==0,Ge=!me&&t==="scroll",z=me?J!==null?J+"Capture":null:J;me=[];for(var F=W,U;F!==null;){U=F;var te=U.stateNode;if(U.tag===5&&te!==null&&(U=te,z!==null&&(te=Ln(F,z),te!=null&&me.push(Zn(F,te,U)))),Ge)break;F=F.return}0<me.length&&(J=new oe(J,de,null,n,Z),ee.push({event:J,listeners:me}))}}if((s&7)===0){e:{if(J=t==="mouseover"||t==="pointerover",oe=t==="mouseout"||t==="pointerout",J&&n!==nl&&(de=n.relatedTarget||n.fromElement)&&(Ts(de)||de[Kt]))break e;if((oe||J)&&(J=Z.window===Z?Z:(J=Z.ownerDocument)?J.defaultView||J.parentWindow:window,oe?(de=n.relatedTarget||n.toElement,oe=W,de=de?Ts(de):null,de!==null&&(Ge=As(de),de!==Ge||de.tag!==5&&de.tag!==6)&&(de=null)):(oe=null,de=W),oe!==de)){if(me=tc,te="onMouseLeave",z="onMouseEnter",F="mouse",(t==="pointerout"||t==="pointerover")&&(me=nc,te="onPointerLeave",z="onPointerEnter",F="pointer"),Ge=oe==null?J:cn(oe),U=de==null?J:cn(de),J=new me(te,F+"leave",oe,n,Z),J.target=Ge,J.relatedTarget=U,te=null,Ts(Z)===W&&(me=new me(z,F+"enter",de,n,Z),me.target=U,me.relatedTarget=Ge,te=me),Ge=te,oe&&de)t:{for(me=oe,z=de,F=0,U=me;U;U=ln(U))F++;for(U=0,te=z;te;te=ln(te))U++;for(;0<F-U;)me=ln(me),F--;for(;0<U-F;)z=ln(z),U--;for(;F--;){if(me===z||z!==null&&me===z.alternate)break t;me=ln(me),z=ln(z)}me=null}else me=null;oe!==null&&Mc(ee,J,oe,me,!1),de!==null&&Ge!==null&&Mc(ee,Ge,de,me,!0)}}e:{if(J=W?cn(W):window,oe=J.nodeName&&J.nodeName.toLowerCase(),oe==="select"||oe==="input"&&J.type==="file")var pe=Yp;else if(cc(J))if(uc)pe=Zp;else{pe=Jp;var fe=Kp}else(oe=J.nodeName)&&oe.toLowerCase()==="input"&&(J.type==="checkbox"||J.type==="radio")&&(pe=Xp);if(pe&&(pe=pe(t,W))){dc(ee,pe,n,Z);break e}fe&&fe(t,J,W),t==="focusout"&&(fe=J._wrapperState)&&fe.controlled&&J.type==="number"&&xe(J,"number",J.value)}switch(fe=W?cn(W):window,t){case"focusin":(cc(fe)||fe.contentEditable==="true")&&(an=fe,El=W,Kn=null);break;case"focusout":Kn=El=an=null;break;case"mousedown":Dl=!0;break;case"contextmenu":case"mouseup":case"dragend":Dl=!1,vc(ee,n,Z);break;case"selectionchange":if(sx)break;case"keydown":case"keyup":vc(ee,n,Z)}var ge;if(Nl)e:{switch(t){case"compositionstart":var ve="onCompositionStart";break e;case"compositionend":ve="onCompositionEnd";break e;case"compositionupdate":ve="onCompositionUpdate";break e}ve=void 0}else nn?oc(t,n)&&(ve="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(ve="onCompositionStart");ve&&(ac&&n.locale!=="ko"&&(nn||ve!=="onCompositionStart"?ve==="onCompositionEnd"&&nn&&(ge=Zi()):(ds=Z,gl="value"in ds?ds.value:ds.textContent,nn=!0)),fe=qa(W,ve),0<fe.length&&(ve=new sc(ve,t,null,n,Z),ee.push({event:ve,listeners:fe}),ge?ve.data=ge:(ge=ic(n),ge!==null&&(ve.data=ge)))),(ge=Hp?Vp(t,n):Gp(t,n))&&(W=qa(W,"onBeforeInput"),0<W.length&&(Z=new sc("onBeforeInput","beforeinput",null,n,Z),ee.push({event:Z,listeners:W}),Z.data=ge))}Dc(ee,s)})}function Zn(t,s,n){return{instance:t,listener:s,currentTarget:n}}function qa(t,s){for(var n=s+"Capture",r=[];t!==null;){var i=t,u=i.stateNode;i.tag===5&&u!==null&&(i=u,u=Ln(t,n),u!=null&&r.unshift(Zn(t,u,i)),u=Ln(t,s),u!=null&&r.push(Zn(t,u,i))),t=t.return}return r}function ln(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Mc(t,s,n,r,i){for(var u=s._reactName,g=[];n!==null&&n!==r;){var C=n,A=C.alternate,W=C.stateNode;if(A!==null&&A===r)break;C.tag===5&&W!==null&&(C=W,i?(A=Ln(n,u),A!=null&&g.unshift(Zn(n,A,C))):i||(A=Ln(n,u),A!=null&&g.push(Zn(n,A,C)))),n=n.return}g.length!==0&&t.push({event:s,listeners:g})}var lx=/\r\n?/g,ox=/\u0000|\uFFFD/g;function Pc(t){return(typeof t=="string"?t:""+t).replace(lx,`
`).replace(ox,"")}function Qa(t,s,n){if(s=Pc(s),Pc(t)!==s&&n)throw Error(o(425))}function Ya(){}var Ll=null,Fl=null;function $l(t,s){return t==="textarea"||t==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Rl=typeof setTimeout=="function"?setTimeout:void 0,ix=typeof clearTimeout=="function"?clearTimeout:void 0,Ac=typeof Promise=="function"?Promise:void 0,cx=typeof queueMicrotask=="function"?queueMicrotask:typeof Ac<"u"?function(t){return Ac.resolve(null).then(t).catch(dx)}:Rl;function dx(t){setTimeout(function(){throw t})}function zl(t,s){var n=s,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Wn(s);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Wn(s)}function ms(t){for(;t!=null;t=t.nextSibling){var s=t.nodeType;if(s===1||s===3)break;if(s===8){if(s=t.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return t}function Tc(t){t=t.previousSibling;for(var s=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(s===0)return t;s--}else n==="/$"&&s++}t=t.previousSibling}return null}var on=Math.random().toString(36).slice(2),Vt="__reactFiber$"+on,ea="__reactProps$"+on,Kt="__reactContainer$"+on,_l="__reactEvents$"+on,ux="__reactListeners$"+on,mx="__reactHandles$"+on;function Ts(t){var s=t[Vt];if(s)return s;for(var n=t.parentNode;n;){if(s=n[Kt]||n[Vt]){if(n=s.alternate,s.child!==null||n!==null&&n.child!==null)for(t=Tc(t);t!==null;){if(n=t[Vt])return n;t=Tc(t)}return s}t=n,n=t.parentNode}return null}function ta(t){return t=t[Vt]||t[Kt],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function cn(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(o(33))}function Ka(t){return t[ea]||null}var Ol=[],dn=-1;function ps(t){return{current:t}}function Fe(t){0>dn||(t.current=Ol[dn],Ol[dn]=null,dn--)}function Ae(t,s){dn++,Ol[dn]=t.current,t.current=s}var xs={},lt=ps(xs),ht=ps(!1),Ls=xs;function un(t,s){var n=t.type.contextTypes;if(!n)return xs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===s)return r.__reactInternalMemoizedMaskedChildContext;var i={},u;for(u in n)i[u]=s[u];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),i}function ft(t){return t=t.childContextTypes,t!=null}function Ja(){Fe(ht),Fe(lt)}function Lc(t,s,n){if(lt.current!==xs)throw Error(o(168));Ae(lt,s),Ae(ht,n)}function Fc(t,s,n){var r=t.stateNode;if(s=s.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in s))throw Error(o(108,je(t)||"Unknown",i));return Y({},n,r)}function Xa(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||xs,Ls=lt.current,Ae(lt,t),Ae(ht,ht.current),!0}function $c(t,s,n){var r=t.stateNode;if(!r)throw Error(o(169));n?(t=Fc(t,s,Ls),r.__reactInternalMemoizedMergedChildContext=t,Fe(ht),Fe(lt),Ae(lt,t)):Fe(ht),Ae(ht,n)}var Jt=null,Za=!1,Bl=!1;function Rc(t){Jt===null?Jt=[t]:Jt.push(t)}function px(t){Za=!0,Rc(t)}function hs(){if(!Bl&&Jt!==null){Bl=!0;var t=0,s=Pe;try{var n=Jt;for(Pe=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Jt=null,Za=!1}catch(i){throw Jt!==null&&(Jt=Jt.slice(t+1)),_i(cl,hs),i}finally{Pe=s,Bl=!1}}return null}var mn=[],pn=0,er=null,tr=0,Et=[],Dt=0,Fs=null,Xt=1,Zt="";function $s(t,s){mn[pn++]=tr,mn[pn++]=er,er=t,tr=s}function zc(t,s,n){Et[Dt++]=Xt,Et[Dt++]=Zt,Et[Dt++]=Fs,Fs=t;var r=Xt;t=Zt;var i=32-Tt(r)-1;r&=~(1<<i),n+=1;var u=32-Tt(s)+i;if(30<u){var g=i-i%5;u=(r&(1<<g)-1).toString(32),r>>=g,i-=g,Xt=1<<32-Tt(s)+i|n<<i|r,Zt=u+t}else Xt=1<<u|n<<i|r,Zt=t}function Ul(t){t.return!==null&&($s(t,1),zc(t,1,0))}function Wl(t){for(;t===er;)er=mn[--pn],mn[pn]=null,tr=mn[--pn],mn[pn]=null;for(;t===Fs;)Fs=Et[--Dt],Et[Dt]=null,Zt=Et[--Dt],Et[Dt]=null,Xt=Et[--Dt],Et[Dt]=null}var St=null,kt=null,_e=!1,Ft=null;function _c(t,s){var n=At(5,null,null,0);n.elementType="DELETED",n.stateNode=s,n.return=t,s=t.deletions,s===null?(t.deletions=[n],t.flags|=16):s.push(n)}function Oc(t,s){switch(t.tag){case 5:var n=t.type;return s=s.nodeType!==1||n.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(t.stateNode=s,St=t,kt=ms(s.firstChild),!0):!1;case 6:return s=t.pendingProps===""||s.nodeType!==3?null:s,s!==null?(t.stateNode=s,St=t,kt=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(n=Fs!==null?{id:Xt,overflow:Zt}:null,t.memoizedState={dehydrated:s,treeContext:n,retryLane:1073741824},n=At(18,null,null,0),n.stateNode=s,n.return=t,t.child=n,St=t,kt=null,!0):!1;default:return!1}}function Hl(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Vl(t){if(_e){var s=kt;if(s){var n=s;if(!Oc(t,s)){if(Hl(t))throw Error(o(418));s=ms(n.nextSibling);var r=St;s&&Oc(t,s)?_c(r,n):(t.flags=t.flags&-4097|2,_e=!1,St=t)}}else{if(Hl(t))throw Error(o(418));t.flags=t.flags&-4097|2,_e=!1,St=t}}}function Bc(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;St=t}function sr(t){if(t!==St)return!1;if(!_e)return Bc(t),_e=!0,!1;var s;if((s=t.tag!==3)&&!(s=t.tag!==5)&&(s=t.type,s=s!=="head"&&s!=="body"&&!$l(t.type,t.memoizedProps)),s&&(s=kt)){if(Hl(t))throw Uc(),Error(o(418));for(;s;)_c(t,s),s=ms(s.nextSibling)}if(Bc(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(317));e:{for(t=t.nextSibling,s=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(s===0){kt=ms(t.nextSibling);break e}s--}else n!=="$"&&n!=="$!"&&n!=="$?"||s++}t=t.nextSibling}kt=null}}else kt=St?ms(t.stateNode.nextSibling):null;return!0}function Uc(){for(var t=kt;t;)t=ms(t.nextSibling)}function xn(){kt=St=null,_e=!1}function Gl(t){Ft===null?Ft=[t]:Ft.push(t)}var xx=$.ReactCurrentBatchConfig;function sa(t,s,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,t));var i=r,u=""+t;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===u?s.ref:(s=function(g){var C=i.refs;g===null?delete C[u]:C[u]=g},s._stringRef=u,s)}if(typeof t!="string")throw Error(o(284));if(!n._owner)throw Error(o(290,t))}return t}function nr(t,s){throw t=Object.prototype.toString.call(s),Error(o(31,t==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":t))}function Wc(t){var s=t._init;return s(t._payload)}function Hc(t){function s(z,F){if(t){var U=z.deletions;U===null?(z.deletions=[F],z.flags|=16):U.push(F)}}function n(z,F){if(!t)return null;for(;F!==null;)s(z,F),F=F.sibling;return null}function r(z,F){for(z=new Map;F!==null;)F.key!==null?z.set(F.key,F):z.set(F.index,F),F=F.sibling;return z}function i(z,F){return z=Ns(z,F),z.index=0,z.sibling=null,z}function u(z,F,U){return z.index=U,t?(U=z.alternate,U!==null?(U=U.index,U<F?(z.flags|=2,F):U):(z.flags|=2,F)):(z.flags|=1048576,F)}function g(z){return t&&z.alternate===null&&(z.flags|=2),z}function C(z,F,U,te){return F===null||F.tag!==6?(F=zo(U,z.mode,te),F.return=z,F):(F=i(F,U),F.return=z,F)}function A(z,F,U,te){var pe=U.type;return pe===k?Z(z,F,U.props.children,te,U.key):F!==null&&(F.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===ne&&Wc(pe)===F.type)?(te=i(F,U.props),te.ref=sa(z,F,U),te.return=z,te):(te=Er(U.type,U.key,U.props,null,z.mode,te),te.ref=sa(z,F,U),te.return=z,te)}function W(z,F,U,te){return F===null||F.tag!==4||F.stateNode.containerInfo!==U.containerInfo||F.stateNode.implementation!==U.implementation?(F=_o(U,z.mode,te),F.return=z,F):(F=i(F,U.children||[]),F.return=z,F)}function Z(z,F,U,te,pe){return F===null||F.tag!==7?(F=Hs(U,z.mode,te,pe),F.return=z,F):(F=i(F,U),F.return=z,F)}function ee(z,F,U){if(typeof F=="string"&&F!==""||typeof F=="number")return F=zo(""+F,z.mode,U),F.return=z,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case P:return U=Er(F.type,F.key,F.props,null,z.mode,U),U.ref=sa(z,null,F),U.return=z,U;case q:return F=_o(F,z.mode,U),F.return=z,F;case ne:var te=F._init;return ee(z,te(F._payload),U)}if(ke(F)||X(F))return F=Hs(F,z.mode,U,null),F.return=z,F;nr(z,F)}return null}function J(z,F,U,te){var pe=F!==null?F.key:null;if(typeof U=="string"&&U!==""||typeof U=="number")return pe!==null?null:C(z,F,""+U,te);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case P:return U.key===pe?A(z,F,U,te):null;case q:return U.key===pe?W(z,F,U,te):null;case ne:return pe=U._init,J(z,F,pe(U._payload),te)}if(ke(U)||X(U))return pe!==null?null:Z(z,F,U,te,null);nr(z,U)}return null}function oe(z,F,U,te,pe){if(typeof te=="string"&&te!==""||typeof te=="number")return z=z.get(U)||null,C(F,z,""+te,pe);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case P:return z=z.get(te.key===null?U:te.key)||null,A(F,z,te,pe);case q:return z=z.get(te.key===null?U:te.key)||null,W(F,z,te,pe);case ne:var fe=te._init;return oe(z,F,U,fe(te._payload),pe)}if(ke(te)||X(te))return z=z.get(U)||null,Z(F,z,te,pe,null);nr(F,te)}return null}function de(z,F,U,te){for(var pe=null,fe=null,ge=F,ve=F=0,Ze=null;ge!==null&&ve<U.length;ve++){ge.index>ve?(Ze=ge,ge=null):Ze=ge.sibling;var Ee=J(z,ge,U[ve],te);if(Ee===null){ge===null&&(ge=Ze);break}t&&ge&&Ee.alternate===null&&s(z,ge),F=u(Ee,F,ve),fe===null?pe=Ee:fe.sibling=Ee,fe=Ee,ge=Ze}if(ve===U.length)return n(z,ge),_e&&$s(z,ve),pe;if(ge===null){for(;ve<U.length;ve++)ge=ee(z,U[ve],te),ge!==null&&(F=u(ge,F,ve),fe===null?pe=ge:fe.sibling=ge,fe=ge);return _e&&$s(z,ve),pe}for(ge=r(z,ge);ve<U.length;ve++)Ze=oe(ge,z,ve,U[ve],te),Ze!==null&&(t&&Ze.alternate!==null&&ge.delete(Ze.key===null?ve:Ze.key),F=u(Ze,F,ve),fe===null?pe=Ze:fe.sibling=Ze,fe=Ze);return t&&ge.forEach(function(Ss){return s(z,Ss)}),_e&&$s(z,ve),pe}function me(z,F,U,te){var pe=X(U);if(typeof pe!="function")throw Error(o(150));if(U=pe.call(U),U==null)throw Error(o(151));for(var fe=pe=null,ge=F,ve=F=0,Ze=null,Ee=U.next();ge!==null&&!Ee.done;ve++,Ee=U.next()){ge.index>ve?(Ze=ge,ge=null):Ze=ge.sibling;var Ss=J(z,ge,Ee.value,te);if(Ss===null){ge===null&&(ge=Ze);break}t&&ge&&Ss.alternate===null&&s(z,ge),F=u(Ss,F,ve),fe===null?pe=Ss:fe.sibling=Ss,fe=Ss,ge=Ze}if(Ee.done)return n(z,ge),_e&&$s(z,ve),pe;if(ge===null){for(;!Ee.done;ve++,Ee=U.next())Ee=ee(z,Ee.value,te),Ee!==null&&(F=u(Ee,F,ve),fe===null?pe=Ee:fe.sibling=Ee,fe=Ee);return _e&&$s(z,ve),pe}for(ge=r(z,ge);!Ee.done;ve++,Ee=U.next())Ee=oe(ge,z,ve,Ee.value,te),Ee!==null&&(t&&Ee.alternate!==null&&ge.delete(Ee.key===null?ve:Ee.key),F=u(Ee,F,ve),fe===null?pe=Ee:fe.sibling=Ee,fe=Ee);return t&&ge.forEach(function(qx){return s(z,qx)}),_e&&$s(z,ve),pe}function Ge(z,F,U,te){if(typeof U=="object"&&U!==null&&U.type===k&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case P:e:{for(var pe=U.key,fe=F;fe!==null;){if(fe.key===pe){if(pe=U.type,pe===k){if(fe.tag===7){n(z,fe.sibling),F=i(fe,U.props.children),F.return=z,z=F;break e}}else if(fe.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===ne&&Wc(pe)===fe.type){n(z,fe.sibling),F=i(fe,U.props),F.ref=sa(z,fe,U),F.return=z,z=F;break e}n(z,fe);break}else s(z,fe);fe=fe.sibling}U.type===k?(F=Hs(U.props.children,z.mode,te,U.key),F.return=z,z=F):(te=Er(U.type,U.key,U.props,null,z.mode,te),te.ref=sa(z,F,U),te.return=z,z=te)}return g(z);case q:e:{for(fe=U.key;F!==null;){if(F.key===fe)if(F.tag===4&&F.stateNode.containerInfo===U.containerInfo&&F.stateNode.implementation===U.implementation){n(z,F.sibling),F=i(F,U.children||[]),F.return=z,z=F;break e}else{n(z,F);break}else s(z,F);F=F.sibling}F=_o(U,z.mode,te),F.return=z,z=F}return g(z);case ne:return fe=U._init,Ge(z,F,fe(U._payload),te)}if(ke(U))return de(z,F,U,te);if(X(U))return me(z,F,U,te);nr(z,U)}return typeof U=="string"&&U!==""||typeof U=="number"?(U=""+U,F!==null&&F.tag===6?(n(z,F.sibling),F=i(F,U),F.return=z,z=F):(n(z,F),F=zo(U,z.mode,te),F.return=z,z=F),g(z)):n(z,F)}return Ge}var hn=Hc(!0),Vc=Hc(!1),ar=ps(null),rr=null,fn=null,ql=null;function Ql(){ql=fn=rr=null}function Yl(t){var s=ar.current;Fe(ar),t._currentValue=s}function Kl(t,s,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&s)!==s?(t.childLanes|=s,r!==null&&(r.childLanes|=s)):r!==null&&(r.childLanes&s)!==s&&(r.childLanes|=s),t===n)break;t=t.return}}function gn(t,s){rr=t,ql=fn=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&s)!==0&&(gt=!0),t.firstContext=null)}function It(t){var s=t._currentValue;if(ql!==t)if(t={context:t,memoizedValue:s,next:null},fn===null){if(rr===null)throw Error(o(308));fn=t,rr.dependencies={lanes:0,firstContext:t}}else fn=fn.next=t;return s}var Rs=null;function Jl(t){Rs===null?Rs=[t]:Rs.push(t)}function Gc(t,s,n,r){var i=s.interleaved;return i===null?(n.next=n,Jl(s)):(n.next=i.next,i.next=n),s.interleaved=n,es(t,r)}function es(t,s){t.lanes|=s;var n=t.alternate;for(n!==null&&(n.lanes|=s),n=t,t=t.return;t!==null;)t.childLanes|=s,n=t.alternate,n!==null&&(n.childLanes|=s),n=t,t=t.return;return n.tag===3?n.stateNode:null}var fs=!1;function Xl(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function qc(t,s){t=t.updateQueue,s.updateQueue===t&&(s.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ts(t,s){return{eventTime:t,lane:s,tag:0,payload:null,callback:null,next:null}}function gs(t,s,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,(Ce&2)!==0){var i=r.pending;return i===null?s.next=s:(s.next=i.next,i.next=s),r.pending=s,es(t,n)}return i=r.interleaved,i===null?(s.next=s,Jl(r)):(s.next=i.next,i.next=s),r.interleaved=s,es(t,n)}function lr(t,s,n){if(s=s.updateQueue,s!==null&&(s=s.shared,(n&4194240)!==0)){var r=s.lanes;r&=t.pendingLanes,n|=r,s.lanes=n,ml(t,n)}}function Qc(t,s){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,u=null;if(n=n.firstBaseUpdate,n!==null){do{var g={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};u===null?i=u=g:u=u.next=g,n=n.next}while(n!==null);u===null?i=u=s:u=u.next=s}else i=u=s;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:u,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=s:t.next=s,n.lastBaseUpdate=s}function or(t,s,n,r){var i=t.updateQueue;fs=!1;var u=i.firstBaseUpdate,g=i.lastBaseUpdate,C=i.shared.pending;if(C!==null){i.shared.pending=null;var A=C,W=A.next;A.next=null,g===null?u=W:g.next=W,g=A;var Z=t.alternate;Z!==null&&(Z=Z.updateQueue,C=Z.lastBaseUpdate,C!==g&&(C===null?Z.firstBaseUpdate=W:C.next=W,Z.lastBaseUpdate=A))}if(u!==null){var ee=i.baseState;g=0,Z=W=A=null,C=u;do{var J=C.lane,oe=C.eventTime;if((r&J)===J){Z!==null&&(Z=Z.next={eventTime:oe,lane:0,tag:C.tag,payload:C.payload,callback:C.callback,next:null});e:{var de=t,me=C;switch(J=s,oe=n,me.tag){case 1:if(de=me.payload,typeof de=="function"){ee=de.call(oe,ee,J);break e}ee=de;break e;case 3:de.flags=de.flags&-65537|128;case 0:if(de=me.payload,J=typeof de=="function"?de.call(oe,ee,J):de,J==null)break e;ee=Y({},ee,J);break e;case 2:fs=!0}}C.callback!==null&&C.lane!==0&&(t.flags|=64,J=i.effects,J===null?i.effects=[C]:J.push(C))}else oe={eventTime:oe,lane:J,tag:C.tag,payload:C.payload,callback:C.callback,next:null},Z===null?(W=Z=oe,A=ee):Z=Z.next=oe,g|=J;if(C=C.next,C===null){if(C=i.shared.pending,C===null)break;J=C,C=J.next,J.next=null,i.lastBaseUpdate=J,i.shared.pending=null}}while(!0);if(Z===null&&(A=ee),i.baseState=A,i.firstBaseUpdate=W,i.lastBaseUpdate=Z,s=i.shared.interleaved,s!==null){i=s;do g|=i.lane,i=i.next;while(i!==s)}else u===null&&(i.shared.lanes=0);Os|=g,t.lanes=g,t.memoizedState=ee}}function Yc(t,s,n){if(t=s.effects,s.effects=null,t!==null)for(s=0;s<t.length;s++){var r=t[s],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(o(191,i));i.call(r)}}}var na={},Gt=ps(na),aa=ps(na),ra=ps(na);function zs(t){if(t===na)throw Error(o(174));return t}function Zl(t,s){switch(Ae(ra,s),Ae(aa,t),Ae(Gt,na),t=s.nodeType,t){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:el(null,"");break;default:t=t===8?s.parentNode:s,s=t.namespaceURI||null,t=t.tagName,s=el(s,t)}Fe(Gt),Ae(Gt,s)}function yn(){Fe(Gt),Fe(aa),Fe(ra)}function Kc(t){zs(ra.current);var s=zs(Gt.current),n=el(s,t.type);s!==n&&(Ae(aa,t),Ae(Gt,n))}function eo(t){aa.current===t&&(Fe(Gt),Fe(aa))}var Oe=ps(0);function ir(t){for(var s=t;s!==null;){if(s.tag===13){var n=s.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var to=[];function so(){for(var t=0;t<to.length;t++)to[t]._workInProgressVersionPrimary=null;to.length=0}var cr=$.ReactCurrentDispatcher,no=$.ReactCurrentBatchConfig,_s=0,Be=null,Ye=null,Je=null,dr=!1,la=!1,oa=0,hx=0;function ot(){throw Error(o(321))}function ao(t,s){if(s===null)return!1;for(var n=0;n<s.length&&n<t.length;n++)if(!Lt(t[n],s[n]))return!1;return!0}function ro(t,s,n,r,i,u){if(_s=u,Be=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,cr.current=t===null||t.memoizedState===null?vx:bx,t=n(r,i),la){u=0;do{if(la=!1,oa=0,25<=u)throw Error(o(301));u+=1,Je=Ye=null,s.updateQueue=null,cr.current=jx,t=n(r,i)}while(la)}if(cr.current=pr,s=Ye!==null&&Ye.next!==null,_s=0,Je=Ye=Be=null,dr=!1,s)throw Error(o(300));return t}function lo(){var t=oa!==0;return oa=0,t}function qt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Je===null?Be.memoizedState=Je=t:Je=Je.next=t,Je}function Mt(){if(Ye===null){var t=Be.alternate;t=t!==null?t.memoizedState:null}else t=Ye.next;var s=Je===null?Be.memoizedState:Je.next;if(s!==null)Je=s,Ye=t;else{if(t===null)throw Error(o(310));Ye=t,t={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},Je===null?Be.memoizedState=Je=t:Je=Je.next=t}return Je}function ia(t,s){return typeof s=="function"?s(t):s}function oo(t){var s=Mt(),n=s.queue;if(n===null)throw Error(o(311));n.lastRenderedReducer=t;var r=Ye,i=r.baseQueue,u=n.pending;if(u!==null){if(i!==null){var g=i.next;i.next=u.next,u.next=g}r.baseQueue=i=u,n.pending=null}if(i!==null){u=i.next,r=r.baseState;var C=g=null,A=null,W=u;do{var Z=W.lane;if((_s&Z)===Z)A!==null&&(A=A.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),r=W.hasEagerState?W.eagerState:t(r,W.action);else{var ee={lane:Z,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};A===null?(C=A=ee,g=r):A=A.next=ee,Be.lanes|=Z,Os|=Z}W=W.next}while(W!==null&&W!==u);A===null?g=r:A.next=C,Lt(r,s.memoizedState)||(gt=!0),s.memoizedState=r,s.baseState=g,s.baseQueue=A,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do u=i.lane,Be.lanes|=u,Os|=u,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[s.memoizedState,n.dispatch]}function io(t){var s=Mt(),n=s.queue;if(n===null)throw Error(o(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,u=s.memoizedState;if(i!==null){n.pending=null;var g=i=i.next;do u=t(u,g.action),g=g.next;while(g!==i);Lt(u,s.memoizedState)||(gt=!0),s.memoizedState=u,s.baseQueue===null&&(s.baseState=u),n.lastRenderedState=u}return[u,r]}function Jc(){}function Xc(t,s){var n=Be,r=Mt(),i=s(),u=!Lt(r.memoizedState,i);if(u&&(r.memoizedState=i,gt=!0),r=r.queue,co(td.bind(null,n,r,t),[t]),r.getSnapshot!==s||u||Je!==null&&Je.memoizedState.tag&1){if(n.flags|=2048,ca(9,ed.bind(null,n,r,i,s),void 0,null),Xe===null)throw Error(o(349));(_s&30)!==0||Zc(n,s,i)}return i}function Zc(t,s,n){t.flags|=16384,t={getSnapshot:s,value:n},s=Be.updateQueue,s===null?(s={lastEffect:null,stores:null},Be.updateQueue=s,s.stores=[t]):(n=s.stores,n===null?s.stores=[t]:n.push(t))}function ed(t,s,n,r){s.value=n,s.getSnapshot=r,sd(s)&&nd(t)}function td(t,s,n){return n(function(){sd(s)&&nd(t)})}function sd(t){var s=t.getSnapshot;t=t.value;try{var n=s();return!Lt(t,n)}catch{return!0}}function nd(t){var s=es(t,1);s!==null&&_t(s,t,1,-1)}function ad(t){var s=qt();return typeof t=="function"&&(t=t()),s.memoizedState=s.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ia,lastRenderedState:t},s.queue=t,t=t.dispatch=yx.bind(null,Be,t),[s.memoizedState,t]}function ca(t,s,n,r){return t={tag:t,create:s,destroy:n,deps:r,next:null},s=Be.updateQueue,s===null?(s={lastEffect:null,stores:null},Be.updateQueue=s,s.lastEffect=t.next=t):(n=s.lastEffect,n===null?s.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,s.lastEffect=t)),t}function rd(){return Mt().memoizedState}function ur(t,s,n,r){var i=qt();Be.flags|=t,i.memoizedState=ca(1|s,n,void 0,r===void 0?null:r)}function mr(t,s,n,r){var i=Mt();r=r===void 0?null:r;var u=void 0;if(Ye!==null){var g=Ye.memoizedState;if(u=g.destroy,r!==null&&ao(r,g.deps)){i.memoizedState=ca(s,n,u,r);return}}Be.flags|=t,i.memoizedState=ca(1|s,n,u,r)}function ld(t,s){return ur(8390656,8,t,s)}function co(t,s){return mr(2048,8,t,s)}function od(t,s){return mr(4,2,t,s)}function id(t,s){return mr(4,4,t,s)}function cd(t,s){if(typeof s=="function")return t=t(),s(t),function(){s(null)};if(s!=null)return t=t(),s.current=t,function(){s.current=null}}function dd(t,s,n){return n=n!=null?n.concat([t]):null,mr(4,4,cd.bind(null,s,t),n)}function uo(){}function ud(t,s){var n=Mt();s=s===void 0?null:s;var r=n.memoizedState;return r!==null&&s!==null&&ao(s,r[1])?r[0]:(n.memoizedState=[t,s],t)}function md(t,s){var n=Mt();s=s===void 0?null:s;var r=n.memoizedState;return r!==null&&s!==null&&ao(s,r[1])?r[0]:(t=t(),n.memoizedState=[t,s],t)}function pd(t,s,n){return(_s&21)===0?(t.baseState&&(t.baseState=!1,gt=!0),t.memoizedState=n):(Lt(n,s)||(n=Wi(),Be.lanes|=n,Os|=n,t.baseState=!0),s)}function fx(t,s){var n=Pe;Pe=n!==0&&4>n?n:4,t(!0);var r=no.transition;no.transition={};try{t(!1),s()}finally{Pe=n,no.transition=r}}function xd(){return Mt().memoizedState}function gx(t,s,n){var r=js(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},hd(t))fd(s,n);else if(n=Gc(t,s,n,r),n!==null){var i=xt();_t(n,t,r,i),gd(n,s,r)}}function yx(t,s,n){var r=js(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(hd(t))fd(s,i);else{var u=t.alternate;if(t.lanes===0&&(u===null||u.lanes===0)&&(u=s.lastRenderedReducer,u!==null))try{var g=s.lastRenderedState,C=u(g,n);if(i.hasEagerState=!0,i.eagerState=C,Lt(C,g)){var A=s.interleaved;A===null?(i.next=i,Jl(s)):(i.next=A.next,A.next=i),s.interleaved=i;return}}catch{}n=Gc(t,s,i,r),n!==null&&(i=xt(),_t(n,t,r,i),gd(n,s,r))}}function hd(t){var s=t.alternate;return t===Be||s!==null&&s===Be}function fd(t,s){la=dr=!0;var n=t.pending;n===null?s.next=s:(s.next=n.next,n.next=s),t.pending=s}function gd(t,s,n){if((n&4194240)!==0){var r=s.lanes;r&=t.pendingLanes,n|=r,s.lanes=n,ml(t,n)}}var pr={readContext:It,useCallback:ot,useContext:ot,useEffect:ot,useImperativeHandle:ot,useInsertionEffect:ot,useLayoutEffect:ot,useMemo:ot,useReducer:ot,useRef:ot,useState:ot,useDebugValue:ot,useDeferredValue:ot,useTransition:ot,useMutableSource:ot,useSyncExternalStore:ot,useId:ot,unstable_isNewReconciler:!1},vx={readContext:It,useCallback:function(t,s){return qt().memoizedState=[t,s===void 0?null:s],t},useContext:It,useEffect:ld,useImperativeHandle:function(t,s,n){return n=n!=null?n.concat([t]):null,ur(4194308,4,cd.bind(null,s,t),n)},useLayoutEffect:function(t,s){return ur(4194308,4,t,s)},useInsertionEffect:function(t,s){return ur(4,2,t,s)},useMemo:function(t,s){var n=qt();return s=s===void 0?null:s,t=t(),n.memoizedState=[t,s],t},useReducer:function(t,s,n){var r=qt();return s=n!==void 0?n(s):s,r.memoizedState=r.baseState=s,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:s},r.queue=t,t=t.dispatch=gx.bind(null,Be,t),[r.memoizedState,t]},useRef:function(t){var s=qt();return t={current:t},s.memoizedState=t},useState:ad,useDebugValue:uo,useDeferredValue:function(t){return qt().memoizedState=t},useTransition:function(){var t=ad(!1),s=t[0];return t=fx.bind(null,t[1]),qt().memoizedState=t,[s,t]},useMutableSource:function(){},useSyncExternalStore:function(t,s,n){var r=Be,i=qt();if(_e){if(n===void 0)throw Error(o(407));n=n()}else{if(n=s(),Xe===null)throw Error(o(349));(_s&30)!==0||Zc(r,s,n)}i.memoizedState=n;var u={value:n,getSnapshot:s};return i.queue=u,ld(td.bind(null,r,u,t),[t]),r.flags|=2048,ca(9,ed.bind(null,r,u,n,s),void 0,null),n},useId:function(){var t=qt(),s=Xe.identifierPrefix;if(_e){var n=Zt,r=Xt;n=(r&~(1<<32-Tt(r)-1)).toString(32)+n,s=":"+s+"R"+n,n=oa++,0<n&&(s+="H"+n.toString(32)),s+=":"}else n=hx++,s=":"+s+"r"+n.toString(32)+":";return t.memoizedState=s},unstable_isNewReconciler:!1},bx={readContext:It,useCallback:ud,useContext:It,useEffect:co,useImperativeHandle:dd,useInsertionEffect:od,useLayoutEffect:id,useMemo:md,useReducer:oo,useRef:rd,useState:function(){return oo(ia)},useDebugValue:uo,useDeferredValue:function(t){var s=Mt();return pd(s,Ye.memoizedState,t)},useTransition:function(){var t=oo(ia)[0],s=Mt().memoizedState;return[t,s]},useMutableSource:Jc,useSyncExternalStore:Xc,useId:xd,unstable_isNewReconciler:!1},jx={readContext:It,useCallback:ud,useContext:It,useEffect:co,useImperativeHandle:dd,useInsertionEffect:od,useLayoutEffect:id,useMemo:md,useReducer:io,useRef:rd,useState:function(){return io(ia)},useDebugValue:uo,useDeferredValue:function(t){var s=Mt();return Ye===null?s.memoizedState=t:pd(s,Ye.memoizedState,t)},useTransition:function(){var t=io(ia)[0],s=Mt().memoizedState;return[t,s]},useMutableSource:Jc,useSyncExternalStore:Xc,useId:xd,unstable_isNewReconciler:!1};function $t(t,s){if(t&&t.defaultProps){s=Y({},s),t=t.defaultProps;for(var n in t)s[n]===void 0&&(s[n]=t[n]);return s}return s}function mo(t,s,n,r){s=t.memoizedState,n=n(r,s),n=n==null?s:Y({},s,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var xr={isMounted:function(t){return(t=t._reactInternals)?As(t)===t:!1},enqueueSetState:function(t,s,n){t=t._reactInternals;var r=xt(),i=js(t),u=ts(r,i);u.payload=s,n!=null&&(u.callback=n),s=gs(t,u,i),s!==null&&(_t(s,t,i,r),lr(s,t,i))},enqueueReplaceState:function(t,s,n){t=t._reactInternals;var r=xt(),i=js(t),u=ts(r,i);u.tag=1,u.payload=s,n!=null&&(u.callback=n),s=gs(t,u,i),s!==null&&(_t(s,t,i,r),lr(s,t,i))},enqueueForceUpdate:function(t,s){t=t._reactInternals;var n=xt(),r=js(t),i=ts(n,r);i.tag=2,s!=null&&(i.callback=s),s=gs(t,i,r),s!==null&&(_t(s,t,r,n),lr(s,t,r))}};function yd(t,s,n,r,i,u,g){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,u,g):s.prototype&&s.prototype.isPureReactComponent?!Yn(n,r)||!Yn(i,u):!0}function vd(t,s,n){var r=!1,i=xs,u=s.contextType;return typeof u=="object"&&u!==null?u=It(u):(i=ft(s)?Ls:lt.current,r=s.contextTypes,u=(r=r!=null)?un(t,i):xs),s=new s(n,u),t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=xr,t.stateNode=s,s._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=u),s}function bd(t,s,n,r){t=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(n,r),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(n,r),s.state!==t&&xr.enqueueReplaceState(s,s.state,null)}function po(t,s,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Xl(t);var u=s.contextType;typeof u=="object"&&u!==null?i.context=It(u):(u=ft(s)?Ls:lt.current,i.context=un(t,u)),i.state=t.memoizedState,u=s.getDerivedStateFromProps,typeof u=="function"&&(mo(t,s,u,n),i.state=t.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(s=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),s!==i.state&&xr.enqueueReplaceState(i,i.state,null),or(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function vn(t,s){try{var n="",r=s;do n+=be(r),r=r.return;while(r);var i=n}catch(u){i=`
Error generating stack: `+u.message+`
`+u.stack}return{value:t,source:s,stack:i,digest:null}}function xo(t,s,n){return{value:t,source:null,stack:n??null,digest:s??null}}function ho(t,s){try{console.error(s.value)}catch(n){setTimeout(function(){throw n})}}var wx=typeof WeakMap=="function"?WeakMap:Map;function jd(t,s,n){n=ts(-1,n),n.tag=3,n.payload={element:null};var r=s.value;return n.callback=function(){jr||(jr=!0,Mo=r),ho(t,s)},n}function wd(t,s,n){n=ts(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=s.value;n.payload=function(){return r(i)},n.callback=function(){ho(t,s)}}var u=t.stateNode;return u!==null&&typeof u.componentDidCatch=="function"&&(n.callback=function(){ho(t,s),typeof r!="function"&&(vs===null?vs=new Set([this]):vs.add(this));var g=s.stack;this.componentDidCatch(s.value,{componentStack:g!==null?g:""})}),n}function Nd(t,s,n){var r=t.pingCache;if(r===null){r=t.pingCache=new wx;var i=new Set;r.set(s,i)}else i=r.get(s),i===void 0&&(i=new Set,r.set(s,i));i.has(n)||(i.add(n),t=$x.bind(null,t,s,n),s.then(t,t))}function Sd(t){do{var s;if((s=t.tag===13)&&(s=t.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return t;t=t.return}while(t!==null);return null}function kd(t,s,n,r,i){return(t.mode&1)===0?(t===s?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(s=ts(-1,1),s.tag=2,gs(n,s,1))),n.lanes|=1),t):(t.flags|=65536,t.lanes=i,t)}var Nx=$.ReactCurrentOwner,gt=!1;function pt(t,s,n,r){s.child=t===null?Vc(s,null,n,r):hn(s,t.child,n,r)}function Cd(t,s,n,r,i){n=n.render;var u=s.ref;return gn(s,i),r=ro(t,s,n,r,u,i),n=lo(),t!==null&&!gt?(s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~i,ss(t,s,i)):(_e&&n&&Ul(s),s.flags|=1,pt(t,s,r,i),s.child)}function Ed(t,s,n,r,i){if(t===null){var u=n.type;return typeof u=="function"&&!Ro(u)&&u.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(s.tag=15,s.type=u,Dd(t,s,u,r,i)):(t=Er(n.type,null,r,s,s.mode,i),t.ref=s.ref,t.return=s,s.child=t)}if(u=t.child,(t.lanes&i)===0){var g=u.memoizedProps;if(n=n.compare,n=n!==null?n:Yn,n(g,r)&&t.ref===s.ref)return ss(t,s,i)}return s.flags|=1,t=Ns(u,r),t.ref=s.ref,t.return=s,s.child=t}function Dd(t,s,n,r,i){if(t!==null){var u=t.memoizedProps;if(Yn(u,r)&&t.ref===s.ref)if(gt=!1,s.pendingProps=r=u,(t.lanes&i)!==0)(t.flags&131072)!==0&&(gt=!0);else return s.lanes=t.lanes,ss(t,s,i)}return fo(t,s,n,r,i)}function Id(t,s,n){var r=s.pendingProps,i=r.children,u=t!==null?t.memoizedState:null;if(r.mode==="hidden")if((s.mode&1)===0)s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ae(jn,Ct),Ct|=n;else{if((n&1073741824)===0)return t=u!==null?u.baseLanes|n:n,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:t,cachePool:null,transitions:null},s.updateQueue=null,Ae(jn,Ct),Ct|=t,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=u!==null?u.baseLanes:n,Ae(jn,Ct),Ct|=r}else u!==null?(r=u.baseLanes|n,s.memoizedState=null):r=n,Ae(jn,Ct),Ct|=r;return pt(t,s,i,n),s.child}function Md(t,s){var n=s.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(s.flags|=512,s.flags|=2097152)}function fo(t,s,n,r,i){var u=ft(n)?Ls:lt.current;return u=un(s,u),gn(s,i),n=ro(t,s,n,r,u,i),r=lo(),t!==null&&!gt?(s.updateQueue=t.updateQueue,s.flags&=-2053,t.lanes&=~i,ss(t,s,i)):(_e&&r&&Ul(s),s.flags|=1,pt(t,s,n,i),s.child)}function Pd(t,s,n,r,i){if(ft(n)){var u=!0;Xa(s)}else u=!1;if(gn(s,i),s.stateNode===null)fr(t,s),vd(s,n,r),po(s,n,r,i),r=!0;else if(t===null){var g=s.stateNode,C=s.memoizedProps;g.props=C;var A=g.context,W=n.contextType;typeof W=="object"&&W!==null?W=It(W):(W=ft(n)?Ls:lt.current,W=un(s,W));var Z=n.getDerivedStateFromProps,ee=typeof Z=="function"||typeof g.getSnapshotBeforeUpdate=="function";ee||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(C!==r||A!==W)&&bd(s,g,r,W),fs=!1;var J=s.memoizedState;g.state=J,or(s,r,g,i),A=s.memoizedState,C!==r||J!==A||ht.current||fs?(typeof Z=="function"&&(mo(s,n,Z,r),A=s.memoizedState),(C=fs||yd(s,n,C,r,J,A,W))?(ee||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(s.flags|=4194308)):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=r,s.memoizedState=A),g.props=r,g.state=A,g.context=W,r=C):(typeof g.componentDidMount=="function"&&(s.flags|=4194308),r=!1)}else{g=s.stateNode,qc(t,s),C=s.memoizedProps,W=s.type===s.elementType?C:$t(s.type,C),g.props=W,ee=s.pendingProps,J=g.context,A=n.contextType,typeof A=="object"&&A!==null?A=It(A):(A=ft(n)?Ls:lt.current,A=un(s,A));var oe=n.getDerivedStateFromProps;(Z=typeof oe=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(C!==ee||J!==A)&&bd(s,g,r,A),fs=!1,J=s.memoizedState,g.state=J,or(s,r,g,i);var de=s.memoizedState;C!==ee||J!==de||ht.current||fs?(typeof oe=="function"&&(mo(s,n,oe,r),de=s.memoizedState),(W=fs||yd(s,n,W,r,J,de,A)||!1)?(Z||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(r,de,A),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(r,de,A)),typeof g.componentDidUpdate=="function"&&(s.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof g.componentDidUpdate!="function"||C===t.memoizedProps&&J===t.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||C===t.memoizedProps&&J===t.memoizedState||(s.flags|=1024),s.memoizedProps=r,s.memoizedState=de),g.props=r,g.state=de,g.context=A,r=W):(typeof g.componentDidUpdate!="function"||C===t.memoizedProps&&J===t.memoizedState||(s.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||C===t.memoizedProps&&J===t.memoizedState||(s.flags|=1024),r=!1)}return go(t,s,n,r,u,i)}function go(t,s,n,r,i,u){Md(t,s);var g=(s.flags&128)!==0;if(!r&&!g)return i&&$c(s,n,!1),ss(t,s,u);r=s.stateNode,Nx.current=s;var C=g&&typeof n.getDerivedStateFromError!="function"?null:r.render();return s.flags|=1,t!==null&&g?(s.child=hn(s,t.child,null,u),s.child=hn(s,null,C,u)):pt(t,s,C,u),s.memoizedState=r.state,i&&$c(s,n,!0),s.child}function Ad(t){var s=t.stateNode;s.pendingContext?Lc(t,s.pendingContext,s.pendingContext!==s.context):s.context&&Lc(t,s.context,!1),Zl(t,s.containerInfo)}function Td(t,s,n,r,i){return xn(),Gl(i),s.flags|=256,pt(t,s,n,r),s.child}var yo={dehydrated:null,treeContext:null,retryLane:0};function vo(t){return{baseLanes:t,cachePool:null,transitions:null}}function Ld(t,s,n){var r=s.pendingProps,i=Oe.current,u=!1,g=(s.flags&128)!==0,C;if((C=g)||(C=t!==null&&t.memoizedState===null?!1:(i&2)!==0),C?(u=!0,s.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Ae(Oe,i&1),t===null)return Vl(s),t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((s.mode&1)===0?s.lanes=1:t.data==="$!"?s.lanes=8:s.lanes=1073741824,null):(g=r.children,t=r.fallback,u?(r=s.mode,u=s.child,g={mode:"hidden",children:g},(r&1)===0&&u!==null?(u.childLanes=0,u.pendingProps=g):u=Dr(g,r,0,null),t=Hs(t,r,n,null),u.return=s,t.return=s,u.sibling=t,s.child=u,s.child.memoizedState=vo(n),s.memoizedState=yo,t):bo(s,g));if(i=t.memoizedState,i!==null&&(C=i.dehydrated,C!==null))return Sx(t,s,g,r,C,i,n);if(u){u=r.fallback,g=s.mode,i=t.child,C=i.sibling;var A={mode:"hidden",children:r.children};return(g&1)===0&&s.child!==i?(r=s.child,r.childLanes=0,r.pendingProps=A,s.deletions=null):(r=Ns(i,A),r.subtreeFlags=i.subtreeFlags&14680064),C!==null?u=Ns(C,u):(u=Hs(u,g,n,null),u.flags|=2),u.return=s,r.return=s,r.sibling=u,s.child=r,r=u,u=s.child,g=t.child.memoizedState,g=g===null?vo(n):{baseLanes:g.baseLanes|n,cachePool:null,transitions:g.transitions},u.memoizedState=g,u.childLanes=t.childLanes&~n,s.memoizedState=yo,r}return u=t.child,t=u.sibling,r=Ns(u,{mode:"visible",children:r.children}),(s.mode&1)===0&&(r.lanes=n),r.return=s,r.sibling=null,t!==null&&(n=s.deletions,n===null?(s.deletions=[t],s.flags|=16):n.push(t)),s.child=r,s.memoizedState=null,r}function bo(t,s){return s=Dr({mode:"visible",children:s},t.mode,0,null),s.return=t,t.child=s}function hr(t,s,n,r){return r!==null&&Gl(r),hn(s,t.child,null,n),t=bo(s,s.pendingProps.children),t.flags|=2,s.memoizedState=null,t}function Sx(t,s,n,r,i,u,g){if(n)return s.flags&256?(s.flags&=-257,r=xo(Error(o(422))),hr(t,s,g,r)):s.memoizedState!==null?(s.child=t.child,s.flags|=128,null):(u=r.fallback,i=s.mode,r=Dr({mode:"visible",children:r.children},i,0,null),u=Hs(u,i,g,null),u.flags|=2,r.return=s,u.return=s,r.sibling=u,s.child=r,(s.mode&1)!==0&&hn(s,t.child,null,g),s.child.memoizedState=vo(g),s.memoizedState=yo,u);if((s.mode&1)===0)return hr(t,s,g,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var C=r.dgst;return r=C,u=Error(o(419)),r=xo(u,r,void 0),hr(t,s,g,r)}if(C=(g&t.childLanes)!==0,gt||C){if(r=Xe,r!==null){switch(g&-g){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=(i&(r.suspendedLanes|g))!==0?0:i,i!==0&&i!==u.retryLane&&(u.retryLane=i,es(t,i),_t(r,t,i,-1))}return $o(),r=xo(Error(o(421))),hr(t,s,g,r)}return i.data==="$?"?(s.flags|=128,s.child=t.child,s=Rx.bind(null,t),i._reactRetry=s,null):(t=u.treeContext,kt=ms(i.nextSibling),St=s,_e=!0,Ft=null,t!==null&&(Et[Dt++]=Xt,Et[Dt++]=Zt,Et[Dt++]=Fs,Xt=t.id,Zt=t.overflow,Fs=s),s=bo(s,r.children),s.flags|=4096,s)}function Fd(t,s,n){t.lanes|=s;var r=t.alternate;r!==null&&(r.lanes|=s),Kl(t.return,s,n)}function jo(t,s,n,r,i){var u=t.memoizedState;u===null?t.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(u.isBackwards=s,u.rendering=null,u.renderingStartTime=0,u.last=r,u.tail=n,u.tailMode=i)}function $d(t,s,n){var r=s.pendingProps,i=r.revealOrder,u=r.tail;if(pt(t,s,r.children,n),r=Oe.current,(r&2)!==0)r=r&1|2,s.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=s.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Fd(t,n,s);else if(t.tag===19)Fd(t,n,s);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===s)break e;for(;t.sibling===null;){if(t.return===null||t.return===s)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ae(Oe,r),(s.mode&1)===0)s.memoizedState=null;else switch(i){case"forwards":for(n=s.child,i=null;n!==null;)t=n.alternate,t!==null&&ir(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=s.child,s.child=null):(i=n.sibling,n.sibling=null),jo(s,!1,i,n,u);break;case"backwards":for(n=null,i=s.child,s.child=null;i!==null;){if(t=i.alternate,t!==null&&ir(t)===null){s.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}jo(s,!0,n,null,u);break;case"together":jo(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function fr(t,s){(s.mode&1)===0&&t!==null&&(t.alternate=null,s.alternate=null,s.flags|=2)}function ss(t,s,n){if(t!==null&&(s.dependencies=t.dependencies),Os|=s.lanes,(n&s.childLanes)===0)return null;if(t!==null&&s.child!==t.child)throw Error(o(153));if(s.child!==null){for(t=s.child,n=Ns(t,t.pendingProps),s.child=n,n.return=s;t.sibling!==null;)t=t.sibling,n=n.sibling=Ns(t,t.pendingProps),n.return=s;n.sibling=null}return s.child}function kx(t,s,n){switch(s.tag){case 3:Ad(s),xn();break;case 5:Kc(s);break;case 1:ft(s.type)&&Xa(s);break;case 4:Zl(s,s.stateNode.containerInfo);break;case 10:var r=s.type._context,i=s.memoizedProps.value;Ae(ar,r._currentValue),r._currentValue=i;break;case 13:if(r=s.memoizedState,r!==null)return r.dehydrated!==null?(Ae(Oe,Oe.current&1),s.flags|=128,null):(n&s.child.childLanes)!==0?Ld(t,s,n):(Ae(Oe,Oe.current&1),t=ss(t,s,n),t!==null?t.sibling:null);Ae(Oe,Oe.current&1);break;case 19:if(r=(n&s.childLanes)!==0,(t.flags&128)!==0){if(r)return $d(t,s,n);s.flags|=128}if(i=s.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ae(Oe,Oe.current),r)break;return null;case 22:case 23:return s.lanes=0,Id(t,s,n)}return ss(t,s,n)}var Rd,wo,zd,_d;Rd=function(t,s){for(var n=s.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break;for(;n.sibling===null;){if(n.return===null||n.return===s)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},wo=function(){},zd=function(t,s,n,r){var i=t.memoizedProps;if(i!==r){t=s.stateNode,zs(Gt.current);var u=null;switch(n){case"input":i=Ut(t,i),r=Ut(t,r),u=[];break;case"select":i=Y({},i,{value:void 0}),r=Y({},r,{value:void 0}),u=[];break;case"textarea":i=Wt(t,i),r=Wt(t,r),u=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ya)}tl(n,r);var g;n=null;for(W in i)if(!r.hasOwnProperty(W)&&i.hasOwnProperty(W)&&i[W]!=null)if(W==="style"){var C=i[W];for(g in C)C.hasOwnProperty(g)&&(n||(n={}),n[g]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(d.hasOwnProperty(W)?u||(u=[]):(u=u||[]).push(W,null));for(W in r){var A=r[W];if(C=i?.[W],r.hasOwnProperty(W)&&A!==C&&(A!=null||C!=null))if(W==="style")if(C){for(g in C)!C.hasOwnProperty(g)||A&&A.hasOwnProperty(g)||(n||(n={}),n[g]="");for(g in A)A.hasOwnProperty(g)&&C[g]!==A[g]&&(n||(n={}),n[g]=A[g])}else n||(u||(u=[]),u.push(W,n)),n=A;else W==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,C=C?C.__html:void 0,A!=null&&C!==A&&(u=u||[]).push(W,A)):W==="children"?typeof A!="string"&&typeof A!="number"||(u=u||[]).push(W,""+A):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(d.hasOwnProperty(W)?(A!=null&&W==="onScroll"&&Le("scroll",t),u||C===A||(u=[])):(u=u||[]).push(W,A))}n&&(u=u||[]).push("style",n);var W=u;(s.updateQueue=W)&&(s.flags|=4)}},_d=function(t,s,n,r){n!==r&&(s.flags|=4)};function da(t,s){if(!_e)switch(t.tailMode){case"hidden":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?s||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function it(t){var s=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(s)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,s}function Cx(t,s,n){var r=s.pendingProps;switch(Wl(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return it(s),null;case 1:return ft(s.type)&&Ja(),it(s),null;case 3:return r=s.stateNode,yn(),Fe(ht),Fe(lt),so(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(sr(s)?s.flags|=4:t===null||t.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Ft!==null&&(To(Ft),Ft=null))),wo(t,s),it(s),null;case 5:eo(s);var i=zs(ra.current);if(n=s.type,t!==null&&s.stateNode!=null)zd(t,s,n,r,i),t.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!r){if(s.stateNode===null)throw Error(o(166));return it(s),null}if(t=zs(Gt.current),sr(s)){r=s.stateNode,n=s.type;var u=s.memoizedProps;switch(r[Vt]=s,r[ea]=u,t=(s.mode&1)!==0,n){case"dialog":Le("cancel",r),Le("close",r);break;case"iframe":case"object":case"embed":Le("load",r);break;case"video":case"audio":for(i=0;i<Jn.length;i++)Le(Jn[i],r);break;case"source":Le("error",r);break;case"img":case"image":case"link":Le("error",r),Le("load",r);break;case"details":Le("toggle",r);break;case"input":Js(r,u),Le("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!u.multiple},Le("invalid",r);break;case"textarea":Ps(r,u),Le("invalid",r)}tl(n,u),i=null;for(var g in u)if(u.hasOwnProperty(g)){var C=u[g];g==="children"?typeof C=="string"?r.textContent!==C&&(u.suppressHydrationWarning!==!0&&Qa(r.textContent,C,t),i=["children",C]):typeof C=="number"&&r.textContent!==""+C&&(u.suppressHydrationWarning!==!0&&Qa(r.textContent,C,t),i=["children",""+C]):d.hasOwnProperty(g)&&C!=null&&g==="onScroll"&&Le("scroll",r)}switch(n){case"input":ie(r),se(r,u,!0);break;case"textarea":ie(r),ka(r);break;case"select":case"option":break;default:typeof u.onClick=="function"&&(r.onclick=Ya)}r=i,s.updateQueue=r,r!==null&&(s.flags|=4)}else{g=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Ca(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=g.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=g.createElement(n,{is:r.is}):(t=g.createElement(n),n==="select"&&(g=t,r.multiple?g.multiple=!0:r.size&&(g.size=r.size))):t=g.createElementNS(t,n),t[Vt]=s,t[ea]=r,Rd(t,s,!1,!1),s.stateNode=t;e:{switch(g=sl(n,r),n){case"dialog":Le("cancel",t),Le("close",t),i=r;break;case"iframe":case"object":case"embed":Le("load",t),i=r;break;case"video":case"audio":for(i=0;i<Jn.length;i++)Le(Jn[i],t);i=r;break;case"source":Le("error",t),i=r;break;case"img":case"image":case"link":Le("error",t),Le("load",t),i=r;break;case"details":Le("toggle",t),i=r;break;case"input":Js(t,r),i=Ut(t,r),Le("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Y({},r,{value:void 0}),Le("invalid",t);break;case"textarea":Ps(t,r),i=Wt(t,r),Le("invalid",t);break;default:i=r}tl(n,i),C=i;for(u in C)if(C.hasOwnProperty(u)){var A=C[u];u==="style"?Di(t,A):u==="dangerouslySetInnerHTML"?(A=A?A.__html:void 0,A!=null&&Ci(t,A)):u==="children"?typeof A=="string"?(n!=="textarea"||A!=="")&&An(t,A):typeof A=="number"&&An(t,""+A):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(d.hasOwnProperty(u)?A!=null&&u==="onScroll"&&Le("scroll",t):A!=null&&V(t,u,A,g))}switch(n){case"input":ie(t),se(t,r,!1);break;case"textarea":ie(t),ka(t);break;case"option":r.value!=null&&t.setAttribute("value",""+ye(r.value));break;case"select":t.multiple=!!r.multiple,u=r.value,u!=null?rt(t,!!r.multiple,u,!1):r.defaultValue!=null&&rt(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Ya)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return it(s),null;case 6:if(t&&s.stateNode!=null)_d(t,s,t.memoizedProps,r);else{if(typeof r!="string"&&s.stateNode===null)throw Error(o(166));if(n=zs(ra.current),zs(Gt.current),sr(s)){if(r=s.stateNode,n=s.memoizedProps,r[Vt]=s,(u=r.nodeValue!==n)&&(t=St,t!==null))switch(t.tag){case 3:Qa(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Qa(r.nodeValue,n,(t.mode&1)!==0)}u&&(s.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Vt]=s,s.stateNode=r}return it(s),null;case 13:if(Fe(Oe),r=s.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_e&&kt!==null&&(s.mode&1)!==0&&(s.flags&128)===0)Uc(),xn(),s.flags|=98560,u=!1;else if(u=sr(s),r!==null&&r.dehydrated!==null){if(t===null){if(!u)throw Error(o(318));if(u=s.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(o(317));u[Vt]=s}else xn(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;it(s),u=!1}else Ft!==null&&(To(Ft),Ft=null),u=!0;if(!u)return s.flags&65536?s:null}return(s.flags&128)!==0?(s.lanes=n,s):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(s.child.flags|=8192,(s.mode&1)!==0&&(t===null||(Oe.current&1)!==0?Ke===0&&(Ke=3):$o())),s.updateQueue!==null&&(s.flags|=4),it(s),null);case 4:return yn(),wo(t,s),t===null&&Xn(s.stateNode.containerInfo),it(s),null;case 10:return Yl(s.type._context),it(s),null;case 17:return ft(s.type)&&Ja(),it(s),null;case 19:if(Fe(Oe),u=s.memoizedState,u===null)return it(s),null;if(r=(s.flags&128)!==0,g=u.rendering,g===null)if(r)da(u,!1);else{if(Ke!==0||t!==null&&(t.flags&128)!==0)for(t=s.child;t!==null;){if(g=ir(t),g!==null){for(s.flags|=128,da(u,!1),r=g.updateQueue,r!==null&&(s.updateQueue=r,s.flags|=4),s.subtreeFlags=0,r=n,n=s.child;n!==null;)u=n,t=r,u.flags&=14680066,g=u.alternate,g===null?(u.childLanes=0,u.lanes=t,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=g.childLanes,u.lanes=g.lanes,u.child=g.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=g.memoizedProps,u.memoizedState=g.memoizedState,u.updateQueue=g.updateQueue,u.type=g.type,t=g.dependencies,u.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ae(Oe,Oe.current&1|2),s.child}t=t.sibling}u.tail!==null&&Ve()>wn&&(s.flags|=128,r=!0,da(u,!1),s.lanes=4194304)}else{if(!r)if(t=ir(g),t!==null){if(s.flags|=128,r=!0,n=t.updateQueue,n!==null&&(s.updateQueue=n,s.flags|=4),da(u,!0),u.tail===null&&u.tailMode==="hidden"&&!g.alternate&&!_e)return it(s),null}else 2*Ve()-u.renderingStartTime>wn&&n!==1073741824&&(s.flags|=128,r=!0,da(u,!1),s.lanes=4194304);u.isBackwards?(g.sibling=s.child,s.child=g):(n=u.last,n!==null?n.sibling=g:s.child=g,u.last=g)}return u.tail!==null?(s=u.tail,u.rendering=s,u.tail=s.sibling,u.renderingStartTime=Ve(),s.sibling=null,n=Oe.current,Ae(Oe,r?n&1|2:n&1),s):(it(s),null);case 22:case 23:return Fo(),r=s.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(s.flags|=8192),r&&(s.mode&1)!==0?(Ct&1073741824)!==0&&(it(s),s.subtreeFlags&6&&(s.flags|=8192)):it(s),null;case 24:return null;case 25:return null}throw Error(o(156,s.tag))}function Ex(t,s){switch(Wl(s),s.tag){case 1:return ft(s.type)&&Ja(),t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 3:return yn(),Fe(ht),Fe(lt),so(),t=s.flags,(t&65536)!==0&&(t&128)===0?(s.flags=t&-65537|128,s):null;case 5:return eo(s),null;case 13:if(Fe(Oe),t=s.memoizedState,t!==null&&t.dehydrated!==null){if(s.alternate===null)throw Error(o(340));xn()}return t=s.flags,t&65536?(s.flags=t&-65537|128,s):null;case 19:return Fe(Oe),null;case 4:return yn(),null;case 10:return Yl(s.type._context),null;case 22:case 23:return Fo(),null;case 24:return null;default:return null}}var gr=!1,ct=!1,Dx=typeof WeakSet=="function"?WeakSet:Set,ce=null;function bn(t,s){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){We(t,s,r)}else n.current=null}function No(t,s,n){try{n()}catch(r){We(t,s,r)}}var Od=!1;function Ix(t,s){if(Ll=Ra,t=yc(),Cl(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,u=r.focusNode;r=r.focusOffset;try{n.nodeType,u.nodeType}catch{n=null;break e}var g=0,C=-1,A=-1,W=0,Z=0,ee=t,J=null;t:for(;;){for(var oe;ee!==n||i!==0&&ee.nodeType!==3||(C=g+i),ee!==u||r!==0&&ee.nodeType!==3||(A=g+r),ee.nodeType===3&&(g+=ee.nodeValue.length),(oe=ee.firstChild)!==null;)J=ee,ee=oe;for(;;){if(ee===t)break t;if(J===n&&++W===i&&(C=g),J===u&&++Z===r&&(A=g),(oe=ee.nextSibling)!==null)break;ee=J,J=ee.parentNode}ee=oe}n=C===-1||A===-1?null:{start:C,end:A}}else n=null}n=n||{start:0,end:0}}else n=null;for(Fl={focusedElem:t,selectionRange:n},Ra=!1,ce=s;ce!==null;)if(s=ce,t=s.child,(s.subtreeFlags&1028)!==0&&t!==null)t.return=s,ce=t;else for(;ce!==null;){s=ce;try{var de=s.alternate;if((s.flags&1024)!==0)switch(s.tag){case 0:case 11:case 15:break;case 1:if(de!==null){var me=de.memoizedProps,Ge=de.memoizedState,z=s.stateNode,F=z.getSnapshotBeforeUpdate(s.elementType===s.type?me:$t(s.type,me),Ge);z.__reactInternalSnapshotBeforeUpdate=F}break;case 3:var U=s.stateNode.containerInfo;U.nodeType===1?U.textContent="":U.nodeType===9&&U.documentElement&&U.removeChild(U.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(te){We(s,s.return,te)}if(t=s.sibling,t!==null){t.return=s.return,ce=t;break}ce=s.return}return de=Od,Od=!1,de}function ua(t,s,n){var r=s.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var u=i.destroy;i.destroy=void 0,u!==void 0&&No(s,n,u)}i=i.next}while(i!==r)}}function yr(t,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var n=s=s.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==s)}}function So(t){var s=t.ref;if(s!==null){var n=t.stateNode;t.tag,t=n,typeof s=="function"?s(t):s.current=t}}function Bd(t){var s=t.alternate;s!==null&&(t.alternate=null,Bd(s)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(s=t.stateNode,s!==null&&(delete s[Vt],delete s[ea],delete s[_l],delete s[ux],delete s[mx])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Ud(t){return t.tag===5||t.tag===3||t.tag===4}function Wd(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Ud(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ko(t,s,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,s?n.nodeType===8?n.parentNode.insertBefore(t,s):n.insertBefore(t,s):(n.nodeType===8?(s=n.parentNode,s.insertBefore(t,n)):(s=n,s.appendChild(t)),n=n._reactRootContainer,n!=null||s.onclick!==null||(s.onclick=Ya));else if(r!==4&&(t=t.child,t!==null))for(ko(t,s,n),t=t.sibling;t!==null;)ko(t,s,n),t=t.sibling}function Co(t,s,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,s?n.insertBefore(t,s):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Co(t,s,n),t=t.sibling;t!==null;)Co(t,s,n),t=t.sibling}var st=null,Rt=!1;function ys(t,s,n){for(n=n.child;n!==null;)Hd(t,s,n),n=n.sibling}function Hd(t,s,n){if(Ht&&typeof Ht.onCommitFiberUnmount=="function")try{Ht.onCommitFiberUnmount(Pa,n)}catch{}switch(n.tag){case 5:ct||bn(n,s);case 6:var r=st,i=Rt;st=null,ys(t,s,n),st=r,Rt=i,st!==null&&(Rt?(t=st,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):st.removeChild(n.stateNode));break;case 18:st!==null&&(Rt?(t=st,n=n.stateNode,t.nodeType===8?zl(t.parentNode,n):t.nodeType===1&&zl(t,n),Wn(t)):zl(st,n.stateNode));break;case 4:r=st,i=Rt,st=n.stateNode.containerInfo,Rt=!0,ys(t,s,n),st=r,Rt=i;break;case 0:case 11:case 14:case 15:if(!ct&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var u=i,g=u.destroy;u=u.tag,g!==void 0&&((u&2)!==0||(u&4)!==0)&&No(n,s,g),i=i.next}while(i!==r)}ys(t,s,n);break;case 1:if(!ct&&(bn(n,s),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(C){We(n,s,C)}ys(t,s,n);break;case 21:ys(t,s,n);break;case 22:n.mode&1?(ct=(r=ct)||n.memoizedState!==null,ys(t,s,n),ct=r):ys(t,s,n);break;default:ys(t,s,n)}}function Vd(t){var s=t.updateQueue;if(s!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Dx),s.forEach(function(r){var i=zx.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function zt(t,s){var n=s.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var u=t,g=s,C=g;e:for(;C!==null;){switch(C.tag){case 5:st=C.stateNode,Rt=!1;break e;case 3:st=C.stateNode.containerInfo,Rt=!0;break e;case 4:st=C.stateNode.containerInfo,Rt=!0;break e}C=C.return}if(st===null)throw Error(o(160));Hd(u,g,i),st=null,Rt=!1;var A=i.alternate;A!==null&&(A.return=null),i.return=null}catch(W){We(i,s,W)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)Gd(s,t),s=s.sibling}function Gd(t,s){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(zt(s,t),Qt(t),r&4){try{ua(3,t,t.return),yr(3,t)}catch(me){We(t,t.return,me)}try{ua(5,t,t.return)}catch(me){We(t,t.return,me)}}break;case 1:zt(s,t),Qt(t),r&512&&n!==null&&bn(n,n.return);break;case 5:if(zt(s,t),Qt(t),r&512&&n!==null&&bn(n,n.return),t.flags&32){var i=t.stateNode;try{An(i,"")}catch(me){We(t,t.return,me)}}if(r&4&&(i=t.stateNode,i!=null)){var u=t.memoizedProps,g=n!==null?n.memoizedProps:u,C=t.type,A=t.updateQueue;if(t.updateQueue=null,A!==null)try{C==="input"&&u.type==="radio"&&u.name!=null&&Xs(i,u),sl(C,g);var W=sl(C,u);for(g=0;g<A.length;g+=2){var Z=A[g],ee=A[g+1];Z==="style"?Di(i,ee):Z==="dangerouslySetInnerHTML"?Ci(i,ee):Z==="children"?An(i,ee):V(i,Z,ee,W)}switch(C){case"input":Ms(i,u);break;case"textarea":Pn(i,u);break;case"select":var J=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!u.multiple;var oe=u.value;oe!=null?rt(i,!!u.multiple,oe,!1):J!==!!u.multiple&&(u.defaultValue!=null?rt(i,!!u.multiple,u.defaultValue,!0):rt(i,!!u.multiple,u.multiple?[]:"",!1))}i[ea]=u}catch(me){We(t,t.return,me)}}break;case 6:if(zt(s,t),Qt(t),r&4){if(t.stateNode===null)throw Error(o(162));i=t.stateNode,u=t.memoizedProps;try{i.nodeValue=u}catch(me){We(t,t.return,me)}}break;case 3:if(zt(s,t),Qt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Wn(s.containerInfo)}catch(me){We(t,t.return,me)}break;case 4:zt(s,t),Qt(t);break;case 13:zt(s,t),Qt(t),i=t.child,i.flags&8192&&(u=i.memoizedState!==null,i.stateNode.isHidden=u,!u||i.alternate!==null&&i.alternate.memoizedState!==null||(Io=Ve())),r&4&&Vd(t);break;case 22:if(Z=n!==null&&n.memoizedState!==null,t.mode&1?(ct=(W=ct)||Z,zt(s,t),ct=W):zt(s,t),Qt(t),r&8192){if(W=t.memoizedState!==null,(t.stateNode.isHidden=W)&&!Z&&(t.mode&1)!==0)for(ce=t,Z=t.child;Z!==null;){for(ee=ce=Z;ce!==null;){switch(J=ce,oe=J.child,J.tag){case 0:case 11:case 14:case 15:ua(4,J,J.return);break;case 1:bn(J,J.return);var de=J.stateNode;if(typeof de.componentWillUnmount=="function"){r=J,n=J.return;try{s=r,de.props=s.memoizedProps,de.state=s.memoizedState,de.componentWillUnmount()}catch(me){We(r,n,me)}}break;case 5:bn(J,J.return);break;case 22:if(J.memoizedState!==null){Yd(ee);continue}}oe!==null?(oe.return=J,ce=oe):Yd(ee)}Z=Z.sibling}e:for(Z=null,ee=t;;){if(ee.tag===5){if(Z===null){Z=ee;try{i=ee.stateNode,W?(u=i.style,typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"):(C=ee.stateNode,A=ee.memoizedProps.style,g=A!=null&&A.hasOwnProperty("display")?A.display:null,C.style.display=Ei("display",g))}catch(me){We(t,t.return,me)}}}else if(ee.tag===6){if(Z===null)try{ee.stateNode.nodeValue=W?"":ee.memoizedProps}catch(me){We(t,t.return,me)}}else if((ee.tag!==22&&ee.tag!==23||ee.memoizedState===null||ee===t)&&ee.child!==null){ee.child.return=ee,ee=ee.child;continue}if(ee===t)break e;for(;ee.sibling===null;){if(ee.return===null||ee.return===t)break e;Z===ee&&(Z=null),ee=ee.return}Z===ee&&(Z=null),ee.sibling.return=ee.return,ee=ee.sibling}}break;case 19:zt(s,t),Qt(t),r&4&&Vd(t);break;case 21:break;default:zt(s,t),Qt(t)}}function Qt(t){var s=t.flags;if(s&2){try{e:{for(var n=t.return;n!==null;){if(Ud(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(An(i,""),r.flags&=-33);var u=Wd(t);Co(t,u,i);break;case 3:case 4:var g=r.stateNode.containerInfo,C=Wd(t);ko(t,C,g);break;default:throw Error(o(161))}}catch(A){We(t,t.return,A)}t.flags&=-3}s&4096&&(t.flags&=-4097)}function Mx(t,s,n){ce=t,qd(t)}function qd(t,s,n){for(var r=(t.mode&1)!==0;ce!==null;){var i=ce,u=i.child;if(i.tag===22&&r){var g=i.memoizedState!==null||gr;if(!g){var C=i.alternate,A=C!==null&&C.memoizedState!==null||ct;C=gr;var W=ct;if(gr=g,(ct=A)&&!W)for(ce=i;ce!==null;)g=ce,A=g.child,g.tag===22&&g.memoizedState!==null?Kd(i):A!==null?(A.return=g,ce=A):Kd(i);for(;u!==null;)ce=u,qd(u),u=u.sibling;ce=i,gr=C,ct=W}Qd(t)}else(i.subtreeFlags&8772)!==0&&u!==null?(u.return=i,ce=u):Qd(t)}}function Qd(t){for(;ce!==null;){var s=ce;if((s.flags&8772)!==0){var n=s.alternate;try{if((s.flags&8772)!==0)switch(s.tag){case 0:case 11:case 15:ct||yr(5,s);break;case 1:var r=s.stateNode;if(s.flags&4&&!ct)if(n===null)r.componentDidMount();else{var i=s.elementType===s.type?n.memoizedProps:$t(s.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var u=s.updateQueue;u!==null&&Yc(s,u,r);break;case 3:var g=s.updateQueue;if(g!==null){if(n=null,s.child!==null)switch(s.child.tag){case 5:n=s.child.stateNode;break;case 1:n=s.child.stateNode}Yc(s,g,n)}break;case 5:var C=s.stateNode;if(n===null&&s.flags&4){n=C;var A=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":A.autoFocus&&n.focus();break;case"img":A.src&&(n.src=A.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var W=s.alternate;if(W!==null){var Z=W.memoizedState;if(Z!==null){var ee=Z.dehydrated;ee!==null&&Wn(ee)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(o(163))}ct||s.flags&512&&So(s)}catch(J){We(s,s.return,J)}}if(s===t){ce=null;break}if(n=s.sibling,n!==null){n.return=s.return,ce=n;break}ce=s.return}}function Yd(t){for(;ce!==null;){var s=ce;if(s===t){ce=null;break}var n=s.sibling;if(n!==null){n.return=s.return,ce=n;break}ce=s.return}}function Kd(t){for(;ce!==null;){var s=ce;try{switch(s.tag){case 0:case 11:case 15:var n=s.return;try{yr(4,s)}catch(A){We(s,n,A)}break;case 1:var r=s.stateNode;if(typeof r.componentDidMount=="function"){var i=s.return;try{r.componentDidMount()}catch(A){We(s,i,A)}}var u=s.return;try{So(s)}catch(A){We(s,u,A)}break;case 5:var g=s.return;try{So(s)}catch(A){We(s,g,A)}}}catch(A){We(s,s.return,A)}if(s===t){ce=null;break}var C=s.sibling;if(C!==null){C.return=s.return,ce=C;break}ce=s.return}}var Px=Math.ceil,vr=$.ReactCurrentDispatcher,Eo=$.ReactCurrentOwner,Pt=$.ReactCurrentBatchConfig,Ce=0,Xe=null,Qe=null,nt=0,Ct=0,jn=ps(0),Ke=0,ma=null,Os=0,br=0,Do=0,pa=null,yt=null,Io=0,wn=1/0,ns=null,jr=!1,Mo=null,vs=null,wr=!1,bs=null,Nr=0,xa=0,Po=null,Sr=-1,kr=0;function xt(){return(Ce&6)!==0?Ve():Sr!==-1?Sr:Sr=Ve()}function js(t){return(t.mode&1)===0?1:(Ce&2)!==0&&nt!==0?nt&-nt:xx.transition!==null?(kr===0&&(kr=Wi()),kr):(t=Pe,t!==0||(t=window.event,t=t===void 0?16:Xi(t.type)),t)}function _t(t,s,n,r){if(50<xa)throw xa=0,Po=null,Error(o(185));zn(t,n,r),((Ce&2)===0||t!==Xe)&&(t===Xe&&((Ce&2)===0&&(br|=n),Ke===4&&ws(t,nt)),vt(t,r),n===1&&Ce===0&&(s.mode&1)===0&&(wn=Ve()+500,Za&&hs()))}function vt(t,s){var n=t.callbackNode;xp(t,s);var r=La(t,t===Xe?nt:0);if(r===0)n!==null&&Oi(n),t.callbackNode=null,t.callbackPriority=0;else if(s=r&-r,t.callbackPriority!==s){if(n!=null&&Oi(n),s===1)t.tag===0?px(Xd.bind(null,t)):Rc(Xd.bind(null,t)),cx(function(){(Ce&6)===0&&hs()}),n=null;else{switch(Hi(r)){case 1:n=cl;break;case 4:n=Bi;break;case 16:n=Ma;break;case 536870912:n=Ui;break;default:n=Ma}n=lu(n,Jd.bind(null,t))}t.callbackPriority=s,t.callbackNode=n}}function Jd(t,s){if(Sr=-1,kr=0,(Ce&6)!==0)throw Error(o(327));var n=t.callbackNode;if(Nn()&&t.callbackNode!==n)return null;var r=La(t,t===Xe?nt:0);if(r===0)return null;if((r&30)!==0||(r&t.expiredLanes)!==0||s)s=Cr(t,r);else{s=r;var i=Ce;Ce|=2;var u=eu();(Xe!==t||nt!==s)&&(ns=null,wn=Ve()+500,Us(t,s));do try{Lx();break}catch(C){Zd(t,C)}while(!0);Ql(),vr.current=u,Ce=i,Qe!==null?s=0:(Xe=null,nt=0,s=Ke)}if(s!==0){if(s===2&&(i=dl(t),i!==0&&(r=i,s=Ao(t,i))),s===1)throw n=ma,Us(t,0),ws(t,r),vt(t,Ve()),n;if(s===6)ws(t,r);else{if(i=t.current.alternate,(r&30)===0&&!Ax(i)&&(s=Cr(t,r),s===2&&(u=dl(t),u!==0&&(r=u,s=Ao(t,u))),s===1))throw n=ma,Us(t,0),ws(t,r),vt(t,Ve()),n;switch(t.finishedWork=i,t.finishedLanes=r,s){case 0:case 1:throw Error(o(345));case 2:Ws(t,yt,ns);break;case 3:if(ws(t,r),(r&130023424)===r&&(s=Io+500-Ve(),10<s)){if(La(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){xt(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Rl(Ws.bind(null,t,yt,ns),s);break}Ws(t,yt,ns);break;case 4:if(ws(t,r),(r&4194240)===r)break;for(s=t.eventTimes,i=-1;0<r;){var g=31-Tt(r);u=1<<g,g=s[g],g>i&&(i=g),r&=~u}if(r=i,r=Ve()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Px(r/1960))-r,10<r){t.timeoutHandle=Rl(Ws.bind(null,t,yt,ns),r);break}Ws(t,yt,ns);break;case 5:Ws(t,yt,ns);break;default:throw Error(o(329))}}}return vt(t,Ve()),t.callbackNode===n?Jd.bind(null,t):null}function Ao(t,s){var n=pa;return t.current.memoizedState.isDehydrated&&(Us(t,s).flags|=256),t=Cr(t,s),t!==2&&(s=yt,yt=n,s!==null&&To(s)),t}function To(t){yt===null?yt=t:yt.push.apply(yt,t)}function Ax(t){for(var s=t;;){if(s.flags&16384){var n=s.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],u=i.getSnapshot;i=i.value;try{if(!Lt(u(),i))return!1}catch{return!1}}}if(n=s.child,s.subtreeFlags&16384&&n!==null)n.return=s,s=n;else{if(s===t)break;for(;s.sibling===null;){if(s.return===null||s.return===t)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function ws(t,s){for(s&=~Do,s&=~br,t.suspendedLanes|=s,t.pingedLanes&=~s,t=t.expirationTimes;0<s;){var n=31-Tt(s),r=1<<n;t[n]=-1,s&=~r}}function Xd(t){if((Ce&6)!==0)throw Error(o(327));Nn();var s=La(t,0);if((s&1)===0)return vt(t,Ve()),null;var n=Cr(t,s);if(t.tag!==0&&n===2){var r=dl(t);r!==0&&(s=r,n=Ao(t,r))}if(n===1)throw n=ma,Us(t,0),ws(t,s),vt(t,Ve()),n;if(n===6)throw Error(o(345));return t.finishedWork=t.current.alternate,t.finishedLanes=s,Ws(t,yt,ns),vt(t,Ve()),null}function Lo(t,s){var n=Ce;Ce|=1;try{return t(s)}finally{Ce=n,Ce===0&&(wn=Ve()+500,Za&&hs())}}function Bs(t){bs!==null&&bs.tag===0&&(Ce&6)===0&&Nn();var s=Ce;Ce|=1;var n=Pt.transition,r=Pe;try{if(Pt.transition=null,Pe=1,t)return t()}finally{Pe=r,Pt.transition=n,Ce=s,(Ce&6)===0&&hs()}}function Fo(){Ct=jn.current,Fe(jn)}function Us(t,s){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,ix(n)),Qe!==null)for(n=Qe.return;n!==null;){var r=n;switch(Wl(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ja();break;case 3:yn(),Fe(ht),Fe(lt),so();break;case 5:eo(r);break;case 4:yn();break;case 13:Fe(Oe);break;case 19:Fe(Oe);break;case 10:Yl(r.type._context);break;case 22:case 23:Fo()}n=n.return}if(Xe=t,Qe=t=Ns(t.current,null),nt=Ct=s,Ke=0,ma=null,Do=br=Os=0,yt=pa=null,Rs!==null){for(s=0;s<Rs.length;s++)if(n=Rs[s],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,u=n.pending;if(u!==null){var g=u.next;u.next=i,r.next=g}n.pending=r}Rs=null}return t}function Zd(t,s){do{var n=Qe;try{if(Ql(),cr.current=pr,dr){for(var r=Be.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}dr=!1}if(_s=0,Je=Ye=Be=null,la=!1,oa=0,Eo.current=null,n===null||n.return===null){Ke=1,ma=s,Qe=null;break}e:{var u=t,g=n.return,C=n,A=s;if(s=nt,C.flags|=32768,A!==null&&typeof A=="object"&&typeof A.then=="function"){var W=A,Z=C,ee=Z.tag;if((Z.mode&1)===0&&(ee===0||ee===11||ee===15)){var J=Z.alternate;J?(Z.updateQueue=J.updateQueue,Z.memoizedState=J.memoizedState,Z.lanes=J.lanes):(Z.updateQueue=null,Z.memoizedState=null)}var oe=Sd(g);if(oe!==null){oe.flags&=-257,kd(oe,g,C,u,s),oe.mode&1&&Nd(u,W,s),s=oe,A=W;var de=s.updateQueue;if(de===null){var me=new Set;me.add(A),s.updateQueue=me}else de.add(A);break e}else{if((s&1)===0){Nd(u,W,s),$o();break e}A=Error(o(426))}}else if(_e&&C.mode&1){var Ge=Sd(g);if(Ge!==null){(Ge.flags&65536)===0&&(Ge.flags|=256),kd(Ge,g,C,u,s),Gl(vn(A,C));break e}}u=A=vn(A,C),Ke!==4&&(Ke=2),pa===null?pa=[u]:pa.push(u),u=g;do{switch(u.tag){case 3:u.flags|=65536,s&=-s,u.lanes|=s;var z=jd(u,A,s);Qc(u,z);break e;case 1:C=A;var F=u.type,U=u.stateNode;if((u.flags&128)===0&&(typeof F.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(vs===null||!vs.has(U)))){u.flags|=65536,s&=-s,u.lanes|=s;var te=wd(u,C,s);Qc(u,te);break e}}u=u.return}while(u!==null)}su(n)}catch(pe){s=pe,Qe===n&&n!==null&&(Qe=n=n.return);continue}break}while(!0)}function eu(){var t=vr.current;return vr.current=pr,t===null?pr:t}function $o(){(Ke===0||Ke===3||Ke===2)&&(Ke=4),Xe===null||(Os&268435455)===0&&(br&268435455)===0||ws(Xe,nt)}function Cr(t,s){var n=Ce;Ce|=2;var r=eu();(Xe!==t||nt!==s)&&(ns=null,Us(t,s));do try{Tx();break}catch(i){Zd(t,i)}while(!0);if(Ql(),Ce=n,vr.current=r,Qe!==null)throw Error(o(261));return Xe=null,nt=0,Ke}function Tx(){for(;Qe!==null;)tu(Qe)}function Lx(){for(;Qe!==null&&!rp();)tu(Qe)}function tu(t){var s=ru(t.alternate,t,Ct);t.memoizedProps=t.pendingProps,s===null?su(t):Qe=s,Eo.current=null}function su(t){var s=t;do{var n=s.alternate;if(t=s.return,(s.flags&32768)===0){if(n=Cx(n,s,Ct),n!==null){Qe=n;return}}else{if(n=Ex(n,s),n!==null){n.flags&=32767,Qe=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ke=6,Qe=null;return}}if(s=s.sibling,s!==null){Qe=s;return}Qe=s=t}while(s!==null);Ke===0&&(Ke=5)}function Ws(t,s,n){var r=Pe,i=Pt.transition;try{Pt.transition=null,Pe=1,Fx(t,s,n,r)}finally{Pt.transition=i,Pe=r}return null}function Fx(t,s,n,r){do Nn();while(bs!==null);if((Ce&6)!==0)throw Error(o(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(o(177));t.callbackNode=null,t.callbackPriority=0;var u=n.lanes|n.childLanes;if(hp(t,u),t===Xe&&(Qe=Xe=null,nt=0),(n.subtreeFlags&2064)===0&&(n.flags&2064)===0||wr||(wr=!0,lu(Ma,function(){return Nn(),null})),u=(n.flags&15990)!==0,(n.subtreeFlags&15990)!==0||u){u=Pt.transition,Pt.transition=null;var g=Pe;Pe=1;var C=Ce;Ce|=4,Eo.current=null,Ix(t,n),Gd(n,t),tx(Fl),Ra=!!Ll,Fl=Ll=null,t.current=n,Mx(n),lp(),Ce=C,Pe=g,Pt.transition=u}else t.current=n;if(wr&&(wr=!1,bs=t,Nr=i),u=t.pendingLanes,u===0&&(vs=null),cp(n.stateNode),vt(t,Ve()),s!==null)for(r=t.onRecoverableError,n=0;n<s.length;n++)i=s[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(jr)throw jr=!1,t=Mo,Mo=null,t;return(Nr&1)!==0&&t.tag!==0&&Nn(),u=t.pendingLanes,(u&1)!==0?t===Po?xa++:(xa=0,Po=t):xa=0,hs(),null}function Nn(){if(bs!==null){var t=Hi(Nr),s=Pt.transition,n=Pe;try{if(Pt.transition=null,Pe=16>t?16:t,bs===null)var r=!1;else{if(t=bs,bs=null,Nr=0,(Ce&6)!==0)throw Error(o(331));var i=Ce;for(Ce|=4,ce=t.current;ce!==null;){var u=ce,g=u.child;if((ce.flags&16)!==0){var C=u.deletions;if(C!==null){for(var A=0;A<C.length;A++){var W=C[A];for(ce=W;ce!==null;){var Z=ce;switch(Z.tag){case 0:case 11:case 15:ua(8,Z,u)}var ee=Z.child;if(ee!==null)ee.return=Z,ce=ee;else for(;ce!==null;){Z=ce;var J=Z.sibling,oe=Z.return;if(Bd(Z),Z===W){ce=null;break}if(J!==null){J.return=oe,ce=J;break}ce=oe}}}var de=u.alternate;if(de!==null){var me=de.child;if(me!==null){de.child=null;do{var Ge=me.sibling;me.sibling=null,me=Ge}while(me!==null)}}ce=u}}if((u.subtreeFlags&2064)!==0&&g!==null)g.return=u,ce=g;else e:for(;ce!==null;){if(u=ce,(u.flags&2048)!==0)switch(u.tag){case 0:case 11:case 15:ua(9,u,u.return)}var z=u.sibling;if(z!==null){z.return=u.return,ce=z;break e}ce=u.return}}var F=t.current;for(ce=F;ce!==null;){g=ce;var U=g.child;if((g.subtreeFlags&2064)!==0&&U!==null)U.return=g,ce=U;else e:for(g=F;ce!==null;){if(C=ce,(C.flags&2048)!==0)try{switch(C.tag){case 0:case 11:case 15:yr(9,C)}}catch(pe){We(C,C.return,pe)}if(C===g){ce=null;break e}var te=C.sibling;if(te!==null){te.return=C.return,ce=te;break e}ce=C.return}}if(Ce=i,hs(),Ht&&typeof Ht.onPostCommitFiberRoot=="function")try{Ht.onPostCommitFiberRoot(Pa,t)}catch{}r=!0}return r}finally{Pe=n,Pt.transition=s}}return!1}function nu(t,s,n){s=vn(n,s),s=jd(t,s,1),t=gs(t,s,1),s=xt(),t!==null&&(zn(t,1,s),vt(t,s))}function We(t,s,n){if(t.tag===3)nu(t,t,n);else for(;s!==null;){if(s.tag===3){nu(s,t,n);break}else if(s.tag===1){var r=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(vs===null||!vs.has(r))){t=vn(n,t),t=wd(s,t,1),s=gs(s,t,1),t=xt(),s!==null&&(zn(s,1,t),vt(s,t));break}}s=s.return}}function $x(t,s,n){var r=t.pingCache;r!==null&&r.delete(s),s=xt(),t.pingedLanes|=t.suspendedLanes&n,Xe===t&&(nt&n)===n&&(Ke===4||Ke===3&&(nt&130023424)===nt&&500>Ve()-Io?Us(t,0):Do|=n),vt(t,s)}function au(t,s){s===0&&((t.mode&1)===0?s=1:(s=Ta,Ta<<=1,(Ta&130023424)===0&&(Ta=4194304)));var n=xt();t=es(t,s),t!==null&&(zn(t,s,n),vt(t,n))}function Rx(t){var s=t.memoizedState,n=0;s!==null&&(n=s.retryLane),au(t,n)}function zx(t,s){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(o(314))}r!==null&&r.delete(s),au(t,n)}var ru;ru=function(t,s,n){if(t!==null)if(t.memoizedProps!==s.pendingProps||ht.current)gt=!0;else{if((t.lanes&n)===0&&(s.flags&128)===0)return gt=!1,kx(t,s,n);gt=(t.flags&131072)!==0}else gt=!1,_e&&(s.flags&1048576)!==0&&zc(s,tr,s.index);switch(s.lanes=0,s.tag){case 2:var r=s.type;fr(t,s),t=s.pendingProps;var i=un(s,lt.current);gn(s,n),i=ro(null,s,r,t,i,n);var u=lo();return s.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,ft(r)?(u=!0,Xa(s)):u=!1,s.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Xl(s),i.updater=xr,s.stateNode=i,i._reactInternals=s,po(s,r,t,n),s=go(null,s,r,!0,u,n)):(s.tag=0,_e&&u&&Ul(s),pt(null,s,i,n),s=s.child),s;case 16:r=s.elementType;e:{switch(fr(t,s),t=s.pendingProps,i=r._init,r=i(r._payload),s.type=r,i=s.tag=Ox(r),t=$t(r,t),i){case 0:s=fo(null,s,r,t,n);break e;case 1:s=Pd(null,s,r,t,n);break e;case 11:s=Cd(null,s,r,t,n);break e;case 14:s=Ed(null,s,r,$t(r.type,t),n);break e}throw Error(o(306,r,""))}return s;case 0:return r=s.type,i=s.pendingProps,i=s.elementType===r?i:$t(r,i),fo(t,s,r,i,n);case 1:return r=s.type,i=s.pendingProps,i=s.elementType===r?i:$t(r,i),Pd(t,s,r,i,n);case 3:e:{if(Ad(s),t===null)throw Error(o(387));r=s.pendingProps,u=s.memoizedState,i=u.element,qc(t,s),or(s,r,null,n);var g=s.memoizedState;if(r=g.element,u.isDehydrated)if(u={element:r,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},s.updateQueue.baseState=u,s.memoizedState=u,s.flags&256){i=vn(Error(o(423)),s),s=Td(t,s,r,n,i);break e}else if(r!==i){i=vn(Error(o(424)),s),s=Td(t,s,r,n,i);break e}else for(kt=ms(s.stateNode.containerInfo.firstChild),St=s,_e=!0,Ft=null,n=Vc(s,null,r,n),s.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(xn(),r===i){s=ss(t,s,n);break e}pt(t,s,r,n)}s=s.child}return s;case 5:return Kc(s),t===null&&Vl(s),r=s.type,i=s.pendingProps,u=t!==null?t.memoizedProps:null,g=i.children,$l(r,i)?g=null:u!==null&&$l(r,u)&&(s.flags|=32),Md(t,s),pt(t,s,g,n),s.child;case 6:return t===null&&Vl(s),null;case 13:return Ld(t,s,n);case 4:return Zl(s,s.stateNode.containerInfo),r=s.pendingProps,t===null?s.child=hn(s,null,r,n):pt(t,s,r,n),s.child;case 11:return r=s.type,i=s.pendingProps,i=s.elementType===r?i:$t(r,i),Cd(t,s,r,i,n);case 7:return pt(t,s,s.pendingProps,n),s.child;case 8:return pt(t,s,s.pendingProps.children,n),s.child;case 12:return pt(t,s,s.pendingProps.children,n),s.child;case 10:e:{if(r=s.type._context,i=s.pendingProps,u=s.memoizedProps,g=i.value,Ae(ar,r._currentValue),r._currentValue=g,u!==null)if(Lt(u.value,g)){if(u.children===i.children&&!ht.current){s=ss(t,s,n);break e}}else for(u=s.child,u!==null&&(u.return=s);u!==null;){var C=u.dependencies;if(C!==null){g=u.child;for(var A=C.firstContext;A!==null;){if(A.context===r){if(u.tag===1){A=ts(-1,n&-n),A.tag=2;var W=u.updateQueue;if(W!==null){W=W.shared;var Z=W.pending;Z===null?A.next=A:(A.next=Z.next,Z.next=A),W.pending=A}}u.lanes|=n,A=u.alternate,A!==null&&(A.lanes|=n),Kl(u.return,n,s),C.lanes|=n;break}A=A.next}}else if(u.tag===10)g=u.type===s.type?null:u.child;else if(u.tag===18){if(g=u.return,g===null)throw Error(o(341));g.lanes|=n,C=g.alternate,C!==null&&(C.lanes|=n),Kl(g,n,s),g=u.sibling}else g=u.child;if(g!==null)g.return=u;else for(g=u;g!==null;){if(g===s){g=null;break}if(u=g.sibling,u!==null){u.return=g.return,g=u;break}g=g.return}u=g}pt(t,s,i.children,n),s=s.child}return s;case 9:return i=s.type,r=s.pendingProps.children,gn(s,n),i=It(i),r=r(i),s.flags|=1,pt(t,s,r,n),s.child;case 14:return r=s.type,i=$t(r,s.pendingProps),i=$t(r.type,i),Ed(t,s,r,i,n);case 15:return Dd(t,s,s.type,s.pendingProps,n);case 17:return r=s.type,i=s.pendingProps,i=s.elementType===r?i:$t(r,i),fr(t,s),s.tag=1,ft(r)?(t=!0,Xa(s)):t=!1,gn(s,n),vd(s,r,i),po(s,r,i,n),go(null,s,r,!0,t,n);case 19:return $d(t,s,n);case 22:return Id(t,s,n)}throw Error(o(156,s.tag))};function lu(t,s){return _i(t,s)}function _x(t,s,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function At(t,s,n,r){return new _x(t,s,n,r)}function Ro(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Ox(t){if(typeof t=="function")return Ro(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Q)return 11;if(t===T)return 14}return 2}function Ns(t,s){var n=t.alternate;return n===null?(n=At(t.tag,s,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=s,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,s=t.dependencies,n.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Er(t,s,n,r,i,u){var g=2;if(r=t,typeof t=="function")Ro(t)&&(g=1);else if(typeof t=="string")g=5;else e:switch(t){case k:return Hs(n.children,i,u,s);case D:g=8,i|=8;break;case _:return t=At(12,n,s,i|2),t.elementType=_,t.lanes=u,t;case B:return t=At(13,n,s,i),t.elementType=B,t.lanes=u,t;case G:return t=At(19,n,s,i),t.elementType=G,t.lanes=u,t;case le:return Dr(n,i,u,s);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case O:g=10;break e;case K:g=9;break e;case Q:g=11;break e;case T:g=14;break e;case ne:g=16,r=null;break e}throw Error(o(130,t==null?t:typeof t,""))}return s=At(g,n,s,i),s.elementType=t,s.type=r,s.lanes=u,s}function Hs(t,s,n,r){return t=At(7,t,r,s),t.lanes=n,t}function Dr(t,s,n,r){return t=At(22,t,r,s),t.elementType=le,t.lanes=n,t.stateNode={isHidden:!1},t}function zo(t,s,n){return t=At(6,t,null,s),t.lanes=n,t}function _o(t,s,n){return s=At(4,t.children!==null?t.children:[],t.key,s),s.lanes=n,s.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},s}function Bx(t,s,n,r,i){this.tag=s,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ul(0),this.expirationTimes=ul(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ul(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Oo(t,s,n,r,i,u,g,C,A){return t=new Bx(t,s,n,C,A),s===1?(s=1,u===!0&&(s|=8)):s=0,u=At(3,null,null,s),t.current=u,u.stateNode=t,u.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Xl(u),t}function Ux(t,s,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:q,key:r==null?null:""+r,children:t,containerInfo:s,implementation:n}}function ou(t){if(!t)return xs;t=t._reactInternals;e:{if(As(t)!==t||t.tag!==1)throw Error(o(170));var s=t;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(ft(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(o(171))}if(t.tag===1){var n=t.type;if(ft(n))return Fc(t,n,s)}return s}function iu(t,s,n,r,i,u,g,C,A){return t=Oo(n,r,!0,t,i,u,g,C,A),t.context=ou(null),n=t.current,r=xt(),i=js(n),u=ts(r,i),u.callback=s??null,gs(n,u,i),t.current.lanes=i,zn(t,i,r),vt(t,r),t}function Ir(t,s,n,r){var i=s.current,u=xt(),g=js(i);return n=ou(n),s.context===null?s.context=n:s.pendingContext=n,s=ts(u,g),s.payload={element:t},r=r===void 0?null:r,r!==null&&(s.callback=r),t=gs(i,s,g),t!==null&&(_t(t,i,g,u),lr(t,i,g)),g}function Mr(t){return t=t.current,t.child?(t.child.tag===5,t.child.stateNode):null}function cu(t,s){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<s?n:s}}function Bo(t,s){cu(t,s),(t=t.alternate)&&cu(t,s)}function Wx(){return null}var du=typeof reportError=="function"?reportError:function(t){console.error(t)};function Uo(t){this._internalRoot=t}Pr.prototype.render=Uo.prototype.render=function(t){var s=this._internalRoot;if(s===null)throw Error(o(409));Ir(t,s,null,null)},Pr.prototype.unmount=Uo.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var s=t.containerInfo;Bs(function(){Ir(null,t,null,null)}),s[Kt]=null}};function Pr(t){this._internalRoot=t}Pr.prototype.unstable_scheduleHydration=function(t){if(t){var s=qi();t={blockedOn:null,target:t,priority:s};for(var n=0;n<cs.length&&s!==0&&s<cs[n].priority;n++);cs.splice(n,0,t),n===0&&Ki(t)}};function Wo(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ar(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function uu(){}function Hx(t,s,n,r,i){if(i){if(typeof r=="function"){var u=r;r=function(){var W=Mr(g);u.call(W)}}var g=iu(s,r,t,0,null,!1,!1,"",uu);return t._reactRootContainer=g,t[Kt]=g.current,Xn(t.nodeType===8?t.parentNode:t),Bs(),g}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var C=r;r=function(){var W=Mr(A);C.call(W)}}var A=Oo(t,0,!1,null,null,!1,!1,"",uu);return t._reactRootContainer=A,t[Kt]=A.current,Xn(t.nodeType===8?t.parentNode:t),Bs(function(){Ir(s,A,n,r)}),A}function Tr(t,s,n,r,i){var u=n._reactRootContainer;if(u){var g=u;if(typeof i=="function"){var C=i;i=function(){var A=Mr(g);C.call(A)}}Ir(s,g,t,i)}else g=Hx(n,s,t,i,r);return Mr(g)}Vi=function(t){switch(t.tag){case 3:var s=t.stateNode;if(s.current.memoizedState.isDehydrated){var n=Rn(s.pendingLanes);n!==0&&(ml(s,n|1),vt(s,Ve()),(Ce&6)===0&&(wn=Ve()+500,hs()))}break;case 13:Bs(function(){var r=es(t,1);if(r!==null){var i=xt();_t(r,t,1,i)}}),Bo(t,1)}},pl=function(t){if(t.tag===13){var s=es(t,134217728);if(s!==null){var n=xt();_t(s,t,134217728,n)}Bo(t,134217728)}},Gi=function(t){if(t.tag===13){var s=js(t),n=es(t,s);if(n!==null){var r=xt();_t(n,t,s,r)}Bo(t,s)}},qi=function(){return Pe},Qi=function(t,s){var n=Pe;try{return Pe=t,s()}finally{Pe=n}},rl=function(t,s,n){switch(s){case"input":if(Ms(t,n),s=n.name,n.type==="radio"&&s!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<n.length;s++){var r=n[s];if(r!==t&&r.form===t.form){var i=Ka(r);if(!i)throw Error(o(90));Me(r),Ms(r,i)}}}break;case"textarea":Pn(t,n);break;case"select":s=n.value,s!=null&&rt(t,!!n.multiple,s,!1)}},Ai=Lo,Ti=Bs;var Vx={usingClientEntryPoint:!1,Events:[ta,cn,Ka,Mi,Pi,Lo]},ha={findFiberByHostInstance:Ts,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Gx={bundleType:ha.bundleType,version:ha.version,rendererPackageName:ha.rendererPackageName,rendererConfig:ha.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ri(t),t===null?null:t.stateNode},findFiberByHostInstance:ha.findFiberByHostInstance||Wx,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lr.isDisabled&&Lr.supportsFiber)try{Pa=Lr.inject(Gx),Ht=Lr}catch{}}return bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Vx,bt.createPortal=function(t,s){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Wo(s))throw Error(o(200));return Ux(t,s,null,n)},bt.createRoot=function(t,s){if(!Wo(t))throw Error(o(299));var n=!1,r="",i=du;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(r=s.identifierPrefix),s.onRecoverableError!==void 0&&(i=s.onRecoverableError)),s=Oo(t,1,!1,null,null,n,!1,r,i),t[Kt]=s.current,Xn(t.nodeType===8?t.parentNode:t),new Uo(s)},bt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var s=t._reactInternals;if(s===void 0)throw typeof t.render=="function"?Error(o(188)):(t=Object.keys(t).join(","),Error(o(268,t)));return t=Ri(s),t=t===null?null:t.stateNode,t},bt.flushSync=function(t){return Bs(t)},bt.hydrate=function(t,s,n){if(!Ar(s))throw Error(o(200));return Tr(null,t,s,!0,n)},bt.hydrateRoot=function(t,s,n){if(!Wo(t))throw Error(o(405));var r=n!=null&&n.hydratedSources||null,i=!1,u="",g=du;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(g=n.onRecoverableError)),s=iu(s,null,t,1,n??null,i,!1,u,g),t[Kt]=s.current,Xn(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[n,i]:s.mutableSourceEagerHydrationData.push(n,i);return new Pr(s)},bt.render=function(t,s,n){if(!Ar(s))throw Error(o(200));return Tr(null,t,s,!1,n)},bt.unmountComponentAtNode=function(t){if(!Ar(t))throw Error(o(40));return t._reactRootContainer?(Bs(function(){Tr(null,null,t,!1,function(){t._reactRootContainer=null,t[Kt]=null})}),!0):!1},bt.unstable_batchedUpdates=Lo,bt.unstable_renderSubtreeIntoContainer=function(t,s,n,r){if(!Ar(n))throw Error(o(200));if(t==null||t._reactInternals===void 0)throw Error(o(38));return Tr(t,s,n,!1,r)},bt.version="18.3.1-next-f1338f8080-20240426",bt}var vu;function nm(){if(vu)return Go.exports;vu=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(l){console.error(l)}}return a(),Go.exports=th(),Go.exports}var bu;function sh(){if(bu)return Fr;bu=1;var a=nm();return Fr.createRoot=a.createRoot,Fr.hydrateRoot=a.hydrateRoot,Fr}var nh=sh();const ah=sm(nh);nm();function va(){return va=Object.assign?Object.assign.bind():function(a){for(var l=1;l<arguments.length;l++){var o=arguments[l];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(a[c]=o[c])}return a},va.apply(this,arguments)}var ks;(function(a){a.Pop="POP",a.Push="PUSH",a.Replace="REPLACE"})(ks||(ks={}));const ju="popstate";function rh(a){a===void 0&&(a={});function l(d,p){let{pathname:m="/",search:f="",hash:h=""}=Ys(d.location.hash.substr(1));return!m.startsWith("/")&&!m.startsWith(".")&&(m="/"+m),Zo("",{pathname:m,search:f,hash:h},p.state&&p.state.usr||null,p.state&&p.state.key||"default")}function o(d,p){let m=d.document.querySelector("base"),f="";if(m&&m.getAttribute("href")){let h=d.location.href,v=h.indexOf("#");f=v===-1?h:h.slice(0,v)}return f+"#"+(typeof p=="string"?p:_r(p))}function c(d,p){Br(d.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(p)+")")}return oh(l,o,c,a)}function Ue(a,l){if(a===!1||a===null||typeof a>"u")throw new Error(l)}function Br(a,l){if(!a){typeof console<"u"&&console.warn(l);try{throw new Error(l)}catch{}}}function lh(){return Math.random().toString(36).substr(2,8)}function wu(a,l){return{usr:a.state,key:a.key,idx:l}}function Zo(a,l,o,c){return o===void 0&&(o=null),va({pathname:typeof a=="string"?a:a.pathname,search:"",hash:""},typeof l=="string"?Ys(l):l,{state:o,key:l&&l.key||c||lh()})}function _r(a){let{pathname:l="/",search:o="",hash:c=""}=a;return o&&o!=="?"&&(l+=o.charAt(0)==="?"?o:"?"+o),c&&c!=="#"&&(l+=c.charAt(0)==="#"?c:"#"+c),l}function Ys(a){let l={};if(a){let o=a.indexOf("#");o>=0&&(l.hash=a.substr(o),a=a.substr(0,o));let c=a.indexOf("?");c>=0&&(l.search=a.substr(c),a=a.substr(0,c)),a&&(l.pathname=a)}return l}function oh(a,l,o,c){c===void 0&&(c={});let{window:d=document.defaultView,v5Compat:p=!1}=c,m=d.history,f=ks.Pop,h=null,v=y();v==null&&(v=0,m.replaceState(va({},m.state,{idx:v}),""));function y(){return(m.state||{idx:null}).idx}function b(){f=ks.Pop;let j=y(),M=j==null?null:j-v;v=j,h&&h({action:f,location:N.location,delta:M})}function w(j,M){f=ks.Push;let I=Zo(N.location,j,M);o&&o(I,j),v=y()+1;let V=wu(I,v),$=N.createHref(I);try{m.pushState(V,"",$)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;d.location.assign($)}p&&h&&h({action:f,location:N.location,delta:1})}function E(j,M){f=ks.Replace;let I=Zo(N.location,j,M);o&&o(I,j),v=y();let V=wu(I,v),$=N.createHref(I);m.replaceState(V,"",$),p&&h&&h({action:f,location:N.location,delta:0})}function S(j){let M=d.location.origin!=="null"?d.location.origin:d.location.href,I=typeof j=="string"?j:_r(j);return I=I.replace(/ $/,"%20"),Ue(M,"No window.location.(origin|href) available to create URL for href: "+I),new URL(I,M)}let N={get action(){return f},get location(){return a(d,m)},listen(j){if(h)throw new Error("A history only accepts one active listener");return d.addEventListener(ju,b),h=j,()=>{d.removeEventListener(ju,b),h=null}},createHref(j){return l(d,j)},createURL:S,encodeLocation(j){let M=S(j);return{pathname:M.pathname,search:M.search,hash:M.hash}},push:w,replace:E,go(j){return m.go(j)}};return N}var Nu;(function(a){a.data="data",a.deferred="deferred",a.redirect="redirect",a.error="error"})(Nu||(Nu={}));function ih(a,l,o){return o===void 0&&(o="/"),ch(a,l,o)}function ch(a,l,o,c){let d=typeof l=="string"?Ys(l):l,p=Sn(d.pathname||"/",o);if(p==null)return null;let m=am(a);dh(m);let f=null;for(let h=0;f==null&&h<m.length;++h){let v=jh(p);f=vh(m[h],v)}return f}function am(a,l,o,c){l===void 0&&(l=[]),o===void 0&&(o=[]),c===void 0&&(c="");let d=(p,m,f)=>{let h={relativePath:f===void 0?p.path||"":f,caseSensitive:p.caseSensitive===!0,childrenIndex:m,route:p};h.relativePath.startsWith("/")&&(Ue(h.relativePath.startsWith(c),'Absolute route path "'+h.relativePath+'" nested under path '+('"'+c+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),h.relativePath=h.relativePath.slice(c.length));let v=Cs([c,h.relativePath]),y=o.concat(h);p.children&&p.children.length>0&&(Ue(p.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+v+'".')),am(p.children,l,y,v)),!(p.path==null&&!p.index)&&l.push({path:v,score:gh(v,p.index),routesMeta:y})};return a.forEach((p,m)=>{var f;if(p.path===""||!((f=p.path)!=null&&f.includes("?")))d(p,m);else for(let h of rm(p.path))d(p,m,h)}),l}function rm(a){let l=a.split("/");if(l.length===0)return[];let[o,...c]=l,d=o.endsWith("?"),p=o.replace(/\?$/,"");if(c.length===0)return d?[p,""]:[p];let m=rm(c.join("/")),f=[];return f.push(...m.map(h=>h===""?p:[p,h].join("/"))),d&&f.push(...m),f.map(h=>a.startsWith("/")&&h===""?"/":h)}function dh(a){a.sort((l,o)=>l.score!==o.score?o.score-l.score:yh(l.routesMeta.map(c=>c.childrenIndex),o.routesMeta.map(c=>c.childrenIndex)))}const uh=/^:[\w-]+$/,mh=3,ph=2,xh=1,hh=10,fh=-2,Su=a=>a==="*";function gh(a,l){let o=a.split("/"),c=o.length;return o.some(Su)&&(c+=fh),l&&(c+=ph),o.filter(d=>!Su(d)).reduce((d,p)=>d+(uh.test(p)?mh:p===""?xh:hh),c)}function yh(a,l){return a.length===l.length&&a.slice(0,-1).every((c,d)=>c===l[d])?a[a.length-1]-l[l.length-1]:0}function vh(a,l,o){let{routesMeta:c}=a,d={},p="/",m=[];for(let f=0;f<c.length;++f){let h=c[f],v=f===c.length-1,y=p==="/"?l:l.slice(p.length)||"/",b=ei({path:h.relativePath,caseSensitive:h.caseSensitive,end:v},y),w=h.route;if(!b)return null;Object.assign(d,b.params),m.push({params:d,pathname:Cs([p,b.pathname]),pathnameBase:Ch(Cs([p,b.pathnameBase])),route:w}),b.pathnameBase!=="/"&&(p=Cs([p,b.pathnameBase]))}return m}function ei(a,l){typeof a=="string"&&(a={path:a,caseSensitive:!1,end:!0});let[o,c]=bh(a.path,a.caseSensitive,a.end),d=l.match(o);if(!d)return null;let p=d[0],m=p.replace(/(.)\/+$/,"$1"),f=d.slice(1);return{params:c.reduce((v,y,b)=>{let{paramName:w,isOptional:E}=y;if(w==="*"){let N=f[b]||"";m=p.slice(0,p.length-N.length).replace(/(.)\/+$/,"$1")}const S=f[b];return E&&!S?v[w]=void 0:v[w]=(S||"").replace(/%2F/g,"/"),v},{}),pathname:p,pathnameBase:m,pattern:a}}function bh(a,l,o){l===void 0&&(l=!1),o===void 0&&(o=!0),Br(a==="*"||!a.endsWith("*")||a.endsWith("/*"),'Route path "'+a+'" will be treated as if it were '+('"'+a.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+a.replace(/\*$/,"/*")+'".'));let c=[],d="^"+a.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(m,f,h)=>(c.push({paramName:f,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)"));return a.endsWith("*")?(c.push({paramName:"*"}),d+=a==="*"||a==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?d+="\\/*$":a!==""&&a!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,l?void 0:"i"),c]}function jh(a){try{return a.split("/").map(l=>decodeURIComponent(l).replace(/\//g,"%2F")).join("/")}catch(l){return Br(!1,'The URL path "'+a+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+l+").")),a}}function Sn(a,l){if(l==="/")return a;if(!a.toLowerCase().startsWith(l.toLowerCase()))return null;let o=l.endsWith("/")?l.length-1:l.length,c=a.charAt(o);return c&&c!=="/"?null:a.slice(o)||"/"}const wh=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Nh=a=>wh.test(a);function Sh(a,l){l===void 0&&(l="/");let{pathname:o,search:c="",hash:d=""}=typeof a=="string"?Ys(a):a,p;if(o)if(Nh(o))p=o;else{if(o.includes("//")){let m=o;o=o.replace(/\/\/+/g,"/"),Br(!1,"Pathnames cannot have embedded double slashes - normalizing "+(m+" -> "+o))}o.startsWith("/")?p=ku(o.substring(1),"/"):p=ku(o,l)}else p=l;return{pathname:p,search:Eh(c),hash:Dh(d)}}function ku(a,l){let o=l.replace(/\/+$/,"").split("/");return a.split("/").forEach(d=>{d===".."?o.length>1&&o.pop():d!=="."&&o.push(d)}),o.length>1?o.join("/"):"/"}function Yo(a,l,o,c){return"Cannot include a '"+a+"' character in a manually specified "+("`to."+l+"` field ["+JSON.stringify(c)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function kh(a){return a.filter((l,o)=>o===0||l.route.path&&l.route.path.length>0)}function ii(a,l){let o=kh(a);return l?o.map((c,d)=>d===o.length-1?c.pathname:c.pathnameBase):o.map(c=>c.pathnameBase)}function ci(a,l,o,c){c===void 0&&(c=!1);let d;typeof a=="string"?d=Ys(a):(d=va({},a),Ue(!d.pathname||!d.pathname.includes("?"),Yo("?","pathname","search",d)),Ue(!d.pathname||!d.pathname.includes("#"),Yo("#","pathname","hash",d)),Ue(!d.search||!d.search.includes("#"),Yo("#","search","hash",d)));let p=a===""||d.pathname==="",m=p?"/":d.pathname,f;if(m==null)f=o;else{let b=l.length-1;if(!c&&m.startsWith("..")){let w=m.split("/");for(;w[0]==="..";)w.shift(),b-=1;d.pathname=w.join("/")}f=b>=0?l[b]:"/"}let h=Sh(d,f),v=m&&m!=="/"&&m.endsWith("/"),y=(p||m===".")&&o.endsWith("/");return!h.pathname.endsWith("/")&&(v||y)&&(h.pathname+="/"),h}const Cs=a=>a.join("/").replace(/\/\/+/g,"/"),Ch=a=>a.replace(/\/+$/,"").replace(/^\/*/,"/"),Eh=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,Dh=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a;function Ih(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.internal=="boolean"&&"data"in a}const lm=["post","put","patch","delete"];new Set(lm);const Mh=["get",...lm];new Set(Mh);function ba(){return ba=Object.assign?Object.assign.bind():function(a){for(var l=1;l<arguments.length;l++){var o=arguments[l];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(a[c]=o[c])}return a},ba.apply(this,arguments)}const Ur=x.createContext(null),om=x.createContext(null),as=x.createContext(null),Wr=x.createContext(null),rs=x.createContext({outlet:null,matches:[],isDataRoute:!1}),im=x.createContext(null);function Ph(a,l){let{relative:o}=l===void 0?{}:l;En()||Ue(!1);let{basename:c,navigator:d}=x.useContext(as),{hash:p,pathname:m,search:f}=Vr(a,{relative:o}),h=m;return c!=="/"&&(h=m==="/"?c:Cs([c,m])),d.createHref({pathname:h,search:f,hash:p})}function En(){return x.useContext(Wr)!=null}function Dn(){return En()||Ue(!1),x.useContext(Wr).location}function cm(a){x.useContext(as).static||x.useLayoutEffect(a)}function Hr(){let{isDataRoute:a}=x.useContext(rs);return a?Gh():Ah()}function Ah(){En()||Ue(!1);let a=x.useContext(Ur),{basename:l,future:o,navigator:c}=x.useContext(as),{matches:d}=x.useContext(rs),{pathname:p}=Dn(),m=JSON.stringify(ii(d,o.v7_relativeSplatPath)),f=x.useRef(!1);return cm(()=>{f.current=!0}),x.useCallback(function(v,y){if(y===void 0&&(y={}),!f.current)return;if(typeof v=="number"){c.go(v);return}let b=ci(v,JSON.parse(m),p,y.relative==="path");a==null&&l!=="/"&&(b.pathname=b.pathname==="/"?l:Cs([l,b.pathname])),(y.replace?c.replace:c.push)(b,y.state,y)},[l,c,m,p,a])}const Th=x.createContext(null);function Lh(a){let l=x.useContext(rs).outlet;return l&&x.createElement(Th.Provider,{value:a},l)}function Vr(a,l){let{relative:o}=l===void 0?{}:l,{future:c}=x.useContext(as),{matches:d}=x.useContext(rs),{pathname:p}=Dn(),m=JSON.stringify(ii(d,c.v7_relativeSplatPath));return x.useMemo(()=>ci(a,JSON.parse(m),p,o==="path"),[a,m,p,o])}function Fh(a,l){return $h(a,l)}function $h(a,l,o,c){En()||Ue(!1);let{navigator:d}=x.useContext(as),{matches:p}=x.useContext(rs),m=p[p.length-1],f=m?m.params:{};m&&m.pathname;let h=m?m.pathnameBase:"/";m&&m.route;let v=Dn(),y;if(l){var b;let j=typeof l=="string"?Ys(l):l;h==="/"||(b=j.pathname)!=null&&b.startsWith(h)||Ue(!1),y=j}else y=v;let w=y.pathname||"/",E=w;if(h!=="/"){let j=h.replace(/^\//,"").split("/");E="/"+w.replace(/^\//,"").split("/").slice(j.length).join("/")}let S=ih(a,{pathname:E}),N=Bh(S&&S.map(j=>Object.assign({},j,{params:Object.assign({},f,j.params),pathname:Cs([h,d.encodeLocation?d.encodeLocation(j.pathname).pathname:j.pathname]),pathnameBase:j.pathnameBase==="/"?h:Cs([h,d.encodeLocation?d.encodeLocation(j.pathnameBase).pathname:j.pathnameBase])})),p,o,c);return l&&N?x.createElement(Wr.Provider,{value:{location:ba({pathname:"/",search:"",hash:"",state:null,key:"default"},y),navigationType:ks.Pop}},N):N}function Rh(){let a=Vh(),l=Ih(a)?a.status+" "+a.statusText:a instanceof Error?a.message:JSON.stringify(a),o=a instanceof Error?a.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return x.createElement(x.Fragment,null,x.createElement("h2",null,"Unexpected Application Error!"),x.createElement("h3",{style:{fontStyle:"italic"}},l),o?x.createElement("pre",{style:d},o):null,null)}const zh=x.createElement(Rh,null);class _h extends x.Component{constructor(l){super(l),this.state={location:l.location,revalidation:l.revalidation,error:l.error}}static getDerivedStateFromError(l){return{error:l}}static getDerivedStateFromProps(l,o){return o.location!==l.location||o.revalidation!=="idle"&&l.revalidation==="idle"?{error:l.error,location:l.location,revalidation:l.revalidation}:{error:l.error!==void 0?l.error:o.error,location:o.location,revalidation:l.revalidation||o.revalidation}}componentDidCatch(l,o){console.error("React Router caught the following error during render",l,o)}render(){return this.state.error!==void 0?x.createElement(rs.Provider,{value:this.props.routeContext},x.createElement(im.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Oh(a){let{routeContext:l,match:o,children:c}=a,d=x.useContext(Ur);return d&&d.static&&d.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=o.route.id),x.createElement(rs.Provider,{value:l},c)}function Bh(a,l,o,c){var d;if(l===void 0&&(l=[]),o===void 0&&(o=null),c===void 0&&(c=null),a==null){var p;if(!o)return null;if(o.errors)a=o.matches;else if((p=c)!=null&&p.v7_partialHydration&&l.length===0&&!o.initialized&&o.matches.length>0)a=o.matches;else return null}let m=a,f=(d=o)==null?void 0:d.errors;if(f!=null){let y=m.findIndex(b=>b.route.id&&f?.[b.route.id]!==void 0);y>=0||Ue(!1),m=m.slice(0,Math.min(m.length,y+1))}let h=!1,v=-1;if(o&&c&&c.v7_partialHydration)for(let y=0;y<m.length;y++){let b=m[y];if((b.route.HydrateFallback||b.route.hydrateFallbackElement)&&(v=y),b.route.id){let{loaderData:w,errors:E}=o,S=b.route.loader&&w[b.route.id]===void 0&&(!E||E[b.route.id]===void 0);if(b.route.lazy||S){h=!0,v>=0?m=m.slice(0,v+1):m=[m[0]];break}}}return m.reduceRight((y,b,w)=>{let E,S=!1,N=null,j=null;o&&(E=f&&b.route.id?f[b.route.id]:void 0,N=b.route.errorElement||zh,h&&(v<0&&w===0?(qh("route-fallback"),S=!0,j=null):v===w&&(S=!0,j=b.route.hydrateFallbackElement||null)));let M=l.concat(m.slice(0,w+1)),I=()=>{let V;return E?V=N:S?V=j:b.route.Component?V=x.createElement(b.route.Component,null):b.route.element?V=b.route.element:V=y,x.createElement(Oh,{match:b,routeContext:{outlet:y,matches:M,isDataRoute:o!=null},children:V})};return o&&(b.route.ErrorBoundary||b.route.errorElement||w===0)?x.createElement(_h,{location:o.location,revalidation:o.revalidation,component:N,error:E,children:I(),routeContext:{outlet:null,matches:M,isDataRoute:!0}}):I()},null)}var dm=(function(a){return a.UseBlocker="useBlocker",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a})(dm||{}),um=(function(a){return a.UseBlocker="useBlocker",a.UseLoaderData="useLoaderData",a.UseActionData="useActionData",a.UseRouteError="useRouteError",a.UseNavigation="useNavigation",a.UseRouteLoaderData="useRouteLoaderData",a.UseMatches="useMatches",a.UseRevalidator="useRevalidator",a.UseNavigateStable="useNavigate",a.UseRouteId="useRouteId",a})(um||{});function Uh(a){let l=x.useContext(Ur);return l||Ue(!1),l}function Wh(a){let l=x.useContext(om);return l||Ue(!1),l}function Hh(a){let l=x.useContext(rs);return l||Ue(!1),l}function mm(a){let l=Hh(),o=l.matches[l.matches.length-1];return o.route.id||Ue(!1),o.route.id}function Vh(){var a;let l=x.useContext(im),o=Wh(),c=mm();return l!==void 0?l:(a=o.errors)==null?void 0:a[c]}function Gh(){let{router:a}=Uh(dm.UseNavigateStable),l=mm(um.UseNavigateStable),o=x.useRef(!1);return cm(()=>{o.current=!0}),x.useCallback(function(d,p){p===void 0&&(p={}),o.current&&(typeof d=="number"?a.navigate(d):a.navigate(d,ba({fromRouteId:l},p)))},[a,l])}const Cu={};function qh(a,l,o){Cu[a]||(Cu[a]=!0)}function Qh(a,l){a?.v7_startTransition,a?.v7_relativeSplatPath}function Gs(a){let{to:l,replace:o,state:c,relative:d}=a;En()||Ue(!1);let{future:p,static:m}=x.useContext(as),{matches:f}=x.useContext(rs),{pathname:h}=Dn(),v=Hr(),y=ci(l,ii(f,p.v7_relativeSplatPath),h,d==="path"),b=JSON.stringify(y);return x.useEffect(()=>v(JSON.parse(b),{replace:o,state:c,relative:d}),[v,b,d,o,c]),null}function di(a){return Lh(a.context)}function $e(a){Ue(!1)}function Yh(a){let{basename:l="/",children:o=null,location:c,navigationType:d=ks.Pop,navigator:p,static:m=!1,future:f}=a;En()&&Ue(!1);let h=l.replace(/^\/*/,"/"),v=x.useMemo(()=>({basename:h,navigator:p,static:m,future:ba({v7_relativeSplatPath:!1},f)}),[h,f,p,m]);typeof c=="string"&&(c=Ys(c));let{pathname:y="/",search:b="",hash:w="",state:E=null,key:S="default"}=c,N=x.useMemo(()=>{let j=Sn(y,h);return j==null?null:{location:{pathname:j,search:b,hash:w,state:E,key:S},navigationType:d}},[h,y,b,w,E,S,d]);return N==null?null:x.createElement(as.Provider,{value:v},x.createElement(Wr.Provider,{children:o,value:N}))}function Kh(a){let{children:l,location:o}=a;return Fh(ti(l),o)}new Promise(()=>{});function ti(a,l){l===void 0&&(l=[]);let o=[];return x.Children.forEach(a,(c,d)=>{if(!x.isValidElement(c))return;let p=[...l,d];if(c.type===x.Fragment){o.push.apply(o,ti(c.props.children,p));return}c.type!==$e&&Ue(!1),!c.props.index||!c.props.children||Ue(!1);let m={id:c.props.id||p.join("-"),caseSensitive:c.props.caseSensitive,element:c.props.element,Component:c.props.Component,index:c.props.index,path:c.props.path,loader:c.props.loader,action:c.props.action,errorElement:c.props.errorElement,ErrorBoundary:c.props.ErrorBoundary,hasErrorBoundary:c.props.ErrorBoundary!=null||c.props.errorElement!=null,shouldRevalidate:c.props.shouldRevalidate,handle:c.props.handle,lazy:c.props.lazy};c.props.children&&(m.children=ti(c.props.children,p)),o.push(m)}),o}function Or(){return Or=Object.assign?Object.assign.bind():function(a){for(var l=1;l<arguments.length;l++){var o=arguments[l];for(var c in o)Object.prototype.hasOwnProperty.call(o,c)&&(a[c]=o[c])}return a},Or.apply(this,arguments)}function pm(a,l){if(a==null)return{};var o={},c=Object.keys(a),d,p;for(p=0;p<c.length;p++)d=c[p],!(l.indexOf(d)>=0)&&(o[d]=a[d]);return o}function Jh(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}function Xh(a,l){return a.button===0&&(!l||l==="_self")&&!Jh(a)}const Zh=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],ef=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],tf="6";try{window.__reactRouterVersion=tf}catch{}const sf=x.createContext({isTransitioning:!1}),nf="startTransition",Eu=Xx[nf];function af(a){let{basename:l,children:o,future:c,window:d}=a,p=x.useRef();p.current==null&&(p.current=rh({window:d,v5Compat:!0}));let m=p.current,[f,h]=x.useState({action:m.action,location:m.location}),{v7_startTransition:v}=c||{},y=x.useCallback(b=>{v&&Eu?Eu(()=>h(b)):h(b)},[h,v]);return x.useLayoutEffect(()=>m.listen(y),[m,y]),x.useEffect(()=>Qh(c),[c]),x.createElement(Yh,{basename:l,children:o,location:f.location,navigationType:f.action,navigator:m,future:c})}const rf=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",lf=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,kn=x.forwardRef(function(l,o){let{onClick:c,relative:d,reloadDocument:p,replace:m,state:f,target:h,to:v,preventScrollReset:y,viewTransition:b}=l,w=pm(l,Zh),{basename:E}=x.useContext(as),S,N=!1;if(typeof v=="string"&&lf.test(v)&&(S=v,rf))try{let V=new URL(window.location.href),$=v.startsWith("//")?new URL(V.protocol+v):new URL(v),P=Sn($.pathname,E);$.origin===V.origin&&P!=null?v=P+$.search+$.hash:N=!0}catch{}let j=Ph(v,{relative:d}),M=df(v,{replace:m,state:f,target:h,preventScrollReset:y,relative:d,viewTransition:b});function I(V){c&&c(V),V.defaultPrevented||M(V)}return x.createElement("a",Or({},w,{href:S||j,onClick:N||p?c:I,ref:o,target:h}))}),of=x.forwardRef(function(l,o){let{"aria-current":c="page",caseSensitive:d=!1,className:p="",end:m=!1,style:f,to:h,viewTransition:v,children:y}=l,b=pm(l,ef),w=Vr(h,{relative:b.relative}),E=Dn(),S=x.useContext(om),{navigator:N,basename:j}=x.useContext(as),M=S!=null&&uf(w)&&v===!0,I=N.encodeLocation?N.encodeLocation(w).pathname:w.pathname,V=E.pathname,$=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;d||(V=V.toLowerCase(),$=$?$.toLowerCase():null,I=I.toLowerCase()),$&&j&&($=Sn($,j)||$);const P=I!=="/"&&I.endsWith("/")?I.length-1:I.length;let q=V===I||!m&&V.startsWith(I)&&V.charAt(P)==="/",k=$!=null&&($===I||!m&&$.startsWith(I)&&$.charAt(I.length)==="/"),D={isActive:q,isPending:k,isTransitioning:M},_=q?c:void 0,O;typeof p=="function"?O=p(D):O=[p,q?"active":null,k?"pending":null,M?"transitioning":null].filter(Boolean).join(" ");let K=typeof f=="function"?f(D):f;return x.createElement(kn,Or({},b,{"aria-current":_,className:O,ref:o,style:K,to:h,viewTransition:v}),typeof y=="function"?y(D):y)});var si;(function(a){a.UseScrollRestoration="useScrollRestoration",a.UseSubmit="useSubmit",a.UseSubmitFetcher="useSubmitFetcher",a.UseFetcher="useFetcher",a.useViewTransitionState="useViewTransitionState"})(si||(si={}));var Du;(function(a){a.UseFetcher="useFetcher",a.UseFetchers="useFetchers",a.UseScrollRestoration="useScrollRestoration"})(Du||(Du={}));function cf(a){let l=x.useContext(Ur);return l||Ue(!1),l}function df(a,l){let{target:o,replace:c,state:d,preventScrollReset:p,relative:m,viewTransition:f}=l===void 0?{}:l,h=Hr(),v=Dn(),y=Vr(a,{relative:m});return x.useCallback(b=>{if(Xh(b,o)){b.preventDefault();let w=c!==void 0?c:_r(v)===_r(y);h(a,{replace:w,state:d,preventScrollReset:p,relative:m,viewTransition:f})}},[v,h,y,c,d,o,a,p,m,f])}function uf(a,l){l===void 0&&(l={});let o=x.useContext(sf);o==null&&Ue(!1);let{basename:c}=cf(si.useViewTransitionState),d=Vr(a,{relative:l.relative});if(!o.isTransitioning)return!1;let p=Sn(o.currentLocation.pathname,c)||o.currentLocation.pathname,m=Sn(o.nextLocation.pathname,c)||o.nextLocation.pathname;return ei(d.pathname,m)!=null||ei(d.pathname,p)!=null}const mf="https://script.google.com/macros/s/AKfycbzvW4BZR43cUSA90lAjAbTx1CMpT4MM0PthkdxjnkLeQ8GbAQpEjljYfZ0IWd-fcrKE/exec",pf=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("rect",{width:"7",height:"9",x:"3",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"5",x:"14",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"9",x:"14",y:"12",rx:"1"}),e.jsx("rect",{width:"7",height:"5",x:"3",y:"16",rx:"1"})]}),Ot=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),xm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"}),e.jsx("path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"})]}),Gr=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("polyline",{points:"9 11 12 14 22 4"}),e.jsx("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]}),xf=a=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:e.jsx("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2"})}),hm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("line",{x1:"12",x2:"12",y1:"2",y2:"22"}),e.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),Rr=a=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:e.jsx("path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"})}),ja=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M8 6v6"}),e.jsx("path",{d:"M16 6v6"}),e.jsx("path",{d:"M2 12h19.6"}),e.jsx("path",{d:"M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3"}),e.jsx("circle",{cx:"7",cy:"18",r:"2"}),e.jsx("path",{d:"M9 18h5"}),e.jsx("circle",{cx:"16",cy:"18",r:"2"})]}),fm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v2"}),e.jsx("path",{d:"M21 14v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"3 10 12 15 21 10"}),e.jsx("line",{x1:"12",y1:"22",x2:"12",y2:"15"})]}),ui=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("line",{x1:"10",y1:"9",x2:"8",y2:"9"})]}),Cn=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),hf=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"}),e.jsx("line",{x1:"12",x2:"12",y1:"14",y2:"20"}),e.jsx("line",{x1:"9",x2:"15",y1:"17",y2:"17"})]}),mi=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"12 6 12 12 16 14"})]}),pi=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"8.5",cy:"7",r:"4"}),e.jsx("line",{x1:"20",y1:"8",x2:"20",y2:"14"}),e.jsx("line",{x1:"17",y1:"11",x2:"23",y2:"11"})]}),qr=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),ni=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),gm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("rect",{width:"20",height:"14",x:"2",y:"5",rx:"2"}),e.jsx("line",{x1:"2",x2:"22",y1:"10",y2:"10"})]}),jt=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),e.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),e.jsx("rect",{width:"12",height:"8",x:"6",y:"14"})]}),wt=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"}),e.jsx("path",{d:"m15 5 4 4"})]}),Re=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),e.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]}),ym=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M2 17h6a4 4 0 0 0 4-4V5a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2z"}),e.jsx("path",{d:"M22 17h-6a4 4 0 0 1-4-4V5a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2z"})]}),vm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1"}),e.jsx("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),e.jsx("path",{d:"m9 14 2 2 4-4"})]}),ff=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}),e.jsx("path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"})]}),qs=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("path",{d:"M12 8v4"}),e.jsx("path",{d:"M12 16h.01"})]}),gf=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),e.jsx("polyline",{points:"10 17 15 12 10 7"}),e.jsx("line",{x1:"15",x2:"3",y1:"12",y2:"12"})]}),bm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",y1:"12",x2:"9",y2:"12"})]}),xi=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]}),jm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("polyline",{points:"16 11 18 13 22 9"})]}),yf=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("line",{x1:"17",y1:"8",x2:"22",y2:"13"}),e.jsx("line",{x1:"22",y1:"8",x2:"17",y2:"13"})]}),vf=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("circle",{cx:"8",cy:"8",r:"6"}),e.jsx("path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18"}),e.jsx("path",{d:"M7 6h1v4"}),e.jsx("path",{d:"m16.71 13.88.7.71-2.82 2.82-.71-.71A3.9 3.9 0 0 1 12 16a4 4 0 0 1 4-4 3.9 3.9 0 0 1 .88 1.29z"})]}),wm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("line",{x1:"21",x2:"14",y1:"4",y2:"4"}),e.jsx("line",{x1:"10",x2:"3",y1:"4",y2:"4"}),e.jsx("line",{x1:"21",x2:"12",y1:"12",y2:"12"}),e.jsx("line",{x1:"8",x2:"3",y1:"12",y2:"12"}),e.jsx("line",{x1:"21",x2:"16",y1:"20",y2:"20"}),e.jsx("line",{x1:"12",x2:"3",y1:"20",y2:"20"}),e.jsx("line",{x1:"14",x2:"14",y1:"2",y2:"6"}),e.jsx("line",{x1:"8",x2:"8",y1:"10",y2:"14"}),e.jsx("line",{x1:"16",x2:"16",y1:"18",y2:"22"})]}),Nm=a=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),Bt=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),hi=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"}),e.jsx("path",{d:"M21 3v5h-5"}),e.jsx("path",{d:"M3 21v-5h5"}),e.jsx("path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"})]}),fi=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"12"}),e.jsx("line",{x1:"12",x2:"12.01",y1:"16",y2:"16"})]}),gi=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),Sm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),e.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),e.jsx("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),e.jsx("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),e.jsx("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),e.jsx("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),e.jsx("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),e.jsx("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]}),km=a=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}),bf=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("line",{x1:"4",x2:"20",y1:"12",y2:"12"}),e.jsx("line",{x1:"4",x2:"20",y1:"6",y2:"6"}),e.jsx("line",{x1:"4",x2:"20",y1:"18",y2:"18"})]}),zr=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),ai=a=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:e.jsx("path",{d:"m9 18 6-6-6-6"})}),Cm=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),Iu=a=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:e.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})}),jf=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),Mu=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),wf=[{href:"/app/dashboard",label:"Dashboard",icon:pf,roles:["Admin","Teacher","Student","Support Staff","Librarian","IT Admin","Finance Admin","Driver"]},{href:"/app/students",label:"Students",icon:Ot,roles:["Admin","Teacher","Student","Finance Admin"]},{href:"/app/attendance",label:"Attendance",icon:Gr,roles:["Admin","Teacher","Student"]},{href:"/app/academics",label:"Academics",icon:xm,roles:["Admin","Teacher","Student"]},{href:"/app/classes",label:"Classes",icon:ym,roles:["Admin","Teacher"]},{href:"/app/exams",label:"Exams & Results",icon:ui,roles:["Admin","Teacher","Student"]},{href:"/app/finance",label:"Finance",icon:hm,roles:["Admin","Student","Finance Admin"]},{href:"/app/staff",label:"Staff",icon:Ot,roles:["Admin","Finance Admin","IT Admin"]},{href:"/app/leave",label:"Leave",icon:hf,roles:["Admin","Teacher","Support Staff","Librarian","IT Admin","Finance Admin","Driver"]},{href:"/app/communication",label:"Communication",icon:Rr,roles:["Admin","Teacher","IT Admin"]},{href:"/app/events",label:"Events",icon:Cn,roles:["Admin","Teacher","Student","Support Staff","Librarian","IT Admin","Finance Admin","Driver"]},{href:"/app/transport",label:"Transport",icon:ja,roles:["Admin","Driver"]},{href:"/app/inventory",label:"Inventory",icon:fm,roles:["Admin","Librarian","IT Admin"]},{href:"/app/id-cards",label:"ID Cards",icon:gm,roles:["Admin","IT Admin"]},{href:"/app/administration",label:"Administration",icon:wm,roles:["Admin","IT Admin"]}],Nf=()=>{try{const a=localStorage.getItem("madrasa_user");if(a)return JSON.parse(a).role}catch{return null}return null},ae=async(a,l)=>{const o=l||mf,c=new URL(o);if(c.searchParams.append("v",Date.now().toString()),!a.authRole){const d=Nf();d&&(a.authRole=d)}try{const d=await fetch(c.toString(),{method:"POST",mode:"cors",cache:"no-store",body:JSON.stringify(a)});if(!d.ok){const m=await d.text();throw new Error(`Request failed with status ${d.status}. Response: ${m}`)}const p=await d.json();if(p.error)throw new Error(p.error);return p}catch(d){if(console.error("Full error in gsPost:",d),d instanceof TypeError&&d.message==="Failed to fetch"){const p=`A "Failed to fetch" network error occurred. This is almost always a configuration issue with your Google Apps Script deployment.

Please perform these steps EXACTLY:
1. Open your Google Sheet and go to Extensions > Apps Script.
2. Make sure the Code.gs file contains the LATEST script provided.
3. Click the BLUE "Deploy" button and select "New deployment".
4. For "Who has access", you MUST select "Anyone".
5. Click "Deploy". Authorize if it asks.
6. You will get a NEW Web app URL ending in /exec. COPY this new URL.
7. Paste the NEW URL into the 'constants.tsx' file or the Exam Definition settings.

Your current URL might be old or have the wrong permissions. Creating a NEW deployment is essential.`;throw alert(p),new Error(p)}throw d}},Ie=async(a,l)=>{try{const o=await ae({action:"read",sheetName:a},l);if(o.error)throw new Error(o.error);return o}catch(o){throw console.error(`Error fetching from sheet "${a}":`,o),o}},Em=a=>{if(!a)return[];if(Array.isArray(a))return a;if(typeof a=="string"){const l=a.trim();if(l.startsWith("[")&&l.endsWith("]"))try{return JSON.parse(l)}catch(o){return console.error("Failed to parse paidItems JSON string:",l,o),[]}if(l.length>0)return l.split(",").map(o=>o.trim())}return[]},wa=(a,l=100)=>{if(a==null||a<0)return{grade:"F",gpa:"0.00",point:0,color:"#e53e3e"};const o=a/l*100;return o>=80?{grade:"A+",gpa:"5.00",point:5,color:"#38a169"}:o>=70?{grade:"A",gpa:"4.00",point:4,color:"#38a169"}:o>=60?{grade:"A-",gpa:"3.50",point:3.5,color:"#ecc94b"}:o>=50?{grade:"B",gpa:"3.00",point:3,color:"#ed8936"}:o>=40?{grade:"C",gpa:"2.00",point:2,color:"#f56565"}:o>=33?{grade:"D",gpa:"1.00",point:1,color:"#f56565"}:{grade:"F",gpa:"0.00",point:0,color:"#e53e3e"}},Dm=a=>{let l=0,o=0,c=!1;for(const h of a){const v=wa(h.marks,h.totalMarks);v.grade==="F"&&(c=!0),l+=v.point,o++}if(o===0)return{grade:"N/A",gpa:"0.00",color:"#a0aec0"};if(c)return{grade:"F",gpa:"0.00",color:"#e53e3e"};const d=l/o,p=d.toFixed(2);let m="F",f="#e53e3e";return d>=5?(m="A+",f="#38a169"):d>=4?(m="A",f="#38a169"):d>=3.5?(m="A-",f="#ecc94b"):d>=3?(m="B",f="#ed8936"):d>=2?(m="C",f="#f56565"):d>=1&&(m="D",f="#f56565"),{grade:m,gpa:p,color:f}},Pu=a=>{const l=a.toLowerCase().replace(/\s+/g,"");return l.includes("five")||l==="class5"||l==="5"?8:l.includes("four")||l==="class4"||l==="4"?7:l.includes("three")||l==="class3"||l==="3"?6:l.includes("two")||l==="class2"||l==="2"?5:l.includes("one")||l==="class1"||l==="1"?4:l==="kg"?3:l==="nursery"?2:l==="play"?1:99},Qr=(a,l)=>Pu(a)-Pu(l),Sf="MadrasaAppDB",kf=1,Ds="app_cache",yi=()=>new Promise((a,l)=>{const o=indexedDB.open(Sf,kf);o.onupgradeneeded=c=>{const d=c.target.result;d.objectStoreNames.contains(Ds)||d.createObjectStore(Ds)},o.onsuccess=c=>{a(c.target.result)},o.onerror=c=>{l(c.target.error)}}),Cf=async a=>{try{const l=await yi();return new Promise((o,c)=>{const m=l.transaction(Ds,"readonly").objectStore(Ds).get(a);m.onsuccess=()=>o(m.result||null),m.onerror=()=>c(m.error)})}catch(l){return console.error("IDB Get Error",l),null}},Im=async(a,l)=>{try{const o=await yi();return new Promise((c,d)=>{const f=o.transaction(Ds,"readwrite").objectStore(Ds).put(l,a);f.onsuccess=()=>c(),f.onerror=()=>d(f.error)})}catch(o){console.error("IDB Save Error",o)}},Ef=async()=>{try{const a=await yi();return new Promise((l,o)=>{const p=a.transaction(Ds,"readwrite").objectStore(Ds).clear();p.onsuccess=()=>l(),p.onerror=()=>o(p.error)})}catch(a){console.error("IDB Clear Error",a)}},Es={students:null,staff:null,classes:null,users:null,subjects:null,timetable:null,homework:null,exams:null,examDefinitions:null,results:null,events:null,leaveRequests:null,academicSessions:null,vehicles:null,inventory:null,notices:null,disciplineIncidents:null,attendance:null,expenses:null,feeStructure:null,feePayments:null,salaryPayments:null,syllabusStatus:null},vi="madrasa_app_data";async function bi(a=!1){if(console.log(a?"Forcing cache clear...":"Initializing app & loading cache from IndexedDB..."),a&&await Ef(),Object.keys(Es).forEach(l=>{Es[l]=null}),!a)try{const l=await Cf(vi);l&&(console.log("Hydrating cache from IndexedDB"),Object.assign(Es,l))}catch(l){console.warn("Failed to load from IndexedDB",l)}}function De(a){return Es[a]}function Te(a,l){Es[a]=l,Im(vi,Es).catch(o=>console.error("Failed to persist cache",o))}function ue(a){console.log(`Cache invalidated for: ${a}`),Es[a]=null,Im(vi,Es).catch(l=>console.error("Failed to persist cache update",l))}const Df=async()=>await Ie("Institution"),If=async a=>(await ae({action:"create",sheetName:"Institution",data:a}),a),Mf=async a=>(await ae({action:"update",sheetName:"Institution",id:a.id,data:a}),a),Pf=async()=>{let a=De("academicSessions");return a||(a=await Ie("AcademicSessions"),Te("academicSessions",a)),a},Af=async a=>{const l={...a,id:`SESS${Date.now()}`,isActive:!1};return await ae({action:"create",sheetName:"AcademicSessions",data:l}),ue("academicSessions"),l},Tf=async a=>(await ae({action:"update",sheetName:"AcademicSessions",id:a.id,data:a}),ue("academicSessions"),a),Lf=async a=>{await ae({action:"setActiveSession",sheetName:"AcademicSessions",id:a}),ue("academicSessions")},Ff=async a=>{await ae({action:"delete",sheetName:"AcademicSessions",id:a}),ue("academicSessions")},at="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJsdWNpZGUgbHVjaWRlLXVzZXItcm91bmQiPjxjaXJjbGUgY3g9IjEyIiBjeT0iOCIgcj0iNSIvPjxwYXRoIGQ9Ik0yMCAyMWE4IDggMCAwIDAtMTYgMCIvPjwvc3ZnPg==",$f=async(a=!1)=>{let l=a?null:De("users");return l||(l=await Ie("Users"),Te("users",l)),l},Mm=async(a,l)=>{try{const o=await ae({action:"login",username:a.trim(),password:l.trim()});return o&&o.user?o.user:null}catch(o){throw console.error("Login System Error:",o),new Error("Authentication failed. Please ensure the backend script is updated.")}},Au=async a=>{const l=await ae({action:"send_otp",username:a.trim()});if(l.error)throw new Error(l.error)},Rf=async(a,l)=>{const o=await ae({action:"verify_otp",username:a.trim(),code:l.trim()});if(o.error)throw new Error(o.error);return o.success},zf=async a=>{const l=De("users")??await Ie("Users");let o="IICM-U";switch(a.role){case"Student":o="IICM-S";break;case"Teacher":o="IICM-T";break;case"Admin":o="IICM-A";break;case"Librarian":o="IICM-L";break;case"IT Admin":o="IICM-ITA";break;case"Finance Admin":o="IICM-FA";break;case"Driver":o="IICM-D";break;case"Support Staff":o="IICM-SS";break}const c=l.filter(m=>m.id.startsWith(o)).length,d=`${o}${String(c+1).padStart(3,"0")}`,p={...a,id:d,username:d,photo:a.photo||at,email:a.email||""};return await ae({action:"create",sheetName:"Users",data:p}),ue("users"),p},_f=async a=>(await ae({action:"update",sheetName:"Users",id:a.id,data:a}),ue("users"),a),Of=async a=>{await ae({action:"delete",sheetName:"Users",id:a}),ue("users"),a.includes("IICM-S")?(await ae({action:"delete",sheetName:"Students",id:a}),ue("students")):(a.includes("IICM-T")||a.includes("IICM-A")||a.includes("IICM-L")||a.includes("IICM-FA")||a.includes("IICM-ITA")||a.includes("IICM-SS")||a.includes("IICM-D"))&&(await ae({action:"delete",sheetName:"Staff",id:a}),ue("staff"))},Bf=a=>({...a,guardianPhone:a.guardianPhone&&String(a.guardianPhone).startsWith("'")?String(a.guardianPhone).substring(1):a.guardianPhone}),Pm=a=>{const l={...a};return l.guardianPhone&&!String(l.guardianPhone).startsWith("'")&&(l.guardianPhone=`'${l.guardianPhone}`),l},tt=async(a,l)=>{const o="students";let c=De(o);return c||(c=await Ie("Students",l),c=c.map(Bf),Te(o,c)),a?.class&&(c=c.filter(d=>d.class===a.class)),a?.section&&(c=c.filter(d=>d.section===a.section)),c},Uf=async a=>{const l=De("students")??await Ie("Students"),o="IICM-S",c=l.filter(v=>v.id.startsWith(o)).map(v=>parseInt(v.id.replace(o,""),10)).filter(v=>!isNaN(v)),d=c.length>0?Math.max(...c):0,p=`${o}${String(d+1).padStart(3,"0")}`;let m=a.admissionDate;if(!m){const v=new Date,y=v.getFullYear(),b=String(v.getMonth()+1).padStart(2,"0"),w=String(v.getDate()).padStart(2,"0");m=`${y}-${b}-${w}`}const f={...a,id:p,admissionDate:m},h=Pm(f);return await ae({action:"create",sheetName:"Students",data:h}),await ae({action:"create",sheetName:"Users",data:{id:p,username:p,password:p.toLowerCase(),name:a.name,role:"Student",photo:a.photo}}),ue("students"),ue("users"),f},Wf=async a=>{const l=Pm(a);return await ae({action:"update",sheetName:"Students",id:a.id,data:l}),await ae({action:"update",sheetName:"Users",id:a.id,data:{name:a.name,photo:a.photo}}),ue("students"),ue("users"),a},Hf=async a=>{await ae({action:"delete",sheetName:"Students",id:a}),await ae({action:"delete",sheetName:"Users",id:a}),ue("students"),ue("users")},Vf=a=>({...a,phone:a.phone&&String(a.phone).startsWith("'")?String(a.phone).substring(1):a.phone}),Am=a=>{const l={...a};return l.phone&&!String(l.phone).startsWith("'")&&(l.phone=`'${l.phone}`),l},dt=async a=>{const l="staff";let o=De(l);return o||(o=await Ie("Staff",a),o=o.map(Vf),Te(l,o)),o},Gf=async a=>{const l=De("staff")??await Ie("Staff");let o="IICM-T";switch(a.role){case"Admin":o="IICM-A";break;case"Librarian":o="IICM-L";break;case"IT Admin":o="IICM-ITA";break;case"Finance Admin":o="IICM-FA";break;case"Driver":o="IICM-D";break;case"Support Staff":o="IICM-SS";break;default:o="IICM-T";break}const c=l.filter(v=>v.id.startsWith(o)).map(v=>parseInt(v.id.replace(o,""),10)).filter(v=>!isNaN(v)),d=c.length>0?Math.max(...c):0,p=`${o}${String(d+1).padStart(3,"0")}`;let m=a.joiningDate;if(!m){const v=new Date,y=v.getFullYear(),b=String(v.getMonth()+1).padStart(2,"0"),w=String(v.getDate()).padStart(2,"0");m=`${y}-${b}-${w}`}const f={...a,id:p,joiningDate:m},h=Am(f);return await ae({action:"create",sheetName:"Staff",data:h}),await ae({action:"create",sheetName:"Users",data:{id:p,username:p,password:"password123",name:a.name,role:a.role,photo:a.photo}}),ue("staff"),ue("users"),f},qf=async a=>{const l=Am(a);return await ae({action:"update",sheetName:"Staff",id:a.id,data:l}),await ae({action:"update",sheetName:"Users",id:a.id,data:{name:a.name,photo:a.photo,role:a.role}}),ue("staff"),ue("users"),a},Qf=async a=>{await ae({action:"delete",sheetName:"Staff",id:a}),await ae({action:"delete",sheetName:"Users",id:a}),ue("staff"),ue("users")},ut=async a=>{const l="classes";let o=De(l);return o||(o=await Ie("Classes",a),Te(l,o)),o},Yf=async a=>{const l=De("classes")??await Ie("Classes"),o={...a,id:`C${String(l.length+1).padStart(2,"0")}`};return await ae({action:"create",sheetName:"Classes",data:o}),ue("classes"),o},Kf=async a=>(await ae({action:"update",sheetName:"Classes",id:a.id,data:a}),ue("classes"),a),Jf=async a=>{await ae({action:"delete",sheetName:"Classes",id:a}),ue("classes")},Yr=async()=>{let a=De("feeStructure");return a||(a=await Ie("FeeStructure"),Te("feeStructure",a)),a},Tm=async()=>{let a=De("feePayments");return a||(a=await Ie("FeePayments"),Te("feePayments",a)),a},Xf=async()=>{let a=De("salaryPayments");return a||(a=await Ie("SalaryPayments"),Te("salaryPayments",a)),a},Zf=async()=>{let a=De("expenses");return a||(a=await Ie("Expenses"),Te("expenses",a)),a},eg=async a=>{const l={...a,id:`FS${Date.now()}`};return await ae({action:"create",sheetName:"FeeStructure",data:l}),ue("feeStructure"),l},tg=async a=>(await ae({action:"update",sheetName:"FeeStructure",id:a.id,data:a}),ue("feeStructure"),a),sg=async a=>{await ae({action:"delete",sheetName:"FeeStructure",id:a}),ue("feeStructure")},ng=async(a,l)=>(await Zf()).filter(c=>{const d=new Date(c.date);return d.getFullYear()===a&&d.getMonth()+1===l}),ag=async a=>{const l=new Date,o=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`,c={...a,id:`EXP${Date.now()}`,date:o};return await ae({action:"create",sheetName:"Expenses",data:c}),ue("expenses"),c},rg=async a=>{await ae({action:"delete",sheetName:"Expenses",id:a}),ue("expenses")},Kr=async(a,l)=>{const o=new Date(a,l-1).toLocaleString("default",{month:"long"}),[c,d,p]=await Promise.all([tt(),Yr(),Tm()]);return c.map(m=>{const f=d.filter(N=>String(N.class)===String(m.class)),h=f.reduce((N,j)=>{const M=parseFloat(String(j.amount));return N+(isNaN(M)?0:M)},0),y=p.filter(N=>String(N.id).trim().toLowerCase()===String(m.id).trim().toLowerCase()&&N.monthKey===o).reduce((N,j)=>(Em(j?.paidItems).forEach(I=>N.add(I)),N),new Set),b=Array.from(y),w=f.map(N=>({type:N.type,amount:parseFloat(String(N.amount))||0,paid:b.includes(N.type)})),E=w.filter(N=>N.paid).reduce((N,j)=>N+j.amount,0),S=E>0?"Paid":"Unpaid";return{studentId:m.id,studentName:m.name,class:m.class,section:m.section,status:S,totalDue:h,totalPaid:E,breakdown:w}})},lg=async(a,l)=>{const o=new Date(a,l-1).toLocaleString("default",{month:"long"}),[c,d]=await Promise.all([dt(),Xf()]);return c.map(p=>{const m=d.find(h=>String(h.id).trim().toLowerCase()===String(p.id).trim().toLowerCase()&&h.monthKey===o),f=parseFloat(String(p.salary))||5e3;return{staffId:p.id,staffName:p.name,role:p.role,salaryAmount:f,status:m?"Paid":"Unpaid",paidAmount:m?.amount,paymentDate:m?.date}})},og=async(a,l,o,c)=>{const d=new Date(o,c-1).toLocaleString("default",{month:"long"}),f=(await Tm()).filter($=>String($.id).trim().toLowerCase()===String(a).trim().toLowerCase()&&$.monthKey===d).reduce(($,P)=>(Em(P?.paidItems).forEach(k=>$.add(k)),$),new Set),h=[...new Set([...Array.from(f),...l])],v=new Date,y=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}`;await ae({action:"batchDeleteAndCreate",sheetName:"FeePayments",batchData:{deleteFilter:{column:"id",value:a,andColumn:"monthKey",andValue:d},createData:[{monthKey:d,id:a,paidItems:h,date:y}]}}),ue("feePayments");const[w,E]=await Promise.all([tt(),Yr()]),S=w.find($=>$.id===a);if(!S)throw new Error("Could not find student to recalculate fee status.");const N=E.filter($=>String($.class)===String(S.class)),j=N.reduce(($,P)=>{const q=parseFloat(String(P.amount));return $+(isNaN(q)?0:q)},0),M=N.map($=>({type:$.type,amount:parseFloat(String($.amount))||0,paid:h.includes($.type)})),I=M.filter($=>$.paid).reduce(($,P)=>$+P.amount,0),V=I>0?"Paid":"Unpaid";return{studentId:S.id,studentName:S.name,class:S.class,section:S.section,status:V,totalDue:j,totalPaid:I,breakdown:M}},ig=async(a,l,o,c)=>{const d=new Date(o,c-1).toLocaleString("default",{month:"long"}),p=new Date,m=`${p.getFullYear()}-${String(p.getMonth()+1).padStart(2,"0")}-${String(p.getDate()).padStart(2,"0")}`,f={monthKey:d,id:a,amount:l,date:m};await ae({action:"batchDeleteAndCreate",sheetName:"SalaryPayments",batchData:{deleteFilter:{column:"id",value:a,andColumn:"monthKey",andValue:d},createData:[f]}}),ue("salaryPayments");const h=(await dt()).find(y=>y.id===a);if(!h)throw new Error("Could not find staff member to update salary status.");const v=parseFloat(String(h.salary))||5e3;return{staffId:h.id,staffName:h.name,role:h.role,salaryAmount:v,status:"Paid",paidAmount:l,paymentDate:f.date}},Lm=async()=>{const[a,l,o]=await Promise.all([tt(),dt(),Kr(new Date().getFullYear(),new Date().getMonth()+1)]),c=o.filter(d=>d.status!=="Paid").length;return{totalStudents:a.length,totalStaff:l.length,unpaidStudentsCount:c}},cg=async()=>{let a=De("notices");return a||(a=await Ie("Notices"),Te("notices",a)),a},Jr=async()=>{let a=De("timetable");return a||(a=await Ie("Timetable"),Te("timetable",a)),a},dg=async a=>{const l={...a,id:`TT${Date.now()}`};return await ae({action:"create",sheetName:"Timetable",data:l}),ue("timetable"),l},ug=async a=>(await ae({action:"update",sheetName:"Timetable",id:a.id,data:a}),ue("timetable"),a),mg=async a=>{await ae({action:"delete",sheetName:"Timetable",id:a}),ue("timetable")},Sa=async()=>{let a=De("subjects");return a||(a=await Ie("Subjects"),a=a.map(l=>{let o={...l};if(typeof l.teacherIds=="string")try{o.teacherIds=JSON.parse(l.teacherIds)}catch{o.teacherIds=[]}return Array.isArray(o.teacherIds)||(o.teacherIds=[]),o}),Te("subjects",a)),a},pg=async a=>{const l={...a,id:`SUB${Date.now()}`},o={...l,teacherIds:JSON.stringify(l.teacherIds||[])};return await ae({action:"create",sheetName:"Subjects",data:o}),ue("subjects"),l},xg=async a=>{const l={...a,teacherIds:JSON.stringify(a.teacherIds||[])};return await ae({action:"update",sheetName:"Subjects",id:a.id,data:l}),ue("subjects"),a},hg=async a=>{await ae({action:"delete",sheetName:"Subjects",id:a}),ue("subjects")},ji=async()=>{let a=De("homework");return a||(a=await Ie("Homework"),Te("homework",a)),a},fg=async a=>{const l={...a,id:`HW${Date.now()}`};return await ae({action:"create",sheetName:"Homework",data:l}),ue("homework"),l},gg=async a=>(await ae({action:"update",sheetName:"Homework",id:a.id,data:a}),ue("homework"),a),yg=async a=>{await ae({action:"delete",sheetName:"Homework",id:a}),ue("homework")},Yt=a=>{if(!a)return"";let l;if(/^\d{4}-\d{2}-\d{2}$/.test(a)){const[p,m,f]=a.split("-").map(Number);l=new Date(p,m-1,f)}else l=new Date(a);if(isNaN(l.getTime()))return a;const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`},Tu=async(a,l,o)=>{const c="attendance";let d=De(c);d||(d=await Ie("Attendance",o),Te(c,d));const p=Yt(l);return d.filter(f=>Yt(f.date)===p&&String(f.classId)===String(a)).length>0},vg=async(a,l,o)=>{const c="attendance";let d=De(c);d||(d=await Ie("Attendance",o),Te(c,d));const p=Yt(l),m=d.filter(b=>Yt(b.date)===p&&String(b.classId)===String(a)),f=(await ut()).find(b=>String(b.id)===String(a));if(!f)return[];const h=await tt({class:f.name,section:f.section},o),v=new Map(m.map(b=>[b.studentId,b]));return h.map(b=>{const w=v.get(b.id);return{studentId:b.id,studentName:b.name,rollNo:b.rollNo,status:w?w.status:"Present",remark:w?w.remark:"",inTime:w?w.inTime:"",outTime:w?w.outTime:""}}).sort((b,w)=>{const E=parseInt(b.rollNo||"",10),S=parseInt(w.rollNo||"",10);return!isNaN(E)&&!isNaN(S)?E-S:isNaN(E)?isNaN(S)?b.studentName.localeCompare(w.studentName):1:-1})},bg=async(a,l)=>{const o="attendance";let c=De(o);c||(c=await Ie("Attendance",l),Te(o,c));const d=Yt(a),p=c.filter(v=>Yt(v.date)===d&&v.classId==="STAFF"),m=await dt();m.sort((v,y)=>{const b=new Date(v.joiningDate||"9999-12-31").getTime(),w=new Date(y.joiningDate||"9999-12-31").getTime();return b!==w?b-w:v.name.localeCompare(y.name)});const f=new Map(p.map(v=>[v.studentId,v]));return m.map(v=>{const y=f.get(v.id);return{studentId:v.id,studentName:v.name,status:y?y.status:"Present",remark:y?y.remark:"",inTime:y?y.inTime:"",outTime:y?y.outTime:""}})},Xr=async(a,l,o,c)=>{const d="attendance";let p=De(d);p||(p=await Ie("Attendance",l),Te(d,p));let m=p.filter(y=>String(y.studentId)===String(a));(o||c)&&(m=m.filter(y=>{const b=Yt(y.date);return!(o&&b<o||c&&b>c)}));const f=m.filter(y=>y.status==="Present").length,h=m.filter(y=>y.status==="Absent").length,v=m.filter(y=>y.status==="Late").length;return{total:m.length,present:f,absent:h,late:v}},Ko=async(a,l,o)=>{const c=Yt(l),d=o.map(p=>({...p,classId:a,date:c}));await ae({action:"batchDeleteAndCreate",sheetName:"Attendance",batchData:{deleteFilter:{column:"date",value:c,andColumn:"classId",andValue:a},createData:d}}),ue("attendance")},Fm=async()=>{let a=De("disciplineIncidents");return a||(a=await Ie("DisciplineIncidents"),Te("disciplineIncidents",a)),a},jg=async a=>{const l={...a,id:`D${Date.now()}`};return await ae({action:"create",sheetName:"DisciplineIncidents",data:l}),ue("disciplineIncidents"),l},wg=async a=>{await ae({action:"delete",sheetName:"DisciplineIncidents",id:a}),ue("disciplineIncidents")},Ng=a=>({...a,driverContact:a.driverContact&&String(a.driverContact).startsWith("'")?String(a.driverContact).substring(1):a.driverContact}),$m=a=>{const l={...a};return l.driverContact&&!String(l.driverContact).startsWith("'")&&(l.driverContact=`'${l.driverContact}`),l},Rm=async()=>{let a=De("vehicles");return a||(a=await Ie("Vehicles"),a=a.map(l=>{let o={...l};if(typeof l.studentIds=="string")try{o.studentIds=JSON.parse(l.studentIds)}catch{o.studentIds=[]}else o.studentIds=l.studentIds||[];return Ng(o)}),Te("vehicles",a)),a},Sg=async a=>{const l={...a,id:`V${Date.now()}`,studentIds:a.studentIds||[]},o={...$m(l),studentIds:JSON.stringify(l.studentIds)};return await ae({action:"create",sheetName:"Vehicles",data:o}),ue("vehicles"),l},zm=async a=>{const l={...$m(a),studentIds:JSON.stringify(a.studentIds||[])};return await ae({action:"update",sheetName:"Vehicles",id:a.id,data:l}),ue("vehicles"),a},kg=async a=>{await ae({action:"delete",sheetName:"Vehicles",id:a}),ue("vehicles")},Cg=async()=>{let a=De("inventory");return a||(a=await Ie("Inventory"),Te("inventory",a)),a},Eg=async a=>{const l={...a,id:`INV${Date.now()}`};return await ae({action:"create",sheetName:"Inventory",data:l}),ue("inventory"),l},Dg=async a=>(await ae({action:"update",sheetName:"Inventory",id:a.id,data:a}),ue("inventory"),a),Ig=async a=>{await ae({action:"delete",sheetName:"Inventory",id:a}),ue("inventory")},Ks=async()=>{let a=De("examDefinitions");return a||(a=await Ie("ExamDefinitions"),Te("examDefinitions",a)),a},Mg=async(a,l=!1,o,c)=>{const d={id:`EXD${Date.now()}`,name:a,isPublished:l,ResultUrl:"",attendanceStartDate:o,attendanceEndDate:c};return await ae({action:"create",sheetName:"ExamDefinitions",data:d}),ue("examDefinitions"),d},Pg=async a=>(await ae({action:"update",sheetName:"ExamDefinitions",id:a.id,data:a}),ue("examDefinitions"),a),Ag=async a=>{await ae({action:"delete",sheetName:"ExamDefinitions",id:a}),ue("examDefinitions")},Qs=async a=>{const l=a?`exams_${btoa(a).substring(0,16)}`:"exams";let o=De(l);return o||(o=await Ie("Exams",a),Te(l,o)),o},In=async a=>{const l="results";let o=De(l);return o||(o=await Ie("Results",a),Te(l,o)),o},Tg=async a=>{const l={...a,id:`EX${Date.now()}`};return await ae({action:"create",sheetName:"Exams",data:l}),ue("exams"),l},_m=async a=>(await ae({action:"update",sheetName:"Exams",id:a.id,data:a}),ue("exams"),a),Lg=async a=>{await ae({action:"delete",sheetName:"Exams",id:a}),ue("exams")},wi=async(a,l)=>{const c=(await In()).filter(p=>p.examId===a);return(await tt({class:l})).map(p=>{const m=c.find(h=>h.studentId===p.id),f=h=>{const v=parseFloat(h);return isNaN(v)?void 0:v};return{studentId:p.id,studentName:p.name,marks:m?f(m.marks)??null:null,ct:m?f(m.ct):void 0,mcq:m?f(m.mcq):void 0,cq:m?f(m.cq):void 0,viva:m?f(m.viva):void 0}})},Fg=async(a,l)=>{const o=l.map(c=>({...c,examId:a}));await ae({action:"batchDeleteAndCreate",sheetName:"Results",batchData:{deleteFilter:{column:"examId",value:a},createData:o}}),ue("results")},$g=async(a,l,o)=>{const d=(await Ks()).find(T=>T.name===a);if(!d?.isPublished)return null;const[p,m,f,h,v]=await Promise.all([Qs(),tt(),In(),ut(),dt()]),y=m.find(T=>T.id.toUpperCase()===o.toUpperCase()&&T.class===l);if(!y)return null;const b=p.filter(T=>T.title===a&&T.class===l);if(b.length===0)return null;const w=await Xr(y.id,void 0,d?.attendanceStartDate?Yt(d.attendanceStartDate):void 0,d?.attendanceEndDate?Yt(d.attendanceEndDate):void 0),E=h.find(T=>T.name===y.class),S=E?E.classTeacherName:"_____________",N=E?v.find(T=>T.id===E.classTeacherId):null,j=N?N.phone:"",M={};b.forEach(T=>{const ne=f.filter(R=>R.examId===T.id);let le=0;ne.forEach(R=>{const X=parseFloat(String(R.marks));!isNaN(X)&&X>le&&(le=X)}),M[T.subject]=le});const I=T=>{const ne=T.map(H=>H.id),le=new Map,R=new Map;ne.forEach(H=>{le.set(H,0),R.set(H,0)});const X=p.filter(H=>H.title===a),Y=new Map;return X.forEach(H=>{const re=parseFloat(String(H.totalMarksCT||0))+parseFloat(String(H.totalMarksMCQ||0))+parseFloat(String(H.totalMarksCQ||0))+parseFloat(String(H.totalMarksViva||0))||100;Y.set(H.class,(Y.get(H.class)||0)+re)}),X.forEach(H=>{f.filter(he=>he.examId===H.id).forEach(he=>{if(le.has(he.studentId)){const be=parseFloat(String(he.marks));isNaN(be)||le.set(he.studentId,(le.get(he.studentId)||0)+be)}})}),T.map(H=>{const re=le.get(H.id)||0,he=Y.get(H.class)||1;return{id:H.id,percent:re/he*100}}).sort((H,re)=>re.percent-H.percent)},V=m.filter(T=>T.class===l),P=I(V).findIndex(T=>T.id===y.id),q=P!==-1?P+1:void 0,D=I(m).findIndex(T=>T.id===y.id),_=D!==-1?D+1:void 0;let O;if(y.group&&y.group!=="-"&&y.group.toLowerCase()!=="n/a"){const T=m.filter(R=>R.class===l&&R.group===y.group),le=I(T).findIndex(R=>R.id===y.id);O=le!==-1?le+1:void 0}const K=[];for(const T of b){const ne=f.find(L=>L.examId===T.id&&L.studentId.toUpperCase()===o.toUpperCase()),le=L=>{const H=parseFloat(L);return isNaN(H)?void 0:H},R=le(ne?.marks),X={ct:parseFloat(String(T.totalMarksCT||0)),mcq:parseFloat(String(T.totalMarksMCQ||0)),cq:parseFloat(String(T.totalMarksCQ||0)),viva:parseFloat(String(T.totalMarksViva||0))},Y=X.ct+X.mcq+X.cq+X.viva||100;K.push({subject:T.subject,marks:R??null,totalMarks:Y,ct:le(ne?.ct),mcq:le(ne?.mcq),cq:le(ne?.cq),viva:le(ne?.viva),highestMark:M[T.subject]||0,fullMarks:X})}if(K.length===0)return null;const Q=K.reduce((T,ne)=>T+(ne.marks||0),0),B=K.reduce((T,ne)=>T+ne.totalMarks,0),G=B>0?Q/B*100:0;return{studentName:y.name,studentId:y.id,rollNo:y.rollNo,className:y.class,section:y.section,group:y.group,guardianName:y.guardianName,examTitle:a,attendance:w,classTeacher:S,teacherPhone:j,results:K,totalMarksObtained:Q,overallTotalMarks:B,percentage:G,rank:q,totalStudents:V.length,institutionalRank:_,totalInstitutionalStudents:m.length,groupRank:O}},Zr=async()=>{let a=De("events");return a||(a=await Ie("Events"),Te("events",a)),a},Rg=async a=>{const l={...a,id:`EVT${Date.now()}`};return await ae({action:"create",sheetName:"Events",data:l}),ue("events"),l},zg=async a=>{await ae({action:"delete",sheetName:"Events",id:a}),ue("events")},Om=async a=>{const l=(await tt()).find(_=>_.id===a);if(!l)return null;const[o,c,d,p,m,f,h,v,y,b,w]=await Promise.all([Kr(new Date().getFullYear(),new Date().getMonth()+1),Qs(),Fm(),Zr(),Jr(),ji(),Rm(),ut(),Sa(),dt(),Xr(a)]),E=o.find(_=>_.studentId===a),S=d.filter(_=>_.studentId===a),N=m.filter(_=>_.class===l.class),j=f.filter(_=>_.class===l.class),M=h.find(_=>_.studentIds?.includes(a))||null,I=v.find(_=>_.name===l.class&&_.section===l.section),V=I?b.find(_=>_.id===I.classTeacherId):null,P=y.filter(_=>!_.class||_.class===l.class).map(_=>{const O=b.filter(K=>_.teacherIds?.includes(K.id));return{subjectName:_.name,teachers:O}});let q=[];for(const _ of(c||[]).filter(O=>O.class===l.class)){const K=(await wi(_.id,_.class)).find(Q=>Q.studentId===a);K&&q.push({examId:_.id,examTitle:_.title,subject:_.subject,marks:K.marks})}const k=new Date;k.setHours(0,0,0,0);const D=(c||[]).filter(_=>_.class===l.class&&new Date(_.date)>=k).sort((_,O)=>new Date(_.date).getTime()-new Date(O.date).getTime());return{student:l,attendance:w,fees:{paid:E?.totalPaid||0,due:(E?.totalDue||0)-(E?.totalPaid||0),status:E?.status||"Unpaid"},results:q,discipline:S,events:p,timetable:N,homework:j,upcomingExams:D,transport:M,classTeacher:V,subjectTeachers:P}},Bm=async()=>{let a=De("leaveRequests");return a||(a=await Ie("LeaveRequests"),Te("leaveRequests",a)),a},_g=async a=>{const l=new Date,o=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`,c={...a,id:`LR${Date.now()}`,status:"Pending",appliedDate:o};return await ae({action:"create",sheetName:"LeaveRequests",data:c}),ue("leaveRequests"),c},Og=async(a,l)=>(await ae({action:"update",sheetName:"LeaveRequests",id:a,data:{status:l}}),ue("leaveRequests"),(await Bm()).find(d=>d.id===a)),Bg=async a=>{await ae({action:"delete",sheetName:"LeaveRequests",id:a}),ue("leaveRequests")},Um=async()=>{await Promise.all([Qs(),Ks(),ut()]),In(),dt()},Wm=()=>{ut(),dt()},Ug=a=>{cg(),Zr(),a.role==="Student"?Om(a.id):(a.role==="Admin"||a.role==="Teacher")&&(tt(),Jr(),ji(),Sa(),Qs(),Lm(),In(),a.role==="Admin"&&Yr())},Wg=async()=>await ae({action:"export_database"}),Hg=async a=>await ae({action:"clear_sheet",sheetName:a}),Vg=async(a,l)=>await ae({action:"clear_attendance_range",sheetName:"Attendance",startDate:a,endDate:l}),Hm={id:"GATEWAY_CONFIG",enabled:!1,provider:"Custom",url:"",headers:"{}",body:'{"number": "{phone}", "message": "{message}"}'},Gg=async()=>{const a=De("gatewayConfig");if(a&&a.length>0)return Lu(a[0]);try{const l=await ae({action:"read",sheetName:"GatewaySettings"});if(l&&Array.isArray(l)&&l.length>0)return Lu(l[0])}catch(l){console.warn("Failed to fetch gateway config, using default",l)}return Hm},qg=async a=>{const l={...a,id:"GATEWAY_CONFIG"},o=await ae({action:"read",sheetName:"GatewaySettings"});return o&&Array.isArray(o)&&o.length>0?await ae({action:"update",sheetName:"GatewaySettings",id:"GATEWAY_CONFIG",data:l}):await ae({action:"create",sheetName:"GatewaySettings",data:l}),ue("gatewayConfig"),l},Lu=a=>({...Hm,...a,enabled:a.enabled===!0||a.enabled==="TRUE"||a.enabled==="true",id:"GATEWAY_CONFIG"}),Vm=x.createContext(void 0),Qg=({children:a})=>{const[l,o]=x.useState(()=>{try{const m=localStorage.getItem("madrasa_user");return m?JSON.parse(m):null}catch{return null}}),c=Hr(),d=async(m,f)=>{const h=await Mm(m,f);if(h)o(h),localStorage.setItem("madrasa_user",JSON.stringify(h)),h.role==="Student"?c("/app/student-dashboard"):c("/app/dashboard");else throw new Error("Invalid credentials. Please try again.")},p=()=>{o(null),localStorage.removeItem("madrasa_user"),bi(),c("/login")};return e.jsx(Vm.Provider,{value:{user:l,login:d,logout:p},children:a})},qe=()=>{const a=x.useContext(Vm);if(a===void 0)throw new Error("useAuth must be used within an AuthProvider");return a},Gm=x.createContext(void 0),Yg=({children:a})=>{const[l,o]=x.useState(()=>{const d=localStorage.getItem("theme");return d==="light"||d==="dark"?d:"dark"});x.useEffect(()=>{document.documentElement.setAttribute("data-theme",l),localStorage.setItem("theme",l)},[l]);const c=()=>{o(d=>d==="dark"?"light":"dark")};return e.jsx(Gm.Provider,{value:{theme:l,toggleTheme:c},children:a})},qm=()=>{const a=x.useContext(Gm);if(a===void 0)throw new Error("useTheme must be used within a ThemeProvider");return a},Kg=()=>wf.map(a=>({...a,roles:[...a.roles]}));let Jg=Kg();const Fu=new Set,Xg=a=>(Fu.add(a),()=>Fu.delete(a)),$u=()=>Jg,Ni=()=>{const[a,l]=x.useState($u());return x.useEffect(()=>Xg(()=>{l([...$u()])}),[]),a},Zg="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiMzOGIyYWMiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMjEgMTZWOEEyIDIgMCAwIDAtMS0xLjczbC03LTRhMiAyIDAgMCAwLTIgMGwtNyA0QTIgMiAwIDAgMCAzIDh2OGEyIDIgMCAwIDAgMSA1LjczbDcgNGEyIDIgMCAwIDAgMiAwbDctNEEyIDIgMCAwIDAgMjEgMTZ6Ij48L3BhdGg+PHBvbHlsaW5lIHBvaW50cz0iMy4yNyA2Ljk2IDEyIDEyLjAxIDIwLjczIDYuOTYiPjwvcG9seWxpbmU+PGxpbmUgeDE9IjEyIiB5MT0iMjIuMDgiIHgyPSIxMiIgeTI9IjEyIj48L2xpbmU+PC9zdmc+",ri={id:"INST-01",name:"Madrasa Modern System",tagline:"Excellence in Education",logo:Zg,address:"123 Islamic Center, Knowledge City, 90210",phone:"(123) 456-7890",email:"contact@madrasams.com"};let Na={...ri};const ey=async()=>{try{let l=(await Df())[0]||null;l||(console.warn("Institution sheet is empty. Creating a default entry."),l=await If(ri)),Na=l}catch(a){console.error("Failed to initialize institution store from Google Sheet, using defaults.",a),Na={...ri}}},mt=()=>Na,ty=async a=>{await Mf(a),Na=a},sy=({isOpen:a,onClose:l})=>{const{user:o}=qe(),c=Ni(),d=o?c.filter(p=>p.roles.includes(o.role)):[];return e.jsxs(e.Fragment,{children:[a&&e.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 md:hidden backdrop-blur-sm",onClick:l}),e.jsxs("aside",{className:`
          fixed inset-y-0 left-0 z-50 w-64
          bg-primary p-4
          border-r border-secondary
          transform transition-transform duration-300 ease-in-out
          shadow-2xl
          ${a?"translate-x-0":"-translate-x-full"}
          md:relative md:translate-x-0 md:block md:shadow-none
        `,children:[e.jsxs("div",{className:"flex items-center justify-between mb-8 pl-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-accent to-accent/80 rounded-xl flex items-center justify-center shadow-lg shadow-accent/20",children:e.jsx("span",{className:"text-xl font-bold text-white",children:"I"})}),e.jsx("h1",{className:"text-xl font-bold text-text-primary tracking-wide",children:"IICM"})]}),e.jsx("button",{onClick:l,className:"md:hidden p-2 text-text-secondary hover:text-text-primary transition-colors rounded-lg hover:bg-secondary",children:e.jsx(Bt,{className:"w-6 h-6"})})]}),e.jsx("nav",{className:"h-[calc(100vh-100px)] overflow-y-auto pr-2 custom-scrollbar",children:e.jsx("ul",{className:"space-y-1",children:d.map(p=>e.jsx("li",{children:e.jsxs(of,{to:p.href,onClick:()=>{window.innerWidth<768&&l&&l()},className:({isActive:m})=>`flex items-center px-4 py-3 rounded-xl transition-all duration-200 font-semibold group ${m?"bg-accent text-white border-l-4 border-white pl-3 shadow-md shadow-accent/30 translate-x-1":"text-text-secondary hover:bg-secondary hover:text-text-primary hover:translate-x-1"}`,children:[e.jsx(p.icon,{className:`
                      w-5 h-5 mr-3
                      transition-transform group-hover:scale-110
                      ${d.find(m=>m.href===p.href),""}
                    `}),e.jsx("span",{children:p.label})]})},p.href))})})]})]})},ny=({onMenuClick:a})=>{const{user:l,logout:o}=qe(),{theme:c,toggleTheme:d}=qm();return e.jsxs("header",{className:"bg-primary/80 backdrop-blur-md p-4 flex justify-between md:justify-end items-center border-b border-secondary sticky top-0 z-40 transition-colors duration-300",children:[a&&e.jsx("button",{onClick:a,className:"md:hidden p-2 text-text-primary hover:bg-secondary rounded-md",children:e.jsx(bf,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:d,className:"p-2 rounded-full text-text-secondary hover:text-accent hover:bg-secondary transition-colors",title:c==="dark"?"Switch to Light Mode":"Switch to Dark Mode",children:c==="dark"?e.jsx(Sm,{className:"w-5 h-5"}):e.jsx(km,{className:"w-5 h-5"})}),e.jsx("button",{onClick:async()=>{window.confirm("Reload all data from server? This will clear all local cache.")&&(await bi(!0),setTimeout(()=>{window.location.reload()},100))},className:"p-2 rounded-full text-text-secondary hover:text-accent hover:bg-secondary transition-colors",title:"Reload All Modules",children:e.jsx(hi,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-3 border-l border-secondary pl-4",children:[e.jsx("img",{src:l?.photo,alt:l?.name,className:"w-8 h-8 md:w-10 md:h-10 rounded-full object-cover border border-secondary"}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("p",{className:"font-semibold text-text-primary text-sm",children:l?.name}),e.jsx("p",{className:"text-xs text-text-secondary",children:l?.role})]}),e.jsx("button",{onClick:o,className:"p-2 text-text-secondary hover:text-red-400 transition-colors",title:"Logout",children:e.jsx(bm,{className:"w-5 h-5"})})]})]})]})},et=({roles:a,children:l})=>{const{user:o}=qe();return o?a.includes(o.role)?l?e.jsx(e.Fragment,{children:l}):e.jsx(di,{}):e.jsx(Gs,{to:"/unauthorized",replace:!0}):e.jsx(Gs,{to:"/login",replace:!0})},ay=()=>{const{user:a,logout:l}=qe(),{theme:o,toggleTheme:c}=qm();return e.jsxs("header",{className:"bg-primary p-4 flex justify-between items-center border-b border-secondary sticky top-0 z-40",children:[e.jsx("h1",{className:"text-lg md:text-xl font-bold text-text-primary truncate mr-2",children:"Student Portal"}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4",children:[e.jsx("button",{onClick:c,className:"p-2 rounded-full text-text-secondary hover:text-accent hover:bg-secondary transition-colors",title:o==="dark"?"Switch to Light Mode":"Switch to Dark Mode",children:o==="dark"?e.jsx(Sm,{className:"w-5 h-5"}):e.jsx(km,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-3 border-l border-secondary pl-2 md:pl-4",children:[e.jsx("img",{src:a?.photo,alt:a?.name,className:"w-8 h-8 rounded-full object-cover border border-secondary"}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("p",{className:"font-semibold text-text-primary text-sm",children:a?.name}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Student"})]}),e.jsx("button",{onClick:l,className:"p-2 text-text-secondary hover:text-red-400",title:"Logout",children:e.jsx(bm,{className:"w-5 h-5"})})]})]})]})},ry=()=>e.jsxs("div",{className:"flex flex-col h-screen bg-background font-sans",children:[e.jsx(ay,{}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-background p-4 md:p-6 transition-all duration-300",children:e.jsx(di,{})})]}),Jo=({title:a,value:l,icon:o,color:c})=>e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg flex items-center transform transition-all duration-300 hover:-translate-y-1 hover:shadow-xl border border-transparent hover:border-secondary/50",children:[e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center mr-6 ${c} shadow-lg text-white`,children:e.jsx(o,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary text-sm font-bold uppercase tracking-wider mb-1",children:a}),e.jsx("p",{className:"text-3xl font-bold text-text-primary",children:l})]})]}),Ru=a=>{const l=a.getDate(),o=a.getMonth(),c=a.getFullYear(),d=["Boishakh","Jyoishtho","Asharh","Srabon","Bhadro","Ashshin","Kartik","Ogrohayon","Poush","Magh","Falgun","Chaitra"],p=[14,13,14,14,15,15,16,16,16,16,15,15];let m=0,f=0,h=o>3||o===3&&l>=14?c-593:c-594;if(l>=p[o])m=(o+9)%12,f=l-p[o]+1;else{m=(o+8)%12;let y=o===0?11:o-1,b=p[y];f=new Date(c,o,0).getDate()-b+l+1}const v=y=>y.toString().replace(/\d/g,b=>""[parseInt(b)]);return`${d[m]} ${v(f)}, ${v(h)}`},zu=a=>{const l=new Date(a);return l.setDate(l.getDate()-1),new Intl.DateTimeFormat("en-US-u-ca-islamic-umalqura",{day:"numeric",month:"long",year:"numeric"}).format(l)},_u=(a,l)=>{const o=a.getMonth()+1,c=a.getDate(),d=`${String(o).padStart(2,"0")}-${String(c).padStart(2,"0")}`,p={"02-21":"Int'l Mother Language Day","03-17":"Sheikh Mujib's Birthday","03-26":"Independence Day","04-14":"Pohela Boishakh (Bengali New Year)","05-01":"May Day","08-15":"National Mourning Day","12-16":"Victory Day","12-25":"Christmas Day"};return p[d]?p[d]:l.includes("Ramadan 1,")?"Start of Ramadan":l.includes("Shawwal 1,")?"Eid ul-Fitr":l.includes("Dhu al-Hijjah 10,")?"Eid ul-Adha":l.includes("Rabi I 12,")?"Eid-e-Miladunnabi":l.includes("Muharram 10,")?"Ashura":l.includes("Rajab 27,")?"Shab-e-Meraj":l.includes("Shaban 15,")?"Shab-e-Barat":null},ga=a=>{if(!a)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a;const l=new Date(a);if(isNaN(l.getTime()))return a;const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`},ly=()=>{const[a,l]=x.useState(null),[o,c]=x.useState([]),[d,p]=x.useState(!0),[m]=x.useState(mt()),[f,h]=x.useState(new Date),[v,y]=x.useState(null),b=x.useCallback(async()=>{try{p(!0);const[$,P]=await Promise.all([Lm(),Zr()]);l($),c(P.filter(q=>q.date))}catch($){console.error("Failed to fetch dashboard data",$)}finally{p(!1)}},[]);x.useEffect(()=>{b()},[b]),x.useEffect(()=>{const $=()=>b();return window.addEventListener("app:refresh",$),()=>window.removeEventListener("app:refresh",$)},[b]);const w=x.useMemo(()=>{const $=f.getFullYear(),P=f.getMonth();return new Date($,P+1,0).getDate()},[f]),E=x.useMemo(()=>{const $=f.getFullYear(),P=f.getMonth();return new Date($,P,1).getDay()},[f]),S=x.useMemo(()=>{const $=[],P=f.getFullYear(),q=f.getMonth();for(let k=0;k<E;k++)$.push(null);for(let k=1;k<=w;k++)$.push(new Date(P,q,k));return $},[f,w,E]),N=()=>h(new Date(f.getFullYear(),f.getMonth()-1,1)),j=()=>h(new Date(f.getFullYear(),f.getMonth()+1,1)),M=$=>{switch($){case"Academic":return"bg-blue-500";case"Sports":return"bg-green-500";case"Cultural":return"bg-purple-500";case"Holiday":return"bg-red-500";default:return"bg-gray-500"}},I=x.useMemo(()=>{const $=new Date;return $.setHours(0,0,0,0),o.filter(P=>new Date(P.date)>=$).sort((P,q)=>new Date(P.date).getTime()-new Date(q.date).getTime())},[o]),V=$=>{const P=zu($),q=Ru($),k=_u($,P),D=ga($.toISOString()),_=o.filter(O=>ga(O.date)===D);y({date:$,hijri:P,bengali:q,holiday:k,events:_})};return d?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx("p",{className:"text-xl",children:"Loading Dashboard..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(Jo,{title:"Total Students",value:a?.totalStudents??0,icon:Ot,color:"bg-blue-500"}),e.jsx(Jo,{title:"Total Staff",value:a?.totalStaff??0,icon:pi,color:"bg-green-500"}),e.jsx(Jo,{title:"Unpaid Students",value:a?.unpaidStudentsCount??0,icon:hm,color:"bg-red-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-primary p-6 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-secondary pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-text-primary",children:[e.jsx(Cn,{className:"w-6 h-6 text-accent"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Academic Calendar"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:N,className:"text-text-secondary hover:text-accent font-bold text-xl",children:"<"}),e.jsx("span",{className:"text-lg font-bold text-text-primary w-40 text-center",children:f.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:j,className:"text-text-secondary hover:text-accent font-bold text-xl",children:">"})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 text-center mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map($=>e.jsx("div",{className:"font-bold text-text-secondary text-sm",children:$},$))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:S.map(($,P)=>{if(!$)return e.jsx("div",{className:"h-32 bg-transparent"},`empty-${P}`);const q=ga($.toISOString()),k=zu($),D=k.split(",")[0],_=Ru($),O=_u($,k),K=o.filter(T=>ga(T.date)===q),Q=K.length>0,B=$.toDateString()===new Date().toDateString(),G=$.getDay()===5;return e.jsxs("div",{onClick:()=>V($),className:`h-32 p-1 rounded-md border border-secondary flex flex-col relative overflow-hidden transition-all hover:bg-secondary/50 cursor-pointer
                                        ${B?"ring-2 ring-accent bg-secondary/30":""}
                                        ${G?"bg-red-900/10":""}
                                    `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`font-bold text-lg ${G?"text-red-400":"text-text-primary"}`,children:$.getDate()}),Q&&e.jsx("div",{className:"flex gap-0.5 pt-1",children:K.slice(0,3).map((T,ne)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${M(T.type)}`,title:T.title},ne))})]}),e.jsxs("div",{className:"flex flex-col text-[10px] text-text-secondary leading-tight opacity-90 gap-0.5",children:[e.jsx("span",{className:"text-green-600/90 font-medium truncate",children:D}),e.jsx("span",{className:"font-bengali text-yellow-600/90 truncate",children:_.split(",")[0]})]}),(O||Q)&&e.jsx("div",{className:"mt-auto pt-1 w-full text-[9px] text-center font-bold",children:O?e.jsx("span",{className:"text-red-300 bg-red-500/20 block rounded-sm px-1 py-0.5 truncate",children:O}):e.jsx("span",{className:"text-blue-300 bg-blue-500/20 block rounded-sm px-1 py-0.5 truncate",children:K[0].title})})]},q)})}),e.jsxs("div",{className:"mt-4 flex gap-4 text-xs text-text-secondary justify-center flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})," Academic"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})," Sports"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"})," Cultural"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"})," Holiday"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-red-400 font-bold",children:"Fri"})," Weekend"]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary flex items-center gap-2",children:[e.jsx(Cn,{className:"w-5 h-5 text-accent"})," Upcoming Events"]}),e.jsx("span",{className:"text-xs bg-accent text-white px-2 py-1 rounded-full",children:I.length})]}),e.jsx("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-2",children:I.length===0?e.jsx("p",{className:"text-text-secondary text-sm",children:"No upcoming events scheduled."}):I.map($=>e.jsxs("div",{className:`p-4 bg-secondary rounded-md border-l-4 ${M($.type).replace("bg-","border-")}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("h4",{className:"font-semibold text-text-primary",children:$.title}),e.jsx("span",{className:"text-xs text-text-secondary bg-primary px-2 py-1 rounded",children:ga($.date)})]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:$.description}),e.jsx("span",{className:`mt-2 inline-block px-2 py-0.5 text-[10px] rounded-full text-white ${M($.type)} opacity-80`,children:$.type})]},$.id))})]}),e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary mb-4",children:"Institution Details"}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:m.logo,alt:"logo",className:"w-16 h-16 rounded-full mr-4 bg-white p-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-text-primary text-lg",children:m.name}),e.jsx("p",{className:"text-text-secondary text-sm",children:m.tagline})]})]}),e.jsxs("div",{className:"text-sm text-text-secondary space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",m.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",m.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",m.email]})]})]}),e.jsx("div",{className:"bg-primary p-6 rounded-lg shadow-lg"})]})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-primary rounded-lg shadow-2xl w-full max-w-md border border-secondary",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-secondary",children:[e.jsx("h3",{className:"text-xl font-bold text-text-primary",children:"Date Details"}),e.jsx("button",{onClick:()=>y(null),className:"text-text-secondary hover:text-red-400",children:e.jsx(Bt,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-center bg-secondary p-4 rounded-lg",children:[e.jsx("h4",{className:"text-3xl font-bold text-accent",children:v.date.getDate()}),e.jsx("p",{className:"text-lg text-text-primary",children:v.date.toLocaleString("default",{month:"long",year:"numeric"})}),e.jsx("p",{className:"text-text-secondary",children:v.date.toLocaleString("default",{weekday:"long"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-secondary p-3 rounded-lg",children:[e.jsx("span",{className:"text-xs text-green-400 font-semibold block mb-1",children:"Hijri Date"}),e.jsx("p",{className:"text-sm text-text-primary",children:v.hijri})]}),e.jsxs("div",{className:"bg-secondary p-3 rounded-lg",children:[e.jsx("span",{className:"text-xs text-yellow-400 font-semibold block mb-1",children:"Bengali Date"}),e.jsx("p",{className:"text-sm text-text-primary font-bengali",children:v.bengali})]})]}),e.jsxs("div",{className:"border-t border-secondary pt-4",children:[e.jsx("h5",{className:"font-semibold text-text-primary mb-2",children:"Holidays & Events"}),v.holiday?e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/50 rounded-lg mb-2",children:e.jsxs("p",{className:"text-red-400 font-bold flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"}),v.holiday]})}):v.events.length===0&&e.jsx("p",{className:"text-text-secondary text-sm italic",children:"No holidays or events for this day."}),v.events.map($=>e.jsxs("div",{className:`p-3 rounded-lg mb-2 border ${M($.type).replace("bg-","border-").replace("500","500/50")} bg-secondary`,children:[e.jsx("p",{className:"text-text-primary font-semibold",children:$.title}),e.jsx("p",{className:"text-xs text-text-secondary",children:$.description}),e.jsx("span",{className:`inline-block mt-1 text-[10px] px-2 py-0.5 rounded-full text-white ${M($.type)}`,children:$.type})]},$.id))]})]})]})})]})},oy=({students:a,onEdit:l,onView:o,onPrint:c,onDelete:d})=>{const{user:p}=qe(),m=p?.role==="Teacher";return e.jsx("div",{className:"overflow-x-auto bg-primary rounded-lg shadow-lg",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Student Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Student ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Class Details"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Roll"}),!m&&e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Guardian Phone"}),!m&&e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(f=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsxs("th",{scope:"row",className:"px-6 py-4 font-medium text-text-primary whitespace-nowrap flex items-center gap-3",children:[e.jsx("img",{src:f.photo||at,alt:f.name,className:"w-8 h-8 rounded-full object-cover bg-secondary",onError:h=>{const v=h.target;v.src=at}}),f.name]}),e.jsx("td",{className:"px-6 py-4",children:f.id}),e.jsxs("td",{className:"px-6 py-4",children:[f.class," - ",f.section,f.group&&e.jsxs("span",{className:"block text-xs text-text-secondary",children:["(",f.group,")"]})]}),e.jsx("td",{className:"px-6 py-4",children:f.rollNo||"-"}),!m&&e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{children:f.guardianPhone}),e.jsx("div",{className:"text-xs text-text-secondary",children:f.guardianName})]}),!m&&e.jsxs("td",{className:"px-6 py-4 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>o(f),className:"p-1.5 bg-blue-500/10 text-blue-400 hover:bg-blue-500/20 rounded",title:"View Profile",children:e.jsx(Cm,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(f),className:"p-1.5 bg-green-500/10 text-green-400 hover:bg-green-500/20 rounded",title:"Print Profile",children:e.jsx(jt,{className:"w-4 h-4"})}),p?.role==="Admin"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l(f),className:"p-1.5 bg-yellow-500/10 text-yellow-400 hover:bg-yellow-500/20 rounded",title:"Edit",children:e.jsx(wt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d(f),className:"p-1.5 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4"})})]})]})]},f.id))})]})})},Ou=35*1024,Bu=a=>{if(!a)return"";if(/^\d{4}-\d{2}-\d{2}/.test(a))return a.substring(0,10);const l=new Date(a);if(isNaN(l.getTime()))return"";const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`},iy=({isOpen:a,onClose:l,onSave:o,initialData:c})=>{const[d,p]=x.useState({name:"",class:"",section:"",rollNo:"",group:"",guardianName:"",guardianPhone:"",photo:"",address:"",gender:"Male",bloodGroup:"",fathersName:"",mothersName:"",dob:"",birthCertificateNo:"",previousEducation:"",permanentAddress:"",admissionDate:new Date().toLocaleDateString("en-CA")}),[m,f]=x.useState(null),[h,v]=x.useState([]);if(x.useEffect(()=>{a&&(async()=>{try{const M=await ut();v(M)}catch(M){console.error("Failed to load classes",M)}})(),c?(p({...c,dob:Bu(c.dob),admissionDate:Bu(c.admissionDate)}),f(c.photo)):(p({name:"",class:"",section:"",rollNo:"",group:"",guardianName:"",guardianPhone:"",photo:"",address:"",gender:"Male",bloodGroup:"",fathersName:"",mothersName:"",dob:"",birthCertificateNo:"",previousEducation:"",permanentAddress:"",admissionDate:new Date().toLocaleDateString("en-CA")}),f(at))},[a,c]),!a)return null;const y=j=>{p({...d,[j.target.name]:j.target.value})},b=j=>{p({...d,class:j.target.value,section:""})},w=j=>{const M=j.target.files?.[0];if(M){if(M.size>Ou){alert(`File is too large. Please select an image smaller than ${Ou/1024}KB to avoid errors.`);return}const I=new FileReader;I.onloadend=()=>{const V=I.result;p($=>({...$,photo:V})),f(V)},I.readAsDataURL(M)}},E=j=>{j.preventDefault(),o(c?{...c,...d}:d)},S=Array.from(new Set(h.map(j=>j.name))).sort((j,M)=>j.localeCompare(M,void 0,{numeric:!0,sensitivity:"base"})),N=h.filter(j=>j.name===d.class).map(j=>j.section).sort();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-4xl h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[c?"Edit":"Add New"," Student"]}),e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"w-full md:w-1/4 space-y-4 flex flex-col items-center",children:[e.jsx("img",{src:m||at,alt:"preview",className:"w-32 h-32 rounded-full object-cover border-2 border-accent"}),e.jsxs("div",{className:"w-full text-center",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:w,className:"text-sm text-text-secondary w-full"}),e.jsx("p",{className:"text-xs text-red-400 mt-1",children:"Max Image Size: 35KB"})]})]}),e.jsxs("div",{className:"w-full md:w-3/4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("h3",{className:"col-span-2 text-lg font-semibold text-accent border-b border-secondary pb-1 mt-2",children:"Student Information"}),e.jsx("input",{type:"text",name:"name",placeholder:"Full Name",value:d.name,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary col-span-2",required:!0}),e.jsxs("select",{name:"gender",value:d.gender,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary",children:[e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsx("input",{type:"text",name:"bloodGroup",placeholder:"Blood Group",value:d.bloodGroup,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary",children:"Date of Birth"}),e.jsx("input",{type:"date",name:"dob",value:d.dob,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary w-full"})]}),e.jsx("input",{type:"text",name:"birthCertificateNo",placeholder:"Birth Certificate No.",value:d.birthCertificateNo,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsx("h3",{className:"col-span-2 text-lg font-semibold text-accent border-b border-secondary pb-1 mt-4",children:"Family Information"}),e.jsx("input",{type:"text",name:"fathersName",placeholder:"Father's Name",value:d.fathersName,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsx("input",{type:"text",name:"mothersName",placeholder:"Mother's Name",value:d.mothersName,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsx("input",{type:"text",name:"guardianName",placeholder:"Guardian Name",value:d.guardianName,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary",required:!0}),e.jsx("input",{type:"tel",name:"guardianPhone",placeholder:"Guardian Phone",value:d.guardianPhone,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary",required:!0}),e.jsx("h3",{className:"col-span-2 text-lg font-semibold text-accent border-b border-secondary pb-1 mt-4",children:"Address Details"}),e.jsx("textarea",{name:"address",placeholder:"Present / Temporary Address",value:d.address,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary",rows:2}),e.jsx("textarea",{name:"permanentAddress",placeholder:"Permanent Address",value:d.permanentAddress,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary",rows:2}),e.jsx("h3",{className:"col-span-2 text-lg font-semibold text-accent border-b border-secondary pb-1 mt-4",children:"Academic Details"}),e.jsxs("div",{className:"flex gap-2 col-span-2",children:[e.jsxs("select",{name:"class",value:d.class,onChange:b,className:"bg-secondary p-3 rounded-md text-text-primary flex-1 focus:outline-none focus:ring-2 focus:ring-accent",required:!0,children:[e.jsx("option",{value:"",children:"Select Class"}),S.map(j=>e.jsx("option",{value:j,children:j},j))]}),e.jsxs("select",{name:"section",value:d.section,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary w-32 focus:outline-none focus:ring-2 focus:ring-accent",required:!0,disabled:!d.class,children:[e.jsx("option",{value:"",children:"Section"}),N.map(j=>e.jsx("option",{value:j,children:j},j))]}),e.jsx("input",{type:"text",name:"rollNo",placeholder:"Roll No",value:d.rollNo,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary w-24"}),e.jsx("input",{type:"text",name:"group",placeholder:"Group (e.g. Science)",value:d.group,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary flex-1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary",children:"Admission Date"}),e.jsx("input",{type:"date",name:"admissionDate",value:d.admissionDate,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary w-full",required:!0})]}),e.jsx("input",{type:"text",name:"previousEducation",placeholder:"Previous Educational History",value:d.previousEducation,onChange:y,className:"bg-secondary p-3 rounded-md text-text-primary"})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4 pb-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:c?"Save Changes":"Add Student"})]})]})]})})},ya=a=>{if(!a)return"-";const l=new Date(a);if(isNaN(l.getTime()))return a;const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`},Si=(a,l)=>{const o=mt(),c=window.open("","_blank"),d=l==="student",p=a,m=a,f=`
        <html>
        <head>
            <title>Profile - ${a.name}</title>
            <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
            <style>
                body { font-family: 'Roboto', sans-serif; background: #fff; color: #333; margin: 0; padding: 0; }
                .container { width: 190mm; margin: 10mm auto; border: 2px solid #1E5631; padding: 15px; position: relative; box-sizing: border-box; }
                .header { text-align: center; border-bottom: 2px solid #D4AF37; padding-bottom: 5px; margin-bottom: 15px; }
                .header img { width: 60px; height: 60px; border-radius: 50%; }
                .header h2 { font-family: 'Playfair Display', serif; color: #1E5631; margin: 5px 0; text-transform: uppercase; font-size: 22px; }
                .header p { margin: 0; font-size: 11px; color: #555; }
                .profile-header { display: flex; gap: 15px; margin-bottom: 20px; align-items: flex-start; }
                .profile-img { width: 110px; height: 130px; object-fit: cover; border: 1px solid #ccc; padding: 3px; }
                .basic-info { flex: 1; }
                .basic-info h2 { margin: 0 0 5px; color: #1E5631; font-family: 'Playfair Display', serif; font-size: 20px; }
                .designation { display: inline-block; background: #1E5631; color: #fff; padding: 3px 12px; border-radius: 12px; font-size: 12px; margin-bottom: 10px; text-transform: uppercase; }
                .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px 15px; }
                .info-item { border-bottom: 1px solid #eee; padding-bottom: 2px; }
                .label { font-weight: bold; color: #555; font-size: 10px; display: block; margin-bottom: 1px; text-transform: uppercase; }
                .value { font-size: 13px; font-weight: 500; }
                .section-title { background: #f4f4f4; padding: 5px 10px; font-weight: bold; color: #1E5631; border-left: 4px solid #D4AF37; margin: 15px 0 10px 0; font-size: 14px; }
                @media print { @page { margin: 0; size: A4; } body { -webkit-print-color-adjust: exact; padding: 0; } .container { border: none; margin: 5mm auto; page-break-inside: avoid; } }
            </style>
        </head>
        <body>
            <div class="container">
                <div class="header">
                    <img src="${o.logo}" />
                    <h2>${o.name}</h2>
                    <p>${o.address}</p>
                    <p>${o.phone} | ${o.email}</p>
                </div>
                <div class="profile-header">
                    <img src="${a.photo}" class="profile-img" />
                    <div class="basic-info">
                        <h2>${a.name}</h2>
                        <div class="designation">${d?"Student":m.designation||m.role}</div>
                        <div class="info-grid">
                            <div class="info-item"><span class="label">ID Number</span><span class="value">${a.id}</span></div>
                            <div class="info-item"><span class="label">${d?"Class":"Join Date"}</span><span class="value">${d?`${p.class} - ${p.section}`:ya(m.joiningDate)}</span></div>
                            ${d?`<div class="info-item"><span class="label">Roll No</span><span class="value">${p.rollNo||"-"}</span></div>`:""}
                            <div class="info-item"><span class="label">Blood Group</span><span class="value">${a.bloodGroup||"-"}</span></div>
                        </div>
                    </div>
                </div>
                <div class="section-title">Personal Information</div>
                <div class="info-grid">
                    <div class="info-item"><span class="label">Gender</span><span class="value">${a.gender||"-"}</span></div>
                    <div class="info-item"><span class="label">Date of Birth</span><span class="value">${ya(a.dob)}</span></div>
                    ${d?`
                    <div class="info-item"><span class="label">Father's Name</span><span class="value">${p.fathersName||"-"}</span></div>
                    <div class="info-item"><span class="label">Mother's Name</span><span class="value">${p.mothersName||"-"}</span></div>
                    `:`
                    <div class="info-item"><span class="label">Father/Husband</span><span class="value">${m.fatherOrHusbandName||"-"}</span></div>
                    <div class="info-item"><span class="label">NID</span><span class="value">${m.nid||"-"}</span></div>
                    `}
                </div>
                <div class="section-title">Contact Information</div>
                <div class="info-grid">
                    ${d?`
                    <div class="info-item"><span class="label">Guardian Name</span><span class="value">${p.guardianName}</span></div>
                    <div class="info-item"><span class="label">Guardian Phone</span><span class="value">${p.guardianPhone}</span></div>
                    <div class="info-item" style="grid-column: span 2"><span class="label">Present Address</span><span class="value">${p.address||"-"}</span></div>
                    <div class="info-item" style="grid-column: span 2"><span class="label">Permanent Address</span><span class="value">${p.permanentAddress||"-"}</span></div>
                    `:`
                    <div class="info-item"><span class="label">Phone</span><span class="value">${m.phone}</span></div>
                    <div class="info-item" style="grid-column: span 2"><span class="label">Present Address</span><span class="value">${m.temporaryAddress||"-"}</span></div>
                    <div class="info-item" style="grid-column: span 2"><span class="label">Permanent Address</span><span class="value">${m.permanentAddress||"-"}</span></div>
                    `}
                </div>
                ${d?"":`
                <div class="section-title">Professional Details</div>
                <div class="info-grid">
                    <div class="info-item"><span class="label">Official Role</span><span class="value">${m.role}</span></div>
                    <div class="info-item"><span class="label">Designation</span><span class="value">${m.designation||"-"}</span></div>
                    ${m.role==="Teacher"?`<div class="info-item"><span class="label">Subject</span><span class="value">${m.subject||"-"}</span></div>`:""}
                    <div class="info-item"><span class="label">Education</span><span class="value">${m.education||"-"}</span></div>
                    <div class="info-item"><span class="label">Specialization</span><span class="value">${m.specialization||"-"}</span></div>
                </div>
                `}
            </div>
            <script>
                window.onload = function() {
                    setTimeout(() => {
                        window.print();
                    }, 500);
                }
            <\/script>
        </body>
        </html>
    `;c?.document.write(f),c?.document.close()},Qm=({isOpen:a,onClose:l,person:o,type:c})=>{const{user:d}=qe();if(!a)return null;const p=c==="student",m=o,f=o,h=d?.role==="Teacher"&&p;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-primary rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-secondary",children:[e.jsx("h2",{className:"text-xl font-bold text-text-primary",children:"Profile Details"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Si(o,c),className:"text-accent hover:bg-secondary p-2 rounded-full transition-colors",title:"Print Profile",children:e.jsx(jt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:l,className:"text-text-secondary hover:text-red-400 p-2 rounded-full transition-colors",children:e.jsx(Bt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"overflow-y-auto p-6 flex-grow",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 mb-6",children:[e.jsx("img",{src:o.photo,alt:o.name,className:"w-32 h-40 object-cover rounded-lg border-2 border-secondary self-center md:self-start"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("h3",{className:"text-2xl font-bold text-text-primary",children:o.name}),e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("span",{className:"bg-accent text-white px-3 py-1 rounded-full text-xs font-semibold uppercase tracking-wider",children:p?"Student":f.role}),!p&&f.designation&&e.jsx("span",{className:"bg-secondary text-accent px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider border border-accent/20",children:f.designation})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium",children:"ID:"})," ",e.jsx("span",{className:"text-text-primary font-bold",children:o.id})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium",children:"Blood Group:"})," ",e.jsx("span",{className:"text-text-primary",children:o.bloodGroup||"N/A"})]}),!h&&e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium",children:"Gender:"})," ",e.jsx("span",{className:"text-text-primary",children:o.gender||"N/A"})]})]}),e.jsx("div",{className:"space-y-2",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium",children:"Class:"})," ",e.jsxs("span",{className:"text-text-primary",children:[m.class," - ",m.section]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium",children:"Roll No:"})," ",e.jsx("span",{className:"text-text-primary",children:m.rollNo||"N/A"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium",children:"Admission:"})," ",e.jsx("span",{className:"text-text-primary",children:ya(m.admissionDate)})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium",children:"Joined:"})," ",e.jsx("span",{className:"text-text-primary",children:ya(f.joiningDate)})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium",children:"Phone:"})," ",e.jsx("span",{className:"text-text-primary",children:f.phone})]})]})})]})]})]}),h?e.jsxs("div",{className:"bg-secondary/20 p-6 rounded-lg border border-secondary flex items-center gap-4",children:[e.jsx(qs,{className:"w-8 h-8 text-yellow-500 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-text-primary",children:"Personal Details Restricted"}),e.jsx("p",{className:"text-sm text-text-secondary",children:"As a teacher, you only have access to students' academic records. Personal contact and family details are hidden for privacy."})]})]}):e.jsxs("div",{className:"border-t border-secondary pt-4 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg text-accent mb-3",children:"Personal Information"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Date of Birth:"})," ",e.jsx("span",{className:"text-text-primary",children:ya(o.dob)})]}),p?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Father's Name:"})," ",e.jsx("span",{className:"text-text-primary",children:m.fathersName||"N/A"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Mother's Name:"})," ",e.jsx("span",{className:"text-text-primary",children:m.mothersName||"N/A"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Birth Cert No:"})," ",e.jsx("span",{className:"text-text-primary",children:m.birthCertificateNo||"N/A"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Father/Husband:"})," ",e.jsx("span",{className:"text-text-primary",children:f.fatherOrHusbandName||"N/A"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"NID:"})," ",e.jsx("span",{className:"text-text-primary",children:f.nid||"N/A"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg text-accent mb-3",children:"Contact Details"}),e.jsx("div",{className:"space-y-2 text-sm",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Guardian:"})," ",e.jsx("span",{className:"text-text-primary",children:m.guardianName})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Guardian Phone:"})," ",e.jsx("span",{className:"text-text-primary",children:m.guardianPhone})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Address:"})," ",e.jsx("span",{className:"text-text-primary",children:m.address||"N/A"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Present Address:"})," ",e.jsx("span",{className:"text-text-primary",children:f.temporaryAddress||"N/A"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Permanent Address:"})," ",e.jsx("span",{className:"text-text-primary",children:f.permanentAddress||"N/A"})]})]})})]}),!p&&e.jsxs("div",{className:"md:col-span-2 border-t border-secondary pt-4 mt-4",children:[e.jsx("h4",{className:"font-bold text-lg text-accent mb-3",children:"Professional Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Education:"})," ",e.jsx("span",{className:"text-text-primary",children:f.education||"N/A"})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Specialization:"})," ",e.jsx("span",{className:"text-text-primary",children:f.specialization||"N/A"})]}),f.role==="Teacher"&&e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"Teaching Subject:"})," ",e.jsx("span",{className:"text-text-primary",children:f.subject||"All"})]}),f.role==="Driver"&&e.jsxs("p",{children:[e.jsx("span",{className:"text-text-secondary font-medium block",children:"License No:"})," ",e.jsx("span",{className:"text-text-primary",children:f.drivingLicense||"N/A"})]})]})]})]})]})]})})},cy=()=>{const{user:a}=qe(),[l,o]=x.useState([]),[c,d]=x.useState([]),[p,m]=x.useState(!0),[f,h]=x.useState(""),[v,y]=x.useState(""),[b,w]=x.useState(!1),[E,S]=x.useState(null),[N,j]=x.useState(!1),[M,I]=x.useState(null),V=x.useCallback(async()=>{try{m(!0);const B=await tt();o(B)}catch(B){console.error("Failed to fetch students",B)}finally{m(!1)}},[]);x.useEffect(()=>{(async()=>{try{const G=await ut();d(G)}catch(G){console.error("Failed to fetch classes",G)}})()},[]),x.useEffect(()=>{V()},[V]),x.useEffect(()=>{const B=()=>V();return window.addEventListener("app:refresh",B),()=>window.removeEventListener("app:refresh",B)},[V]);const $=async B=>{"id"in B?await Wf(B):await Uf(B),V(),k()},P=async B=>{if(window.confirm(`Are you sure you want to delete ${B.name} (ID: ${B.id})? This will also remove their portal access.`))try{m(!0),await Hf(B.id),await V()}catch(G){console.error("Failed to delete student",G),alert("Error deleting student. Please try again.")}finally{m(!1)}},q=(B=null)=>{S(B),w(!0)},k=()=>{S(null),w(!1)},D=B=>{I(B),j(!0)},_=B=>{Si(B,"student")},O=()=>{const B=mt(),G=window.open("","_blank");if(!G){alert("Please allow popups to print.");return}const T=K.map((le,R)=>`
            <tr>
                <td style="text-align: center;">${R+1}</td>
                <td>${le.id}</td>
                <td style="text-align: left; padding-left: 10px;">${le.name}</td>
                <td style="text-align: center;">${le.class}</td>
                <td style="text-align: center;">${le.section||"-"}</td>
                <td style="text-align: center;">${le.rollNo||"-"}</td>
                <td>${le.guardianPhone||"N/A"}</td>
            </tr>
        `).join(""),ne=`
            <!DOCTYPE html>
            <html>
                <head>
                    <title>Student List - ${f||"All Classes"}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&family=Tiro+Bangla&display=swap" rel="stylesheet">
                    <style>
                        @media print {
                            @page { size: A4; margin: 12mm; }
                            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
                            .no-print { display: none; }
                            thead { display: table-header-group; }
                            tfoot { display: table-footer-group; }
                        }
                        body {
                            font-family: 'Times New Roman', serif;
                            margin: 0; padding: 0;
                            background: transparent;
                        }
                        .watermark {
                            position: fixed;
                            top: 50%; left: 50%;
                            transform: translate(-50%, -50%);
                            width: 600px; height: 600px;
                            background-image: url('${B.logo}');
                            background-repeat: no-repeat;
                            background-position: center;
                            background-size: contain;
                            opacity: 0.12;
                            z-index: -1;
                            pointer-events: none;
                        }
                        .report-container {
                            width: 100%;
                            position: relative;
                        }
                        .header-content { text-align: center; margin-bottom: 10px; padding: 10px; }
                        .bismillah-img { width: 100px; margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto; transform: scaleX(1.8); }
                        .inst-name { font-size: 20px; font-weight: bold; text-transform: uppercase; color: #2c3e50; margin: 5px 0; letter-spacing: 1px; }
                        .inst-address { font-size: 12px; margin-bottom: 5px; }
                        .inst-contact { font-size: 12px; }
                        .logo { position: absolute; left: 10px; top: 10px; width: 70px; height: 70px; }
                        
                        .report-title { 
                            text-align: center; margin-top: 5px; margin-bottom: 10px; 
                            font-size: 16px; font-weight: bold; text-decoration: underline; 
                        }

                        .data-table { width: 100%; border-collapse: collapse; font-size: 11px; }
                        .data-table th, .data-table td { border: 1px solid #666; padding: 6px; text-align: center; }
                        .data-table th { background-color: #f8fafc !important; font-weight: bold; }
                        .data-table tr { page-break-inside: avoid; }

                        .footer-content { margin-top: 30px; }
                        .sig-row { display: flex; justify-content: space-between; padding: 0 20px; margin-top: 40px; }
                        .sig-box { text-align: center; width: 150px; }
                        .sig-line { border-top: 1px solid #000; font-size: 12px; font-weight: bold; padding-top: 5px;}

                        .print-date { font-size: 10px; font-style: italic; color: #555; margin-top: 20px; }
                        
                        /* Border wrap logic for multi-page */
                        .main-wrap {
                            border: 1px solid #666;
                            padding: 5px;
                            min-height: 100%;
                        }
                        .inner-wrap {
                            border: 1px solid #444;
                            padding: 15px;
                            min-height: 100%;
                        }
                    </style>
                </head>
                <body>
                    <div class="watermark"></div>
                    <div class="main-wrap">
                        <div class="inner-wrap">
                            <table class="report-container">
                                <thead>
                                    <tr>
                                        <td>
                                            <div class="header-content">
                                                <img src="${B.logo}" class="logo" />
                                                <img src="https://iili.io/fEBrvMQ.png" class="bismillah-img" alt="Bismillah" />
                                                <div class="inst-name">${B.name}</div>
                                                <div class="inst-address">${B.address}</div>
                                                <div class="inst-contact">Phone: ${B.phone}, Email: ${B.email}</div>
                                                <div class="report-title">Student List - ${f||"All Classes"}</div>
                                                <div style="font-size: 13px; margin-bottom: 10px;">Total Record: <strong>${K.length}</strong></div>
                                            </div>
                                            <table class="data-table" style="margin-bottom: 0;">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 30px;">SL</th>
                                                        <th style="width: 80px;">ID</th>
                                                        <th>Student Name</th>
                                                        <th style="width: 60px;">Class</th>
                                                        <th style="width: 60px;">Sec</th>
                                                        <th style="width: 50px;">Roll</th>
                                                        <th style="width: 100px;">Contact</th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <table class="data-table">
                                                <tbody>
                                                    ${T}
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>
                                            <div class="footer-content">
                                                <div class="sig-row">
                                                    <div class="sig-box"><div class="sig-line">Prepared By</div></div>
                                                    <div class="sig-box"><div class="sig-line">Class Teacher</div></div>
                                                    <div class="sig-box"><div class="sig-line">Principal</div></div>
                                                </div>
                                                <div style="display: flex; justify-content: space-between; align-items: end;">
                                                    <div class="print-date">Printed on ${new Date().toLocaleString("en-GB")}</div>
                                                    <div style="font-size: 10px; font-style: italic; color: #555;">Powered by IICM</div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <script>
                        window.onload = function() {
                            setTimeout(() => {
                                window.print();
                            }, 500);
                        }
                    <\/script>
                </body>
            </html>
        `;G.document.write(ne),G.document.close()},K=x.useMemo(()=>{let B=l;if(f&&(B=B.filter(G=>G.class===f)),v){const G=v.toLowerCase();B=B.filter(T=>T.name.toLowerCase().includes(G)||T.id.toLowerCase().includes(G)||T.guardianName.toLowerCase().includes(G))}return[...B].sort((G,T)=>{const ne=parseInt(G.rollNo||"0",10),le=parseInt(T.rollNo||"0",10);return ne-le})},[l,f,v]),Q=x.useMemo(()=>Array.from(new Set(c.map(B=>B.name))).sort(Qr),[c]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Student Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:O,className:"bg-secondary text-text-primary px-4 py-2 rounded-lg font-semibold hover:bg-secondary/80 transition-colors flex items-center gap-2",children:[e.jsx(jt,{className:"w-5 h-5"}),"Print List"]}),a?.role==="Admin"&&e.jsx("button",{onClick:()=>q(),className:"bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90 transition-colors",children:"Add New Student"})]})]}),e.jsxs("div",{className:"bg-primary p-4 rounded-lg shadow-lg flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"md:w-1/4",children:e.jsxs("select",{value:f,onChange:B=>h(B.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:[e.jsx("option",{value:"",children:"All Classes"}),Q.map(B=>e.jsx("option",{value:B,children:B},B))]})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name, ID, or guardian...",value:v,onChange:B=>y(B.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})})]}),p?e.jsx("p",{className:"text-center text-text-secondary mt-8",children:"Loading students..."}):e.jsx(oy,{students:K,onEdit:q,onView:D,onPrint:_,onDelete:P}),b&&e.jsx(iy,{isOpen:b,onClose:k,onSave:$,initialData:E}),M&&e.jsx(Qm,{isOpen:N,onClose:()=>j(!1),person:M,type:"student"})]})},dy=({staff:a,onEdit:l,onView:o,onPrint:c,onDelete:d})=>{const{user:p}=qe();return e.jsx("div",{className:"overflow-x-auto bg-primary rounded-lg shadow-lg",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Staff Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Staff ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Role & Designation"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Department/Subject"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Phone"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(m=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsxs("th",{scope:"row",className:"px-6 py-4 font-medium text-text-primary whitespace-nowrap flex items-center gap-3",children:[e.jsx("img",{src:m.photo||at,alt:m.name,className:"w-8 h-8 rounded-full object-cover bg-secondary",onError:f=>{const h=f.target;h.src=at}}),m.name]}),e.jsx("td",{className:"px-6 py-4 font-mono text-xs",children:m.id}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("span",{className:"font-semibold text-text-primary",children:m.role}),m.designation&&e.jsx("span",{className:"block text-[10px] text-accent font-bold uppercase tracking-tight",children:m.designation})]}),e.jsx("td",{className:"px-6 py-4",children:m.role==="Teacher"?m.subject||"All Subjects":m.designation||"General"}),e.jsx("td",{className:"px-6 py-4",children:m.phone}),e.jsxs("td",{className:"px-6 py-4 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>o(m),className:"p-1.5 bg-blue-500/10 text-blue-400 hover:bg-blue-500/20 rounded transition-colors",title:"View Profile",children:e.jsx(Cm,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(m),className:"p-1.5 bg-green-500/10 text-green-400 hover:bg-green-500/20 rounded transition-colors",title:"Print Profile",children:e.jsx(jt,{className:"w-4 h-4"})}),p?.role==="Admin"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>l(m),className:"p-1.5 bg-yellow-500/10 text-yellow-400 hover:bg-yellow-500/20 rounded transition-colors",title:"Edit",children:e.jsx(wt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>d(m),className:"p-1.5 bg-red-500/10 text-red-400 hover:bg-red-500/20 rounded transition-colors",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4"})})]})]})]},m.id))})]})})},Uu=35*1024,Wu=a=>{if(!a)return"";if(/^\d{4}-\d{2}-\d{2}/.test(a))return a.substring(0,10);const l=new Date(a);if(isNaN(l.getTime()))return"";const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`},uy=({isOpen:a,onClose:l,onSave:o,initialData:c})=>{const[d,p]=x.useState({name:"",role:"Teacher",subject:"",designation:"",drivingLicense:"",phone:"",photo:"",gender:"Male",bloodGroup:"",fatherOrHusbandName:"",dob:"",nid:"",education:"",specialization:"",previousEmployment:"",salary:0,joiningDate:new Date().toLocaleDateString("en-CA"),permanentAddress:"",temporaryAddress:""}),[m,f]=x.useState(null);if(x.useEffect(()=>{c?(p({...c,dob:Wu(c.dob),joiningDate:Wu(c.joiningDate)}),f(c.photo)):(p({name:"",role:"Teacher",subject:"",designation:"",drivingLicense:"",phone:"",photo:"",gender:"Male",bloodGroup:"",fatherOrHusbandName:"",dob:"",nid:"",education:"",specialization:"",previousEmployment:"",salary:0,joiningDate:new Date().toLocaleDateString("en-CA"),permanentAddress:"",temporaryAddress:""}),f(at))},[c]),!a)return null;const h=b=>{p({...d,[b.target.name]:b.target.value})},v=b=>{const w=b.target.files?.[0];if(w){if(w.size>Uu){alert(`File is too large. Please select an image smaller than ${Uu/1024}KB to avoid errors.`);return}const E=new FileReader;E.onloadend=()=>{const S=E.result;p(N=>({...N,photo:S})),f(S)},E.readAsDataURL(w)}},y=b=>{b.preventDefault();const w={...d};w.role!=="Teacher"&&delete w.subject,w.role!=="Driver"&&delete w.drivingLicense,o(c?{...c,...w}:w)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-4xl h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[c?"Edit":"Add New"," Staff Member"]}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"w-full md:w-1/4 space-y-4 flex flex-col items-center",children:[e.jsx("img",{src:m||at,alt:"preview",className:"w-32 h-32 rounded-full object-cover border-2 border-accent"}),e.jsxs("div",{className:"w-full text-center",children:[e.jsx("input",{type:"file",id:"staff-photo-input",accept:"image/*",onChange:v,className:"hidden"}),e.jsx("label",{htmlFor:"staff-photo-input",className:"cursor-pointer bg-secondary px-4 py-2 rounded-md text-sm text-text-primary hover:bg-accent hover:text-white transition-colors",children:"Change Photo"}),e.jsx("p",{className:"text-xs text-red-400 mt-2",children:"Max Image Size: 35KB"})]})]}),e.jsxs("div",{className:"w-full md:w-3/4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("h3",{className:"col-span-2 text-lg font-semibold text-accent border-b border-secondary pb-1 mt-2",children:"Personal Information"}),e.jsx("input",{type:"text",name:"name",placeholder:"Full Name",value:d.name,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary",required:!0}),e.jsx("input",{type:"text",name:"fatherOrHusbandName",placeholder:"Father/Husband Name",value:d.fatherOrHusbandName,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsxs("select",{name:"gender",value:d.gender,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary",children:[e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]}),e.jsx("input",{type:"text",name:"bloodGroup",placeholder:"Blood Group (e.g. A+)",value:d.bloodGroup,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary",children:"Date of Birth"}),e.jsx("input",{type:"date",name:"dob",value:d.dob,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary w-full"})]}),e.jsx("input",{type:"text",name:"nid",placeholder:"NID Number",value:d.nid,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsx("h3",{className:"col-span-2 text-lg font-semibold text-accent border-b border-secondary pb-1 mt-4",children:"Contact Details"}),e.jsx("input",{type:"tel",name:"phone",placeholder:"Phone Number",value:d.phone,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary",required:!0}),e.jsx("textarea",{name:"temporaryAddress",placeholder:"Present / Temporary Address",value:d.temporaryAddress,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary",rows:2}),e.jsx("textarea",{name:"permanentAddress",placeholder:"Permanent Address",value:d.permanentAddress,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary",rows:2}),e.jsx("h3",{className:"col-span-2 text-lg font-semibold text-accent border-b border-secondary pb-1 mt-4",children:"Professional Details"}),e.jsxs("select",{name:"role",value:d.role,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary",children:[e.jsx("option",{value:"Teacher",children:"Teacher"}),e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"Librarian",children:"Librarian"}),e.jsx("option",{value:"IT Admin",children:"IT Admin"}),e.jsx("option",{value:"Finance Admin",children:"Finance Admin"}),e.jsx("option",{value:"Driver",children:"Driver"}),e.jsx("option",{value:"Support Staff",children:"Support Staff"})]}),e.jsx("input",{type:"text",name:"designation",placeholder:"Designation / Job Title (e.g. Headmaster, Senior Teacher, Driver)",value:d.designation,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary"}),d.role==="Teacher"&&e.jsx("input",{type:"text",name:"subject",placeholder:"Subject Specialization",value:d.subject,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary",required:!0}),d.role==="Driver"&&e.jsx("input",{type:"text",name:"drivingLicense",placeholder:"Driving License No",value:d.drivingLicense,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary",children:"Date of Joining"}),e.jsx("input",{type:"date",name:"joiningDate",value:d.joiningDate,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary w-full",required:!0})]}),e.jsx("input",{type:"number",name:"salary",placeholder:"Salary Amount",value:d.salary,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsx("input",{type:"text",name:"education",placeholder:"Educational Qualification (e.g. MA, B.Ed)",value:d.education,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsx("input",{type:"text",name:"specialization",placeholder:"Specialized Skills",value:d.specialization,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary"}),e.jsx("textarea",{name:"previousEmployment",placeholder:"Previous Employment History",value:d.previousEmployment,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary col-span-2",rows:2})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4 pb-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:c?"Save Changes":"Add Staff"})]})]})]})})},my=()=>{const[a,l]=x.useState([]),[o,c]=x.useState(!0),[d,p]=x.useState(!1),[m,f]=x.useState(null),[h,v]=x.useState(!1),[y,b]=x.useState(null),[w,E]=x.useState(""),S=x.useCallback(async()=>{try{c(!0);const k=await dt();l(k)}catch(k){console.error("Failed to fetch staff",k)}finally{c(!1)}},[]);x.useEffect(()=>{S()},[S]),x.useEffect(()=>{const k=()=>S();return window.addEventListener("app:refresh",k),()=>window.removeEventListener("app:refresh",k)},[S]);const N=async k=>{"id"in k?await qf(k):await Gf(k),S(),I()},j=async k=>{if(window.confirm(`Are you sure you want to delete ${k.name} (ID: ${k.id})? This will also remove their portal access.`))try{c(!0),await Qf(k.id),await S()}catch(D){console.error("Failed to delete staff",D),alert("Error deleting staff. Please try again.")}finally{c(!1)}},M=(k=null)=>{f(k),p(!0)},I=()=>{f(null),p(!1)},V=k=>{b(k),v(!0)},$=k=>{Si(k,"staff")},P=()=>{const k=mt(),D=window.open("","_blank");if(!D){alert("Please allow popups to print.");return}const _=q.map((K,Q)=>`
            <tr>
                <td style="text-align: center;">${Q+1}</td>
                <td>${K.id}</td>
                <td style="text-align: left; padding-left: 10px;">${K.name}</td>
                <td>${K.role}</td>
                <td>${K.phone}</td>
                <td>${K.joiningDate}</td>
            </tr>
        `).join(""),O=`
            <!DOCTYPE html>
            <html>
                <head>
                    <title>Staff List</title>
                    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&family=Tiro+Bangla&display=swap" rel="stylesheet">
                    <style>
                        @media print {
                            @page { size: A4; margin: 12mm; }
                            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
                            .no-print { display: none; }
                            thead { display: table-header-group; }
                            tfoot { display: table-footer-group; }
                        }
                        body {
                            font-family: 'Times New Roman', serif;
                            margin: 0; padding: 0;
                            background: transparent;
                        }
                        .watermark {
                            position: fixed;
                            top: 50%; left: 50%;
                            transform: translate(-50%, -50%);
                            width: 600px; height: 600px;
                            background-image: url('${k.logo}');
                            background-repeat: no-repeat;
                            background-position: center;
                            background-size: contain;
                            opacity: 0.12;
                            z-index: -1;
                            pointer-events: none;
                        }
                        .report-container {
                            width: 100%;
                            position: relative;
                        }
                        .header-content { text-align: center; margin-bottom: 10px; padding: 10px; }
                        .bismillah-img { width: 100px; margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto; transform: scaleX(1.8); }
                        .inst-name { font-size: 20px; font-weight: bold; text-transform: uppercase; color: #2c3e50; margin: 5px 0; letter-spacing: 1px; }
                        .inst-address { font-size: 12px; margin-bottom: 5px; }
                        .inst-contact { font-size: 12px; }
                        .logo { position: absolute; left: 10px; top: 10px; width: 70px; height: 70px; }
                        
                        .report-title { 
                            text-align: center; margin-top: 5px; margin-bottom: 10px; 
                            font-size: 16px; font-weight: bold; text-decoration: underline; 
                        }

                        .data-table { width: 100%; border-collapse: collapse; font-size: 11px; }
                        .data-table th, .data-table td { border: 1px solid #666; padding: 6px; text-align: center; }
                        .data-table th { background-color: #f8fafc !important; font-weight: bold; }
                        .data-table tr { page-break-inside: avoid; }

                        .footer-content { margin-top: 30px; }
                        .sig-row { display: flex; justify-content: space-between; padding: 0 20px; margin-top: 40px; }
                        .sig-box { text-align: center; width: 150px; }
                        .sig-line { border-top: 1px solid #000; font-size: 12px; font-weight: bold; padding-top: 5px;}

                        .print-date { font-size: 10px; font-style: italic; color: #555; margin-top: 20px; }
                        
                        .main-wrap {
                            border: 1px solid #666;
                            padding: 5px;
                            min-height: 100%;
                        }
                        .inner-wrap {
                            border: 1px solid #444;
                            padding: 15px;
                            min-height: 100%;
                        }
                    </style>
                </head>
                <body>
                    <div class="watermark"></div>
                    <div class="main-wrap">
                        <div class="inner-wrap">
                            <table class="report-container">
                                <thead>
                                    <tr>
                                        <td>
                                            <div class="header-content">
                                                <img src="${k.logo}" class="logo" />
                                                <img src="https://iili.io/fEBrvMQ.png" class="bismillah-img" alt="Bismillah" />
                                                <div class="inst-name">${k.name}</div>
                                                <div class="inst-address">${k.address}</div>
                                                <div class="inst-contact">Phone: ${k.phone}, Email: ${k.email}</div>
                                                <div class="report-title">Staff Member List</div>
                                                <div style="font-size: 13px; margin-bottom: 10px;">Total Record: <strong>${q.length}</strong></div>
                                            </div>
                                            <table class="data-table" style="margin-bottom: 0;">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 40px;">SL</th>
                                                        <th style="width: 100px;">ID</th>
                                                        <th>Staff Name</th>
                                                        <th style="width: 120px;">Role</th>
                                                        <th style="width: 120px;">Contact</th>
                                                        <th style="width: 100px;">Joining Date</th>
                                                    </tr>
                                                </thead>
                                            </table>
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <table class="data-table">
                                                <tbody>
                                                    ${_}
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td>
                                            <div class="footer-content">
                                                <div class="sig-row">
                                                    <div class="sig-box"><div class="sig-line">Prepared By</div></div>
                                                    <div class="sig-box"><div class="sig-line">Admin Officer</div></div>
                                                    <div class="sig-box"><div class="sig-line">Authorized Sign</div></div>
                                                </div>
                                                <div style="display: flex; justify-content: space-between; align-items: end;">
                                                    <div class="print-date">Printed on ${new Date().toLocaleString("en-GB")}</div>
                                                    <div style="font-size: 10px; font-style: italic; color: #555;">Powered by IICM</div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <script>
                        window.onload = function() {
                            setTimeout(() => {
                                window.print();
                            }, 500);
                        }
                    <\/script>
                </body>
            </html>
        `;D.document.write(O),D.document.close()},q=x.useMemo(()=>w?a.filter(k=>k.name.toLowerCase().includes(w.toLowerCase())||k.id.toLowerCase().includes(w.toLowerCase())||k.role.toLowerCase().includes(w.toLowerCase())||k.subject&&k.subject.toLowerCase().includes(w.toLowerCase())):a,[a,w]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Staff Management"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:P,className:"bg-secondary text-text-primary px-4 py-2 rounded-lg font-semibold hover:bg-secondary/80 transition-colors flex items-center gap-2",children:[e.jsx(jt,{className:"w-5 h-5"}),"Print List"]}),e.jsx("button",{onClick:()=>M(),className:"bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90 transition-colors",children:"Add New Staff"})]})]}),e.jsx("div",{className:"bg-primary p-4 rounded-lg shadow-lg",children:e.jsx("input",{type:"text",placeholder:"Search by name, ID, role, or subject...",value:w,onChange:k=>E(k.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})}),o?e.jsx("p",{className:"text-center text-text-secondary mt-8",children:"Loading staff..."}):e.jsx(dy,{staff:q,onEdit:M,onView:V,onPrint:$,onDelete:j}),d&&e.jsx(uy,{isOpen:d,onClose:I,onSave:N,initialData:m}),y&&e.jsx(Qm,{isOpen:h,onClose:()=>v(!1),person:y,type:"staff"})]})},py=({onClose:a,onSave:l,initialData:o})=>{const[c,d]=x.useState({day:o?.day||"Monday",time:o?.time||"",subject:o?.subject||"",teacher:o?.teacher||"",class:o?.class||""}),[p,m]=x.useState([]),[f,h]=x.useState([]),[v,y]=x.useState([]);x.useEffect(()=>{(async()=>{const[M,I,V]=await Promise.all([ut(),Sa(),dt()]);m(M),h(I),y(V.filter($=>$.role==="Teacher")),!o&&M.length>0&&d($=>({...$,class:M[0].name}))})()},[o]);const b=j=>{const{name:M,value:I}=j.target;d(V=>({...V,[M]:I}))},w=async j=>{j.preventDefault(),o?await ug({...c,id:o.id}):await dg(c),l()},E=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],S=x.useMemo(()=>c.class?f.filter(j=>!j.class||j.class===c.class):f,[f,c.class]),N=x.useMemo(()=>{if(!c.subject)return v;const j=S.find(M=>M.name===c.subject);return j&&j.teacherIds&&j.teacherIds.length>0?v.filter(M=>j.teacherIds.includes(M.id)):v},[v,c.subject,S]);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[o?"Edit":"Add"," Timetable Period"]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("select",{name:"day",value:c.day,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:E.map(j=>e.jsx("option",{value:j,children:j},j))}),e.jsx("input",{type:"time",name:"time",value:c.time,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0})]}),e.jsxs("select",{name:"class",value:c.class,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:[e.jsx("option",{value:"",children:"Select Class"}),p.map(j=>e.jsxs("option",{value:j.name,children:[j.name," - ",j.section]},j.id))]}),e.jsxs("select",{name:"subject",value:c.subject,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:[e.jsx("option",{value:"",children:"Select Subject"}),S.map(j=>e.jsx("option",{value:j.name,children:j.name},j.id))]}),e.jsxs("select",{name:"teacher",value:c.teacher,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:[e.jsx("option",{value:"",children:"Select Teacher"}),N.map(j=>e.jsx("option",{value:j.name,children:j.name},j.id))]}),N.length===0&&c.subject&&e.jsx("p",{className:"text-xs text-red-400",children:"No teachers found for this subject."}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:a,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:"Save"})]})]})]})})},xy=({onClose:a,onSave:l,initialData:o,teachers:c,classes:d})=>{const[p,m]=x.useState(o?.name||""),[f,h]=x.useState(o?.teacherIds||[]),[v,y]=x.useState(o?.class||""),[b,w]=x.useState(o?.section||"");x.useEffect(()=>{!o&&!v&&d.length>0&&y(d[0].name)},[o,d,v]);const E=M=>{h(I=>I.includes(M)?I.filter(V=>V!==M):[...I,M])},S=async M=>{M.preventDefault();const I={name:p,teacherIds:f,class:v,section:b};o?await xg({...I,id:o.id}):await pg(I),l()},N=Array.from(new Set(d.map(M=>M.name))).sort(),j=d.filter(M=>M.name===v).map(M=>M.section).sort();return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[o?"Edit":"Add"," Subject"]}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Class"}),e.jsxs("select",{value:v,onChange:M=>{y(M.target.value),w("")},className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,children:[e.jsx("option",{value:"",children:"Select Class"}),N.map(M=>e.jsx("option",{value:M,children:M},M))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Section"}),e.jsxs("select",{value:b,onChange:M=>w(M.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",disabled:!v,children:[e.jsx("option",{value:"",children:"All / Select"}),j.map(M=>e.jsx("option",{value:M,children:M},M))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Subject Name"}),e.jsx("input",{type:"text",name:"name",placeholder:"e.g. Mathematics",value:p,onChange:M=>m(M.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-text-secondary mb-2 block",children:"Assign Teachers"}),e.jsx("div",{className:"max-h-48 overflow-y-auto bg-secondary p-2 rounded-md space-y-1",children:c.length===0?e.jsx("p",{className:"text-xs text-text-secondary p-2",children:"No teachers available."}):c.map(M=>e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-background cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.includes(M.id),onChange:()=>E(M.id),className:"w-5 h-5 bg-background border-secondary rounded text-accent focus:ring-accent"}),e.jsx("span",{className:"text-text-primary",children:M.name})]},M.id))})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:a,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:"Save"})]})]})]})})},hy=({onClose:a,onSave:l,initialData:o,classes:c,subjects:d})=>{const[p,m]=x.useState({class:o?.class||c[0]?.name||"",subject:o?.subject||d[0]?.name||"",title:o?.title||"",description:o?.description||"",dueDate:o?.dueDate||""}),f=v=>{m(y=>({...y,[v.target.name]:v.target.value}))},h=async v=>{v.preventDefault(),o?await gg({...p,id:o.id}):await fg(p),l()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[o?"Edit":"Add"," Homework"]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("select",{name:"class",value:p.class,onChange:f,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:c.map(v=>e.jsxs("option",{value:v.name,children:["Class ",v.name," - ",v.section]},v.id))}),e.jsx("select",{name:"subject",value:p.subject,onChange:f,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:d.map(v=>e.jsx("option",{value:v.name,children:v.name},v.id))})]}),e.jsx("input",{type:"text",name:"title",placeholder:"Homework Title",value:p.title,onChange:f,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0}),e.jsx("textarea",{name:"description",placeholder:"Description",value:p.description,onChange:f,rows:4,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"text-text-secondary text-sm",children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",value:p.dueDate,onChange:f,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:a,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:"Save"})]})]})]})})},fy=a=>{if(!a)return"N/A";if(/^\d{2}:\d{2}(:\d{2})?$/.test(a)){const[o,c]=a.split(":").map(Number),d=new Date;return d.setHours(o,c,0,0),d.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}const l=new Date(a);return isNaN(l.getTime())?a:l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})},gy=a=>{if(!a)return"N/A";if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a;try{const l=new Date(a);if(isNaN(l.getTime()))return a;const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`}catch{return a}},yy=()=>{const{user:a}=qe(),l=a?.role==="Admin",o=a?.role==="Teacher",[c,d]=x.useState("timetable"),[p,m]=x.useState([]),[f,h]=x.useState([]),[v,y]=x.useState([]),[b,w]=x.useState([]),[E,S]=x.useState([]),[N,j]=x.useState(""),[M,I]=x.useState(!0),[V,$]=x.useState(null),[P,q]=x.useState(null),k=x.useCallback(async()=>{try{I(!0);const[G,T,ne,le,R]=await Promise.all([Jr(),ut(),Sa(),ji(),dt()]);m(G),h(T),y(ne),w(le),S(R),T.length>0&&!N&&j(T[0].id)}catch(G){console.error("Failed to fetch academic data",G)}finally{I(!1)}},[N]);x.useEffect(()=>{k()},[]),x.useEffect(()=>{const G=()=>k();return window.addEventListener("app:refresh",G),()=>window.removeEventListener("app:refresh",G)},[k]);const D=()=>{k(),$(null),q(null)},_=async G=>{if(l&&window.confirm("Are you sure you want to delete this period?"))try{I(!0),await mg(G),k()}catch(T){console.error("Failed to delete period",T),alert("Error deleting period.")}finally{I(!1)}},O=async G=>{if(l&&window.confirm(`Are you sure you want to delete the subject "${G.name}"?`))try{I(!0),await hg(G.id),k()}catch(T){console.error("Failed to delete subject",T),alert("Error deleting subject.")}finally{I(!1)}},K=async G=>{if(window.confirm(`Are you sure you want to delete the homework "${G.title}"?`))try{I(!0),await yg(G.id),k()}catch(T){console.error("Failed to delete homework",T),alert("Error deleting homework.")}finally{I(!1)}},Q=(G,T=null)=>{q(T),$(G)},B=[{id:"timetable",label:"Timetable",icon:mi},{id:"subjects",label:"Subjects",icon:ym},{id:"homework",label:"Homework",icon:vm}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Academic Management"}),e.jsx("div",{children:e.jsx("select",{value:N,onChange:G=>j(G.target.value),className:"bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:f.map(G=>e.jsxs("option",{value:G.id,children:["Class ",G.name," - ",G.section]},G.id))})})]}),e.jsxs("div",{className:"bg-primary rounded-lg shadow-lg",children:[e.jsx("div",{className:"flex border-b border-secondary",children:B.map(G=>e.jsxs("button",{onClick:()=>d(G.id),className:`flex items-center gap-2 px-4 py-3 font-medium text-sm -mb-px border-b-2 ${c===G.id?"border-accent text-accent":"border-transparent text-text-secondary hover:text-text-primary"}`,children:[e.jsx(G.icon,{className:"w-5 h-5"}),G.label]},G.id))}),e.jsx("div",{className:"p-6 min-h-[500px]",children:M?e.jsx("p",{className:"text-center text-text-secondary mt-8",children:"Loading..."}):e.jsxs(e.Fragment,{children:[c==="timetable"&&e.jsx(vy,{timetable:p,classes:f,selectedClassId:N,onEdit:G=>Q("timetable",G),onDelete:_,onAdd:()=>Q("timetable"),isAdmin:l}),c==="subjects"&&e.jsx(by,{subjects:v,staff:E,classes:f,selectedClassId:N,onEdit:G=>Q("subject",G),onDelete:O,onAdd:()=>Q("subject"),isAdmin:l}),c==="homework"&&e.jsx(jy,{homework:b,classes:f,selectedClassId:N,onEdit:G=>Q("homework",G),onDelete:K,onAdd:()=>Q("homework"),isAdmin:l||o})]})})]}),V==="timetable"&&e.jsx(py,{onClose:()=>$(null),onSave:D,initialData:P}),V==="subject"&&e.jsx(xy,{onClose:()=>$(null),onSave:D,initialData:P,teachers:E.filter(G=>G.role==="Teacher"),classes:f}),V==="homework"&&e.jsx(hy,{onClose:()=>$(null),onSave:D,initialData:P,classes:f,subjects:v})]})},vy=({timetable:a,classes:l,selectedClassId:o,onEdit:c,onDelete:d,onAdd:p,isAdmin:m})=>{const f=x.useMemo(()=>l.find(b=>b.id===o)?.name||"",[l,o]),h=x.useMemo(()=>a.filter(b=>b.class===f),[a,f]),v=x.useMemo(()=>{const b={};for(const w of h)b[w.day]||(b[w.day]=[]),b[w.day]?.push(w);return Object.values(b).forEach(w=>{w&&w.sort((E,S)=>E.time.localeCompare(S.time))}),b},[h]),y=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary",children:["Timetable: Class ",f]}),m&&e.jsx("button",{onClick:p,className:"bg-accent text-white px-3 py-1 rounded-md text-sm font-semibold hover:bg-accent/90",children:"Add Period"})]}),e.jsx("div",{className:"overflow-x-auto pb-4",children:e.jsx("div",{className:"flex space-x-4",children:y.filter(b=>v[b]?.length??!1).map(b=>e.jsxs("div",{className:"flex-shrink-0 w-60 bg-secondary p-3 rounded-lg",children:[e.jsx("h4",{className:"font-bold text-accent text-center mb-2",children:b}),e.jsx("div",{className:"space-y-2",children:v[b]?.map(w=>e.jsxs("div",{className:"bg-background p-2 rounded-md text-sm group relative",children:[m&&e.jsxs("div",{className:"absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>c(w),className:"p-1 hover:bg-secondary rounded",title:"Edit",children:e.jsx(wt,{className:"w-3 h-3 text-yellow-400"})}),e.jsx("button",{onClick:()=>d(w.id),className:"p-1 hover:bg-secondary rounded",title:"Delete",children:e.jsx(Re,{className:"w-3 h-3 text-red-500"})})]}),e.jsxs("p",{className:"font-semibold text-text-primary",children:[fy(w.time)," - ",w.subject]}),e.jsx("p",{className:"text-text-secondary",children:w.teacher})]},w.id))})]},b))})})]})},by=({subjects:a,staff:l,classes:o,selectedClassId:c,onAdd:d,onEdit:p,onDelete:m,isAdmin:f})=>{const h=x.useMemo(()=>new Map(l.map(b=>[b.id,b.name])),[l]),v=x.useMemo(()=>o.find(b=>b.id===c),[o,c]),y=x.useMemo(()=>v?a.filter(b=>!b.class||b.class===v.name):a,[a,v]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary",children:["Subject Management: ",v?`Class ${v.name}`:"All"]}),f&&e.jsx("button",{onClick:d,className:"bg-accent text-white px-3 py-1 rounded-md text-sm font-semibold hover:bg-accent/90",children:"Add Subject"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Class"}),e.jsx("th",{className:"px-4 py-2",children:"Section"}),e.jsx("th",{className:"px-4 py-2",children:"Subject"}),e.jsx("th",{className:"px-4 py-2",children:"Teachers"}),e.jsx("th",{className:"px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-4",children:"No subjects found for this class."})}):y.map(b=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsx("td",{className:"px-4 py-2 font-medium",children:b.class||"All"}),e.jsx("td",{className:"px-4 py-2",children:b.section||"All"}),e.jsx("td",{className:"px-4 py-2 font-medium text-text-primary",children:b.name}),e.jsx("td",{className:"px-4 py-2",children:(Array.isArray(b.teacherIds)?b.teacherIds:[]).map(w=>h.get(w)).join(", ")}),e.jsx("td",{className:"px-4 py-2 flex gap-2",children:f&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(b),className:"p-1 hover:bg-background rounded",title:"Edit",children:e.jsx(wt,{className:"w-4 h-4 text-yellow-400"})}),e.jsx("button",{onClick:()=>m(b),className:"p-1 hover:bg-background rounded",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4 text-red-500"})})]})})]},b.id))})]})})]})},jy=({homework:a,classes:l,selectedClassId:o,onAdd:c,onEdit:d,onDelete:p,isAdmin:m})=>{const f=x.useMemo(()=>l.find(v=>v.id===o)?.name||"",[l,o]),h=x.useMemo(()=>a.filter(v=>v.class===f),[a,f]);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary",children:["Homework: Class ",f]}),m&&e.jsx("button",{onClick:c,className:"bg-accent text-white px-3 py-1 rounded-md text-sm font-semibold hover:bg-accent/90",children:"New Homework"})]}),e.jsx("div",{className:"space-y-4",children:h.map(v=>e.jsx("div",{className:"bg-secondary p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-accent font-semibold",children:v.subject}),e.jsx("h4",{className:"font-semibold text-text-primary",children:v.title}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:v.description})]}),e.jsxs("div",{className:"text-right flex-shrink-0 ml-4",children:[e.jsxs("p",{className:"text-sm font-semibold text-text-primary",children:["Due: ",gy(v.dueDate)]}),m&&e.jsxs("div",{className:"flex gap-2 justify-end mt-2",children:[e.jsx("button",{onClick:()=>d(v),className:"p-1 hover:bg-background rounded",title:"Edit",children:e.jsx(wt,{className:"w-4 h-4 text-yellow-400"})}),e.jsx("button",{onClick:()=>p(v),className:"p-1 hover:bg-background rounded",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4 text-red-500"})})]})]})]})},v.id))})]})},wy=({isOpen:a,onClose:l,onSave:o,selectedClass:c})=>{const[d,p]=x.useState({studentId:"",incidentType:"Misbehavior",description:"",actionTaken:""}),[m,f]=x.useState([]);if(x.useEffect(()=>{c&&tt({class:c.name,section:c.section}).then(y=>{f(y),y.length>0&&p(b=>({...b,studentId:y[0].id}))})},[c]),!a)return null;const h=y=>{p(b=>({...b,[y.target.name]:y.target.value}))},v=async y=>{y.preventDefault();const b=m.find(S=>S.id===d.studentId);if(!b||!c)return;const w=new Date,E=`${w.getFullYear()}-${String(w.getMonth()+1).padStart(2,"0")}-${String(w.getDate()).padStart(2,"0")}`;await jg({...d,studentName:b.name,class:c.name,date:E}),o()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:"Log New Discipline Incident"}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Student"}),e.jsx("select",{name:"studentId",value:d.studentId,onChange:h,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:m.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Incident Type"}),e.jsxs("select",{name:"incidentType",value:d.incidentType,onChange:h,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:[e.jsx("option",{children:"Misbehavior"}),e.jsx("option",{children:"Uniform Violation"}),e.jsx("option",{children:"Late Submission"}),e.jsx("option",{children:"Other"})]})]}),e.jsx("textarea",{name:"description",placeholder:"Description of Incident",value:d.description,onChange:h,rows:3,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0}),e.jsx("input",{type:"text",name:"actionTaken",placeholder:"Action Taken (e.g., Verbal Warning)",value:d.actionTaken,onChange:h,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:"Log Incident"})]})]})]})})},Ny=()=>{const{user:a}=qe(),l=a?.role==="Admin",[o,c]=x.useState("attendance"),[d,p]=x.useState("student"),[m,f]=x.useState([]),[h,v]=x.useState([]),[y,b]=x.useState([]),[w,E]=x.useState(!1),[S,N]=x.useState(""),[j,M]=x.useState(()=>{const T=new Date;return`${T.getFullYear()}-${String(T.getMonth()+1).padStart(2,"0")}-${String(T.getDate()).padStart(2,"0")}`}),[I,V]=x.useState(!1),[$,P]=x.useState(!1),[q,k]=x.useState(!1),D=x.useMemo(()=>y.find(T=>T.id===S),[y,S]),_=x.useMemo(()=>a?l?!0:d==="student"?D?.classTeacherId===a.id:!1:!1,[a,l,d,D]),O=x.useCallback(async()=>{E(!0);try{if(o==="discipline"){const T=await Fm();v(T)}else{let T=[],ne=!1;d==="student"?S&&(T=await vg(S,j),ne=await Tu(S,j)):(T=await bg(j),ne=await Tu("STAFF",j)),f(T),k(ne)}P(!1)}catch(T){console.error("Failed to fetch data",T)}finally{E(!1)}},[S,j,d,o]);x.useEffect(()=>{ut().then(T=>{b(T),T.length>0&&N(T[0].id)})},[]),x.useEffect(()=>{O()},[O]),x.useEffect(()=>{const T=()=>O();return window.addEventListener("app:refresh",T),()=>window.removeEventListener("app:refresh",T)},[O]);const K=async()=>{if(!_){alert("You do not have permission to save attendance for this class.");return}E(!0);try{if(d==="student"){if(!S)return;await Ko(S,j,m)}else await Ko("STAFF",j,m);alert(q?"Attendance updated successfully!":"Attendance submitted successfully!"),k(!0),P(!1)}catch{alert("Failed to save attendance. Please try again.")}finally{E(!1)}},Q=async()=>{if(l&&window.confirm("Are you sure you want to delete today's attendance for this selection? This cannot be undone."))try{E(!0),await Ko(d==="student"?S:"STAFF",j,[]),await O(),alert("Attendance deleted successfully.")}catch(T){console.error("Failed to delete attendance",T),alert("Error deleting attendance.")}finally{E(!1)}},B=async T=>{if(l&&window.confirm("Are you sure you want to delete this discipline record?"))try{E(!0),await wg(T),O()}catch(ne){console.error("Failed to delete discipline incident",ne),alert("Error deleting record.")}finally{E(!1)}},G=[{id:"attendance",label:"Attendance",icon:Gr},{id:"discipline",label:"Discipline",icon:qs}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Attendance & Discipline"}),e.jsx("div",{className:"bg-primary p-4 rounded-lg shadow-lg",children:e.jsx("div",{className:"flex flex-wrap items-center justify-between gap-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 w-full",children:[o==="attendance"&&l&&e.jsxs("div",{className:"flex bg-secondary rounded-lg p-1 w-full sm:w-auto",children:[e.jsxs("button",{onClick:()=>p("student"),className:`flex-1 sm:flex-none px-3 py-1.5 rounded-md text-sm font-semibold transition-all flex items-center justify-center gap-2 ${d==="student"?"bg-primary text-accent shadow-sm":"text-text-secondary"}`,children:[e.jsx(jm,{className:"w-4 h-4"})," Students"]}),e.jsxs("button",{onClick:()=>p("staff"),className:`flex-1 sm:flex-none px-3 py-1.5 rounded-md text-sm font-semibold transition-all flex items-center justify-center gap-2 ${d==="staff"?"bg-primary text-accent shadow-sm":"text-text-secondary"}`,children:[e.jsx(Ot,{className:"w-4 h-4"})," Staff"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 w-full sm:w-auto",children:[o==="attendance"&&d==="student"&&e.jsx("select",{value:S,onChange:T=>N(T.target.value),className:"bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent text-sm flex-1 sm:flex-none",children:y.map(T=>e.jsxs("option",{value:T.id,children:[T.name," - ",T.section]},T.id))}),o==="attendance"&&e.jsx("input",{type:"date",value:j,onChange:T=>M(T.target.value),className:"bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent text-sm flex-1 sm:flex-none"})]}),o==="discipline"&&e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsx("label",{className:"text-sm text-text-secondary mr-2",children:"Filter Class:"}),e.jsx("select",{value:S,onChange:T=>N(T.target.value),className:"bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent text-sm w-full sm:w-auto",children:y.map(T=>e.jsxs("option",{value:T.id,children:[T.name," - ",T.section]},T.id))})]})]})})}),e.jsxs("div",{className:"bg-primary rounded-lg shadow-lg",children:[e.jsx("div",{className:"flex border-b border-secondary overflow-x-auto",children:G.map(T=>e.jsxs("button",{onClick:()=>c(T.id),className:`flex items-center gap-2 px-4 py-3 font-medium text-sm -mb-px border-b-2 flex-shrink-0 ${o===T.id?"border-accent text-accent":"border-transparent text-text-secondary hover:text-text-primary"}`,children:[e.jsx(T.icon,{className:"w-5 h-5"}),T.label]},T.id))}),e.jsx("div",{className:"p-4 md:p-6 min-h-[500px]",children:w?e.jsx("p",{className:"text-center text-text-secondary mt-8",children:"Loading..."}):e.jsxs(e.Fragment,{children:[o==="attendance"&&e.jsx(Sy,{attendance:m,setAttendance:f,onSave:K,isDirty:$,setIsDirty:P,type:d,canEdit:_,attendanceTaken:q,onDelete:Q,isAdmin:l}),o==="discipline"&&e.jsx(ky,{incidents:h,selectedClass:D,onAddIncident:()=>V(!0),onDelete:B,isAdmin:l})]})})]}),I&&e.jsx(wy,{isOpen:I,onClose:()=>V(!1),onSave:()=>{O(),V(!1)},selectedClass:D||null})]})},Sy=({attendance:a,setAttendance:l,onSave:o,isDirty:c,setIsDirty:d,type:p,canEdit:m,attendanceTaken:f,onDelete:h,isAdmin:v})=>{const y=x.useMemo(()=>a.reduce((N,j)=>(j.status==="Present"?N.present++:j.status==="Absent"?N.absent++:j.status==="Late"&&N.late++,N),{present:0,absent:0,late:0}),[a]),b=(N,j)=>{m&&(l(M=>M.map(I=>I.studentId===N?{...I,status:j}:I)),d(!0))},w=(N,j)=>{m&&(l(M=>M.map(I=>I.studentId===N?{...I,remark:j}:I)),d(!0))},E=(N,j,M)=>{m&&(l(I=>I.map(V=>V.studentId===N?{...V,[j]:M}:V)),d(!0))},S=()=>{m&&(l(N=>N.map(j=>({...j,status:"Present"}))),d(!0))};return a.length===0?e.jsxs("div",{className:"text-center py-10 text-text-secondary",children:["No ",p," records found. Please ensure users are added."]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 bg-secondary/20 p-4 rounded-lg border border-secondary",children:[e.jsx("div",{className:"flex items-center gap-2",children:f?e.jsxs(e.Fragment,{children:[e.jsx(gi,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-green-500 block text-sm",children:"Attendance Recorded"}),e.jsx("span",{className:"text-[10px] text-text-secondary uppercase",children:"Records are being updated"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(fi,{className:"w-5 h-5 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-yellow-500 block text-sm",children:"Not Recorded Yet"}),e.jsx("span",{className:"text-[10px] text-text-secondary uppercase",children:"Submission pending for today"})]})]})}),!m&&e.jsxs("div",{className:"text-yellow-500 text-xs font-semibold flex items-center gap-2 bg-yellow-500/10 px-2 py-1 rounded border border-yellow-500/20",children:[e.jsx(qs,{className:"w-3 h-3"})," Read Only Mode"]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-secondary p-3 rounded-lg text-center",children:[e.jsx("span",{className:"font-bold text-text-primary",children:a.length}),e.jsx("p",{className:"text-[10px] text-text-secondary uppercase",children:"Total"})]}),e.jsxs("div",{className:"bg-secondary p-3 rounded-lg text-center",children:[e.jsx("span",{className:"font-bold text-green-400",children:y.present}),e.jsx("p",{className:"text-[10px] text-text-secondary uppercase",children:"Present"})]}),e.jsxs("div",{className:"bg-secondary p-3 rounded-lg text-center",children:[e.jsx("span",{className:"font-bold text-red-400",children:y.absent}),e.jsx("p",{className:"text-[10px] text-text-secondary uppercase",children:"Absent"})]}),e.jsxs("div",{className:"bg-secondary p-3 rounded-lg text-center",children:[e.jsx("span",{className:"font-bold text-yellow-400",children:y.late}),e.jsx("p",{className:"text-[10px] text-text-secondary uppercase",children:"Late"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 sticky top-0 z-10 bg-primary/95 backdrop-blur-sm py-3 border-b border-secondary mb-2",children:[m?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:S,className:"bg-secondary text-text-primary px-4 py-2 text-sm rounded-lg font-semibold hover:bg-secondary/80 border border-secondary transition-colors text-nowrap",children:"Mark All Present"}),v&&f&&e.jsxs("button",{onClick:h,className:"bg-red-500/10 text-red-500 px-4 py-2 text-sm rounded-lg font-semibold hover:bg-red-500/20 border border-red-500/20 transition-colors text-nowrap flex items-center gap-1",children:[e.jsx(Re,{className:"w-4 h-4"})," Delete Attendance"]})]}):e.jsx("div",{}),m&&e.jsxs("button",{onClick:o,disabled:!c,className:`w-full sm:w-auto px-6 py-2 rounded-lg font-bold transition-all flex items-center justify-center gap-2 shadow-lg ${c?"bg-accent text-white hover:bg-accent/90":"bg-secondary text-text-secondary cursor-not-allowed opacity-50"}`,children:[e.jsx(Gr,{className:"w-5 h-5"}),f?"Update Now":"Submit Now"]})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[p==="student"&&e.jsx("th",{scope:"col",className:"px-6 py-3 w-20",children:"Roll"}),e.jsxs("th",{scope:"col",className:"px-6 py-3",children:[p==="student"?"Student":"Staff"," Name"]}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center",children:"Status"}),p==="staff"&&e.jsx("th",{scope:"col",className:"px-6 py-3 w-24",children:"In Time"}),p==="staff"&&e.jsx("th",{scope:"col",className:"px-6 py-3 w-24",children:"Out Time"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Remarks"})]})}),e.jsx("tbody",{children:a.map(N=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[p==="student"&&e.jsx("td",{className:"px-6 py-4 font-mono text-xs",children:N.rollNo||"-"}),e.jsxs("td",{scope:"row",className:"px-6 py-4 font-medium text-text-primary whitespace-nowrap",children:[N.studentName," ",e.jsx("br",{}),e.jsx("span",{className:"text-[10px] text-text-secondary uppercase",children:N.studentId})]}),e.jsx("td",{className:"px-6 py-4 flex justify-center gap-2",children:["Present","Absent","Late"].map(j=>e.jsx("button",{disabled:!m,onClick:()=>b(N.studentId,j),className:`px-3 py-1 text-xs font-medium rounded-full transition-all ${N.status===j?j==="Present"?"bg-green-500 text-white shadow-md scale-105":j==="Absent"?"bg-red-500 text-white shadow-md scale-105":"bg-yellow-500 text-white shadow-md scale-105":"bg-secondary text-text-secondary hover:bg-opacity-70"} ${!m&&"cursor-not-allowed opacity-70"}`,children:j},j))}),p==="staff"&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"time",value:N.inTime||"",disabled:!m||N.status==="Absent",onChange:j=>E(N.studentId,"inTime",j.target.value),className:"w-full bg-background p-1.5 rounded-md text-text-primary text-xs focus:outline-none focus:ring-1 focus:ring-accent border border-secondary disabled:opacity-50"})}),p==="staff"&&e.jsx("td",{className:"px-6 py-4",children:e.jsx("input",{type:"time",value:N.outTime||"",disabled:!m||N.status==="Absent",onChange:j=>E(N.studentId,"outTime",j.target.value),className:"w-full bg-background p-1.5 rounded-md text-text-primary text-xs focus:outline-none focus:ring-1 focus:ring-accent border border-secondary disabled:opacity-50"})}),e.jsx("td",{className:"px-6 py-4",children:N.status==="Absent"||N.status==="Late"||p==="staff"?e.jsx("input",{type:"text",placeholder:"Add a remark...",value:N.remark||"",disabled:!m,onChange:j=>w(N.studentId,j.target.value),className:"w-full bg-background p-1.5 rounded-md text-text-primary text-xs focus:outline-none focus:ring-1 focus:ring-accent border border-secondary disabled:opacity-50"}):e.jsx("span",{className:"text-xs text-text-secondary italic",children:"N/A"})})]},N.studentId))})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:a.map(N=>e.jsxs("div",{className:"bg-secondary/30 p-4 rounded-xl border border-secondary shadow-sm",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[p==="student"&&e.jsx("div",{className:"bg-accent text-white font-bold w-8 h-8 rounded-lg flex items-center justify-center text-xs shadow-sm",children:N.rollNo||"-"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-text-primary leading-none mb-1",children:N.studentName}),e.jsx("p",{className:"text-[10px] text-text-secondary uppercase font-mono",children:N.studentId})]})]})}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4",children:["Present","Absent","Late"].map(j=>e.jsx("button",{disabled:!m,onClick:()=>b(N.studentId,j),className:`py-2 text-xs font-bold rounded-lg transition-all border ${N.status===j?j==="Present"?"bg-green-500 text-white border-green-400 shadow-md scale-105":j==="Absent"?"bg-red-500 text-white border-red-400 shadow-md scale-105":"bg-yellow-500 text-white border-yellow-400 shadow-md scale-105":"bg-primary text-text-secondary border-secondary"} ${!m&&"opacity-50 cursor-not-allowed"}`,children:j},j))}),p==="staff"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary uppercase block mb-1",children:"In Time"}),e.jsx("input",{type:"time",value:N.inTime||"",disabled:!m||N.status==="Absent",onChange:j=>E(N.studentId,"inTime",j.target.value),className:"w-full bg-primary p-2 rounded-lg text-text-primary text-xs border border-secondary focus:ring-1 focus:ring-accent outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-text-secondary uppercase block mb-1",children:"Out Time"}),e.jsx("input",{type:"time",value:N.outTime||"",disabled:!m||N.status==="Absent",onChange:j=>E(N.studentId,"outTime",j.target.value),className:"w-full bg-primary p-2 rounded-lg text-text-primary text-xs border border-secondary focus:ring-1 focus:ring-accent outline-none"})]})]}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"text",placeholder:"Write remark here...",value:N.remark||"",disabled:!m,onChange:j=>w(N.studentId,j.target.value),className:"w-full bg-primary p-2.5 rounded-lg text-text-primary text-xs border border-secondary focus:ring-1 focus:ring-accent outline-none"})})]},N.studentId))})]})},ky=({incidents:a,selectedClass:l,onAddIncident:o,onDelete:c,isAdmin:d})=>{const p=x.useMemo(()=>l?a.filter(m=>m.class===l.name):[],[a,l]);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary",children:["Discipline Log: ",l?.name||"Class"]}),e.jsx("button",{onClick:o,className:"w-full sm:w-auto bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90 text-sm shadow-md",children:"Log New Incident"})]}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Student"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Incident Type"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Description"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Action Taken"}),d&&e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-4",children:"No incidents logged for this class."})}):p.map(m=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-text-primary",children:m.studentName}),e.jsx("td",{className:"px-6 py-4",children:m.date}),e.jsx("td",{className:"px-6 py-4",children:m.incidentType}),e.jsx("td",{className:"px-6 py-4 text-xs max-w-xs truncate",children:m.description}),e.jsx("td",{className:"px-6 py-4 font-medium",children:m.actionTaken}),d&&e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>c(m.id),className:"p-1 hover:bg-secondary rounded text-red-500",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4"})})})]},m.id))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:p.length===0?e.jsx("p",{className:"text-center text-text-secondary text-sm italic",children:"No incidents found."}):p.map(m=>e.jsxs("div",{className:"bg-secondary/30 p-4 rounded-lg border border-secondary",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("p",{className:"font-bold text-text-primary",children:m.studentName}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] bg-primary px-2 py-1 rounded border border-secondary",children:m.date}),d&&e.jsx("button",{onClick:()=>c(m.id),className:"p-1 bg-primary rounded border border-secondary text-red-500",children:e.jsx(Re,{className:"w-3 h-3"})})]})]}),e.jsx("p",{className:"text-xs text-accent font-semibold mb-2 uppercase tracking-wide",children:m.incidentType}),e.jsx("p",{className:"text-sm text-text-secondary mb-3 leading-relaxed",children:m.description}),e.jsxs("div",{className:"bg-primary/50 p-2 rounded border border-secondary text-xs",children:[e.jsx("span",{className:"text-text-secondary mr-1",children:"Action:"}),e.jsx("span",{className:"text-text-primary font-bold",children:m.actionTaken})]})]},m.id))})]})},Cy=({isOpen:a,onClose:l,onSuccess:o,studentStatus:c,year:d,month:p})=>{const[m,f]=x.useState(()=>c.breakdown.filter(E=>!E.paid).map(E=>E.type)),[h,v]=x.useState(!1),y=E=>{f(S=>S.includes(E)?S.filter(N=>N!==E):[...S,E])},b=x.useMemo(()=>c.breakdown.filter(E=>m.includes(E.type)).reduce((E,S)=>E+S.amount,0),[m,c]),w=async()=>{if(m.length!==0){v(!0);try{const E=await og(c.studentId,m,d,p),S=mt(),N=window.open("","_blank"),j=E.breakdown.filter(I=>m.includes(I.type)).map(I=>`
                <tr>
                    <td style="padding: 6px 10px; border: 1px solid #D4AF37; color: #1E5631;">${I.type}</td>
                    <td style="padding: 6px 10px; border: 1px solid #D4AF37; text-align: right; font-weight: bold;">${I.amount.toLocaleString()}</td>
                </tr>
            `).join(""),M=`
            <html>
            <head>
                <title>Receipt - ${c.studentName}</title>
                <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
                <style>
                    body { font-family: 'Playfair Display', serif; color: #1E3A29; margin: 0; padding: 20px; background-color: #fff; }
                    .container { 
                        border: 3px solid #1E5631; 
                        outline: 1px solid #D4AF37; outline-offset: -5px;
                        padding: 25px; max-width: 800px; margin: 0 auto; 
                        position: relative; background-color: #fdfbf7;
                        min-height: 500px; box-sizing: border-box;
                        display: flex; flex-direction: column;
                    }
                    .watermark {
                        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                        opacity: 0.10;
                        background-image: url('${S.logo}');
                        background-repeat: no-repeat; background-position: center; background-size: contain;
                        width: 60%; height: 60%; z-index: 0; pointer-events: none;
                    }
                    .header { 
                        display: flex; align-items: center; justify-content: center; gap: 20px;
                        border-bottom: 2px solid #D4AF37; padding-bottom: 10px; margin-bottom: 15px;
                        position: relative; z-index: 1;
                    }
                    .header img { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #D4AF37; }
                    .header h1 { font-family: serif; margin: 0; color: #1E5631; font-size: 22px; text-shadow: 1px 1px 0 #D4AF37; }
                    .header p { margin: 2px 0 0; font-style: italic; color: #555; font-size: 12px; }
                    .bismillah { text-align: center; font-family: serif; font-size: 18px; color: #1E5631; margin-bottom: 5px; }
                    
                    .receipt-title {
                        text-align: center; font-family: serif; font-size: 18px; color: #D4AF37;
                        margin-bottom: 20px; font-weight: bold; text-decoration: underline; text-underline-offset: 4px;
                    }
                    
                    .info-grid { 
                        display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; 
                        position: relative; z-index: 1; font-size: 14px;
                    }
                    .info-item .label { font-weight: bold; color: #1E5631; margin-right: 5px; }
                    
                    table { width: 100%; border-collapse: collapse; margin-bottom: auto; position: relative; z-index: 1; font-size: 14px; }
                    th { background-color: #1E5631; color: #D4AF37; padding: 8px; text-align: left; font-family: serif; border: 1px solid #D4AF37; font-size: 12px; }
                    th:last-child { text-align: right; }
                    td { padding: 6px 10px; border: 1px solid #D4AF37; }
                    
                    .total-row { background-color: #1E5631; color: #fff; font-weight: bold; }
                    .total-row td:last-child { color: #D4AF37; }
                    
                    .footer-info { 
                        margin-top: 20px; border-top: 1px solid #D4AF37; padding-top: 10px;
                        display: flex; justify-content: space-between; font-size: 12px;
                        position: relative; z-index: 1;
                    }
                    @media print {
                        body { background-color: #fff; }
                        .container { box-shadow: none; margin: 0; width: 100%; max-width: none; border: 2px solid #000; }
                    }
                </style>
            </head>
            <body>
                <div class="container">
                    <div class="watermark"></div>
                    <div class="bismillah">   </div>
                    
                    <div class="header">
                        <img src="${S.logo}" alt="logo">
                        <div class="header-text">
                            <h1>${S.name}</h1>
                            <p>${S.address}</p>
                        </div>
                    </div>
                    
                    <div class="receipt-title">Payment Receipt</div>
                    
                    <div class="info-grid">
                        <div class="info-item"><span class="label">Date:</span> ${new Date().toLocaleDateString()}</div>
                        <div class="info-item"><span class="label">Receipt No:</span> #${Date.now().toString().slice(-6)}</div>
                        <div class="info-item"><span class="label">Student Name:</span> ${c.studentName}</div>
                        <div class="info-item"><span class="label">Student ID:</span> ${c.studentId}</div>
                        <div class="info-item"><span class="label">Month:</span> ${new Date(d,p-1).toLocaleString("default",{month:"long",year:"numeric"})}</div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${j}
                            <tr class="total-row">
                                <td>Total Paid</td>
                                <td style="text-align: right;">${b.toLocaleString()}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="footer-info">
                        <div>Status: <span style="font-weight: bold; color: #1E5631;">${E.status.toUpperCase()}</span></div>
                        <div>Authorized Signature</div>
                    </div>
                </div>
                <script>
                    window.onload = function() {
                        setTimeout(() => {
                            window.print();
                        }, 500);
                    }
                <\/script>
            </body>
            </html>
        `;N?.document.write(M),N?.document.close(),o(E)}catch(E){console.error("Failed to collect fee",E),alert("An error occurred during payment collection. Please check your connection and try again.")}finally{v(!1)}}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-2 text-text-primary",children:["Collect Fees: ",c.studentName]}),e.jsxs("p",{className:"text-text-secondary mb-6",children:["For ",new Date(d,p-1).toLocaleString("default",{month:"long",year:"numeric"})]}),e.jsx("div",{className:"space-y-2 mb-4",children:c.breakdown.map(E=>e.jsxs("div",{className:`p-3 rounded-md flex justify-between items-center ${E.paid?"bg-green-500/10":"bg-secondary"}`,children:[e.jsxs("label",{className:"flex items-center gap-3 text-text-primary",children:[e.jsx("input",{type:"checkbox",checked:E.paid||m.includes(E.type),disabled:E.paid,onChange:()=>y(E.type),className:"w-5 h-5 bg-background border-secondary rounded text-accent focus:ring-accent disabled:opacity-50"}),E.type]}),e.jsxs("span",{className:E.paid?"text-green-400":"text-text-primary",children:["",E.amount.toLocaleString()," ",E.paid&&"(Paid)"]})]},E.type))}),e.jsxs("div",{className:"text-right font-bold text-xl text-text-primary mb-6",children:["Total to Pay: ",b.toLocaleString()]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("button",{onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:b===0||h,className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold flex items-center gap-2 disabled:bg-gray-500",children:h?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"w-4 h-4"})," Collect & Print Receipt"]})})]})]})}):null},Ey=({isOpen:a,onClose:l,onSuccess:o,staffStatus:c,year:d,month:p})=>{const[m,f]=x.useState(!1),h=async()=>{f(!0);try{const v=await ig(c.staffId,c.salaryAmount,d,p),y=mt(),b=window.open("","_blank"),w=`
            <html>
            <head>
                <title>Salary Slip - ${c.staffName}</title>
                <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
                <style>
                    body { font-family: 'Playfair Display', serif; color: #1E3A29; margin: 0; padding: 20px; box-sizing: border-box; background-color: #fff; }
                    .container { 
                        border: 3px solid #1E5631; 
                        outline: 1px solid #D4AF37; outline-offset: -5px;
                        padding: 30px; max-width: 800px; margin: 0 auto; 
                        position: relative; background-color: #fdfbf7;
                        min-height: 500px; box-sizing: border-box;
                        display: flex; flex-direction: column;
                    }
                    .watermark {
                        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                        opacity: 0.10;
                        background-image: url('${y.logo}');
                        background-repeat: no-repeat; background-position: center; background-size: contain;
                        width: 60%; height: 60%; z-index: 0; pointer-events: none;
                    }
                    .header { 
                        display: flex; align-items: center; justify-content: center; gap: 20px;
                        border-bottom: 2px solid #D4AF37; padding-bottom: 10px; margin-bottom: 20px;
                        position: relative; z-index: 1;
                    }
                    .header img { width: 50px; height: 50px; border-radius: 50%; border: 2px solid #D4AF37; }
                    .header h1 { font-family: serif; margin: 0; color: #1E5631; font-size: 22px; text-shadow: 1px 1px 0 #D4AF37; }
                    .bismillah { text-align: center; font-family: serif; font-size: 18px; color: #1E5631; margin-bottom: 5px; }
                    
                    .slip-title {
                        text-align: center; font-family: serif; font-size: 18px; color: #D4AF37;
                        margin-bottom: 25px; font-weight: bold; text-decoration: underline; text-underline-offset: 4px;
                    }
                    
                    .info-box {
                        border: 1px solid #D4AF37; padding: 20px;
                        position: relative; z-index: 1; margin-bottom: auto;
                        background-color: rgba(255,255,255,0.7);
                    }
                    .row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }
                    .row .label { font-weight: bold; color: #1E5631; }
                    
                    .amount-box {
                        background-color: #1E5631; color: white; padding: 15px; text-align: center;
                        border: 2px solid #D4AF37; margin-bottom: 30px;
                        position: relative; z-index: 1;
                    }
                    .amount-label { font-family: serif; font-size: 12px; text-transform: uppercase; color: #D4AF37; margin-bottom: 5px; }
                    .amount-value { font-family: serif; font-size: 28px; font-weight: bold; }
                    
                    .footer { 
                        margin-top: 20px; border-top: 1px solid #D4AF37; padding-top: 10px;
                        display: flex; justify-content: space-between; font-size: 12px;
                        position: relative; z-index: 1;
                    }
                    
                    @media print {
                        .container { border: 2px solid #000; box-shadow: none; margin: 0; width: 100%; max-width: none; }
                        body { background: #fff; }
                    }
                </style>
            </head>
            <body>
                <div class="container">
                    <div class="watermark"></div>
                    <div class="bismillah">   </div>
                    
                    <div class="header">
                        <img src="${y.logo}" alt="logo">
                        <div class="header-text">
                            <h1>${y.name}</h1>
                        </div>
                    </div>
                    
                    <div class="slip-title">Salary Slip</div>
                    
                    <div class="info-box">
                        <div class="row"><span class="label">Date:</span> ${new Date().toLocaleDateString()}</div>
                        <div class="row"><span class="label">Transaction ID:</span> TXN-${Date.now().toString().slice(-8)}</div>
                        <div class="row"><span class="label">Staff Name:</span> ${c.staffName}</div>
                        <div class="row"><span class="label">Staff ID:</span> ${c.staffId}</div>
                        <div class="row"><span class="label">Role:</span> ${c.role}</div>
                        <div class="row"><span class="label">Salary Month:</span> ${new Date(d,p-1).toLocaleString("default",{month:"long",year:"numeric"})}</div>
                    </div>
                    
                    <div class="amount-box">
                        <div class="amount-label">Net Salary Paid</div>
                        <div class="amount-value">${c.salaryAmount.toLocaleString()}</div>
                    </div>
                    
                    <div class="footer">
                        <div>Status: <span style="font-weight: bold; color: #1E5631;">PAID</span></div>
                        <div>Authorized Signature</div>
                    </div>
                </div>
                <script>
                    window.onload = function() {
                        setTimeout(() => {
                            window.print();
                        }, 500);
                    }
                <\/script>
            </body>
            </html>
        `;b?.document.write(w),b?.document.close(),o(v)}catch(v){console.error("Failed to pay salary",v),alert("An error occurred during salary payment. Please check your connection and try again.")}finally{f(!1)}};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2 text-text-primary",children:"Confirm Salary Payment"}),e.jsxs("p",{className:"text-text-secondary mb-6",children:["For ",new Date(d,p-1).toLocaleString("default",{month:"long",year:"numeric"})]}),e.jsxs("div",{className:"bg-secondary p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-text-secondary",children:[e.jsx("p",{children:"Staff Member:"}),e.jsx("p",{className:"font-semibold text-text-primary",children:c.staffName})]}),e.jsxs("div",{className:"flex justify-between text-text-secondary",children:[e.jsx("p",{children:"Amount:"}),e.jsxs("p",{className:"font-semibold text-text-primary",children:["",c.salaryAmount.toLocaleString()]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{onClick:h,disabled:m,className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold flex items-center gap-2 disabled:bg-gray-500",children:m?"Processing...":e.jsxs(e.Fragment,{children:[e.jsx(jt,{className:"w-4 h-4"})," Pay & Print Slip"]})})]})]})}):null},Dy=({isOpen:a,onClose:l,onSuccess:o})=>{const[c,d]=x.useState("Utilities"),[p,m]=x.useState(""),[f,h]=x.useState(""),[v,y]=x.useState(!1);if(!a)return null;const b=async w=>{w.preventDefault(),y(!0);try{const E=await ag({category:c,description:p,amount:parseFloat(f)});o(E)}catch(E){console.error("Failed to log expense",E),alert("Could not log expense. Please try again.")}finally{y(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:"Log New Expense"}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("select",{value:c,onChange:w=>d(w.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,children:[e.jsx("option",{children:"Utilities"}),e.jsx("option",{children:"Maintenance"}),e.jsx("option",{children:"Supplies"}),e.jsx("option",{children:"Other"})]}),e.jsx("input",{type:"text",placeholder:"Description",value:p,onChange:w=>m(w.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"number",placeholder:"Amount",value:f,onChange:w=>h(w.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v,className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold disabled:bg-gray-500",children:v?"Saving...":"Log Expense"})]})]})]})})},Iy=({isOpen:a,onClose:l,onSave:o,initialData:c,classes:d})=>{const[p,m]=x.useState({class:"",type:"Tuition",amount:0});if(x.useEffect(()=>{m(c||{class:d.length>0?d[0].name:"",type:"",amount:0})},[c,d]),!a)return null;const f=v=>{const{name:y,value:b}=v.target;m({...p,[y]:y==="amount"?parseFloat(b):b})},h=async v=>{v.preventDefault(),c?await tg({...c,...p}):await eg(p),o()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[c?"Edit":"Add"," Fee Structure"]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Class"}),e.jsxs("select",{name:"class",value:p.class,onChange:f,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,children:[d.length===0&&e.jsx("option",{value:"",children:"No Classes Found"}),[...new Set(d.map(v=>v.name))].map(v=>e.jsx("option",{value:v,children:v},v))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Fee Type"}),e.jsx("input",{type:"text",name:"type",value:p.type,onChange:f,placeholder:"Enter Fee Type (e.g. Tuition, Exam Fee)",className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Amount ()"}),e.jsx("input",{type:"number",name:"amount",value:p.amount,onChange:f,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,min:"0"})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:"Save"})]})]})]})})},My=()=>{const{user:a}=qe(),l=["Admin","Finance Admin"].includes(a?.role||""),[o,c]=x.useState("fees"),[d,p]=x.useState(new Date),[m,f]=x.useState(!0),[h,v]=x.useState(""),[y,b]=x.useState(""),[w,E]=x.useState(""),[S,N]=x.useState([]),[j,M]=x.useState([]),[I,V]=x.useState([]),[$,P]=x.useState([]),[q,k]=x.useState([]),[D,_]=x.useState(null),[O,K]=x.useState(null),[Q,B]=x.useState(!1),[G,T]=x.useState(!1),[ne,le]=x.useState(null),R=x.useCallback(async()=>{try{f(!0);const ie=d.getFullYear(),Me=d.getMonth()+1,[ze,Ut,Js,Xs,Ms]=await Promise.all([Kr(ie,Me),lg(ie,Me),ng(ie,Me),Yr(),ut()]);N(ze),M(Ut),V(Js),P(Xs),k(Ms)}catch(ie){console.error("Failed to fetch finance data",ie)}finally{f(!1)}},[d]);x.useEffect(()=>{R()},[R]),x.useEffect(()=>{const ie=()=>R();return window.addEventListener("app:refresh",ie),()=>window.removeEventListener("app:refresh",ie)},[R]);const X=x.useMemo(()=>Array.from(new Set(q.map(ie=>ie.name))).sort(Qr),[q]);x.useEffect(()=>{o==="structure"&&!y&&X.length>0&&b(X[0])},[o,X,y]);const Y=ie=>{const[Me,ze]=ie.target.value.split("-").map(Number);p(new Date(Me,ze-1,5)),v("")},L=ie=>{N(Me=>Me.map(ze=>ze.studentId===ie.studentId?ie:ze)),_(null)},H=ie=>{M(Me=>Me.map(ze=>ze.staffId===ie.staffId?ie:ze)),K(null)},re=ie=>{V(Me=>[ie,...Me]),B(!1)},he=()=>{R(),T(!1),le(null)},be=async ie=>{if(window.confirm("Are you sure you want to delete this expense record?"))try{f(!0),await rg(ie),R()}catch(Me){console.error("Failed to delete expense",Me)}finally{f(!1)}},we=async ie=>{if(window.confirm("Are you sure you want to delete this fee item? This will affect fee calculations for this class."))try{f(!0),await sg(ie),R()}catch(Me){console.error("Failed to delete fee item",Me)}finally{f(!1)}},je=x.useMemo(()=>{let ie=S;return w&&(ie=ie.filter(Me=>Me.class===w)),h?ie.filter(Me=>Me.studentName.toLowerCase().includes(h.toLowerCase())||Me.studentId.toLowerCase().includes(h.toLowerCase())):ie},[S,h,w]),ye=x.useMemo(()=>h?j.filter(ie=>ie.staffName.toLowerCase().includes(h.toLowerCase())||ie.staffId.toLowerCase().includes(h.toLowerCase())):j,[j,h]),Se=x.useMemo(()=>y?$.filter(ie=>ie.class===y):[],[$,y]),He=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Financial Management"}),e.jsxs("div",{className:"bg-primary p-4 rounded-lg shadow-lg flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[o!=="structure"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"month-select",className:"font-semibold text-text-primary",children:"Month:"}),e.jsx("input",{type:"month",id:"month-select",value:He,onChange:Y,className:"bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})]}),o==="fees"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"fee-class-select",className:"font-semibold text-text-primary ml-2",children:"Class:"}),e.jsxs("select",{id:"fee-class-select",value:w,onChange:ie=>E(ie.target.value),className:"bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:[e.jsx("option",{value:"",children:"All Classes"}),X.map(ie=>e.jsx("option",{value:ie,children:ie},ie))]})]}),o==="structure"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"class-select",className:"font-semibold text-text-primary",children:"Class:"}),e.jsx("select",{id:"class-select",value:y,onChange:ie=>b(ie.target.value),className:"bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:X.map(ie=>e.jsx("option",{value:ie,children:ie},ie))})]})]}),e.jsx("div",{className:"flex-grow max-w-sm",children:e.jsx("input",{type:"text",placeholder:"Search...",value:h,onChange:ie=>v(ie.target.value),className:`w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent ${o==="structure"?"invisible":""}`,disabled:o==="expenses"||o==="structure"})}),e.jsxs("div",{className:"flex gap-2",children:[o==="structure"&&l&&e.jsx("button",{onClick:()=>{le(null),T(!0)},className:"bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90",children:"Add Fee Item"}),l&&e.jsx("button",{onClick:()=>B(!0),className:"bg-secondary text-text-primary px-4 py-2 rounded-lg font-semibold hover:bg-secondary/80",children:"Log Expense"})]})]}),e.jsxs("div",{className:"bg-primary rounded-lg shadow-lg",children:[e.jsx("div",{className:"flex border-b border-secondary",children:["fees","salaries","expenses","structure"].map(ie=>e.jsx("button",{onClick:()=>{c(ie),v("")},className:`px-4 py-3 font-medium text-sm -mb-px border-b-2 ${o===ie?"border-accent text-accent":"border-transparent text-text-secondary hover:text-text-primary"}`,children:ie.charAt(0).toUpperCase()+ie.slice(1).replace("-"," ")},ie))}),e.jsx("div",{className:"overflow-x-auto",children:m?e.jsx("p",{className:"text-center py-8 text-text-secondary",children:"Loading financial data..."}):e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[o==="fees"&&e.jsx(Py,{feeStatus:je,onCollect:_,canEdit:l}),o==="salaries"&&e.jsx(Ay,{salaryStatus:ye,onPay:K,canEdit:l}),o==="expenses"&&e.jsx(Ty,{expenses:I,canEdit:l,onDelete:be}),o==="structure"&&e.jsx(Ly,{items:Se,canEdit:l,onEdit:ie=>{le(ie),T(!0)},onDelete:we})]})})]}),D&&e.jsx(Cy,{studentStatus:D,isOpen:!!D,onClose:()=>_(null),onSuccess:L,year:d.getFullYear(),month:d.getMonth()+1}),O&&e.jsx(Ey,{staffStatus:O,isOpen:!!O,onClose:()=>K(null),onSuccess:H,year:d.getFullYear(),month:d.getMonth()+1}),Q&&e.jsx(Dy,{isOpen:Q,onClose:()=>B(!1),onSuccess:re}),G&&e.jsx(Iy,{isOpen:G,onClose:()=>T(!1),onSave:he,initialData:ne,classes:q})]})},Py=({feeStatus:a,onCollect:l,canEdit:o})=>e.jsxs(e.Fragment,{children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Student"}),e.jsx("th",{className:"px-6 py-3",children:"Class"}),e.jsx("th",{className:"px-6 py-3",children:"Action"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"text-center py-4 text-text-secondary",children:"No students found."})}):a.map(c=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsxs("td",{className:"px-6 py-4 font-medium text-text-primary",children:[c.studentName," ",e.jsxs("span",{className:"text-text-secondary",children:["(",c.studentId,")"]})]}),e.jsxs("td",{className:"px-6 py-4",children:[c.class,"-",c.section]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:c.status==="Paid"?"text-green-400 font-bold":"text-red-400 font-bold",children:c.status}),o&&c.totalPaid<c.totalDue&&e.jsx("button",{onClick:()=>l(c),className:"bg-accent text-white px-3 py-1 rounded-md text-xs font-semibold hover:bg-accent/90",children:"Collect Balance"})]})})]},c.studentId))})]}),Ay=({salaryStatus:a,onPay:l,canEdit:o})=>e.jsxs(e.Fragment,{children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Staff"}),e.jsx("th",{className:"px-6 py-3",children:"Role"}),e.jsx("th",{className:"px-6 py-3",children:"Salary"}),e.jsx("th",{className:"px-6 py-3",children:"Action"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-4 text-text-secondary",children:"No staff found."})}):a.map(c=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsxs("td",{className:"px-6 py-4 font-medium text-text-primary",children:[c.staffName," ",e.jsxs("span",{className:"text-text-secondary",children:["(",c.staffId,")"]})]}),e.jsx("td",{className:"px-6 py-4",children:c.role}),e.jsxs("td",{className:"px-6 py-4",children:["",c.salaryAmount.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4",children:[o&&c.status!=="Paid"&&e.jsx("button",{onClick:()=>l(c),className:"bg-accent text-white px-3 py-1 rounded-md text-xs font-semibold hover:bg-accent/90",children:"Pay"}),(!o||c.status==="Paid")&&e.jsx("span",{className:c.status==="Paid"?"text-green-400":"text-red-400",children:c.status})]})]},c.staffId))})]}),Ty=({expenses:a,canEdit:l,onDelete:o})=>e.jsxs(e.Fragment,{children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Date"}),e.jsx("th",{className:"px-6 py-3",children:"Category"}),e.jsx("th",{className:"px-6 py-3",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Amount"}),l&&e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:l?5:4,className:"text-center py-4 text-text-secondary",children:"No expenses for this month."})}):a.map(c=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsx("td",{className:"px-6 py-4",children:new Date(c.date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4",children:c.category}),e.jsx("td",{className:"px-6 py-4 font-medium text-text-primary",children:c.description}),e.jsxs("td",{className:"px-6 py-4 font-semibold text-red-400 text-right",children:["",c.amount.toLocaleString()]}),l&&e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>o(c.id),className:"p-1 hover:bg-background rounded",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4 text-red-500"})})})]},c.id))})]}),Ly=({items:a,canEdit:l,onEdit:o,onDelete:c})=>e.jsxs(e.Fragment,{children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:"Fee Type"}),e.jsx("th",{className:"px-6 py-3 text-right",children:"Amount"}),l&&e.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:l?3:2,className:"text-center py-4 text-text-secondary",children:"No fee structure items found for this class."})}):a.map((d,p)=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsx("td",{className:"px-6 py-4",children:d.type}),e.jsxs("td",{className:"px-6 py-4 font-semibold text-green-400 text-right",children:["",d.amount.toLocaleString()]}),l&&e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>o(d),className:"p-1 hover:bg-background rounded",title:"Edit",children:e.jsx(wt,{className:"w-4 h-4 text-yellow-400"})}),e.jsx("button",{onClick:()=>c(d.id),className:"p-1 hover:bg-background rounded",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4 text-red-500"})})]})})]},d.id||p))})]}),Fy=()=>{const[a,l]=x.useState([]),[o,c]=x.useState([]),[d,p]=x.useState([]),[m,f]=x.useState(!0),[h,v]=x.useState("students"),[y,b]=x.useState(""),[w,E]=x.useState(""),[S,N]=x.useState(""),[j,M]=x.useState(new Set),[I,V]=x.useState(!1),[$,P]=x.useState(!1),[q,k]=x.useState(0),[D,_]=x.useState(!1),[O,K]=x.useState(!1),[Q,B]=x.useState({enabled:!1,provider:"Custom",url:"",headers:"{}",body:'{"number": "{phone}", "message": "{message}"}'}),[G,T]=x.useState("idle"),[ne,le]=x.useState([]),R=async()=>{try{f(!0);const[se,xe,ke,rt]=await Promise.all([tt(),dt(),ut(),Gg()]);l(se),c(xe),p(ke),rt&&B(rt)}catch(se){console.error("Failed to fetch data",se)}finally{f(!1)}};x.useEffect(()=>{R()},[]),x.useEffect(()=>{const se=()=>R();return window.addEventListener("app:refresh",se),()=>window.removeEventListener("app:refresh",se)},[]),x.useEffect(()=>{M(new Set),E(""),b("")},[h]);const X=se=>{const xe=h==="students"?se.guardianPhone:se.phone;return xe?xe.replace(/[^0-9+]/g,""):""},Y=se=>se.replace(/\D/g,""),L=(se,xe)=>{if(!se)return;const ke=se.replace(/\D/g,""),rt=ke.length===11&&ke.startsWith("01")?`88${ke}`:ke,Wt=encodeURIComponent(xe),Ps=1e3,Pn=700,ka=(window.screen.width-Ps)/2,Ca=(window.screen.height-Pn)/2;window.open(`https://web.whatsapp.com/send?phone=${rt}&text=${Wt}`,"whatsapp_popup",`width=${Ps},height=${Pn},top=${Ca},left=${ka},scrollbars=yes,resizable=yes`)},H=se=>{if(!S){alert("Please enter a message to send.");return}if(!se){alert("No phone number found.");return}L(se,S)},re=x.useMemo(()=>{let se=h==="students"?a:o;if(h==="students"&&y){const xe=d.find(ke=>ke.id===y);xe&&(se=se.filter(ke=>ke.class===xe.name&&ke.section===xe.section))}return w?se.filter(xe=>xe.name.toLowerCase().includes(w.toLowerCase())||xe.id.toLowerCase().includes(w.toLowerCase())||(h==="students"?xe.class.toLowerCase().includes(w.toLowerCase()):xe.role.toLowerCase().includes(w.toLowerCase()))):se},[h,a,o,d,y,w]),he=se=>{const xe=new Set(j);xe.has(se)?xe.delete(se):xe.add(se),M(xe)},be=()=>{j.size===re.length?M(new Set):M(new Set(re.map(se=>se.id)))},we=()=>{if(j.size!==0){if(!S){alert("Please enter a message to send.");return}k(0),le([]),T("idle"),V(!0)}},je=x.useMemo(()=>(h==="students"?a:o).filter(xe=>j.has(xe.id)),[a,o,j,h]),ye=je[q],Se=ye?X(ye):"",He=q/je.length*100,ie=async()=>{if(!Se){ze();return}if(Q.enabled){T("sending");try{const se=Y(Se),xe=Q.body.replace("{phone}",se).replace("{message}",S);let ke={};try{ke=JSON.parse(Q.headers)}catch{console.error("Invalid headers JSON")}const rt=await fetch(Q.url,{method:"POST",headers:{"Content-Type":"application/json",...ke},body:xe});if(rt.ok)le(Wt=>[`[${new Date().toLocaleTimeString()}] Sent to ${ye.name}`,...Wt]),T("success"),setTimeout(ze,1500);else{const Wt=await rt.text();le(Ps=>[`[${new Date().toLocaleTimeString()}] FAIL ${ye.name}: ${Wt}`,...Ps]),T("error"),setTimeout(ze,2e3)}}catch(se){le(xe=>[`[${new Date().toLocaleTimeString()}] ERROR ${ye.name}: ${se.message}`,...xe]),T("error"),setTimeout(ze,2e3)}}else L(Se,S),ze()},Me=()=>{le(se=>[`[${new Date().toLocaleTimeString()}] Skipped ${ye?.name||"Unknown"}`,...se]),ze()},ze=()=>{q<je.length-1?(k(se=>se+1),T("idle")):Ut()},Ut=()=>{alert("Bulk sending completed!"),V(!1),M(new Set),N("")},Js=async()=>{try{K(!0),await qg(Q),_(!1)}catch(se){console.error("Failed to save settings",se),alert("Failed to save settings. Please try again.")}finally{K(!1)}},Xs=()=>{const se=je.map(xe=>X(xe)).filter(xe=>xe&&xe.length>5).join(", ");if(!se){alert("No valid phone numbers found in selection.");return}navigator.clipboard.writeText(se).then(()=>{alert("Phone numbers copied to clipboard! You can now paste them into a WhatsApp Group or Broadcast List.")}).catch(xe=>{console.error("Failed to copy: ",xe),alert("Failed to copy. Please manually select the numbers.")})},Ms=()=>je.map(se=>X(se)).filter(se=>se&&se.length>5).join(", ");return e.jsxs("div",{className:"space-y-4 sm:space-y-6 flex flex-col",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:justify-between sm:items-center",children:[e.jsxs("h2",{className:"text-3xl font-bold text-text-primary flex items-center gap-3",children:[e.jsx(Rr,{className:"w-8 h-8 text-accent"}),"Direct Messaging"]}),e.jsx("button",{onClick:()=>_(!0),className:"p-2 bg-secondary rounded-full text-text-primary hover:bg-accent hover:text-white transition-colors",children:e.jsx(Mu,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"bg-primary rounded-lg shadow-lg flex-grow overflow-hidden flex flex-col",children:e.jsxs("div",{className:"flex-grow p-3 sm:p-6 flex flex-col md:flex-row gap-4 sm:gap-6 overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-1/3 flex flex-col gap-3 sm:gap-4 bg-secondary/10 p-3 sm:p-4 rounded-lg border border-secondary",children:[e.jsx("h3",{className:"font-bold text-lg text-text-primary mb-2",children:"1. Select Group & Compose"}),e.jsxs("div",{className:"flex bg-secondary rounded-lg p-1 shadow-sm",children:[e.jsx("button",{onClick:()=>v("students"),className:`flex-1 py-2 rounded-md text-sm font-semibold transition-all ${h==="students"?"bg-primary text-accent shadow-md":"text-text-secondary hover:text-text-primary"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"})," Students"]})}),e.jsx("button",{onClick:()=>v("staff"),className:`flex-1 py-2 rounded-md text-sm font-semibold transition-all ${h==="staff"?"bg-primary text-accent shadow-md":"text-text-secondary hover:text-text-primary"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ot,{className:"w-4 h-4"})," Staff"]})})]}),h==="students"&&e.jsxs("div",{className:"relative",children:[e.jsx(xm,{className:"absolute left-3 top-3 w-4 h-4 text-text-secondary"}),e.jsxs("select",{value:y,onChange:se=>b(se.target.value),className:"w-full bg-secondary pl-10 p-2.5 rounded-md text-text-primary text-sm focus:outline-none focus:ring-2 focus:ring-accent border border-transparent appearance-none cursor-pointer hover:bg-secondary/70 transition-colors",children:[e.jsx("option",{value:"",children:"All Classes"}),d.map(se=>e.jsxs("option",{value:se.id,children:[se.name," ",se.section?`- ${se.section}`:""]},se.id))]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(xi,{className:"absolute left-3 top-3 w-4 h-4 text-text-secondary"}),e.jsx("input",{type:"text",placeholder:`Search ${h}...`,value:w,onChange:se=>E(se.target.value),className:"w-full bg-primary pl-10 p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent border border-transparent focus:border-accent transition-all shadow-sm"})]}),e.jsxs("div",{className:"flex flex-col bg-primary p-4 rounded-lg border border-secondary shadow-sm",children:[e.jsx("label",{className:"text-sm font-semibold text-text-primary mb-2 block",children:"Message"}),e.jsx("textarea",{value:S,onChange:se=>N(se.target.value),placeholder:"Type your message here... (e.g., Reminder: Tomorrow is a holiday)",className:"w-full min-h-[120px] max-h-[200px] sm:max-h-[260px] overflow-y-auto bg-secondary/30 p-3 rounded-md text-text-primary text-sm focus:outline-none focus:ring-2 focus:ring-accent resize-none border border-secondary/50"}),e.jsxs("div",{className:"mt-2 text-xs text-text-secondary flex justify-between",children:[e.jsx("span",{children:Q.enabled?"API Mode Active":"Manual Mode"}),e.jsxs("span",{children:[S.length," chars"]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:gap-3",children:[e.jsxs("button",{onClick:we,disabled:j.size===0,className:`w-full py-3 rounded-lg font-bold transition-all flex items-center justify-center gap-2 shadow-lg
                                    ${j.size>0?"bg-accent text-white hover:bg-accent/90 hover:shadow-accent/20 hover:-translate-y-0.5":"bg-secondary text-text-secondary cursor-not-allowed"}`,children:[e.jsx(zr,{className:"w-5 h-5"}),j.size>0?`Send ${Q.enabled?"via API":"Individually"} (${j.size})`:"Select Recipients"]}),e.jsxs("button",{onClick:()=>P(!0),disabled:j.size===0,className:`w-full py-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-2 border border-accent/50
                                    ${j.size>0?"text-accent hover:bg-accent hover:text-white":"text-text-secondary opacity-50 cursor-not-allowed border-secondary"}`,children:[e.jsx(Ot,{className:"w-5 h-5"}),"Prepare Group Message"]})]})]}),e.jsxs("div",{className:"w-full md:w-2/3 flex flex-col bg-primary rounded-lg border border-secondary overflow-hidden max-h-[60vh] md:max-h-none",children:[e.jsxs("div",{className:"p-4 border-b border-secondary flex justify-between items-center bg-secondary/5",children:[e.jsxs("h3",{className:"font-bold text-lg text-text-primary",children:["2. Select Recipients (",re.length,")"]}),e.jsx("button",{onClick:be,className:"text-sm text-accent font-semibold hover:underline",children:j.size===re.length&&re.length>0?"Unselect All":"Select All"})]}),e.jsx("div",{className:"overflow-y-auto flex-grow",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary sticky top-0 z-10 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 w-16 text-center",children:"Select"}),e.jsx("th",{className:"px-6 py-3",children:"Name"}),e.jsx("th",{className:"px-6 py-3",children:h==="students"?"Class Details":"Role"}),e.jsx("th",{className:"px-6 py-3",children:"Phone"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Quick Action"})]})}),e.jsx("tbody",{children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-10 text-lg",children:"Loading contacts..."})}):re.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"text-center py-10",children:['No results found matching "',w,'".']})}):re.map(se=>{const xe=X(se),ke=j.has(se.id);return e.jsxs("tr",{onClick:()=>he(se.id),className:`border-b border-secondary cursor-pointer transition-colors 
                                                        ${ke?"bg-accent/10 hover:bg-accent/20":"hover:bg-secondary/30"}`,children:[e.jsx("td",{className:"px-6 py-3 text-center",children:e.jsx("button",{className:"text-accent focus:outline-none",children:ke?e.jsx(Gr,{className:"w-5 h-5"}):e.jsx(xf,{className:"w-5 h-5 text-text-secondary"})})}),e.jsxs("td",{className:"px-6 py-3 font-medium text-text-primary",children:[se.name,e.jsx("div",{className:"text-xs text-text-secondary",children:se.id})]}),e.jsx("td",{className:"px-6 py-3",children:h==="students"?e.jsxs("span",{className:"bg-secondary px-2 py-1 rounded text-xs font-semibold",children:[se.class," - ",se.section]}):se.role}),e.jsx("td",{className:"px-6 py-3 font-mono text-xs",children:xe||e.jsx("span",{className:"text-red-400 italic",children:"No Number"})}),e.jsx("td",{className:"px-6 py-3 text-center",onClick:rt=>rt.stopPropagation(),children:xe&&e.jsxs("button",{onClick:()=>H(xe),className:"bg-green-500 text-white hover:bg-green-600 px-3 py-1.5 rounded-md text-xs font-bold flex items-center justify-center gap-1 mx-auto transition-colors shadow-sm",title:"Send Quick WhatsApp Message",children:[e.jsx(zr,{className:"w-3 h-3"})," Chat"]})})]},se.id)})})]})})]})]})}),I&&ye&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center backdrop-blur-sm",children:e.jsxs("div",{className:"bg-primary rounded-xl p-8 shadow-2xl w-full max-w-md text-center border border-secondary relative animate-[fadeIn_0.2s]",children:[e.jsx("button",{onClick:()=>V(!1),className:"absolute top-4 right-4 text-text-secondary hover:text-red-400",children:e.jsx(Bt,{className:"w-6 h-6"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-text-primary mb-1",children:"Sending Queue"}),e.jsxs("p",{className:"text-text-secondary text-sm",children:["Processing ",je.length," messages"]}),Q.enabled&&e.jsx("p",{className:"text-xs text-accent mt-1 uppercase font-bold",children:"Automatic Mode (API)"})]}),e.jsx("div",{className:"w-full bg-secondary rounded-full h-2.5 mb-6 overflow-hidden",children:e.jsx("div",{className:"bg-accent h-2.5 rounded-full transition-all duration-300",style:{width:`${He}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-text-secondary mb-6 font-mono",children:[e.jsxs("span",{children:[q+1," / ",je.length]}),e.jsxs("span",{children:[Math.round(He),"%"]})]}),e.jsxs("div",{className:"bg-secondary/50 p-6 rounded-xl mb-4 border border-secondary relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-1 h-full bg-accent"}),e.jsx("p",{className:"text-xs text-text-secondary uppercase tracking-wider mb-2 font-semibold",children:"Next Recipient"}),e.jsx("p",{className:"font-bold text-2xl text-text-primary mb-1",children:ye.name}),Se?e.jsxs("p",{className:"text-lg font-mono text-green-500 flex items-center justify-center gap-2",children:[e.jsx(Rr,{className:"w-4 h-4"})," ",Se]}):e.jsxs("p",{className:"text-red-400 flex items-center justify-center gap-2 font-bold mt-2",children:[e.jsx(fi,{className:"w-5 h-5"})," No Phone Number"]})]}),Q.enabled&&e.jsxs("div",{className:"bg-black/80 rounded-md p-2 h-24 overflow-y-auto mb-4 text-left font-mono text-[10px] text-green-400 border border-green-900/50",children:[ne.map((se,xe)=>e.jsx("div",{children:se},xe)),ne.length===0&&e.jsx("div",{className:"opacity-50",children:"Ready to start..."})]}),e.jsxs("div",{className:"space-y-3",children:[Se?e.jsx("button",{onClick:ie,disabled:Q.enabled&&G==="sending",className:`w-full text-white px-6 py-4 rounded-xl font-bold text-lg transition-all shadow-lg flex items-center justify-center gap-2 transform active:scale-95
                                        ${Q.enabled&&G==="sending"?"bg-secondary cursor-wait":"bg-green-500 hover:bg-green-600 hover:shadow-green-500/30"}`,children:Q.enabled&&G==="sending"?"Sending...":e.jsxs(e.Fragment,{children:[e.jsx(zr,{className:"w-6 h-6"})," ",Q.enabled?"Start Auto-Send":"Send & Next"]})}):e.jsxs("button",{onClick:Me,className:"w-full bg-red-500/10 text-red-500 border border-red-500/20 px-6 py-4 rounded-xl font-bold text-lg hover:bg-red-500/20 transition-all flex items-center justify-center gap-2",children:["Skip (No Number) ",e.jsx(ai,{className:"w-5 h-5"})]}),q<je.length-1&&Se&&!Q.enabled&&e.jsxs("button",{onClick:Me,className:"text-text-secondary text-sm hover:text-text-primary hover:underline flex items-center justify-center gap-1 w-full py-2",children:["Skip this person ",e.jsx(ai,{className:"w-3 h-3"})]})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center backdrop-blur-sm",children:e.jsxs("div",{className:"bg-primary rounded-xl p-8 shadow-2xl w-full max-w-lg border border-secondary relative animate-[fadeIn_0.2s]",children:[e.jsx("button",{onClick:()=>P(!1),className:"absolute top-4 right-4 text-text-secondary hover:text-red-400",children:e.jsx(Bt,{className:"w-6 h-6"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-2xl font-bold text-text-primary mb-2",children:"Prepare Group Message"}),e.jsx("p",{className:"text-text-secondary text-sm",children:"Copy the numbers below to create a WhatsApp Group or Broadcast List."})]}),e.jsxs("div",{className:"bg-secondary/30 p-4 rounded-lg mb-6 border border-secondary",children:[e.jsxs("label",{className:"text-xs font-semibold text-text-secondary uppercase mb-2 block",children:["Selected Contacts (",je.length,")"]}),e.jsx("textarea",{readOnly:!0,value:Ms(),className:"w-full h-32 bg-background p-3 rounded-md text-text-primary font-mono text-xs focus:outline-none resize-none border border-secondary"})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("button",{onClick:Xs,className:"w-full bg-accent text-white px-4 py-3 rounded-lg font-bold hover:bg-accent/90 transition-all flex items-center justify-center gap-2",children:[e.jsx(ff,{className:"w-5 h-5"})," Copy All Numbers"]}),e.jsxs("a",{href:"https://web.whatsapp.com",target:"_blank",rel:"noopener noreferrer",className:"w-full bg-green-500 text-white px-4 py-3 rounded-lg font-bold hover:bg-green-600 transition-all flex items-center justify-center gap-2 text-center",children:[e.jsx(Rr,{className:"w-5 h-5"})," Open WhatsApp Web"]})]}),e.jsxs("p",{className:"text-xs text-text-secondary mt-4 text-center",children:[e.jsx("strong",{children:"Note:"})," Paste the copied numbers into your phone contacts or directly into WhatsApp when creating a New Group or Broadcast List."]})]})}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center backdrop-blur-sm",children:e.jsxs("div",{className:"bg-primary rounded-xl p-8 shadow-2xl w-full max-w-lg border border-secondary relative animate-[fadeIn_0.2s]",children:[e.jsxs("h2",{className:"text-2xl font-bold text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(Mu,{className:"w-6 h-6"})," Gateway Settings"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between bg-secondary p-4 rounded-lg",children:[e.jsx("label",{className:"font-semibold text-text-primary",children:"Enable API Gateway"}),e.jsx("button",{onClick:()=>B(se=>({...se,enabled:!se.enabled})),className:`w-12 h-6 rounded-full p-1 transition-colors ${Q.enabled?"bg-accent":"bg-gray-600"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full shadow-md transform transition-transform ${Q.enabled?"translate-x-6":""}`})})]}),Q.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-text-secondary block mb-1",children:"Provider Preset"}),e.jsxs("select",{value:Q.provider,onChange:se=>{const xe=se.target.value;B(xe==="YCloud"?ke=>({...ke,provider:xe,url:"https://api.ycloud.com/v2/whatsapp/messages/send",headers:'{"X-API-Key": "YOUR_KEY_HERE"}',body:'{"to": "{phone}", "type": "template", "template": {"name": "hello_world", "language": {"code": "en_US"}}}'}):xe==="GreenWeb"?ke=>({...ke,provider:xe,url:"https://api.greenweb.com.bd/api.php",headers:"{}",body:'{"token": "YOUR_TOKEN", "to": "{phone}", "message": "{message}"}'}):xe==="AlphaSMS"?ke=>({...ke,provider:xe,url:"https://api.sms.net.bd/sendsms",headers:"{}",body:'{"api_key": "YOUR_KEY", "msg": "{message}", "to": "{phone}"}'}):xe==="MimSMS"?ke=>({...ke,provider:xe,url:"https://esms.mimsms.com/smsapi",headers:"{}",body:'{"api_key": "YOUR_KEY", "type": "text", "contacts": "{phone}", "senderid": "YOUR_ID", "msg": "{message}"}'}):ke=>({...ke,provider:xe}))},className:"w-full bg-secondary p-2 rounded-md text-text-primary border border-secondary focus:border-accent",children:[e.jsx("option",{value:"Custom",children:"Custom API"}),e.jsx("option",{value:"GreenWeb",children:"GreenWeb (BD)"}),e.jsx("option",{value:"AlphaSMS",children:"Alpha SMS (BD)"}),e.jsx("option",{value:"MimSMS",children:"MimSMS (BD)"}),e.jsx("option",{value:"YCloud",children:"YCloud (WhatsApp)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-text-secondary block mb-1",children:"API Endpoint URL"}),e.jsx("input",{type:"text",value:Q.url,onChange:se=>B(xe=>({...xe,url:se.target.value})),className:"w-full bg-secondary p-2 rounded-md text-text-primary text-xs font-mono border border-secondary focus:border-accent",placeholder:"https://api.example.com/send"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-text-secondary block mb-1",children:"Headers (JSON)"}),e.jsx("textarea",{value:Q.headers,onChange:se=>B(xe=>({...xe,headers:se.target.value})),className:"w-full bg-secondary p-2 rounded-md text-text-primary text-xs font-mono border border-secondary focus:border-accent h-20",placeholder:'{"Authorization": "Bearer token"}'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-text-secondary block mb-1",children:"Body Template (JSON)"}),e.jsx("textarea",{value:Q.body,onChange:se=>B(xe=>({...xe,body:se.target.value})),className:"w-full bg-secondary p-2 rounded-md text-text-primary text-xs font-mono border border-secondary focus:border-accent h-24",placeholder:'{"to": "{phone}", "text": "{message}"}'}),e.jsxs("p",{className:"text-[10px] text-text-secondary mt-1",children:["Available variables: ",e.jsx("code",{children:"{phone}"}),", ",e.jsx("code",{children:"{message}"})]})]}),e.jsxs("div",{className:"p-3 bg-blue-500/10 text-blue-400 text-xs rounded-md border border-blue-500/20",children:[e.jsx("strong",{children:"Note:"})," Free APIs may have rate limits. Ensure your provider supports CORS or use a proxy if requests fail."]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>_(!1),className:"px-4 py-2 text-text-primary hover:bg-secondary rounded-md",children:"Cancel"}),e.jsx("button",{onClick:Js,disabled:O,className:"bg-accent text-white px-6 py-2 rounded-md font-bold hover:bg-accent/90 disabled:opacity-50 disabled:cursor-wait",children:O?"Saving...":"Save Configuration"})]})]})})]})},$y=({isOpen:a,onClose:l,onSave:o,initialData:c})=>{const[d,p]=x.useState({vehicleNumber:"",route:"",driverName:"",driverContact:"",driverAddress:"",driverFatherName:"",driverNID:"",driverLicense:""}),[m,f]=x.useState([]),[h,v]=x.useState("");if(x.useEffect(()=>{dt().then(E=>{const S=E.filter(N=>N.role==="Driver");f(S)}),p(c?{vehicleNumber:c.vehicleNumber,route:c.route,driverName:c.driverName,driverContact:c.driverContact,driverAddress:c.driverAddress||"",driverFatherName:c.driverFatherName||"",driverNID:c.driverNID||"",driverLicense:c.driverLicense||""}:{vehicleNumber:"",route:"",driverName:"",driverContact:"",driverAddress:"",driverFatherName:"",driverNID:"",driverLicense:""})},[c]),!a)return null;const y=E=>{p({...d,[E.target.name]:E.target.value})},b=E=>{const S=E.target.value;v(S);const N=m.find(j=>j.id===S);N&&p(j=>({...j,driverName:N.name,driverContact:N.phone,driverFatherName:N.fatherOrHusbandName||"",driverNID:N.nid||"",driverAddress:N.permanentAddress||N.temporaryAddress||"",driverLicense:N.drivingLicense||""}))},w=E=>{E.preventDefault();const S=d;o(c?{...c,...S}:S)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-3xl h-[90vh] overflow-y-auto",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[c?"Edit":"Add New"," Vehicle & Driver"]}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-accent border-b border-secondary pb-1 mb-3",children:"Vehicle Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"vehicleNumber",placeholder:"Vehicle Number (e.g., BUS-101)",value:d.vehicleNumber,onChange:y,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"text",name:"route",placeholder:"Route (e.g., North Route)",value:d.route,onChange:y,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-secondary pb-1 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-accent",children:"Driver Details"}),e.jsxs("select",{className:"bg-secondary text-sm p-1 rounded border border-accent text-text-primary",onChange:b,value:h,children:[e.jsx("option",{value:"",children:"-- Select Driver from Staff --"}),m.map(E=>e.jsxs("option",{value:E.id,children:[E.name," (",E.id,")"]},E.id))]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"driverName",placeholder:"Driver's Name",value:d.driverName,onChange:y,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"text",name:"driverFatherName",placeholder:"Father's Name",value:d.driverFatherName,onChange:y,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsx("input",{type:"tel",name:"driverContact",placeholder:"Driver's Contact",value:d.driverContact,onChange:y,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"text",name:"driverNID",placeholder:"NID Number",value:d.driverNID,onChange:y,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsx("input",{type:"text",name:"driverLicense",placeholder:"Driving License No",value:d.driverLicense,onChange:y,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsx("textarea",{name:"driverAddress",placeholder:"Driver's Address",value:d.driverAddress,onChange:y,rows:1,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent md:col-span-2"})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:c?"Save Changes":"Add Vehicle"})]})]})]})})},Ry=({isOpen:a,onClose:l,vehicle:o,onSave:c})=>{const[d,p]=x.useState([]),[m,f]=x.useState(o.studentIds||[]),[h,v]=x.useState(!0),[y,b]=x.useState(""),[w,E]=x.useState(!1);x.useEffect(()=>{a&&(async()=>{v(!0);try{const V=await tt();p(V)}catch(V){console.error("Failed to fetch students",V)}finally{v(!1)}})()},[a]);const S=I=>{f(V=>V.includes(I)?V.filter($=>$!==I):[...V,I])},N=async()=>{E(!0);try{await zm({...o,studentIds:m}),c(),l()}catch(I){console.error("Failed to save transport assignments",I),alert("Failed to save. Please try again.")}finally{E(!1)}},j=x.useMemo(()=>y?d.filter(I=>I.name.toLowerCase().includes(y.toLowerCase())||I.id.toLowerCase().includes(y.toLowerCase())||I.class.toLowerCase().includes(y.toLowerCase())):d,[d,y]),M=x.useMemo(()=>d.filter(I=>m.includes(I.id)),[d,m]);return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-6 shadow-2xl w-full max-w-2xl h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b border-secondary pb-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-text-primary",children:"Manage Passengers"}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Vehicle: ",o.vehicleNumber," (",o.route,")"]})]}),e.jsx("button",{onClick:l,className:"text-text-secondary hover:text-red-400",children:e.jsx(Bt,{})})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(xi,{className:"absolute left-3 top-2.5 w-4 h-4 text-text-secondary"}),e.jsx("input",{type:"text",placeholder:"Search student by name, ID or class...",value:y,onChange:I=>b(I.target.value),className:"w-full bg-secondary pl-10 p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})]}),e.jsxs("div",{className:"bg-accent/10 px-3 py-2 rounded-md text-accent text-sm font-bold whitespace-nowrap",children:[m.length," Assigned"]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden flex gap-4",children:[e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden border border-secondary rounded-lg",children:[e.jsx("div",{className:"bg-secondary p-2 text-sm font-semibold text-text-primary",children:"Available Students"}),e.jsx("div",{className:"overflow-y-auto p-2 space-y-2",children:h?e.jsx("p",{className:"text-center p-4 text-text-secondary",children:"Loading..."}):j.filter(I=>!m.includes(I.id)).length===0?e.jsx("p",{className:"text-center p-4 text-text-secondary text-sm",children:"No matching students found."}):j.filter(I=>!m.includes(I.id)).slice(0,50).map(I=>e.jsxs("div",{className:"flex justify-between items-center p-2 hover:bg-secondary rounded-md border border-transparent hover:border-accent/30 group",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-text-primary",children:I.name}),e.jsxs("p",{className:"text-xs text-text-secondary",children:[I.id," | Class ",I.class]})]}),e.jsx("button",{onClick:()=>S(I.id),className:"p-1 bg-green-500/20 text-green-500 rounded hover:bg-green-500/40",children:e.jsx(pi,{className:"w-4 h-4"})})]},I.id))})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden border border-secondary rounded-lg bg-secondary/10",children:[e.jsxs("div",{className:"bg-secondary p-2 text-sm font-semibold text-text-primary flex justify-between",children:[e.jsx("span",{children:"Assigned Passengers"}),m.length>0&&e.jsx("span",{className:"text-xs bg-accent text-white px-1.5 rounded-full",children:m.length})]}),e.jsx("div",{className:"overflow-y-auto p-2 space-y-2",children:M.length===0?e.jsx("p",{className:"text-center p-4 text-text-secondary text-sm",children:"No students assigned."}):M.map(I=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-background rounded-md shadow-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-text-primary",children:I.name}),e.jsx("p",{className:"text-xs text-text-secondary",children:I.id})]}),e.jsx("button",{onClick:()=>S(I.id),className:"p-1 text-red-400 hover:bg-red-50 rounded",children:e.jsx(Re,{className:"w-4 h-4"})})]},I.id))})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-4 border-t border-secondary pt-4",children:[e.jsx("button",{onClick:l,className:"px-4 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{onClick:N,disabled:w,className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold disabled:opacity-50",children:w?"Saving...":"Save Changes"})]})]})}):null},zy=()=>{const{user:a}=qe(),l=a?.role==="Admin",[o,c]=x.useState([]),[d,p]=x.useState([]),[m,f]=x.useState(!0),[h,v]=x.useState(!1),[y,b]=x.useState(!1),[w,E]=x.useState(null),[S,N]=x.useState(null),j=x.useCallback(async()=>{try{f(!0);const[D,_]=await Promise.all([Rm(),tt()]);c(D),p(_)}catch(D){console.error("Failed to fetch data",D)}finally{f(!1)}},[]);x.useEffect(()=>{j()},[j]),x.useEffect(()=>{const D=()=>j();return window.addEventListener("app:refresh",D),()=>window.removeEventListener("app:refresh",D)},[j]);const M=async D=>{"id"in D?await zm(D):await Sg(D),j(),$()},I=async D=>{if(window.confirm(`Are you sure you want to delete the vehicle "${D.vehicleNumber}"?`))try{f(!0),await kg(D.id),j()}catch(_){console.error("Failed to delete vehicle",_),alert("Error deleting vehicle.")}finally{f(!1)}},V=(D=null)=>{E(D),v(!0)},$=()=>{E(null),v(!1)},P=D=>{N(D),b(!0)},q=()=>{N(null),b(!1)},k=D=>{const _=mt(),O=d.filter(ne=>D.studentIds?.includes(ne.id)),K=window.open("","_blank");if(!K){alert("Please allow popups to print.");return}const Q=O.map((ne,le)=>`
            <tr>
                <td style="text-align: center;">${le+1}</td>
                <td>${ne.id}</td>
                <td style="text-align: left; padding-left: 10px;">${ne.name}</td>
                <td style="text-align: center;">${ne.class}</td>
                <td style="text-align: center;">${ne.section||"-"}</td>
                <td>${ne.guardianPhone||"N/A"}</td>
            </tr>
        `).join(""),B=Math.max(0,20-O.length),G=Array(B).fill(0).map(()=>`
            <tr><td style="height: 25px;"></td><td></td><td></td><td></td><td></td><td></td></tr>
        `).join(""),T=`
            <!DOCTYPE html>
            <html>
                <head>
                    <title>Vehicle Passenger List - ${D.vehicleNumber}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&family=Tiro+Bangla&display=swap" rel="stylesheet">
                    <style>
                        @media print {
                            @page { size: A4; margin: 0; }
                            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
                            .no-print { display: none; }
                        }
                        body {
                            font-family: 'Times New Roman', serif;
                            margin: 0;
                            padding: 0;
                            height: 100vh;
                            box-sizing: border-box;
                        }
                        .report-container {
                            width: 210mm;
                            height: 297mm;
                            margin: 0 auto;
                            padding: 10mm;
                            box-sizing: border-box;
                            position: relative;
                            overflow: hidden;
                        }
                        .watermark {
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            width: 600px;
                            height: 600px;
                            background-image: url('${_.logo}');
                            background-repeat: no-repeat;
                            background-position: center;
                            background-size: contain;
                            opacity: 0.15;
                            z-index: 0;
                            pointer-events: none;
                        }
                        .border-box {
                            border: 1px solid #666;
                            padding: 5px;
                            height: 98%;
                            position: relative;
                            z-index: 1;
                        }
                        .inner-border {
                            border: 1px solid #444;
                            height: 100%;
                            padding: 15px;
                            box-sizing: border-box;
                        }
                        .header { text-align: center; position: relative; margin-bottom: 10px; }
                        .bismillah-img { width: 100px; margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto; transform: scaleX(1.8); }
                        .inst-name { font-size: 20px; font-weight: bold; text-transform: uppercase; color: #2c3e50; margin: 5px 0; letter-spacing: 1px; }
                        .inst-address { font-size: 12px; margin-bottom: 5px; }
                        .inst-contact { font-size: 12px; }
                        .logo { position: absolute; left: 10px; top: 10px; width: 70px; height: 70px; }
                        
                        .report-title { 
                            text-align: center; margin-top: 5px; margin-bottom: 5px; 
                            font-size: 16px; font-weight: bold; text-decoration: underline; 
                        }

                        .info-section { 
                            display: flex; justify-content: space-between; 
                            border: 1px solid #999; 
                            padding: 10px 20px; margin-bottom: 15px; font-size: 14px; line-height: 1.6;
                        }
                        .info-col { width: 48%; }
                        .info-row { display: flex; }
                        .label { width: 120px; font-weight: bold; }
                        .val { font-weight: 500; }

                        .data-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 15px; }
                        .data-table th, .data-table td { border: 1px solid #666; padding: 6px; text-align: center; }
                        .data-table th { background-color: #f8fafc; font-weight: bold; }
                        
                        .footer { display: flex; justify-content: space-between; margin-top: 40px; padding: 0 20px; }
                        .sig-box { text-align: center; width: 150px; }
                        .sig-line { border-top: 1px solid #000; margin-top: 30px; font-size: 12px; font-weight: bold; padding-top: 5px;}

                        .print-date { position: absolute; bottom: 5px; left: 10px; font-size: 10px; font-style: italic; color: #555; }
                        .watermark-text { position: absolute; bottom: 5px; right: 10px; font-size: 10px; font-style: italic; color: #555; }
                    </style>
                </head>
                <body>
                    <div class="report-container">
                        <div class="watermark"></div>
                        <div class="border-box">
                            <div class="inner-border">
                                <div class="header">
                                    <img src="${_.logo}" class="logo" />
                                    <img src="https://iili.io/fEBrvMQ.png" class="bismillah-img" alt="Bismillah" />
                                    <div class="inst-name">${_.name}</div>
                                    <div class="inst-address">${_.address}</div>
                                    <div class="inst-contact">Phone: ${_.phone}, Email: ${_.email}</div>
                                    <div class="report-title">Vehicle Passenger List</div>
                                </div>

                                <div class="info-section">
                                    <div class="info-col">
                                        <div class="info-row"><span class="label">Vehicle No :</span> <span class="val">${D.vehicleNumber}</span></div>
                                        <div class="info-row"><span class="label">Route :</span> <span class="val">${D.route}</span></div>
                                        <div class="info-row"><span class="label">Total Passengers :</span> <span class="val">${O.length}</span></div>
                                    </div>
                                    <div class="info-col">
                                        <div class="info-row"><span class="label">Driver Name :</span> <span class="val">${D.driverName}</span></div>
                                        <div class="info-row"><span class="label">Phone :</span> <span class="val">${D.driverContact}</span></div>
                                        <div class="info-row"><span class="label">License No :</span> <span class="val">${D.driverLicense||"-"}</span></div>
                                    </div>
                                </div>

                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th style="width: 40px;">SL</th>
                                            <th style="width: 100px;">Student ID</th>
                                            <th>Student Name</th>
                                            <th style="width: 70px;">Class</th>
                                            <th style="width: 70px;">Section</th>
                                            <th style="width: 120px;">Guardian Phone</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${Q}
                                        ${G}
                                    </tbody>
                                </table>

                                <div class="footer">
                                    <div class="sig-box"><div class="sig-line">Prepared By</div></div>
                                    <div class="sig-box"><div class="sig-line">Transport Officer</div></div>
                                    <div class="sig-box"><div class="sig-line">Authorized Sign</div></div>
                                </div>

                                <div class="print-date">Printed on ${new Date().toLocaleString("en-GB")}</div>
                                <div class="watermark-text">Powered by IICM</div>
                            </div>
                        </div>
                    </div>
                    <script>
                        window.onload = function() {
                            setTimeout(() => {
                                window.print();
                            }, 500);
                        }
                    <\/script>
                </body>
            </html>
        `;K.document.write(T),K.document.close()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Transport Management"}),l&&e.jsxs("button",{onClick:()=>V(),className:"bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90 transition-colors flex items-center gap-2",children:[e.jsx(ja,{className:"w-5 h-5"}),"Add New Vehicle"]})]}),m?e.jsx("p",{className:"text-center text-text-secondary mt-8",children:"Loading transport data..."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(D=>e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg relative group border border-secondary hover:border-accent/50 transition-all flex flex-col",children:[l&&e.jsxs("div",{className:"absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>k(D),className:"p-2 bg-secondary rounded-full hover:bg-background text-text-secondary hover:text-accent",title:"Print",children:e.jsx(jt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>V(D),className:"p-2 bg-secondary rounded-full hover:bg-background text-text-secondary hover:text-accent",title:"Edit",children:e.jsx(wt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>I(D),className:"p-2 bg-secondary rounded-full hover:bg-background text-red-500",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center mb-4 border-b border-secondary pb-4",children:[e.jsx("div",{className:"p-3 bg-accent/10 rounded-full mr-4",children:e.jsx(ja,{className:"w-8 h-8 text-accent"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-text-primary",children:D.vehicleNumber}),e.jsx("p",{className:"text-sm text-text-secondary font-medium",children:D.route})]})]}),e.jsxs("div",{className:"space-y-2 text-sm mb-4 flex-grow",children:[e.jsxs("div",{className:"font-semibold text-accent flex items-center gap-2",children:[e.jsx(ni,{className:"w-4 h-4"})," Driver Details"]}),e.jsxs("div",{className:"bg-secondary/30 p-3 rounded-md space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Name:"})," ",e.jsx("span",{className:"font-medium text-text-primary",children:D.driverName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Phone:"})," ",e.jsx("span",{className:"text-text-primary",children:D.driverContact})]}),D.driverFatherName&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"Father:"})," ",e.jsx("span",{className:"text-text-primary",children:D.driverFatherName})]}),D.driverLicense&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"License:"})," ",e.jsx("span",{className:"text-text-primary",children:D.driverLicense})]}),D.driverNID&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-text-secondary",children:"NID:"})," ",e.jsx("span",{className:"text-text-primary",children:D.driverNID})]}),D.driverAddress&&e.jsxs("div",{className:"flex justify-between flex-col mt-1",children:[e.jsx("span",{className:"text-text-secondary text-xs",children:"Address:"})," ",e.jsx("span",{className:"text-text-primary text-xs",children:D.driverAddress})]})]}),e.jsxs("div",{className:"flex justify-between items-center p-2 bg-secondary rounded-md mt-2",children:[e.jsx("span",{className:"text-text-secondary",children:"Total Passengers"}),e.jsxs("span",{className:"font-bold text-accent flex items-center gap-1",children:[e.jsx(Ot,{className:"w-3 h-3"}),D.studentIds?D.studentIds.length:0]})]})]}),e.jsxs("button",{onClick:()=>P(D),className:"w-full py-2 rounded-md border border-accent text-accent font-semibold hover:bg-accent hover:text-white transition-colors flex items-center justify-center gap-2 text-sm mt-auto",children:[e.jsx(Ot,{className:"w-4 h-4"})," ",l?"Manage Students":"View Students"]})]},D.id))}),h&&e.jsx($y,{isOpen:h,onClose:$,onSave:M,initialData:w}),y&&S&&e.jsx(Ry,{isOpen:y,onClose:q,vehicle:S,onSave:j})]})},Xo=()=>{const a=new Date;return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},_y=({isOpen:a,onClose:l,onSave:o,initialData:c})=>{const[d,p]=x.useState({name:"",category:"",quantity:0,status:"In Stock",date:Xo()});if(x.useEffect(()=>{p(c?{name:c.name,category:c.category,quantity:c.quantity,status:c.status,date:c.date||Xo()}:{name:"",category:"",quantity:0,status:"In Stock",date:Xo()})},[c]),!a)return null;const m=h=>{const{name:v,value:y}=h.target;p({...d,[v]:v==="quantity"?parseInt(y,10):y})},f=h=>{h.preventDefault(),o(c?{...c,...d}:d)};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[c?"Edit":"Add New"," Inventory Item"]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("input",{type:"text",name:"name",placeholder:"Item Name",value:d.name,onChange:m,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"text",name:"category",placeholder:"Category (e.g., Furniture, Books)",value:d.category,onChange:m,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",name:"quantity",placeholder:"Quantity",value:d.quantity,onChange:m,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,min:"0"}),e.jsxs("select",{name:"status",value:d.status,onChange:m,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,children:[e.jsx("option",{value:"In Stock",children:"In Stock"}),e.jsx("option",{value:"Low Stock",children:"Low Stock"}),e.jsx("option",{value:"Out of Stock",children:"Out of Stock"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Purchase/Entry Date"}),e.jsx("input",{type:"date",name:"date",value:d.date,onChange:m,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:c?"Save Changes":"Add Item"})]})]})]})})},Oy=a=>{if(!a)return"N/A";if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a;try{const l=new Date(a);if(isNaN(l.getTime()))return a;const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`}catch{return a}},By=()=>{const{user:a}=qe(),l=["Admin","Librarian","IT Admin"].includes(a?.role||""),[o,c]=x.useState([]),[d,p]=x.useState(!0),[m,f]=x.useState(!1),[h,v]=x.useState(null),y=x.useCallback(async()=>{try{p(!0);const N=await Cg();c(N)}catch(N){console.error("Failed to fetch inventory data",N)}finally{p(!1)}},[]);x.useEffect(()=>{y()},[y]),x.useEffect(()=>{const N=()=>y();return window.addEventListener("app:refresh",N),()=>window.removeEventListener("app:refresh",N)},[y]);const b=async N=>{"id"in N?await Dg(N):await Eg(N),y(),S()},w=async N=>{if(window.confirm("Are you sure you want to delete this inventory item?"))try{p(!0),await Ig(N),y()}catch(j){console.error("Failed to delete inventory item",j)}finally{p(!1)}},E=(N=null)=>{v(N),f(!0)},S=()=>{v(null),f(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Inventory & Asset Management"}),l&&e.jsxs("button",{onClick:()=>E(),className:"bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90 transition-colors flex items-center gap-2",children:[e.jsx(fm,{className:"w-5 h-5"}),"Add New Item"]})]}),e.jsx("div",{className:"overflow-x-auto bg-primary rounded-lg shadow-lg",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Item Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Category"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Quantity"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Date"}),l&&e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:d?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4",children:"Loading inventory..."})}):o.map(N=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-text-primary",children:N.name}),e.jsx("td",{className:"px-6 py-4",children:N.category}),e.jsx("td",{className:"px-6 py-4",children:N.quantity}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${N.status==="In Stock"?"bg-green-500/20 text-green-400":N.status==="Low Stock"?"bg-yellow-500/20 text-yellow-400":"bg-red-500/20 text-red-400"}`,children:N.status})}),e.jsx("td",{className:"px-6 py-4",children:Oy(N.date)}),l&&e.jsxs("td",{className:"px-6 py-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>E(N),className:"p-1 hover:bg-background rounded",title:"Edit",children:e.jsx(wt,{className:"w-4 h-4 text-yellow-400"})}),e.jsx("button",{onClick:()=>w(N.id),className:"p-1 hover:bg-background rounded",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4 text-red-500"})})]})]},N.id))})]})}),m&&e.jsx(_y,{isOpen:m,onClose:S,onSave:b,initialData:h})]})},Uy=a=>{if(!a)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a;const l=new Date(a);if(isNaN(l.getTime()))return"";const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`},Wy=a=>{if(!a)return"";if(/^\d{1,2}:\d{2}(:\d{2})?$/.test(a)){const o=a.split(":");return`${o[0].padStart(2,"0")}:${o[1]}`}const l=new Date(a);if(!isNaN(l.getTime())){const o=String(l.getHours()).padStart(2,"0"),c=String(l.getMinutes()).padStart(2,"0");return`${o}:${c}`}return a},Hy=({onClose:a,onSave:l,initialData:o})=>{const[c,d]=x.useState({title:o?.title||"",class:o?.class||"",subject:o?.subject||"",date:Uy(o?.date),time:Wy(o?.time)}),[p,m]=x.useState([]),[f,h]=x.useState([]),[v,y]=x.useState([]);x.useEffect(()=>{(async()=>{const[N,j,M]=await Promise.all([ut(),Sa(),Ks()]);m(N),h(j),y(M),!o&&N.length>0&&d(I=>({...I,class:N[0].name}))})()},[o]);const b=S=>{const{name:N,value:j}=S.target;d(M=>({...M,[N]:j}))},w=async S=>{S.preventDefault(),o?await _m({...c,id:o.id}):await Tg(c),l()},E=x.useMemo(()=>c.class?f.filter(S=>!S.class||S.class===c.class):[],[f,c.class]);return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[o?"Edit":"Add"," Exam"]}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Exam Name"}),e.jsxs("select",{name:"title",value:c.title,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,children:[e.jsx("option",{value:"",children:"Select Exam Name"}),v.length>0?v.map(S=>e.jsx("option",{value:S.name,children:S.name},S.id)):e.jsx("option",{value:"",disabled:!0,children:"No exam names found. Please add in 'Manage Exam Names'."})]}),v.length===0&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:"Please add exam names in the 'Manage Exam Names' section first."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Class"}),e.jsxs("select",{name:"class",value:c.class,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:[e.jsx("option",{value:"",children:"Select Class"}),p.map(S=>e.jsxs("option",{value:S.name,children:[S.name," - ",S.section]},S.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Subject"}),e.jsxs("select",{name:"subject",value:c.subject,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0,children:[e.jsx("option",{value:"",children:"Select Subject"}),E.map(S=>e.jsx("option",{value:S.name,children:S.name},S.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Date"}),e.jsx("input",{type:"date",name:"date",value:c.date,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Time"}),e.jsx("input",{type:"time",name:"time",value:c.time,onChange:b,className:"w-full bg-secondary p-3 rounded-md text-text-primary",required:!0})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:a,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",disabled:!c.title,children:"Save"})]})]})]})})},Vy=a=>{if(!a)return"TBA";if(/^\d{1,2}:\d{2}(:\d{2})?$/.test(a)){const[o,c]=a.split(":").map(Number),d=new Date;return d.setHours(o,c,0,0),d.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}const l=new Date(a);return isNaN(l.getTime())?a:l.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})},Hu=a=>{if(!a)return"";const l=new Date(a);return isNaN(l.getTime())?a:l.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},Gy=({isOpen:a,onClose:l,allExams:o})=>{const[c,d]=x.useState(""),[p,m]=x.useState(""),[f,h]=x.useState([]),[v,y]=x.useState(!1),b=x.useMemo(()=>Array.from(new Set(o.map(S=>S.title))),[o]),w=x.useMemo(()=>c?Array.from(new Set(o.filter(S=>S.title===c).map(S=>S.class))):[],[o,c]);x.useEffect(()=>{(async()=>{if(c&&p){y(!0);try{const N=await tt({class:p}),j=new Date,M=await Kr(j.getFullYear(),j.getMonth()+1),I=N.map(V=>{const $=M.find(q=>q.studentId===V.id),P=$?["Paid","Partially Paid"].includes($.status)||$.totalDue<=0:!1;return{student:V,isEligible:P,feeStatus:$?$.status:"Unknown"}});h(I)}catch(N){console.error("Error fetching data for admit cards",N)}finally{y(!1)}}else h([])})()},[c,p]);const E=S=>{const N=mt(),j=window.open("","_blank"),I=o.filter(k=>k.title===c&&k.class===p).sort((k,D)=>new Date(k.date).getTime()-new Date(D.date).getTime()).map(k=>`
            <tr>
                <td style="padding: 5px; border: 1px solid #D4AF37; text-align: center;">${Hu(k.date)}</td>
                <td style="padding: 5px; border: 1px solid #D4AF37; text-align: center;">${Vy(k.time)}</td>
                <td style="padding: 5px; border: 1px solid #D4AF37; font-weight: bold;"><span class="latin-fix">${k.subject}</span></td>
            </tr>
        `).join(""),V=S.rollNo||S.id.replace(/\D/g,""),$=V?parseInt(V,10).toString():"N/A",P=S.dob?Hu(S.dob):"N/A",q=`
            <html>
            <head>
                <title>Admit Card - ${S.name}</title>
                <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&display=swap" rel="stylesheet">
                <style>
                    @page {
                        size: A4;
                        margin: 8mm 6mm;
                    }
                    body { font-family: 'Libre Baskerville', serif; background-color: #fff; margin: 0; padding: 20px; color: #1E3A29; }
                    .card {
                        width: 100%;
                        max-width: 194mm;   /* wider but still A4-safe */
                        min-height: 275mm;
                        margin: 0 auto;
                        padding: 12mm;

                        box-sizing: border-box;
                        position: relative;

                        border: 3px solid #1E5631;
                        outline: 2px solid #D4AF37;
                        outline-offset: -6px;
                        background: #fdfbf7;
                    }
                    .watermark {
                        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                        width: 600px; height: 600px;
                        background-image: url('${N.logo}');
                        background-size: contain; background-repeat: no-repeat; background-position: center;
                        opacity: 0.05; z-index: 0;
                    }
                    .latin-fix {
                        direction: ltr;
                        unicode-bidi: isolate;
                        font-variant-ligatures: none;
                        font-feature-settings: "liga" 0, "clig" 0, "calt" 0;
                    }
                    .header { text-align: center; border-bottom: 2px solid #D4AF37; padding-bottom: 10px; margin-bottom: 15px; position: relative; z-index: 1; }
                    .header img { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #1E5631; display: block; margin: 0 auto 5px; }
                    .header h1 { font-family: serif; font-size: 24px; color: #1E5631; margin: 0; text-transform: uppercase; }
                    .header p { font-size: 12px; margin: 2px 0; color: #555; }
                    
                    .admit-title {
                        background-color: #1E5631; color: #D4AF37;
                        display: inline-block; padding: 5px 20px; border-radius: 20px;
                        font-family: serif; font-weight: bold; font-size: 16px;
                        margin-top: 5px; border: 1px solid #D4AF37;
                    }
                    
                    .candidate-box { display: flex; gap: 20px; margin-bottom: 15px; position: relative; z-index: 1; border: 1px solid #D4AF37; padding: 15px; background: rgba(255,255,255,0.5); }
                    .photo-frame { width: 110px; height: 130px; border: 2px solid #1E5631; display: flex; align-items: center; justify-content: center; background: #fff; flex-shrink: 0; }
                    .photo-frame img { width: 100%; height: 100%; object-fit: cover; }
                    
                    .details { display: grid; grid-template-columns: 1fr 1fr; column-gap: 14px; row-gap: 6px; font-size: 13px; }
                    .details > div { white-space: nowrap; }
                    .details .value { word-break: keep-all; }
                    .details .label { font-weight: bold; color: #1E5631; width: 85px; display: inline-block; }
                    
                    table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 12px; position: relative; z-index: 1; }
                    th { background-color: #1E5631; color: #fff; padding: 5px; border: 1px solid #D4AF37; font-family: serif; }
                    td { padding: 5px; border: 1px solid #D4AF37; }
                    
                    .instructions { font-size: 10px; margin-bottom: 30px; position: relative; z-index: 1; }
                    .instructions h4 { margin: 0 0 5px 0; color: #1E5631; border-bottom: 1px solid #D4AF37; display: inline-block; }
                    
                    .footer { display: flex; justify-content: space-between; margin-top: 100px; position: relative; z-index: 1; }
                    .sig-line { border-top: 1px solid #1E5631; width: 150px; text-align: center; font-size: 12px; font-weight: bold; padding-top: 5px; }
                    
                    @media print {
                        html, body {
                            width: 210mm;
                            height: 297mm;
                            margin: 0;
                            padding: 0;
                        }

                        body {
                            -webkit-print-color-adjust: exact;
                            print-color-adjust: exact;
                        }

                        .card {
                            page-break-after: always;
                        }
                    }
                </style>
            </head>
            <body>
                <div class="card">
                    <div class="watermark"></div>
                    <div class="header">
                        <img src="${N.logo}">
                        <h1>${N.name}</h1>
                        <p>${N.address}</p>
                        <div class="admit-title">${c} ADMIT CARD</div>
                    </div>
                    
                    <div class="candidate-box">
                        <div class="photo-frame"><img src="${S.photo||at}" /></div>
                        <div class="details">
                            <div><span class="label">Name:</span> ${S.name}</div>
                            <div><span class="label">ID No:</span> ${S.id}</div>
                            
                            <div><span class="label">Class:</span> ${S.class}</div>
                            <div><span class="label">Section:</span> ${S.section}</div>
                            
                            <div><span class="label">Roll No:</span> ${$}</div>
                            <div><span class="label">Group:</span> ${S.group||"N/A"}</div>
                            
                            <div><span class="label">Gender:</span> ${S.gender||"N/A"}</div>
                            <div><span class="label">Blood:</span> ${S.bloodGroup||"N/A"}</div>
                            
                            <div><span class="label">Guardian:</span> ${S.guardianName}</div>
                            <div><span class="label">Phone:</span> ${S.guardianPhone}</div>
                            
                            <div><span class="label">DOB:</span> ${P}</div>
                            <div><span class="label">Session:</span> ${new Date().getFullYear()}</div>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Subject</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${I}
                        </tbody>
                    </table>
                    
                    <div class="instructions">
                        <h4>Important Instructions</h4>
                        <ul>
                            <li>Candidates must bring this Admit Card to the examination hall.</li>
                            <li>Arrive at least 15 minutes before the scheduled time.</li>
                            <li>Use of mobile phones or electronic gadgets is strictly prohibited.</li>
                            <li>Maintain silence and discipline inside the exam hall.</li>
                            <li>Bring your own stationery (pens, pencils, rulers, etc.).</li>
                        </ul>
                    </div>
                    
                    <div class="footer">
                        <div class="sig-line">Class Teacher</div>
                        <div class="sig-line">Director</div>
                    </div>
                </div>
                <script>
                    window.onload = function() {
                        setTimeout(() => {
                            window.print();
                        }, 500);
                    }
                <\/script>
            </body>
            </html>
        `;j?.document.write(q),j?.document.close()};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-4xl h-[85vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-secondary pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Generate Admit Cards"}),e.jsx("button",{onClick:l,className:"text-text-secondary hover:text-red-400",children:e.jsx(Bt,{})})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block text-sm text-text-secondary mb-1",children:"Select Exam"}),e.jsxs("select",{value:c,onChange:S=>{d(S.target.value),m("")},className:"w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:[e.jsx("option",{value:"",children:"-- Choose Exam --"}),b.map(S=>e.jsx("option",{value:S,children:S},S))]})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"block text-sm text-text-secondary mb-1",children:"Select Class"}),e.jsxs("select",{value:p,onChange:S=>m(S.target.value),className:"w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",disabled:!c,children:[e.jsx("option",{value:"",children:"-- Choose Class --"}),w.map(S=>e.jsx("option",{value:S,children:S},S))]})]})]}),e.jsx("div",{className:"flex-grow overflow-y-auto bg-secondary/30 rounded-lg p-4 border border-secondary",children:v?e.jsx("div",{className:"text-center py-10 text-text-secondary",children:"Checking eligibility..."}):f.length===0?e.jsx("div",{className:"text-center py-10 text-text-secondary",children:p?"No students found.":"Please select an exam and class to view students."}):e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"ID"}),e.jsx("th",{className:"px-4 py-3",children:"Student Name"}),e.jsx("th",{className:"px-4 py-3",children:"Fee Status"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Action"})]})}),e.jsx("tbody",{children:f.map(({student:S,isEligible:N,feeStatus:j})=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsx("td",{className:"px-4 py-3",children:S.id}),e.jsx("td",{className:"px-4 py-3 font-medium text-text-primary",children:S.name}),e.jsx("td",{className:"px-4 py-3",children:N?e.jsxs("span",{className:"flex items-center gap-1 font-semibold text-green-400",children:[e.jsx(gi,{className:"w-4 h-4"})," ",j==="Partially Paid"?"Cleared (Partial)":"Cleared"]}):e.jsxs("span",{className:"flex items-center gap-1 text-red-400 font-semibold",title:"Must clear dues for current month",children:[e.jsx(fi,{className:"w-4 h-4"})," ",j]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("button",{onClick:()=>E(S),disabled:!N,className:"bg-accent text-white px-3 py-1 rounded hover:bg-accent/90 disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center gap-2 mx-auto text-xs",children:[e.jsx(jt,{className:"w-3 h-3"})," Print"]})})]},S.id))})]})})]})}):null},Ym=({onClose:a})=>{const[l,o]=x.useState([]),[c,d]=x.useState(""),[p,m]=x.useState(!1),[f,h]=x.useState(""),[v,y]=x.useState(""),[b,w]=x.useState(!1),[E,S]=x.useState(null),[N,j]=x.useState({name:"",isPublished:!1,attendanceStartDate:"",attendanceEndDate:""}),M=k=>{if(!k)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(k))return k;const D=new Date(k);if(isNaN(D.getTime()))return k;const _=D.getFullYear(),O=String(D.getMonth()+1).padStart(2,"0"),K=String(D.getDate()).padStart(2,"0");return`${_}-${O}-${K}`},I=async()=>{w(!0);try{const k=await Ks();o(k)}catch(k){console.error(k)}finally{w(!1)}};x.useEffect(()=>{I()},[]);const V=async()=>{if(c.trim()){w(!0);try{await Mg(c.trim(),p,f||void 0,v||void 0),d(""),m(!1),h(""),y(""),await I()}catch{alert("Failed to add exam name.")}finally{w(!1)}}},$=k=>{S(k.id),j({name:k.name,isPublished:!!k.isPublished,attendanceStartDate:M(k.attendanceStartDate),attendanceEndDate:M(k.attendanceEndDate)})},P=async()=>{if(E){w(!0);try{await Pg({id:E,name:N.name,isPublished:N.isPublished,attendanceStartDate:N.attendanceStartDate||void 0,attendanceEndDate:N.attendanceEndDate||void 0}),S(null),await I()}catch{alert("Failed to update.")}finally{w(!1)}}},q=async k=>{if(confirm("Are you sure? This will remove the name and linked database from the list.")){w(!0);try{await Ag(k),await I()}catch{alert("Failed to delete exam name.")}finally{w(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-primary rounded-lg p-6 sm:p-8 shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:"Public Results Sources"}),e.jsxs("div",{className:"bg-secondary/20 p-4 rounded-lg border border-secondary mb-6",children:[e.jsx("p",{className:"text-xs text-text-secondary font-bold uppercase mb-4 tracking-wider",children:"Add New Exam Source"}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsx("input",{type:"text",placeholder:"Exam Title (e.g. Mid Term 2025)",value:c,onChange:k=>d(k.target.value),className:"w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent border border-secondary"}),e.jsxs("div",{className:"flex items-center gap-2 bg-secondary p-2 rounded-md border border-secondary",children:[e.jsx("input",{type:"checkbox",id:"newIsPublished",checked:p,onChange:k=>m(k.target.checked),className:"w-4 h-4 accent-accent"}),e.jsx("label",{htmlFor:"newIsPublished",className:"text-xs text-text-primary cursor-pointer select-none font-semibold",children:"Publish Results"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 p-3 bg-primary/30 rounded-md border border-secondary/50",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[10px] text-text-secondary uppercase font-bold",children:"Attendance Start"}),e.jsx("input",{type:"date",value:f,onChange:k=>h(k.target.value),className:"bg-secondary p-1.5 rounded-md text-text-primary text-xs focus:outline-none border border-secondary"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[10px] text-text-secondary uppercase font-bold",children:"Attendance End"}),e.jsx("input",{type:"date",value:v,onChange:k=>y(k.target.value),className:"bg-secondary p-1.5 rounded-md text-text-primary text-xs focus:outline-none border border-secondary"})]})]}),e.jsxs("button",{onClick:V,disabled:b||!c.trim(),className:"w-full bg-accent text-white py-2 rounded-md font-bold hover:bg-accent/90 disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx(qr,{className:"w-5 h-5"})," Add Exam Source"]})]})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto space-y-3 mb-6 pr-2",children:[e.jsx("p",{className:"text-xs text-text-secondary font-bold uppercase mb-1 tracking-wider",children:"Configured Sources"}),b&&l.length===0?e.jsx("p",{className:"text-center text-text-secondary py-10",children:"Loading sources..."}):l.length===0?e.jsx("p",{className:"text-center text-text-secondary italic py-10",children:"No sources defined yet."}):l.map(k=>e.jsx("div",{className:"bg-secondary p-4 rounded-lg border border-secondary group",children:E===k.id?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:N.name,onChange:D=>j({...N,name:D.target.value}),className:"w-full bg-primary p-2 rounded text-sm text-text-primary border border-accent"}),e.jsxs("div",{className:"flex items-center gap-2 bg-primary p-2 rounded border border-accent",children:[e.jsx("input",{type:"checkbox",id:`editIsPublished-${k.id}`,checked:N.isPublished,onChange:D=>j({...N,isPublished:D.target.checked}),className:"w-4 h-4 accent-accent"}),e.jsx("label",{htmlFor:`editIsPublished-${k.id}`,className:"text-xs text-text-primary font-bold",children:"Results Published"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[10px] text-text-secondary uppercase font-bold",children:"Start"}),e.jsx("input",{type:"date",value:N.attendanceStartDate,onChange:D=>j({...N,attendanceStartDate:D.target.value}),className:"w-full bg-primary p-1 rounded text-xs text-text-primary border border-accent"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[10px] text-text-secondary uppercase font-bold",children:"End"}),e.jsx("input",{type:"date",value:N.attendanceEndDate,onChange:D=>j({...N,attendanceEndDate:D.target.value}),className:"w-full bg-primary p-1 rounded text-xs text-text-primary border border-accent"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>S(null),className:"p-1.5 text-text-secondary hover:bg-primary rounded",children:e.jsx(Bt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:P,className:"p-1.5 text-green-400 hover:bg-primary rounded",children:e.jsx(Nm,{className:"w-5 h-5"})})]})]}):e.jsxs("div",{className:"flex justify-between items-start gap-4",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"text-text-primary font-bold block truncate",children:k.name}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:k.isPublished?e.jsx("span",{className:"text-[10px] bg-green-500/20 text-green-500 px-1.5 py-0.5 rounded font-bold uppercase border border-green-500/30",children:"Published"}):e.jsx("span",{className:"text-[10px] bg-gray-500/20 text-gray-500 px-1.5 py-0.5 rounded font-bold uppercase border border-gray-500/30",children:"Unpublished"})}),(k.attendanceStartDate||k.attendanceEndDate)&&e.jsxs("span",{className:"text-[10px] text-accent font-bold block mt-1",children:["Attendance Range: ",M(k.attendanceStartDate)||"Start"," to ",M(k.attendanceEndDate)||"End"]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:[e.jsx("button",{onClick:()=>$(k),className:"text-yellow-400 hover:bg-primary p-1.5 rounded transition-colors",title:"Edit Source",children:e.jsx(wt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(k.id),className:"text-red-400 hover:bg-primary p-1.5 rounded transition-colors",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4"})})]})]})},k.id))]}),e.jsx("div",{className:"flex justify-end border-t border-secondary pt-4",children:e.jsx("button",{onClick:a,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80 font-bold",children:"Close"})})]})})},qy=a=>{if(!a)return"Invalid Date";if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a;const l=new Date(a);if(!isNaN(l.getTime())){const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`}return a},Qy=a=>{if(!a)return"Invalid Time";const l=new Date(a);if(isNaN(l.getTime())){if(/^\d{1,2}:\d{2}$/.test(a)){const[o,c]=a.split(":").map(Number),d=new Date;return d.setHours(o,c),d.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}return a}return l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})},Yy=()=>{const{user:a}=qe(),l=a?.role==="Admin",o=l||a?.role==="Teacher",[c,d]=x.useState([]),[p,m]=x.useState(!0),[f,h]=x.useState(!1),[v,y]=x.useState(!1),[b,w]=x.useState(!1),[E,S]=x.useState(!1),[N,j]=x.useState(!1),[M,I]=x.useState(!1),[V,$]=x.useState(null),P=async()=>{try{m(!0);const B=await Qs();d(B)}catch(B){console.error("Failed to fetch exam data",B)}finally{m(!1)}};x.useEffect(()=>{P()},[]),x.useEffect(()=>{const B=()=>P();return window.addEventListener("app:refresh",B),()=>window.removeEventListener("app:refresh",B)},[]);const q=()=>{P(),j(!1),$(null)},k=async B=>{if(window.confirm(`Are you sure you want to delete the exam "${B.title}" for ${B.subject}? This will also delete all marks entered for this exam.`))try{m(!0),await Lg(B.id),P()}catch(G){console.error("Failed to delete exam",G),alert("Error deleting exam. Please try again.")}finally{m(!1)}},D=()=>{h(!1),P()},_=x.useMemo(()=>{const B={};return c.forEach(G=>{B[G.class]||(B[G.class]=[]),B[G.class].push(G)}),Object.keys(B).forEach(G=>{B[G].sort((T,ne)=>new Date(T.date+"T00:00:00").getTime()-new Date(ne.date+"T00:00:00").getTime())}),B},[c]),O=B=>B.toLowerCase().replace(/\s+/g," ").trim(),K=["Play","Kg","Nursery","Class One","Class Two","Class Three","Class Four","Class Five","Class Six","Class Seven","Class Eight","Class Nine","Class Ten"].reduce((B,G,T)=>(B[O(G)]=T,B),{}),Q=x.useMemo(()=>Object.keys(_).sort((B,G)=>(K[O(B)]??999)-(K[O(G)]??999)),[_]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Examination & Results"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg flex flex-col h-full max-h-[80vh]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 flex-shrink-0",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Exam Schedule"}),l&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>I(!0),className:"bg-secondary text-text-primary px-3 py-1 rounded-md text-sm font-semibold hover:bg-secondary/80",children:"Manage Exam Names"}),e.jsx("button",{onClick:()=>{$(null),j(!0)},className:"bg-accent text-white px-3 py-1 rounded-md text-sm font-semibold hover:bg-accent/90",children:"Add Exam"})]})]}),e.jsx("div",{className:"overflow-y-auto flex-grow pr-2 space-y-6",children:p?e.jsx("p",{className:"text-center py-4 text-text-secondary",children:"Loading schedule..."}):c.length===0?e.jsx("p",{className:"text-center py-4 text-text-secondary",children:"No exams scheduled."}):Q.map(B=>e.jsxs("div",{className:"border border-secondary rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-secondary/50 p-3 border-b border-secondary flex items-center justify-between",children:[e.jsxs("h4",{className:"font-bold text-accent",children:["Class: ",B]}),e.jsxs("span",{className:"text-xs text-text-secondary bg-primary px-2 py-1 rounded-full",children:[_[B].length," Exams"]})]}),e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Exam Name"}),e.jsx("th",{className:"px-4 py-2",children:"Subject"}),e.jsx("th",{className:"px-4 py-2",children:"Date/Time"}),l&&e.jsx("th",{className:"px-4 py-2 text-right",children:"Actions"})]})}),e.jsx("tbody",{children:_[B].map(G=>e.jsxs("tr",{className:"border-b border-secondary/50 hover:bg-secondary/30 last:border-0",children:[e.jsx("td",{className:"px-4 py-2 font-medium text-text-primary",children:G.title}),e.jsx("td",{className:"px-4 py-2",children:G.subject}),e.jsx("td",{className:"px-4 py-2",children:e.jsxs("div",{className:"flex flex-col text-xs",children:[e.jsx("span",{children:qy(G.date)}),e.jsx("span",{className:"text-text-secondary",children:Qy(G.time)})]})}),l&&e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{$(G),j(!0)},className:"p-1 hover:bg-secondary rounded text-yellow-400",title:"Edit",children:e.jsx(wt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>k(G),className:"p-1 hover:bg-secondary rounded text-red-500",title:"Delete",children:e.jsx(Re,{className:"w-3 h-3"})})]})})]},G.id))})]})]},B))})]}),e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg h-fit",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary mb-4",children:"Manage Results"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-secondary/20 p-4 rounded-lg border border-secondary",children:[e.jsx("h4",{className:"font-bold text-text-primary mb-2",children:"1. Input Marks"}),e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"Enter marks for CT, MCQ, Creative Questions, and Viva for specific exams."}),o?e.jsxs("button",{onClick:()=>h(!0),className:"w-full bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90 transition-colors flex justify-between items-center group",children:[e.jsx("span",{children:"Input Results"}),e.jsx(ai,{className:"w-4 h-4 group-hover:translate-x-1 transition-transform"})]}):e.jsx("p",{className:"text-red-400 text-xs",children:"Access Restricted"})]}),e.jsxs("div",{className:"bg-secondary/20 p-4 rounded-lg border border-secondary",children:[e.jsx("h4",{className:"font-bold text-text-primary mb-2",children:"2. Final Reports"}),e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"Calculate totals, GPAs, and generate printable report cards or tabulation sheets."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>y(!0),className:"flex-1 bg-secondary text-text-primary px-4 py-2 rounded-lg font-semibold hover:bg-secondary/80 transition-colors flex justify-between items-center group",children:[e.jsx("span",{children:"Individual Report Cards"}),e.jsx(jt,{className:"w-4 h-4 group-hover:text-accent transition-colors"})]}),e.jsxs("button",{onClick:()=>w(!0),className:"flex-1 bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90 transition-colors flex justify-between items-center group",children:[e.jsx("span",{children:"Class Result Sheet"}),e.jsx(ui,{className:"w-4 h-4"})]})]})]}),e.jsxs("div",{className:"bg-secondary/20 p-4 rounded-lg border border-secondary",children:[e.jsx("h4",{className:"font-bold text-text-primary mb-2",children:"3. Logistics"}),e.jsx("p",{className:"text-sm text-text-secondary mb-3",children:"Generate admit cards for eligible students (fees cleared)."}),e.jsxs("button",{onClick:()=>S(!0),className:"w-full bg-yellow-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-yellow-700 transition-colors flex justify-between items-center group",children:[e.jsx("span",{children:"Generate Admit Cards"}),e.jsx(gm,{className:"w-4 h-4"})]})]})]})]})]}),f&&e.jsx(Ky,{allExams:c,onClose:D,isAdmin:l}),v&&e.jsx(Jy,{allExams:c,onClose:()=>y(!1)}),b&&e.jsx(Xy,{allExams:c,onClose:()=>w(!1)}),E&&e.jsx(Gy,{isOpen:E,onClose:()=>S(!1),allExams:c}),N&&e.jsx(Hy,{onClose:()=>{j(!1),$(null)},onSave:q,initialData:V}),M&&e.jsx(Ym,{onClose:()=>I(!1)})]})},Ky=({allExams:a,onClose:l,isAdmin:o})=>{const[c,d]=x.useState(""),[p,m]=x.useState([]),[f,h]=x.useState(!1),[v,y]=x.useState(""),[b,w]=x.useState(""),[E,S]=x.useState({totalMarksCT:10,totalMarksMCQ:30,totalMarksCQ:50,totalMarksViva:10}),N=x.useMemo(()=>a.find(k=>k.id===c),[a,c]),j=x.useMemo(()=>[...new Set(a.map(k=>k.class))].sort(),[a]),M=x.useMemo(()=>v?[...new Set(a.filter(k=>k.class===v).map(k=>k.title))].sort():[],[a,v]),I=x.useMemo(()=>!v||!b?[]:a.filter(k=>k.class===v&&k.title===b),[a,v,b]);x.useEffect(()=>{N?(h(!0),S({totalMarksCT:N.totalMarksCT!==void 0?Number(N.totalMarksCT):10,totalMarksMCQ:N.totalMarksMCQ!==void 0?Number(N.totalMarksMCQ):30,totalMarksCQ:N.totalMarksCQ!==void 0?Number(N.totalMarksCQ):50,totalMarksViva:N.totalMarksViva!==void 0?Number(N.totalMarksViva):10}),wi(N.id,N.class).then(k=>{m(k),h(!1)})):m([])},[N]);const V=(k,D,_)=>{const O=_===""?0:parseFloat(_);m(K=>K.map(Q=>{if(Q.studentId===k){const B={...Q,[D]:O||void 0},G=(B.ct||0)+(B.mcq||0)+(B.cq||0)+(B.viva||0),T=B.ct!==void 0||B.mcq!==void 0||B.cq!==void 0||B.viva!==void 0;return{...B,marks:T?G:null}}return Q}))},$=k=>{const{name:D,value:_}=k.target;S(O=>({...O,[D]:parseFloat(_)||0}))},P=async()=>{N&&(await _m({...N,...E}),await Fg(N.id,p),alert("Exam configuration and results saved successfully!"),l())},q=E.totalMarksCT+E.totalMarksMCQ+E.totalMarksCQ+E.totalMarksViva;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-5xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Input Exam Results"}),e.jsx("button",{onClick:l,className:"text-text-secondary hover:text-red-400",children:"Close"})]}),e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-secondary/10 p-4 rounded-lg border border-secondary",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-text-secondary mb-1 uppercase",children:"1. Select Class"}),e.jsxs("select",{value:v,onChange:k=>{y(k.target.value),w(""),d("")},className:"w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:[e.jsx("option",{value:"",children:"-- Class --"}),j.map(k=>e.jsx("option",{value:k,children:k},k))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-text-secondary mb-1 uppercase",children:"2. Select Exam Name"}),e.jsxs("select",{value:b,onChange:k=>{w(k.target.value),d("")},className:"w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",disabled:!v,children:[e.jsx("option",{value:"",children:"-- Exam Name --"}),M.map(k=>e.jsx("option",{value:k,children:k},k))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-text-secondary mb-1 uppercase",children:"3. Select Subject"}),e.jsxs("select",{value:c,onChange:k=>d(k.target.value),className:"w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",disabled:!b,children:[e.jsx("option",{value:"",children:"-- Subject --"}),I.map(k=>e.jsx("option",{value:k.id,children:k.subject},k.id))]})]})]}),N&&e.jsxs("div",{className:"bg-secondary/30 p-3 rounded-md border border-secondary",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sm font-bold text-text-primary",children:[e.jsx(wm,{className:"w-4 h-4 text-accent"})," Configure Exam Full Marks"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary block",children:"CT Max"}),e.jsx("input",{type:"number",name:"totalMarksCT",value:E.totalMarksCT,onChange:$,className:"w-16 p-1 rounded text-sm bg-background border border-secondary text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary block",children:"MCQ Max"}),e.jsx("input",{type:"number",name:"totalMarksMCQ",value:E.totalMarksMCQ,onChange:$,className:"w-16 p-1 rounded text-sm bg-background border border-secondary text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary block",children:"CQ Max"}),e.jsx("input",{type:"number",name:"totalMarksCQ",value:E.totalMarksCQ,onChange:$,className:"w-16 p-1 rounded text-sm bg-background border border-secondary text-center"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary block",children:"Viva Max"}),e.jsx("input",{type:"number",name:"totalMarksViva",value:E.totalMarksViva,onChange:$,className:"w-16 p-1 rounded text-sm bg-background border border-secondary text-center"})]}),e.jsxs("div",{className:"ml-auto flex flex-col items-end justify-center",children:[e.jsx("span",{className:"text-xs text-text-secondary",children:"Total"}),e.jsx("span",{className:"font-bold text-accent",children:q})]})]})]})]}),e.jsx("div",{className:"flex-grow overflow-auto border border-secondary rounded-lg",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary relative",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Student Name"}),e.jsxs("th",{className:"px-4 py-3 text-center w-24",children:["CT (",E.totalMarksCT,")"]}),e.jsxs("th",{className:"px-4 py-3 text-center w-24",children:["MCQ (",E.totalMarksMCQ,")"]}),e.jsxs("th",{className:"px-4 py-3 text-center w-24",children:["CQ (",E.totalMarksCQ,")"]}),e.jsxs("th",{className:"px-4 py-3 text-center w-24",children:["Viva (",E.totalMarksViva,")"]}),e.jsx("th",{className:"px-4 py-3 text-center w-24 font-bold text-accent",children:"Total"}),o&&e.jsx("th",{className:"px-4 py-3 text-center w-16 text-red-500",children:"Delete"})]})}),e.jsx("tbody",{children:f?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8",children:"Loading students..."})}):p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8",children:N?"No students found in this class.":"Please select Class, Exam Name, and Subject."})}):p.map(k=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/30",children:[e.jsxs("td",{className:"px-4 py-2 font-medium text-text-primary",children:[k.studentName," ",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-text-secondary",children:k.studentId})]}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"number",min:"0",placeholder:"-",value:k.ct??"",onChange:D=>V(k.studentId,"ct",D.target.value),className:"w-16 bg-background p-2 rounded-md text-text-primary text-center focus:ring-1 focus:ring-accent"})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"number",min:"0",placeholder:"-",value:k.mcq??"",onChange:D=>V(k.studentId,"mcq",D.target.value),className:"w-16 bg-background p-2 rounded-md text-text-primary text-center focus:ring-1 focus:ring-accent"})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"number",min:"0",placeholder:"-",value:k.mcq??"",onChange:D=>V(k.studentId,"cq",D.target.value),className:"w-16 bg-background p-2 rounded-md text-text-primary text-center focus:ring-1 focus:ring-accent"})}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("input",{type:"number",min:"0",placeholder:"-",value:k.viva??"",onChange:D=>V(k.studentId,"viva",D.target.value),className:"w-16 bg-background p-2 rounded-md text-text-primary text-center focus:ring-1 focus:ring-accent"})}),e.jsx("td",{className:"px-4 py-2 text-center font-bold text-lg text-accent",children:k.marks??"-"}),o&&e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx("button",{onClick:()=>{window.confirm(`Clear all marks for ${k.studentName}?`)&&m(D=>D.map(_=>_.studentId===k.studentId?{..._,ct:void 0,mcq:void 0,cq:void 0,viva:void 0,marks:null}:_))},className:"p-1 hover:bg-red-500/10 rounded text-red-500",title:"Clear Marks",children:e.jsx(Re,{className:"w-4 h-4"})})})]},k.studentId))})]})}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{onClick:P,disabled:!N,className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold disabled:bg-gray-500",children:"Save Configuration & Results"})]})]})})},Jy=({allExams:a,onClose:l})=>{const[o,c]=x.useState(""),[d,p]=x.useState(!1),[m,f]=x.useState([]),[h,v]=x.useState([]),[y,b]=x.useState(new Map);x.useEffect(()=>{(async()=>{const[S,N]=await Promise.all([ut(),dt()]);f(S),v(N)})()},[]),x.useEffect(()=>{(async()=>{if(o){p(!0);const[S,N,j]=await Promise.all([Ks(),tt(),In()]),M=N.filter(O=>O.class===o),I=a.filter(O=>O.class===o),V=new Set(I.map(O=>O.title)),$=new Map,P={},q={},k={};a.forEach(O=>{if(V.has(O.title)){const K=(O.totalMarksCT||0)+(O.totalMarksMCQ||0)+(O.totalMarksCQ||0)+(O.totalMarksViva||0)||100;k[O.class]=(k[O.class]||0)+K}});for(const O of M){let K,Q;if(I.length>0){const G=S.find(T=>T.name===I[0].title);K=G?.attendanceStartDate,Q=G?.attendanceEndDate}const B=await Xr(O.id,void 0,K?K+"T00:00:00":void 0,Q?Q+"T23:59:59":void 0);$.set(O.id,{student:O,results:[],attendance:B}),P[O.id]=0}N.forEach(O=>q[O.id]=0),j.forEach(O=>{const K=a.find(Q=>Q.id===O.examId);if(K&&V.has(K.title)){const Q=parseFloat(String(O.marks));isNaN(Q)||(q[O.studentId]!==void 0&&(q[O.studentId]+=Q),P[O.studentId]!==void 0&&(P[O.studentId]+=Q))}});const D=Object.entries(P).map(([O,K])=>{const Q=M.find(G=>G.id===O),B=Q?k[Q.class]:1;return{id:O,obtained:K,percent:K/B*100}}).sort((O,K)=>K.percent-O.percent),_=Object.entries(q).map(([O,K])=>{const Q=N.find(G=>G.id===O),B=Q?k[Q.class]:1;return{id:O,percent:K/B*100}}).sort((O,K)=>K.percent-O.percent);for(const O of I){const K=await wi(O.id,o),Q={ct:Number(O.totalMarksCT||0),mcq:Number(O.totalMarksMCQ||0),cq:Number(O.totalMarksCQ||0),viva:Number(O.totalMarksViva||0)},B=Q.ct+Q.mcq+Q.cq+Q.viva||100;let G=0;K.forEach(T=>{const ne=T.marks||0;ne>G&&(G=ne)});for(const T of K)$.has(T.studentId)&&$.get(T.studentId)?.results.push({subject:O.subject,examTitle:O.title,marks:T.marks,ct:T.ct,mcq:T.mcq,cq:T.cq,viva:T.viva,totalMarks:B,fullMarks:Q,highestMark:G})}D.forEach((O,K)=>{const Q=O.id;if($.has(Q)){$.get(Q).rank=K+1,$.get(Q).totalObtained=O.obtained;const B=_.findIndex(T=>T.id===Q)+1;$.get(Q).institutionalRank=B;const G=$.get(Q).student;if(G.group&&G.group!=="-"&&G.group.toLowerCase()!=="n/a"){const le=M.filter(R=>R.group===G.group).map(R=>{const X=P[R.id]||0,Y=k[R.class]||1;return{id:R.id,percent:X/Y*100}}).sort((R,X)=>X.percent-R.percent).findIndex(R=>R.id===Q)+1;$.get(Q).groupRank=le}}}),b($),p(!1)}else b(new Map)})()},[o,a]);const w=E=>{const S=y.get(E);if(!S)return;const N=mt(),j=window.open("","_blank"),M=Dm(S.results.map(T=>({marks:T.marks,totalMarks:T.totalMarks}))),I=S.totalObtained,V=S.results.reduce((T,ne)=>T+ne.totalMarks,0),$=V>0?I/V*100:0,P=m.find(T=>T.name===o),q=h.find(T=>T.id===P?.classTeacherId),k=S.student.rollNo||S.student.id.replace(/\D/g,""),D=k?parseInt(k,10).toString():"N/A",_={studentName:S.student.name,className:S.student.class,section:S.student.section,group:S.student.group||"N/A",studentId:S.student.id,rollNo:D,examTitle:S.results.length>0?S.results[0].examTitle:"EXAMINATION",classTeacher:P?P.classTeacherName:"_____________",teacherPhone:q?q.phone:"",totalMarksObtained:I,percentage:$,rank:S.rank,institutionalRank:S.institutionalRank,groupRank:S.groupRank},O=S.attendance||{total:0,present:0,absent:0},K=V;let Q=S.results.map(T=>{const ne=wa(T.marks,T.totalMarks),le=T.ct??"-",R=T.cq??"-",X=T.viva??"-",Y=T.fullMarks||{ct:0,cq:0,viva:0},L=Y.ct>0?Y.ct:"-",H=Y.cq>0?Y.cq:"-",re=Y.viva>0?Y.viva:"-";return`
            <tr>
                <td style="text-align: left; padding-left: 5px;">${T.subject}</td>
                <td>${L}</td><td>${H}</td><td>${re}</td>
                <td>${le!=="-"?Number(le).toFixed(1):"--"}</td>
                <td>${R!=="-"?Number(R).toFixed(1):"--"}</td>
                <td>${X!=="-"?Number(X).toFixed(1):"--"}</td>
                <td style="font-weight: bold;">${T.marks?Number(T.marks).toFixed(1):"-"}</td>
                <td style="font-weight: bold;">${ne.grade}</td>
                <td>${ne.point.toFixed(1)}</td>
                <td>${T.highestMark?Number(T.highestMark).toFixed(1):"-"}</td>
            </tr>
        `}).join("");const B=Array(Math.max(0,15-S.results.length)).fill(0).map(()=>`
            <tr><td style="height: 24px;"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        `).join(""),G=`
            <html>
            <head>
                <title>Progress Report - ${_.studentName}</title>
                <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&family=Tiro+Bangla&display=swap" rel="stylesheet">
                <style>
                    @media print {
                        @page { size: A4; margin: 0; }
                        body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
                        .no-print { display: none; }
                    }
                    body {
                        font-family: 'Times New Roman', serif;
                        background-color: transparent;
                        margin: 0;
                        padding: 0;
                        height: 100vh;
                        box-sizing: border-box;
                    }
                    .report-container {
                        width: 210mm;
                        height: 297mm;
                        margin: 0 auto;
                        padding: 10mm;
                        box-sizing: border-box;
                        background-color: transparent;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .watermark {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 600px;
                        height: 600px;
                        background-image: url('${N.logo}');
                        background-repeat: no-repeat;
                        background-position: center;
                        background-size: contain;
                        opacity: 0.20;
                        z-index: 0;
                        pointer-events: none;
                    }
                    
                    .border-box {
                        border: 1px solid #666;
                        padding: 5px;
                        height: 98%;
                        position: relative;
                        z-index: 1;
                        background: transparent;
                    }
                    .inner-border {
                        border: 1px solid #444;
                        height: 100%;
                        padding: 15px;
                        box-sizing: border-box;
                        background: transparent;
                    }

                    .header { text-align: center; position: relative; margin-bottom: 10px; background: transparent; }
                    .bismillah-img { width: 100px; margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto; transform: scaleX(1.8); }
                    .inst-name { font-size: 20px; font-weight: bold; text-transform: uppercase; color: #2c3e50; margin: 5px 0; letter-spacing: 1px; }
                    .inst-address { font-size: 12px; margin-bottom: 5px; }
                    .inst-contact { font-size: 12px; }
                    .logo { position: absolute; left: 10px; top: 10px; width: 70px; height: 70px; }
                    
                    .report-title { 
                        text-align: center; margin-top: 5px; margin-bottom: 5px; 
                        font-size: 16px; font-weight: bold; text-decoration: underline; 
                    }
                    .exam-name { text-align: center; font-size: 14px; text-transform: uppercase; margin-bottom: 10px; }

                    .student-info { 
                        display: flex; justify-content: space-between; 
                        border: 1px solid #999; background-color: transparent;
                        padding: 10px 20px; margin-bottom: 10px; font-size: 14px; line-height: 1.6;
                    }
                    .info-col { width: 48%; }
                    .info-row { display: flex; }
                    .label { width: 100px; font-weight: bold; }
                    .val { font-weight: 500; }

                    .marks-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 15px; background-color: transparent; }
                    .marks-table th, .marks-table td { border: 1px solid #666; padding: 4px; text-align: center; background-color: transparent !important; }
                    .marks-table th { font-weight: bold; }
                    
                    .bottom-grid { display: flex; gap: 10px; margin-top: 10px; background: transparent; }
                    .col-summary { width: 30%; }
                    .col-attendance { width: 40%; }
                    .col-grading { width: 30%; }

                    .sub-table { width: 100%; border-collapse: collapse; font-size: 11px; margin-bottom: 10px; background-color: transparent; }
                    .sub-table td { border: 1px solid #666; padding: 3px 5px; background-color: transparent !important; }
                    .sub-table .lbl { font-weight: bold; }
                    
                    .grading-table { width: 100%; border-collapse: collapse; font-size: 10px; text-align: center; background-color: transparent; }
                    .grading-table th, .grading-table td { border: 1px solid #666; padding: 2px; background-color: transparent !important; }
                    .grading-table th { font-weight: bold; }

                    .remarks-box { 
                        border: 1px solid #666; height: 50px; margin-top: 5px; padding: 5px; 
                        background-color: transparent; position: relative; font-size: 12px;
                    }

                    .footer { display: flex; justify-content: space-between; margin-top: 30px; padding: 0 20px; }
                    .sig-box { text-align: center; width: 150px; }
                    .sig-line { border-top: 1px solid #000; margin-top: 8px; font-size: 12px; font-weight: bold; padding-top: 5px;}
                    .sig-box .outstanding { font-family: 'Tiro Bangla', serif; font-size: 14px; position: relative; top: 10px; }

                    .watermark-text { position: absolute; bottom: 5px; right: 10px; font-size: 10px; font-style: italic; color: #555; }
                    .print-date { position: absolute; bottom: 5px; left: 10px; font-size: 10px; font-style: italic; color: #555; }

                </style>
            </head>
            <body>
                <div class="report-container">
                    <div class="watermark"></div>
                    <div class="border-box">
                        <div class="inner-border">
                            
                            <!-- Header -->
                            <div class="header">
                                <img src="${N.logo}" class="logo" />
                                <img src="https://iili.io/fEBrvMQ.png" class="bismillah-img" alt="Bismillah" />
                                <div class="inst-name">${N.name}</div>
                                <div class="inst-address">${N.address}</div>
                                <div class="inst-contact">Phone: ${N.phone}, Email: ${N.email}</div>
                                <div class="report-title">Progress Report</div>
                                <div class="exam-name">${_.examTitle}</div>
                            </div>

                            <!-- Info -->
                            <div class="student-info">
                                <div class="info-col">
                                    <div class="info-row"><span class="label">Name :</span> <span class="val">${_.studentName}</span></div>
                                    <div class="info-row"><span class="label">Class :</span> <span class="val">${_.className}</span></div>
                                    <div class="info-row"><span class="label">Section :</span> <span class="val">${_.section}</span></div>
                                    <div class="info-row"><span class="label">Group :</span> <span class="val">${_.group}</span></div>
                                </div>
                                <div class="info-col">
                                    <div class="info-row"><span class="label">ID Number :</span> <span class="val">${_.studentId}</span></div>
                                    <div class="info-row"><span class="label">Roll No :</span> <span class="val">${_.rollNo||"-"}</span></div>
                                    <div class="info-row"><span class="label">Class Teacher :</span> <span class="val">${_.classTeacher}</span></div>
                                    <div class="info-row"><span class="label">Teacher Cell :</span> <span class="val">${_.teacherPhone}</span></div>
                                </div>
                            </div>

                            <!-- Table -->
                            <table class="marks-table">
                                <thead>
                                    <tr>
                                        <th rowspan="2" style="width: 25%;">Subject</th>
                                        <th colspan="3">Exam Marks</th>
                                        <th colspan="3">Obtained / Calculated Marks</th>
                                        <th rowspan="2" style="width: 7%;">Total</th>
                                        <th rowspan="2" style="width: 6%;">Grade</th>
                                        <th rowspan="2" style="width: 6%;">Grade Point</th>
                                        <th rowspan="2" style="width: 7%;">Highest Marks</th>
                                    </tr>
                                    <tr>
                                        <th style="width: 6%;">CT</th> <th style="width: 6%;">CQ</th> <th style="width: 6%;">Viva</th>
                                        <th style="width: 6%;">CT</th> <th style="width: 6%;">CQ</th> <th style="width: 6%;">Viva</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${Q}
                                    ${B}
                                </tbody>
                            </table>

                            <!-- Bottom Grid -->
                            <div class="bottom-grid">
                                <!-- Col 1: Summary -->
                                <div class="col-summary">
                                    <table class="sub-table">
                                        <tr><td class="lbl">Exam Full Marks</td><td style="text-align:right;">${K}</td></tr>
                                        <tr><td class="lbl">Total Obtained Marks</td><td style="text-align:right;">${_.totalMarksObtained.toFixed(2)}</td></tr>
                                        <tr><td class="lbl">Obtained Percentage</td><td style="text-align:right;">${_.percentage.toFixed(2)}%</td></tr>
                                    </table>
                                    <table class="sub-table">
                                        <tr><td class="lbl">Obtained GPA</td><td style="text-align:right; font-weight:bold;">${M.gpa}</td></tr>
                                        <tr><td class="lbl">Class Merit</td><td style="text-align:right;">${_.rank||"-"}</td></tr>
                                        <tr><td class="lbl">Institutional Merit</td><td style="text-align:right;">${_.institutionalRank||"-"}</td></tr>
                                        <tr><td class="lbl">Group Merit</td><td style="text-align:right;">${_.groupRank||"N/A"}</td></tr>
                                    </table>
                                </div>

                                <!-- Col 2: Attendance & Remarks -->
                                <div class="col-attendance">
                                    <table class="sub-table">
                                        <tr><td class="lbl">Working Days</td><td style="text-align:center;">${O.total}</td></tr>
                                        <tr><td class="lbl">Present</td><td style="text-align:center;">${O.present}</td></tr>
                                        <tr><td class="lbl">Absent</td><td style="text-align:center;">${O.absent}</td></tr>
                                    </table>
                                    
                                    <div style="font-size: 11px; font-weight: bold; margin-bottom: 2px;">Promotion Note / Remarks</div>
                                    <div class="remarks-box">
                                        ${M.grade==="F"?"FAILED.":"PASSED."}
                                    </div>
                                </div>

                                <!-- Col 3: Grading Scale -->
                                <div class="col-grading">
                                    <table class="grading-table">
                                        <tr style="background-color: transparent !important;"><th colspan="3">Grade Distribution</th></tr>
                                        <tr><th>Marks</th><th>Grade</th><th>GP</th></tr>
                                        <tr><td>80% and Above</td><td>A+</td><td>5.00</td></tr>
                                        <tr><td>70% - 79%</td><td>A</td><td>4.00</td></tr>
                                        <tr><td>60% - 69%</td><td>A-</td><td>3.50</td></tr>
                                        <tr><td>50% - 59%</td><td>B</td><td>3.00</td></tr>
                                        <tr><td>40% - 49%</td><td>C</td><td>2.00</td></tr>
                                        <tr><td>33% - 39%</td><td>D</td><td>1.00</td></tr>
                                        <tr><td>Below 33%</td><td>F</td><td>0.00</td></tr>
                                    </table>
                                </div>
                            </div>

                            <!-- Footer Signatures -->
                            <div class="footer">
                                <div class="sig-box">
                                    <div style="height: 15px;"></div>
                                    <div class="sig-line">Class Teacher</div>
                                </div>
                                <div class="sig-box">
                                    <div style="height: 15px;"></div> 
                                    <div class="sig-line">Director</div>
                                </div>
                                <div class="sig-box">
                                    <div style="height: 15px;"></div>
                                    <div class="sig-line">Guardian</div>
                                </div>
                            </div>

                            <div class="remarks-box" style="margin-top: 10px; height: 30px; display:flex; align-items:center; background: transparent;">
                                <span style="font-weight:bold; margin-right: 10px;">Remarks:</span>
                            </div>

                            <div class="print-date">Printed on ${new Date().toLocaleDateString("en-GB")}</div>
                            <div class="watermark-text">Powered by IICM</div>

                        </div>
                    </div>
                </div>
                <script>
                    window.onload = function() {
                        setTimeout(() => {
                            window.print();
                        }, 500);
                    }
                <\/script>
            </body>
            </html>
        `;j?.document.write(G),j?.document.close()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:"Generate Report Cards"}),e.jsxs("select",{onChange:E=>c(E.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent mb-4",children:[e.jsx("option",{value:"",children:"Select Class"}),[...new Set(a.map(E=>E.class))].map(E=>e.jsxs("option",{value:E,children:["Class ",E]},E))]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:d?e.jsx("p",{children:"Loading results..."}):Array.from(y.values()).map(({student:E})=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-secondary rounded-md mb-2",children:[e.jsx("span",{className:"text-text-primary",children:E.name}),e.jsxs("button",{onClick:()=>w(E.id),className:"text-accent hover:underline text-sm flex items-center gap-1",children:[e.jsx(jt,{className:"w-4 h-4"})," Print Report"]})]},E.id))}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Close"})})]})})},Xy=({allExams:a,onClose:l})=>{const[o,c]=x.useState(""),[d,p]=x.useState(""),[m,f]=x.useState(!1),h=x.useMemo(()=>Array.from(new Set(a.map(b=>b.title))),[a]),v=x.useMemo(()=>o?Array.from(new Set(a.filter(b=>b.title===o).map(b=>b.class))):[],[a,o]),y=async()=>{if(!(!o||!d)){f(!0);try{const[b,w,E]=await Promise.all([Ks(),tt(),In()]),S=mt(),N=b.find(R=>R.name===o),j=N?.attendanceStartDate,M=N?.attendanceEndDate,I=w.filter(R=>R.class===d),V=a.filter(R=>R.title===o),$=V.filter(R=>R.class===d);if($.length===0){alert("No subjects found for this exam and class."),f(!1);return}const P={};V.forEach(R=>{const X=(R.totalMarksCT||0)+(R.totalMarksMCQ||0)+(R.totalMarksCQ||0)+(R.totalMarksViva||0)||100;P[R.class]=(P[R.class]||0)+X});const q={};w.forEach(R=>q[R.id]=0),E.forEach(R=>{if(V.find(Y=>Y.id===R.examId)){const Y=parseFloat(String(R.marks));isNaN(Y)||q[R.studentId]!==void 0&&(q[R.studentId]+=Y)}});const k=w.map(R=>{const X=q[R.id]||0,Y=P[R.class]||0,L=Y>0?X/Y*100:0;return{id:R.id,percent:L}}).filter(R=>R.percent>0).sort((R,X)=>X.percent-R.percent),D=$.length,_=await Promise.all(I.map(async R=>{let X=0,Y=0,L=0,H=0;$.forEach(ye=>{const Se=E.find(Ut=>Ut.examId===ye.id&&Ut.studentId===R.id),He=Se?parseFloat(String(Se.marks)):0,ie=isNaN(He)?0:He,Me=(ye.totalMarksCT||0)+(ye.totalMarksMCQ||0)+(ye.totalMarksCQ||0)+(ye.totalMarksViva||0)||100,ze=wa(ie,Me);ze.grade==="F"&&H++,X+=ie,Y+=Me,L+=ze.point});const re=Y>0?X/Y*100:0,he=H>0?0:L/D,be=k.findIndex(ye=>ye.id===R.id),we=be!==-1?be+1:"N/A",je=await Xr(R.id,void 0,j?j+"T00:00:00":void 0,M?M+"T23:59:59":void 0);return{id:R.id,roll:R.rollNo||R.id.replace(/\D/g,""),name:R.name,obtained:isNaN(X)?0:X,totalPossible:Y,percent:isNaN(re)?0:re,totalGP:isNaN(L)?0:L,gpa:isNaN(he)?0:he,failCount:H,instMerit:we,attendance:je}}));_.sort((R,X)=>(X.percent||0)-(R.percent||0));const O=I.length>0?I[0].section:"N/A",K=I.length>0&&I[0].group||"N/A",Q=_.length>0?_[0].totalPossible:0,B=16,G=[];for(let R=0;R<_.length;R+=B)G.push(_.slice(R,R+B));const T=window.open("","_blank"),ne=G.map((R,X)=>{const Y=R.map((re,he)=>{const be=X*B+he;return`
                    <tr>
                        <td style="text-align: center;">${re.id}</td>
                        <td style="text-align: center;">${parseInt(re.roll,10)||"-"}</td>
                        <td style="text-align: left; padding-left: 8px;">${re.name}</td>
                        <td style="text-align: center;">${re.obtained.toFixed(1)}</td>
                        <td style="text-align: center;">${re.percent.toFixed(2)}%</td>
                        <td style="text-align: center;">${re.totalGP.toFixed(2)}</td>
                        <td style="text-align: center; font-weight: bold;">${re.gpa.toFixed(2)}</td>
                        <td style="text-align: center; font-weight: bold; color: #1E5631;">${re.obtained>0?be+1:"-"}</td>
                        <td style="text-align: center; font-weight: bold;">${re.instMerit}</td>
                        <td style="text-align: center;">${re.attendance.present} / ${re.attendance.total}</td>
                        <td style="text-align: center; font-size: 10px;">${re.failCount>0?`<span style="color: red; font-weight:bold;">Fail(${re.failCount})</span>`:'<span style="color: #1E5631;">Pass</span>'}</td>
                    </tr>
                `}).join(""),L=B-R.length,H=Array(Math.max(0,L)).fill(0).map(()=>`
                    <tr>
                         <td style="height: 29px;"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                    </tr>
                `).join("");return`
                <div class="page-container" style="${X<G.length-1?"page-break-after: always;":""}">
                    <div class="watermark"></div>
                    <div class="header">
                        <img src="${S.logo}" class="logo" />
                        <img src="https://iili.io/fEBrvMQ.png" class="bismillah-img" alt="Bismillah" />
                        <div class="inst-name">${S.name}</div>
                        <div class="inst-addr">${S.address}</div>
                        <div class="exam-title">${o}</div>
                        <div class="sheet-title">Result Sheet of ${d} (${new Date().getFullYear()})</div>
                    </div>

                    <div class="meta-info">
                        <div>Section: ${O} | Group: ${K} | Page: ${X+1} of ${G.length}</div>
                        <div style="text-align: right;">Total Full Marks: ${Q.toFixed(1)}</div>
                    </div>

                    <table class="marks-table">
                        <thead>
                            <tr>
                                <th style="width: 10%;">ID No.</th>
                                <th style="width: 7%;">Roll</th>
                                <th>Student Name</th>
                                <th style="width: 8%;">Obtained</th>
                                <th style="width: 8%;">Percent</th>
                                <th style="width: 8%;">Total GP</th>
                                <th style="width: 7%;">GPA</th>
                                <th style="width: 7%;">Merit</th>
                                <th style="width: 7%;">Inst. Merit</th>
                                <th style="width: 8%;">Atten.</th>
                                <th style="width: 10%;">Fail Tot. / Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Y}
                            ${H}
                        </tbody>
                    </table>

                    <div class="footer">
                        <div class="sig-box"><div class="sig-line">Class Teacher</div></div>
                        <div class="sig-box"><div class="sig-line">Exam Coordinator</div></div>
                        <div class="sig-box"><div class="sig-line">Chairman & Director</div></div>
                    </div>

                    <div class="brand">IsCool-Bell, powered by Soft Engine Ltd.</div>
                </div>
                `}).join(""),le=`
                <html>
                <head>
                    <title>Result Sheet - ${d}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
                    <style>
                        @media print { 
                            @page { size: A4 portrait; margin: 0; } 
                            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } 
                        }
                        body { font-family: 'Roboto', sans-serif; font-size: 11px; padding: 0; margin: 0; color: #000; background: #fff; }
                        
                        .page-container {
                            width: 210mm;
                            min-height: 297mm; /* Changed from fixed height to min-height */
                            padding: 10mm;
                            margin: 0 auto;
                            box-sizing: border-box;
                            position: relative;
                            overflow: visible; /* Allow content to flow naturally */
                            display: flex;
                            flex-direction: column;
                        }

                        .watermark { 
                            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                            opacity: 0.12; width: 450px; height: 450px; 
                            background-image: url('${S.logo}'); 
                            background-size: contain; background-repeat: no-repeat; z-index: -1; 
                        }

                        .header { text-align: center; position: relative; margin-bottom: 5px; border-bottom: 2px solid #1E5631; padding-bottom: 5px; flex-shrink: 0; }
                        .logo { position: absolute; left: 0; top: 10px; width: 50px; height: 50px; }
                        .bismillah-img { width: 80px; display: block; margin: 0 auto 5px auto; }
                        .inst-name { font-size: 20px; font-weight: bold; text-transform: uppercase; color: #1E5631; margin-bottom: 2px; }
                        .inst-addr { font-size: 10px; margin-bottom: 5px; color: #555; }
                        .exam-title { font-size: 16px; font-weight: bold; text-transform: uppercase; text-decoration: underline; margin-bottom: 2px; color: #1E5631; }
                        .sheet-title { font-size: 12px; font-weight: bold; margin-bottom: 5px; }
                        
                        .meta-info { display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: bold; font-size: 10px; border: 1px solid #333; padding: 5px 8px; background: #fdfbf7; flex-shrink: 0; }
                        
                        .marks-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; flex-grow: 1; }
                        .marks-table th, .marks-table td { border: 1px solid #333; padding: 5px 4px; }
                        .marks-table th { background-color: #f2f2f2; text-transform: uppercase; font-size: 9px; font-weight: bold; color: #1E5631; }
                        
                        /* Footer to stay at bottom of A4 page content area */
                        .footer { margin-top: auto; padding-top: 20px; display: flex; justify-content: space-between; flex-shrink: 0; }
                        .sig-box { text-align: center; width: 180px; }
                        .sig-line { border-top: 1px solid #000; padding-top: 5px; font-weight: bold; font-size: 11px; }
                        .brand { text-align: right; font-size: 9px; font-style: italic; color: #888; margin-top: 5px; flex-shrink: 0; }
                    </style>
                </head>
                <body>
                    ${ne}
                </body>
                </html>
            `;T?.document.write(le),T?.document.close()}catch(b){console.error(b),alert("Failed to generate result sheet.")}finally{f(!1)}}};return m?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center backdrop-blur-sm",children:e.jsxs("div",{className:"bg-primary p-8 rounded-xl shadow-2xl flex flex-col items-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-accent border-t-transparent rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-text-primary font-bold",children:"Processing Merit Lists..."}),e.jsx("p",{className:"text-text-secondary text-sm",children:"Correcting Non-Numeric Data & Ranking"})]})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-primary rounded-lg p-6 sm:p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-text-primary",children:"Result Sheet Generator"}),e.jsx("button",{onClick:l,className:"text-text-secondary hover:text-red-400",children:"Close"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"1. Select Exam"}),e.jsxs("select",{value:o,onChange:b=>{c(b.target.value),p("")},className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,children:[e.jsx("option",{value:"",children:"-- Choose Exam --"}),h.map(b=>e.jsx("option",{value:b,children:b},b))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"2. Select Class"}),e.jsxs("select",{value:d,onChange:b=>p(b.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,disabled:!o,children:[e.jsx("option",{value:"",children:"-- Select Class --"}),v.map(b=>e.jsx("option",{value:b,children:b},b))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-secondary",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsxs("button",{onClick:y,disabled:!o||!d,className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/90 font-semibold disabled:bg-gray-500 flex items-center gap-2",children:[e.jsx(jt,{className:"w-4 h-4"})," Generate & Print Sheet"]})]})]})})},Zy=({isOpen:a,onClose:l,onAddEvent:o})=>{const[c,d]=x.useState(""),[p,m]=x.useState(""),[f,h]=x.useState("Academic"),[v,y]=x.useState("");if(!a)return null;const b=w=>{w.preventDefault(),o({title:c,date:p,type:f,description:v}),l()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:"Add New Event"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",placeholder:"Event Title",value:c,onChange:w=>d(w.target.value),className:"bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"date",value:p,onChange:w=>m(w.target.value),className:"bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsxs("select",{value:f,onChange:w=>h(w.target.value),className:"bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent col-span-2",required:!0,children:[e.jsx("option",{children:"Academic"}),e.jsx("option",{children:"Sports"}),e.jsx("option",{children:"Cultural"}),e.jsx("option",{children:"Holiday"})]}),e.jsx("textarea",{placeholder:"Description",value:v,onChange:w=>y(w.target.value),rows:3,className:"col-span-2 bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:"Add Event"})]})]})]})})},ev=()=>{const[a,l]=x.useState([]),[o,c]=x.useState(!0),[d,p]=x.useState(!1),m=async()=>{try{c(!0);const y=await Zr();l(y)}catch(y){console.error("Failed to fetch events",y)}finally{c(!1)}};x.useEffect(()=>{m()},[]),x.useEffect(()=>{const y=()=>m();return window.addEventListener("app:refresh",y),()=>window.removeEventListener("app:refresh",y)},[]);const f=async y=>{const b=await Rg(y);l(w=>[b,...w])},h=async y=>{if(window.confirm("Are you sure you want to delete this event?"))try{c(!0),await zg(y),l(b=>b.filter(w=>w.id!==y))}catch(b){console.error("Failed to delete event",b)}finally{c(!1)}},v=y=>{switch(y){case"Academic":return"bg-blue-500/20 text-blue-400";case"Sports":return"bg-green-500/20 text-green-400";case"Cultural":return"bg-purple-500/20 text-purple-400";case"Holiday":return"bg-yellow-500/20 text-yellow-400";default:return"bg-gray-500/20 text-gray-400"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Events & Activity"}),e.jsxs("button",{onClick:()=>p(!0),className:"bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90 transition-colors flex items-center gap-2",children:[e.jsx(Cn,{className:"w-5 h-5"}),"Add New Event"]})]}),e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary mb-4",children:"Upcoming Events"}),e.jsx("div",{className:"space-y-4",children:o?e.jsx("p",{children:"Loading events..."}):a.map(y=>e.jsxs("div",{className:"p-4 bg-secondary rounded-md flex items-start gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-accent",children:new Date(y.date).getDate()}),e.jsx("p",{className:"text-sm text-text-secondary",children:new Date(y.date).toLocaleString("default",{month:"short"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-semibold text-text-primary",children:y.title}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${v(y.type)}`,children:y.type})]}),e.jsxs("div",{className:"flex justify-between items-start mt-1",children:[e.jsx("p",{className:"text-text-secondary text-sm",children:y.description}),e.jsx("button",{onClick:()=>h(y.id),className:"p-1 hover:bg-red-500/10 rounded text-red-500/50 hover:text-red-500",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4"})})]})]})]},y.id))})]}),e.jsx(Zy,{isOpen:d,onClose:()=>p(!1),onAddEvent:f})]})},Vu=a=>{if(!a)return"N/A";const l=new Date(a);return isNaN(l.getTime())?a:l.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})},tv=({person:a,type:l,onClose:o})=>{const c=mt(),d=l==="students",[p,m]=x.useState(!1),f=d?a.address:a.temporaryAddress||a.permanentAddress,h=d?a.rollNo||a.id.replace(/\D/g,""):"",v=h?parseInt(h,10).toString():"",y=()=>{const b=`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${a.id}`,w=d?"":Vu(a.joiningDate),E="https://iili.io/fEBrvMQ.png",S=window.open("","_blank"),N=d?"Student":a.designation||a.role,j=`
            <html>
            <head>
                <title>ID Card - ${a.name}</title>
                <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
                <style>
                    body {
                        font-family: 'Roboto', sans-serif;
                        background-color: #fff;
                        padding: 20px;
                        display: flex;
                        justify-content: center;
                        gap: 20px;
                    }
                    @media print {
                        body { -webkit-print-color-adjust: exact; margin: 0; padding: 0; }
                        .no-print { display: none; }
                    }
                    /* ID Card Container - 2.125 x 3.37 inch standard CR80 */
                    .id-card {
                        width: 2.13in;
                        height: 3.37in;
                        border-radius: 8px;
                        position: relative;
                        overflow: hidden;
                        background: #fff;
                        border: 1px solid #ddd;
                        flex-shrink: 0;
                        box-sizing: border-box;
                    }
                    .gold-frame {
                        position: absolute; top: 4px; left: 4px; right: 4px; bottom: 4px;
                        border: 1px solid #D4AF37;
                        border-radius: 6px;
                        z-index: 1; pointer-events: none;
                    }
                    .pattern-bg {
                        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                        background-image: url('${c.logo}');
                        background-size: 80%;
                        background-position: center;
                        background-repeat: no-repeat;
                        opacity: 0.07;
                        z-index: 0;
                    }
                    
                    /* Header Area */
                    .header {
                        background-color: #1E5631;
                        height: 82px; 
                        width: 100%;
                        position: relative;
                        z-index: 2;
                        border-bottom: 2px solid #D4AF37;
                        text-align: center;
                        color: white;
                        padding-top: 2px;
                        box-sizing: border-box;
                    }
                    .bismillah-img {
                        width: 55px;
                        display: block; margin: 0 auto;
                        filter: invert(81%) sepia(23%) saturate(966%) hue-rotate(359deg) brightness(89%) contrast(90%);
                    }
                    .logo-circle {
                        width: 44px; height: 44px;
                        background: white;
                        border-radius: 50%;
                        border: 2px solid #D4AF37;
                        margin: 2px auto;
                        display: flex; align-items: center; justify-content: center;
                        overflow: hidden;
                    }
                    .logo-circle img { width: 38px; height: 38px; }
                    .inst-name { font-family: serif; font-size: 8px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 1px; }

                    /* Photo & Name */
                    .photo-area { margin-top: 6px; text-align: center; position: relative; z-index: 2; }
                    .profile-img { 
                        width: 80px; height: 90px;
                        border: 2px solid #1E5631; 
                        border-radius: 6px; 
                        object-fit: cover;
                        background: #f0f0f0;
                    }
                    .student-name {
                        text-align: center;
                        font-family: serif;
                        color: #1E5631;
                        font-weight: bold;
                        font-size: 12px;
                        margin: 4px 0 2px 0;
                        text-transform: uppercase;
                        z-index: 2; position: relative;
                        padding: 0 4px;
                        display: flex; align-items: center; justify-content: center;
                        min-height: 2.4em;
                        line-height: 1.1;
                    }
                    .designation {
                        background-color: #D4AF37; color: #1E5631;
                        font-size: 9px; font-weight: bold;
                        display: inline-block; padding: 1px 10px;
                        border-radius: 10px; margin-bottom: 6px;
                        z-index: 2; text-transform: uppercase;
                    }

                    /* Details Grid */
                    .content-layout {
                        display: grid;
                        grid-template-columns: 1fr 45px;
                        width: 90%; margin: 0 auto;
                        gap: 2px;
                        z-index: 2; position: relative;
                    }
                    .details-col { display: flex; flex-direction: column; font-size: 9px; gap: 2px; }
                    .d-item { display: flex; align-items: baseline; width: 100%; line-height: 1.30; }
                    .d-label { font-weight: bold; color: #555; width: 42px; font-size: 8px; flex-shrink: 0; }
                    .d-val { color: #000; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 110px; }
                    .d-val.blood { color: #c00; }

                    .qr-col { display: flex; flex-direction: column; justify-content: flex-end; align-items: center; }
                    .qr-in-grid { width: 42px; height: 42px; border: 1px solid #ddd; padding: 1px; background: #fff; }

                    /* Back Side specific */
                    .back-header {
                        background-color: #1E5631;
                        color: #fff;
                        font-size: 10px;
                        padding: 8px 5px;
                        text-align: center;
                        font-weight: bold;
                        text-transform: uppercase;
                        border-bottom: 2px solid #D4AF37;
                    }
                    .back-inst-name { font-size: 10px; font-weight: bold; }
                    .back-inst-addr { font-size: 7px; font-weight: normal; opacity: 0.9; margin-top: 2px; text-transform: none; }
                    
                    .back-content { padding: 10px 15px; font-size: 9px; text-align: center; display: flex; flex-direction: column; height: 75%; justify-content: space-between; }
                    .terms { font-size: 8px; color: #666; text-align: justify; margin-bottom: 5px; line-height: 1.35; }
                    .signature-area { display: flex; justify-content: space-between; align-items: flex-end; margin-top: auto; width: 100%; margin-bottom: 5px; }
                    .sig-line { border-top: 1px solid #000; width: 80px; text-align: center; font-size: 7px; padding-top: 2px; }
                    .barcode { height: 25px; width: 80%; margin: 5px auto 0 auto; background: repeating-linear-gradient(90deg, #000, #000 1px, #fff 1px, #fff 3px); }
                    .barcode-num { font-family: monospace; font-size: 8px; letter-spacing: 2px; }

                </style>
            </head>
            <body>
                <!-- FRONT -->
                <div class="id-card">
                    <div class="gold-frame"></div>
                    <div class="pattern-bg"></div>
                    
                    <div class="header">
                        <img src="${E}" class="bismillah-img" />
                        <div class="logo-circle"><img src="${c.logo}" /></div>
                        <div class="inst-name">${c.name}</div>
                    </div>

                    <div class="photo-area">
                        <img src="${a.photo||at}" class="profile-img" />
                    </div>

                    <div class="student-name"><span>${a.name}</span></div>
                    <div style="text-align:center;"><span class="designation">${N}</span></div>

                    <div class="content-layout">
                        <div class="details-col">
                            ${d?`
                            <div class="d-item"><span class="d-label">ID:</span><span class="d-val">${a.id}</span></div>
                            <div class="d-item"><span class="d-label">Roll:</span><span class="d-val">${v}</span></div>
                            <div class="d-item"><span class="d-label">Class:</span><span class="d-val">${a.class}</span></div>
                            <div class="d-item"><span class="d-label">Sec:</span><span class="d-val">${a.section}</span></div>
                            <div class="d-item"><span class="d-label">Group:</span><span class="d-val">${a.group||"-"}</span></div>
                            <div class="d-item"><span class="d-label">Blood:</span><span class="d-val blood">${a.bloodGroup||"-"}</span></div>
                            `:`
                            <div class="d-item"><span class="d-label">ID:</span><span class="d-val">${a.id}</span></div>
                            <div class="d-item"><span class="d-label">Phone:</span><span class="d-val">${a.phone}</span></div>
                            <div class="d-item"><span class="d-label">Gender:</span><span class="d-val">${a.gender||"-"}</span></div>
                            <div class="d-item"><span class="d-label">Blood:</span><span class="d-val blood">${a.bloodGroup||"-"}</span></div>
                            <div class="d-item"><span class="d-label">Joined:</span><span class="d-val">${w}</span></div>
                            <div class="d-item"><span class="d-label">Valid:</span><span class="d-val">Dec 2025</span></div>
                            `}
                        </div>
                        <div class="qr-col">
                            <img src="${b}" class="qr-in-grid" />
                        </div>
                    </div>
                </div>

                <!-- BACK -->
                <div class="id-card">
                        <div class="gold-frame"></div>
                        <div class="pattern-bg"></div>
                        
                        <div class="back-header">
                        <div class="back-inst-name">${c.name}</div>
                        <div class="back-inst-addr">${c.address}</div>
                        </div>

                        <div class="back-content">
                        <div class="contact-info" style="margin-bottom: 5px; font-weight: bold; color: #1E5631;">
                            ${d?`
                            <div>Guardian: ${a.guardianName}</div>
                            <div>Phone: ${a.guardianPhone}</div>
                            `:`
                            <div>Emergency: ${a.phone}</div>
                            `}
                            <div style="margin-top:5px; font-size:8px; color:#000;">${f||c.address}</div>
                        </div>

                        <div class="terms">
                            1. This card is the property of ${c.name}.<br>
                            2. It is non-transferable and must be worn at all times within campus.<br>
                            3. If found, please return to the address above.<br>
                            4. Loss of this card must be reported immediately to
							<div align="center"><b>Email: info@iqramadrasha.com</b></div>
							<div align="center"><b>Phone: +8801718720379</b></div>
                        </div>

                        <div class="signature-area">
                            <div class="sig-line">Holder's Sign</div>
                            <div class="sig-line">Director's Sign</div>
                        </div>

                        <div>
                            <div class="barcode"></div>
                            <div class="barcode-num">${a.id}</div>
                        </div>
                        </div>
                </div>

                <script>
                    window.onload = function() {
                        setTimeout(() => {
                            window.print();
                        }, 500);
                    }
                <\/script>
            </body>
            </html>
        `;S?.document.write(j),S?.document.close()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-primary rounded-lg p-6 shadow-2xl w-full max-w-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-text-primary",children:"ID Card Preview"}),e.jsx("button",{onClick:o,className:"text-text-secondary hover:text-red-400",children:e.jsx(Bt,{})})]}),e.jsx("div",{className:"relative mx-auto w-[240px] h-[380px] bg-white rounded-lg overflow-hidden border border-secondary shadow-inner mb-4 transition-all duration-500",style:{perspective:"1000px"},children:e.jsxs("div",{className:"w-full h-full relative transition-transform duration-700",style:{transformStyle:"preserve-3d",transform:p?"rotateY(180deg)":"rotateY(0deg)"},children:[e.jsxs("div",{className:"absolute w-full h-full backface-hidden bg-white flex flex-col items-center p-2 border-2 border-accent",style:{backfaceVisibility:"hidden"},children:[e.jsx("div",{className:"w-full h-16 bg-[#1E5631] absolute top-0 border-b-2 border-[#D4AF37] flex flex-col items-center justify-center pt-1",children:e.jsx("img",{src:"https://iili.io/fEBrvMQ.png",className:"w-14 opacity-90 invert brightness-200 sepia saturate-200 hue-rotate-15",alt:"Bismillah"})}),e.jsx("img",{src:c.logo,className:"w-12 h-12 rounded-full bg-white p-1 border-2 border-[#D4AF37] z-10 -mt-4"}),e.jsx("h4",{className:"text-[#1E5631] font-bold text-[10px] mt-0.5 uppercase tracking-wider z-10 text-center px-2 leading-tight",children:c.name}),e.jsx("img",{src:a.photo,className:"w-20 h-24 object-cover border-2 border-[#1E5631] rounded mt-2 z-10 bg-gray-200"}),e.jsx("div",{className:"w-full px-2 mt-1 z-10 h-8 flex items-center justify-center",children:e.jsx("h2",{className:"text-[#1E5631] font-bold text-sm uppercase text-center leading-tight line-clamp-2",children:a.name})}),e.jsx("span",{className:"text-[9px] bg-[#D4AF37] text-[#1E5631] px-2 py-0.5 rounded-full font-bold z-10 mb-2",children:d?"STUDENT":(a.designation||a.role).toUpperCase()}),e.jsxs("div",{className:"w-full px-3 grid grid-cols-[1fr_40px] gap-2 mt-0 z-10 text-[10px] text-gray-700 leading-tight",children:[e.jsx("div",{className:"flex flex-col space-y-1",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"ID:"})," ",e.jsx("span",{className:"font-bold truncate",children:a.id})]}),e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"Roll:"})," ",e.jsx("span",{className:"font-bold truncate",children:v})]}),e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"Class:"})," ",e.jsx("span",{className:"font-bold truncate",children:a.class})]}),e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"Sec:"})," ",e.jsx("span",{className:"font-bold truncate",children:a.section})]}),e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"Group:"})," ",e.jsx("span",{className:"font-bold truncate",children:a.group||"-"})]}),e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"Blood:"})," ",e.jsx("span",{className:"font-bold text-red-600 truncate",children:a.bloodGroup||"-"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"ID:"})," ",e.jsx("span",{className:"font-bold truncate",children:a.id})]}),e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"Phone:"})," ",e.jsx("span",{className:"font-bold truncate",children:a.phone})]}),e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"Gender:"})," ",e.jsx("span",{className:"font-bold truncate",children:a.gender||"-"})]}),e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"Joined:"})," ",e.jsx("span",{className:"font-bold truncate",children:Vu(a.joiningDate)})]}),e.jsxs("div",{className:"flex overflow-hidden",children:[e.jsx("span",{className:"font-bold w-10 text-[9px] flex-shrink-0",children:"Valid:"})," ",e.jsx("span",{className:"font-bold truncate",children:"Dec 2025"})]})]})}),e.jsx("div",{className:"flex flex-col justify-end items-center",children:e.jsx("div",{className:"w-10 h-10 bg-black/10 flex items-center justify-center text-[5px] border border-gray-300 bg-white",children:"QR"})})]})]}),e.jsxs("div",{className:"absolute w-full h-full backface-hidden bg-white flex flex-col p-4 border-2 border-accent",style:{backfaceVisibility:"hidden",transform:"rotateY(180deg)"},children:[e.jsxs("div",{className:"text-center border-b border-[#D4AF37] pb-2 mb-2",children:[e.jsx("h4",{className:"text-[#1E5631] font-bold uppercase text-[10px]",children:c.name}),e.jsx("p",{className:"text-[8px] text-gray-600 leading-tight",children:c.address})]}),e.jsxs("div",{className:"text-[10px] space-y-1 text-gray-700 mb-4 flex-grow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Guardian:"})," ",d?a.guardianName:"Next of Kin"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Phone:"})," ",d?a.guardianPhone:a.phone]}),e.jsx("div",{className:"mt-2 text-[9px] text-center italic border-t border-gray-200 pt-2",children:f})]}),e.jsxs("div",{className:"mt-auto pt-2",children:[e.jsx("div",{className:"h-8 w-full bg-black/10 flex items-center justify-center text-[8px] tracking-[4px]",children:"BARCODE"}),e.jsx("p",{className:"text-[8px] text-center mt-1",children:a.id})]})]})]})}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>m(!p),className:"p-2 rounded-full bg-secondary hover:bg-accent/20 text-text-primary transition-colors",title:"Flip Card",children:e.jsx(hi,{className:`w-5 h-5 ${p?"rotate-180":""} transition-transform`})}),e.jsxs("button",{onClick:y,className:"bg-accent text-white px-6 py-2 rounded-md font-bold hover:bg-accent/90 flex items-center gap-2 shadow-lg",children:[e.jsx(jt,{className:"w-4 h-4"})," Print ID Card"]})]})]})})},sv=()=>{const{user:a}=qe(),l=["Admin","IT Admin"].includes(a?.role||""),[o,c]=x.useState([]),[d,p]=x.useState([]),[m,f]=x.useState([]),[h,v]=x.useState(!0),[y,b]=x.useState("students"),[w,E]=x.useState(""),[S,N]=x.useState(""),[j,M]=x.useState(null);x.useEffect(()=>{(async()=>{v(!0);const[q,k,D]=await Promise.all([tt(),dt(),ut()]);c(q),p(k),f(D),v(!1)})()},[]);const I=x.useMemo(()=>Array.from(new Set(m.map(P=>P.name))).sort(Qr),[m]),V=x.useMemo(()=>{if(y==="staff")return w?d.filter(P=>P.name.toLowerCase().includes(w.toLowerCase())||P.id.toLowerCase().includes(w.toLowerCase())):d;{let P=o;if(S&&(P=P.filter(q=>q.class===S)),w){const q=w.toLowerCase();P=P.filter(k=>k.name.toLowerCase().includes(q)||k.id.toLowerCase().includes(q))}return P}},[o,d,y,w,S]),$=P=>{M(P)};return l?e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Generate ID Cards"}),e.jsxs("div",{className:"bg-primary p-4 rounded-lg shadow-lg",children:[e.jsx("div",{className:"flex border-b border-secondary mb-4",children:["students","staff"].map(P=>e.jsx("button",{onClick:()=>{b(P),E(""),N("")},className:`px-4 py-2 font-medium text-sm -mb-px border-b-2 ${y===P?"border-accent text-accent":"border-transparent text-text-secondary hover:text-text-primary"}`,children:P.charAt(0).toUpperCase()+P.slice(1)},P))}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[y==="students"&&e.jsx("div",{className:"md:w-1/4",children:e.jsxs("select",{value:S,onChange:P=>N(P.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",children:[e.jsx("option",{value:"",children:"All Classes"}),I.map(P=>e.jsx("option",{value:P,children:P},P))]})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:`Search ${y} by name or ID...`,value:w,onChange:P=>E(P.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})})]})]}),e.jsx("div",{className:"bg-primary rounded-lg shadow-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:y==="students"?"Class Details":"Role"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Action"})]})}),e.jsx("tbody",{children:h?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-4",children:"Loading..."})}):V.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-8 text-text-secondary italic",children:"No results found."})}):V.map(P=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-text-primary",children:P.name}),e.jsx("td",{className:"px-6 py-4",children:P.id}),e.jsx("td",{className:"px-6 py-4",children:y==="students"?`${P.class} - ${P.section}`:P.role}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>$(P),className:"font-medium text-accent hover:underline",children:"Generate"})})]},P.id))})]})})}),j&&e.jsx(tv,{person:j,type:y,onClose:()=>M(null)})]}):e.jsx("div",{className:"text-center p-8 text-red-400",children:"Access Denied. Contact Administrator."})},nv=({isOpen:a,onClose:l,onSave:o,initialData:c,teachers:d})=>{const[p,m]=x.useState(c?.name||""),[f,h]=x.useState(c?.section||""),[v,y]=x.useState(c?.classTeacherId||(d.length>0?d[0].id:""));if(!a)return null;const b=w=>{w.preventDefault();const E=d.find(S=>S.id===v);if(!E){alert("Please select a valid teacher.");return}o({name:p,section:f,classTeacherId:v,classTeacherName:E.name})};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[c?"Edit":"Add"," Class"]}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Class Name (e.g., Class 5)",value:p,onChange:w=>m(w.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"text",placeholder:"Section (e.g., A)",value:f,onChange:w=>h(w.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Class Teacher"}),e.jsx("select",{value:v,onChange:w=>y(w.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,children:d.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:"Save"})]})]})]})})},av=a=>{if(!a)return"N/A";if(/^\d{2}:\d{2}(:\d{2})?$/.test(a)){const[o,c]=a.split(":").map(Number),d=new Date;return d.setHours(o,c,0,0),d.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}const l=new Date(a);return isNaN(l.getTime())?a:l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})},rv=({classInfo:a,studentCount:l,isSelected:o,onClick:c,onEdit:d,onDelete:p,isAdmin:m})=>e.jsxs("div",{onClick:c,className:`p-4 rounded-lg mb-2 cursor-pointer transition-colors ${o?"bg-accent text-white":"bg-secondary hover:bg-secondary/80"}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-lg",children:[a.name," - ",a.section]}),e.jsx("p",{className:`text-sm ${o?"text-gray-200":"text-text-secondary"}`,children:a.classTeacherName})]}),m&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:d,className:`p-1 rounded-full ${o?"hover:bg-accent/80":"hover:bg-background"}`,title:"Edit",children:e.jsx(wt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:p,className:`p-1 rounded-full ${o?"hover:bg-accent/80":"hover:bg-background"}`,title:"Delete",children:e.jsx(Re,{className:"w-4 h-4 text-red-400"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm",children:[e.jsx(Ot,{className:"w-4 h-4"}),e.jsxs("span",{children:[l," Students"]})]})]}),lv=({data:a})=>{const{classInfo:l,studentsInClass:o,timetableForClass:c}=a,d=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],p=Object.keys(c).length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold text-accent",children:["Class ",l.name," - Section ",l.section]}),e.jsxs("p",{className:"text-text-secondary",children:["Class Teacher: ",l.classTeacherName]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xl font-semibold text-text-primary flex items-center gap-2",children:[e.jsx(Ot,{className:"w-5 h-5 text-accent"})," Student Roster (",o.length,")"]}),e.jsx("div",{className:"max-h-48 sm:max-h-60 overflow-y-auto bg-secondary p-2 rounded-md",children:o.length>0?e.jsx("ul",{className:"divide-y divide-background",children:o.map(m=>e.jsxs("li",{className:"p-2 flex items-center gap-3",children:[e.jsx("img",{src:m.photo||at,alt:m.name,className:"w-8 h-8 rounded-full object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-primary",children:m.name}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["ID: ",m.id]})]})]},m.id))}):e.jsx("p",{className:"text-center text-text-secondary p-4",children:"No students enrolled in this class."})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-xl font-semibold text-text-primary flex items-center gap-2",children:[e.jsx(mi,{className:"w-5 h-5 text-accent"})," Weekly Timetable"]}),e.jsx("div",{className:"overflow-x-auto pb-2",children:p?e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:space-x-4",children:d.filter(m=>c[m]?.length>0).map(m=>e.jsxs("div",{className:"flex-shrink-0 w-52 bg-secondary p-3 rounded-lg",children:[e.jsx("h5",{className:"font-bold text-accent text-center mb-2",children:m}),e.jsx("div",{className:"space-y-2",children:c[m].map(f=>e.jsxs("div",{className:"bg-background p-2 rounded-md text-xs",children:[e.jsxs("p",{className:"font-semibold text-text-primary",children:[av(f.time)," - ",f.subject]}),e.jsx("p",{className:"text-text-secondary",children:f.teacher})]},f.id))})]},m))}):e.jsx("p",{className:"text-center text-text-secondary p-4",children:"Timetable has not been set for this class."})})]})]})},ov=()=>{const{user:a}=qe(),l=a?.role==="Admin",[o,c]=x.useState([]),[d,p]=x.useState([]),[m,f]=x.useState([]),[h,v]=x.useState([]),[y,b]=x.useState(!0),[w,E]=x.useState(!1),[S,N]=x.useState(null),[j,M]=x.useState(null),I=x.useCallback(async()=>{try{b(!0);const[D,_,O,K]=await Promise.all([ut(),dt(),tt(),Jr()]),Q=[...D].sort((B,G)=>Qr(B.name,G.name));c(Q),p(_.filter(B=>B.role==="Teacher")),f(O),v(K),Q.length>0&&!j&&M(Q[0].id)}catch(D){console.error("Failed to fetch data",D)}finally{b(!1)}},[j]);x.useEffect(()=>{I()},[]),x.useEffect(()=>{const D=()=>I();return window.addEventListener("app:refresh",D),()=>window.removeEventListener("app:refresh",D)},[I]);const V=x.useMemo(()=>{if(!j)return null;const D=o.find(Q=>Q.id===j);if(!D)return null;const _=m.filter(Q=>Q.class===D.name&&Q.section===D.section),K=h.filter(Q=>Q.class===D.name).reduce((Q,B)=>((Q[B.day]=Q[B.day]||[]).push(B),Q[B.day].sort((G,T)=>G.time.localeCompare(T.time)),Q),{});return{classInfo:D,studentsInClass:_,timetableForClass:K}},[j,o,m,h]),$=async D=>{const _=d.find(K=>K.id===D.classTeacherId);if(!_){alert("Selected teacher not found.");return}const O={...D,classTeacherName:_.name};S?await Kf({...O,id:S.id}):await Yf(O),I(),q()},P=(D,_=null)=>{D.stopPropagation(),N(_),E(!0)},q=()=>{N(null),E(!1)},k=async(D,_)=>{if(D.stopPropagation(),window.confirm(`Are you sure you want to delete Class ${_.name}? This might affect student records.`))try{b(!0),await Jf(_.id),I()}catch(O){console.error("Failed to delete class",O)}finally{b(!1)}};return y?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx("p",{className:"text-xl",children:"Loading Class Management..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-3 sm:flex-row sm:justify-between sm:items-center",children:e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Manage Classes"})}),e.jsxs("div",{className:"flex flex-col gap-6 sm:flex-row sm:",children:[e.jsxs("div",{className:"w-full sm:w-1/3 flex flex-col bg-primary rounded-lg shadow-lg max-h-[60vh] sm:max-h-none",children:[e.jsxs("div",{className:"p-4 border-b border-secondary flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary",children:["All Classes (",o.length,")"]}),l&&e.jsx("button",{onClick:D=>P(D),className:"bg-accent text-white px-3 py-1.5 rounded-md font-semibold hover:bg-accent/90 text-sm",children:"Add New"})]}),e.jsx("div",{className:"overflow-y-auto flex-grow p-2",children:o.map(D=>{const _=m.filter(O=>O.class===D.name&&O.section===D.section).length;return e.jsx(rv,{classInfo:D,studentCount:_,isSelected:j===D.id,onClick:()=>M(D.id),onEdit:O=>P(O,D),onDelete:O=>k(O,D),isAdmin:l},D.id)})})]}),e.jsx("div",{className:"w-full sm:w-2/3 bg-primary rounded-lg shadow-lg p-4 sm:p-6 overflow-y-auto",children:V?e.jsx(lv,{data:V}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-text-secondary",children:"Select a class to view its details or add a new one."})})})]}),w&&e.jsx(nv,{isOpen:w,onClose:q,onSave:$,initialData:S,teachers:d})]})},iv=()=>{const a=mt();return e.jsxs("div",{className:"relative min-h-screen bg-background text-text-primary flex items-center justify-center overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 z-0 opacity-10",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCI+PHJlY3Qgd2lkdGg9IjMwIiBoZWlnaHQ9IjMwIiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE1IDBMNy41IDE1TDE1IDMwTDIyLjUgMTVMMTUgMFoiIGZpbGw9IiMzOGIyYWMiLz48L3N2Zz4=')] bg-repeat animate-[spin_60s_linear_infinite]"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-background via-primary to-background"})]}),e.jsxs("div",{className:"relative z-10 text-center p-8 bg-primary/50 backdrop-blur-sm rounded-2xl shadow-2xl max-w-2xl",children:[e.jsx("img",{src:a.logo,alt:"logo",className:"w-24 h-24 mx-auto mb-4 bg-white rounded-full p-2"}),e.jsx("h1",{className:"text-5xl font-bold text-accent mb-2",children:a.name}),e.jsx("p",{className:"text-xl text-text-secondary mb-8",children:a.tagline}),e.jsxs("div",{className:"text-2xl font-light text-text-primary mb-10",children:[e.jsx("p",{children:"   "}),e.jsx("p",{className:"text-lg text-text-secondary",children:"In the name of Allah, the Most Gracious, the Most Merciful"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsx(kn,{to:"/login",onMouseEnter:Wm,className:"w-full sm:w-auto bg-accent text-white font-semibold px-8 py-3 rounded-lg hover:bg-accent/90 transition-transform transform hover:scale-105",children:"Portal Login"}),e.jsx(kn,{to:"/results",onMouseEnter:Um,className:"w-full sm:w-auto bg-secondary text-text-primary font-semibold px-8 py-3 rounded-lg hover:bg-secondary/80 transition-transform transform hover:scale-105",children:"Check Exam Results"})]})]}),e.jsx("footer",{className:"absolute bottom-4 text-center w-full text-text-secondary text-sm",children:e.jsxs("p",{children:[" ",new Date().getFullYear()," ",a.name,". All Rights Reserved | Created by ",e.jsx("a",{href:"https://www.facebook.com/mrnhh99",target:"_blank",children:"Nayem Hossen"})]})})]})},cv=()=>{const{login:a}=qe();Hr();const l=mt(),[o,c]=x.useState("credentials"),[d,p]=x.useState(!1),[m,f]=x.useState(""),[h,v]=x.useState(""),[y,b]=x.useState(""),[w,E]=x.useState(""),[S,N]=x.useState(null),[j,M]=x.useState(0);x.useEffect(()=>{Wm()},[]),x.useEffect(()=>{let k;return j>0&&(k=setInterval(()=>{M(D=>D-1)},1e3)),()=>clearInterval(k)},[j]);const I=k=>{let D=k.message||"Authentication failed.";return D=D.replace("Google Apps Script Error:","").trim(),D.includes("Check recipient")||D.includes("Invalid email")?"Unable to send verification code. Please contact the administrator to ensure your email address is correct.":D.includes("quota")?"System email limit reached for the day. Please try again later or contact support.":D},V=async k=>{k.preventDefault(),f(""),p(!0);try{const D=await Mm(h,y);if(!D)throw new Error("Invalid User ID or Password.");if(!D.email)throw new Error("No email address is linked to this account. Please contact the administrator to add an email before logging in.");N(D),Ug(D),await Au(D.username),c("verification"),M(60)}catch(D){f(I(D))}finally{p(!1)}},$=async k=>{if(k.preventDefault(),!!S){f(""),p(!0);try{if(await Rf(S.username,w))await a(h,y);else throw new Error("Invalid verification code.")}catch(D){f(I(D))}finally{p(!1)}}},P=async()=>{if(!(!S||j>0)){p(!0),f("");try{await Au(S.username),M(60),alert(`Code resent to ${q(S.email||"")}`)}catch(k){f(I(k))}finally{p(!1)}}},q=k=>{const[D,_]=k.split("@");return _?`${D.length>3?D.substring(0,3)+"...":D}@${_}`:k};return e.jsxs("div",{className:"relative min-h-screen bg-background text-text-primary flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 z-0 opacity-5 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMCIgaGVpZ2h0PSIzMCI+PHJlY3Qgd2lkdGg9IjMwIiBoZWlnaHQ9IjMwIiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTE1IDBMNy41IDE1TDE1IDMwTDIyLjUgMTVMMTUgMFoiIGZpbGw9IiMzOGIyYWMiLz48L3N2Zz4=')]"}),e.jsxs("div",{className:"relative z-10 w-full max-w-md bg-primary/90 backdrop-blur-xl p-8 rounded-2xl shadow-2xl transition-all duration-300 border border-secondary/50",children:[e.jsx(kn,{to:"/",className:"absolute top-4 left-4 text-text-secondary hover:text-accent",children:" Home"}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:l.logo,alt:"logo",className:"w-20 h-20 mx-auto mb-4 bg-white rounded-full p-1.5 shadow-md"}),e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:o==="credentials"?"Portal Login":"Security Check"}),e.jsx("p",{className:"text-text-secondary",children:o==="credentials"?"Welcome back. Please login to your account.":`Please enter the verification code sent to ${q(S?.email||"")}`})]}),m&&e.jsx("div",{className:"text-red-400 bg-red-500/10 p-3 rounded-md text-center text-sm mb-6 border border-red-500/20",children:m}),o==="credentials"?e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"User ID"}),e.jsx("input",{type:"text",placeholder:"Enter your User ID",value:h,onChange:k=>v(k.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent border border-transparent focus:border-accent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2",children:"Password"}),e.jsx("input",{type:"password",placeholder:"",value:y,onChange:k=>b(k.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent border border-transparent focus:border-accent",required:!0})]}),e.jsx("button",{type:"submit",disabled:d,className:"w-full bg-accent text-white font-semibold py-3 rounded-lg hover:bg-accent/90 transition-colors flex items-center justify-center gap-2 disabled:bg-secondary disabled:cursor-not-allowed shadow-lg",children:d?"Authenticating...":e.jsxs(e.Fragment,{children:[e.jsx(gf,{className:"w-5 h-5"})," Login"]})})]}):e.jsxs("form",{onSubmit:$,className:"space-y-6 animate-[fadeIn_0.3s]",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(qs,{className:"w-16 h-16 text-accent mb-2"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-2 text-center",children:"Verification Code (OTP)"}),e.jsx("input",{type:"text",placeholder:"6-Digit Code",maxLength:6,value:w,onChange:k=>E(k.target.value.replace(/\D/g,"")),className:"w-full bg-secondary p-4 rounded-md text-text-primary font-mono text-2xl text-center tracking-widest focus:outline-none focus:ring-2 focus:ring-accent border border-transparent focus:border-accent",required:!0,autoFocus:!0})]}),e.jsx("button",{type:"submit",disabled:d||w.length<6,className:"w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 disabled:bg-secondary disabled:cursor-not-allowed shadow-lg",children:d?"Verifying...":e.jsxs(e.Fragment,{children:[e.jsx(gi,{className:"w-5 h-5"})," Verify & Login"]})}),e.jsxs("div",{className:"flex justify-between text-sm mt-4",children:[e.jsx("button",{type:"button",onClick:()=>c("credentials"),className:"text-text-secondary hover:text-primary",children:" Back to Login"}),e.jsx("button",{type:"button",onClick:P,disabled:j>0||d,className:`text-accent hover:underline ${j>0?"opacity-50 cursor-not-allowed no-underline":""}`,children:j>0?`Resend in ${j}s`:"Resend Code"})]})]})]})]})},dv=()=>{const a=mt(),[l,o]=x.useState([]),[c,d]=x.useState([]),[p,m]=x.useState(!1),[f,h]=x.useState(!1),[v,y]=x.useState(null),[b,w]=x.useState(""),[E,S]=x.useState(""),[N,j]=x.useState(""),[M,I]=x.useState(null);x.useEffect(()=>{Qs().then(o),Ks().then(d)},[]),x.useEffect(()=>{(async()=>{if(b){const _=c.find(O=>O.name===b);h(!0);try{const O=_?.resultUrl||void 0,K=await Qs(O);o(K)}catch(O){console.error("Failed to fetch exams from custom source",O)}finally{h(!1)}}})()},[b,c]);const V=x.useMemo(()=>{const D=new Set(c.filter(_=>{const O=_.isPublished;return O===!0||O==="TRUE"||O==="true"||O==="1"}).map(_=>_.name));return Array.from(D)},[c]),$=x.useMemo(()=>{if(!b)return[];const D=new Set(l.filter(_=>_.title===b).map(_=>_.class));return Array.from(D)},[l,b]),P=async D=>{if(D.preventDefault(),!b||!E||!N){y("Please select an exam, class, and enter a student ID.");return}const _=c.find(K=>K.name===b);if(!(_&&(_.isPublished===!0||_.isPublished==="TRUE"||_.isPublished==="true"||_.isPublished==="1"))){y("This result is currently not published for public view.");return}m(!0),y(null),I(null);try{const K=await $g(b,E,N.trim());K?I(K):y("Result not found. Please check the details and try again.")}catch{y("An error occurred while fetching the result.")}finally{m(!1)}},q=M?Dm(M.results.map(D=>({marks:D.marks,totalMarks:D.totalMarks}))):null,k=()=>{if(!M||!q)return;const D=window.open("","_blank");if(!D){alert("Please allow popups to print the report card.");return}const _=M.results.map(T=>{const ne=wa(T.marks,T.totalMarks),le=T.ct??"-",R=T.cq??"-",X=T.viva??"-",Y=T.fullMarks||{ct:0,cq:0,viva:0},L=Y.ct>0?Y.ct:"-",H=Y.cq>0?Y.cq:"-",re=Y.viva>0?Y.viva:"-";return`
                <tr>
                    <td style="text-align: left; padding-left: 5px;">${T.subject}</td>
                    <td>${L}</td><td>${H}</td><td>${re}</td>
                    <td>${le!=="-"?Number(le).toFixed(1):"--"}</td>
                    <td>${R!=="-"?Number(R).toFixed(1):"--"}</td>
                    <td>${X!=="-"?Number(X).toFixed(1):"--"}</td>
                    <td style="font-weight: bold;">${T.marks?Number(T.marks).toFixed(1):"-"}</td>
                    <td style="font-weight: bold;">${ne.grade}</td>
                    <td>${ne.point.toFixed(1)}</td>
                    <td>${T.highestMark?Number(T.highestMark).toFixed(1):"-"}</td>
                </tr>
            `}).join(""),O=Math.max(0,15-M.results.length),K=Array(O).fill(0).map(()=>`
            <tr><td style="height: 24px;"></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        `).join(""),Q=M.attendance||{total:0,present:0,absent:0},B=M.results.reduce((T,ne)=>T+ne.totalMarks,0),G=`
            <html>
            <head>
                <title>Progress Report - ${M.studentName}</title>
                <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;700&family=Tiro+Bangla&display=swap" rel="stylesheet">
                <style>
                    @media print {
                        @page { size: A4; margin: 0; }
                        body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
                        .no-print { display: none; }
                    }
                    body {
                        font-family: 'Times New Roman', serif;
                        background-color: transparent;
                        margin: 0;
                        padding: 0;
                        height: 100vh;
                        box-sizing: border-box;
                    }
                    .report-container {
                        width: 210mm;
                        height: 297mm;
                        margin: 0 auto;
                        padding: 10mm;
                        box-sizing: border-box;
                        background-color: transparent;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .watermark {
                        position: absolute;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        width: 600px;
                        height: 600px;
                        background-image: url('${a.logo}');
                        background-repeat: no-repeat;
                        background-position: center;
                        background-size: contain;
                        opacity: 0.20;
                        z-index: 0;
                        pointer-events: none;
                    }
                    
                    .border-box {
                        border: 1px solid #666;
                        padding: 5px;
                        height: 98%;
                        position: relative;
                        z-index: 1;
                        background: transparent;
                    }
                    .inner-border {
                        border: 1px solid #444;
                        height: 100%;
                        padding: 15px;
                        box-sizing: border-box;
                        background: transparent;
                    }

                    .header { text-align: center; position: relative; margin-bottom: 10px; background: transparent; }
                    .bismillah-img { width: 100px; margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto; transform: scaleX(1.8); }
                    .inst-name { font-size: 20px; font-weight: bold; text-transform: uppercase; color: #2c3e50; margin: 5px 0; letter-spacing: 1px; }
                    .inst-address { font-size: 12px; margin-bottom: 5px; }
                    .inst-contact { font-size: 12px; }
                    .logo { position: absolute; left: 10px; top: 10px; width: 70px; height: 70px; }
                    
                    .report-title { 
                        text-align: center; margin-top: 5px; margin-bottom: 5px; 
                        font-size: 16px; font-weight: bold; text-decoration: underline; 
                    }
                    .exam-name { text-align: center; font-size: 14px; text-transform: uppercase; margin-bottom: 10px; }

                    .student-info { 
                        display: flex; justify-content: space-between; 
                        border: 1px solid #999; background-color: transparent;
                        padding: 10px 20px; margin-bottom: 10px; font-size: 14px; line-height: 1.6;
                    }
                    .info-col { width: 48%; }
                    .info-row { display: flex; }
                    .label { width: 100px; font-weight: bold; }
                    .val { font-weight: 500; }

                    .marks-table { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 15px; background-color: transparent; }
                    .marks-table th, .marks-table td { border: 1px solid #666; padding: 4px; text-align: center; background-color: transparent !important; }
                    .marks-table th { font-weight: bold; }
                    
                    .bottom-grid { display: flex; gap: 10px; margin-top: 10px; background: transparent; }
                    .col-summary { width: 30%; }
                    .col-attendance { width: 40%; }
                    .col-grading { width: 30%; }

                    .sub-table { width: 100%; border-collapse: collapse; font-size: 11px; margin-bottom: 10px; background-color: transparent; }
                    .sub-table td { border: 1px solid #666; padding: 3px 5px; background-color: transparent !important; }
                    .sub-table .lbl { font-weight: bold; }
                    
                    .grading-table { width: 100%; border-collapse: collapse; font-size: 10px; text-align: center; background-color: transparent; }
                    .grading-table th, .grading-table td { border: 1px solid #666; padding: 2px; background-color: transparent !important; }
                    .grading-table th { font-weight: bold; }

                    .remarks-box { 
                        border: 1px solid #666; height: 50px; margin-top: 5px; padding: 5px; 
                        background-color: transparent; position: relative; font-size: 12px;
                    }

                    .footer { display: flex; justify-content: space-between; margin-top: 30px; padding: 0 20px; }
                    .sig-box { text-align: center; width: 150px; }
                    .sig-line { border-top: 1px solid #000; margin-top: 8px; font-size: 12px; font-weight: bold; padding-top: 5px;}
                    .sig-box .outstanding { font-family: 'Tiro Bangla', serif; font-size: 14px; position: relative; top: 10px; }

                    .watermark-text { position: absolute; bottom: 5px; right: 10px; font-size: 10px; font-style: italic; color: #555; }
                    .print-date { position: absolute; bottom: 5px; left: 10px; font-size: 10px; font-style: italic; color: #555; }

                </style>
            </head>
            <body>
                <div class="report-container">
                    <div class="watermark"></div>
                    <div class="border-box">
                        <div class="inner-border">
                            
                            <!-- Header -->
                            <div class="header">
                                <img src="${a.logo}" class="logo" />
                                <img src="https://iili.io/fEBrvMQ.png" class="bismillah-img" alt="Bismillah" />
                                <div class="inst-name">${a.name}</div>
                                <div class="inst-address">${a.address}</div>
                                <div class="inst-contact">Phone: ${a.phone}, Email: ${a.email}</div>
                                <div class="report-title">Progress Report</div>
                                <div class="exam-name">${M.examTitle}</div>
                            </div>

                            <!-- Info -->
                            <div class="student-info">
                                <div class="info-col">
                                    <div class="info-row"><span class="label">Name :</span> <span class="val">${M.studentName}</span></div>
                                    <div class="info-row"><span class="label">Class :</span> <span class="val">${M.className}</span></div>
                                    <div class="info-row"><span class="label">Section :</span> <span class="val">${M.section}</span></div>
                                    <div class="info-row"><span class="label">Group :</span> <span class="val">${M.group||"N/A"}</span></div>
                                </div>
                                <div class="info-col">
                                    <div class="info-row"><span class="label">ID Number :</span> <span class="val">${M.studentId}</span></div>
                                    <div class="info-row"><span class="label">Roll No :</span> <span class="val">${M.rollNo||"-"}</span></div>
                                    <div class="info-row"><span class="label">Class Teacher :</span> <span class="val">${M.classTeacher}</span></div>
                                    <div class="info-row"><span class="label">Teacher Cell :</span> <span class="val">${M.teacherPhone}</span></div>
                                </div>
                            </div>

                            <!-- Table -->
                            <table class="marks-table">
                                <thead>
                                    <tr>
                                        <th rowspan="2" style="width: 25%;">Subject</th>
                                        <th colspan="3">Exam Marks</th>
                                        <th colspan="3">Obtained / Calculated Marks</th>
                                        <th rowspan="2" style="width: 7%;">Total</th>
                                        <th rowspan="2" style="width: 6%;">Grade</th>
                                        <th rowspan="2" style="width: 6%;">Grade Point</th>
                                        <th rowspan="2" style="width: 7%;">Highest Marks</th>
                                    </tr>
                                    <tr>
                                        <th style="width: 6%;">CT</th> <th style="width: 6%;">CQ</th> <th style="width: 6%;">Viva</th>
                                        <th style="width: 6%;">CT</th> <th style="width: 6%;">CQ</th> <th style="width: 6%;">Viva</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${_}
                                    ${K}
                                </tbody>
                            </table>

                            <!-- Bottom Grid -->
                            <div class="bottom-grid">
                                <!-- Col 1: Summary -->
                                <div class="col-summary">
                                    <table class="sub-table">
                                        <tr><td class="lbl">Exam Full Marks</td><td style="text-align:right;">${B}</td></tr>
                                        <tr><td class="lbl">Total Obtained Marks</td><td style="text-align:right;">${M.totalMarksObtained.toFixed(2)}</td></tr>
                                        <tr><td class="lbl">Obtained Percentage</td><td style="text-align:right;">${M.percentage.toFixed(2)}%</td></tr>
                                    </table>
                                    <table class="sub-table">
                                        <tr><td class="lbl">Obtained GPA</td><td style="text-align:right; font-weight:bold;">${q.gpa}</td></tr>
                                        <tr><td class="lbl">Class Merit</td><td style="text-align:right;">${M.rank||"-"}</td></tr>
                                        <tr><td class="lbl">Institutional Merit</td><td style="text-align:right;">${M.institutionalRank||"-"}</td></tr>
                                        <tr><td class="lbl">Group Merit</td><td style="text-align:right;">${M.groupRank||"N/A"}</td></tr>
                                    </table>
                                </div>

                                <!-- Col 2: Attendance & Remarks -->
                                <div class="col-attendance">
                                    <table class="sub-table">
                                        <tr><td class="lbl">Working Days</td><td style="text-align:center;">${Q.total}</td></tr>
                                        <tr><td class="lbl">Present</td><td style="text-align:center;">${Q.present}</td></tr>
                                        <tr><td class="lbl">Absent</td><td style="text-align:center;">${Q.absent}</td></tr>
                                    </table>
                                    
                                    <div style="font-size: 11px; font-weight: bold; margin-bottom: 2px;">Promotion Note / Remarks</div>
                                    <div class="remarks-box">
                                        ${q.grade==="F"?"FAILED.":"PASSED."}
                                    </div>
                                </div>

                                <!-- Col 3: Grading Scale -->
                                <div class="col-grading">
                                    <table class="grading-table">
                                        <tr style="background-color: transparent !important;"><th colspan="3">Grade Distribution</th></tr>
                                        <tr><th>Marks</th><th>Grade</th><th>GP</th></tr>
                                        <tr><td>80% and Above</td><td>A+</td><td>5.00</td></tr>
                                        <tr><td>70% - 79%</td><td>A</td><td>4.00</td></tr>
                                        <tr><td>60% - 69%</td><td>A-</td><td>3.50</td></tr>
                                        <tr><td>50% - 59%</td><td>B</td><td>3.00</td></tr>
                                        <tr><td>40% - 49%</td><td>C</td><td>2.00</td></tr>
                                        <tr><td>33% - 39%</td><td>D</td><td>1.00</td></tr>
                                        <tr><td>Below 33%</td><td>F</td><td>0.00</td></tr>
                                    </table>
                                </div>
                            </div>

                            <!-- Footer Signatures -->
                            <div class="footer">
                                <div class="sig-box">
                                    <div style="height: 15px;"></div>
                                    <div class="sig-line">Class Teacher</div>
                                </div>
                                <div class="sig-box">
                                    <div style="height: 15px;"></div> 
                                    <div class="sig-line">Director</div>
                                </div>
                                <div class="sig-box">
                                    <div style="height: 15px;"></div>
                                    <div class="sig-line">Guardian</div>
                                </div>
                            </div>

                            <div class="remarks-box" style="margin-top: 10px; height: 30px; display:flex; align-items:center; background: transparent;">
                                <span style="font-weight:bold; margin-right: 10px;">Remarks:</span>
                            </div>

                            <div class="print-date">Printed on ${new Date().toLocaleDateString("en-GB")}</div>
                            <div class="watermark-text">Powered by IICM</div>

                        </div>
                    </div>
                </div>
                <script>
                    window.onload = function() {
                        setTimeout(() => {
                            window.print();
                        }, 500);
                    }
                <\/script>
            </body>
            </html>
        `;D.document.write(G),D.document.close()};return e.jsx("div",{className:"min-h-screen bg-background text-text-primary p-4 sm:p-6 md:p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(kn,{to:"/",className:"text-accent hover:underline mb-8 inline-block",children:" Back to Home"}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:a.logo,alt:"logo",className:"w-20 h-20 mx-auto mb-4 bg-white rounded-full p-1.5"}),e.jsx("h1",{className:"text-4xl font-bold text-text-primary",children:"Check Exam Results"}),e.jsx("p",{className:"text-text-secondary",children:"Select your exam database and enter your ID."})]}),e.jsxs("div",{className:"bg-primary p-8 rounded-2xl shadow-2xl mb-8 relative",children:[f&&e.jsx("div",{className:"absolute inset-0 bg-primary/60 backdrop-blur-sm z-20 flex items-center justify-center rounded-2xl",children:e.jsxs("div",{className:"flex items-center gap-3 text-accent font-bold",children:[e.jsx(hi,{className:"w-6 h-6 animate-spin"}),"Connecting to Database..."]})}),e.jsxs("form",{onSubmit:P,className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Exam Title"}),e.jsxs("select",{value:b,onChange:D=>{w(D.target.value),S("")},className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,children:[e.jsx("option",{value:"",children:"-- Choose Exam --"}),V.map(D=>e.jsx("option",{value:D,children:D},D))]})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Class"}),e.jsxs("select",{value:E,onChange:D=>S(D.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,disabled:!b||f,children:[e.jsx("option",{value:"",children:"-- Select Class --"}),$.map(D=>e.jsxs("option",{value:D,children:["Class ",D]},D))]})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Student ID"}),e.jsx("input",{type:"text",placeholder:"e.g., S001",value:N,onChange:D=>j(D.target.value),className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0,disabled:f})]}),e.jsx("button",{type:"submit",disabled:p||f,className:"md:col-span-1 w-full bg-accent text-white font-semibold py-3 rounded-lg hover:bg-accent/90 transition-colors flex items-center justify-center gap-2 disabled:bg-secondary",children:p?"Searching...":e.jsxs(e.Fragment,{children:[e.jsx(xi,{className:"w-5 h-5"})," Search Result"]})})]})]}),v&&e.jsx("div",{className:"text-center p-4 bg-red-500/20 text-red-400 rounded-lg",children:v}),M&&q&&e.jsxs("div",{className:"bg-primary p-8 rounded-2xl shadow-2xl animate-[fadeIn_0.5s]",children:[e.jsxs("div",{className:"border-b-2 border-secondary pb-4 mb-6 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-accent uppercase tracking-tight",children:[M.examTitle," Result"]}),e.jsx("p",{className:"text-text-secondary",children:a.name})]}),e.jsxs("button",{onClick:k,className:"bg-accent text-white font-semibold px-4 py-2 rounded-lg hover:bg-accent/90 transition-colors flex items-center gap-2",children:[e.jsx(jt,{className:"w-5 h-5"}),"Print"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-3 text-lg mb-8 bg-secondary/20 p-6 rounded-xl border border-secondary",children:[e.jsxs("div",{className:"flex justify-between border-b border-secondary pb-1",children:[e.jsx("span",{className:"text-text-secondary",children:"Student Name:"})," ",e.jsx("span",{className:"text-text-primary font-bold",children:M.studentName})]}),e.jsxs("div",{className:"flex justify-between border-b border-secondary pb-1",children:[e.jsx("span",{className:"text-text-secondary",children:"Student ID:"})," ",e.jsx("span",{className:"text-text-primary font-bold font-mono",children:M.studentId})]}),e.jsxs("div",{className:"flex justify-between border-b border-secondary pb-1",children:[e.jsx("span",{className:"text-text-secondary",children:"Class:"})," ",e.jsx("span",{className:"text-text-primary font-bold",children:M.className})]}),e.jsxs("div",{className:"flex justify-between border-b border-secondary pb-1",children:[e.jsx("span",{className:"text-text-secondary",children:"Merit Position:"})," ",e.jsxs("span",{className:"text-accent font-bold",children:["#",M.rank]})]})]}),e.jsx("div",{className:"overflow-x-auto mb-8",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-4",children:"Subject"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-center",children:"Marks"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-center",children:"Grade"}),e.jsx("th",{scope:"col",className:"px-6 py-4 text-center",children:"GP"})]})}),e.jsx("tbody",{children:M.results.map((D,_)=>{const O=wa(D.marks,D.totalMarks);return e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-text-primary",children:D.subject}),e.jsx("td",{className:"px-6 py-4 text-center font-semibold text-text-primary",children:D.marks??"Absent"}),e.jsx("td",{className:"px-6 py-4 text-center font-bold",style:{color:O.color},children:O.grade}),e.jsx("td",{className:"px-6 py-4 text-center font-bold",children:O.gpa})]},_)})})]})}),e.jsxs("div",{className:"bg-secondary/40 rounded-xl p-6 flex flex-col md:flex-row items-center justify-between gap-6 border border-secondary",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("p",{className:"text-text-secondary text-xs uppercase font-bold tracking-widest mb-1",children:"Total Marks"}),e.jsxs("p",{className:"text-4xl font-black text-text-primary",children:[M.totalMarksObtained," ",e.jsxs("span",{className:"text-xl text-text-secondary",children:["/ ",M.overallTotalMarks]})]})]}),e.jsx("div",{className:"h-12 w-px bg-secondary hidden md:block"}),e.jsxs("div",{className:"text-center md:text-right",children:[e.jsx("p",{className:"text-text-secondary text-xs uppercase font-bold tracking-widest mb-1",children:"Final Result"}),e.jsxs("p",{className:"text-4xl font-black",style:{color:q.color},children:[q.gpa,e.jsxs("span",{className:"text-xl ml-2 font-bold opacity-80",children:["(",q.grade,")"]})]})]})]})]})]})})},Gu=a=>{const l=a.getDate(),o=a.getMonth(),c=a.getFullYear(),d=["Boishakh","Jyoishtho","Asharh","Srabon","Bhadro","Ashshin","Kartik","Ogrohayon","Poush","Magh","Falgun","Chaitra"],p=[14,13,14,14,15,15,16,16,16,16,15,15];let m=0,f=0,h=o>3||o===3&&l>=14?c-593:c-594;if(l>=p[o])m=(o+9)%12,f=l-p[o]+1;else{m=(o+8)%12;let y=o===0?11:o-1,b=p[y];f=new Date(c,o,0).getDate()-b+l+1}const v=y=>y.toString().replace(/\d/g,b=>""[parseInt(b)]);return`${d[m]} ${v(f)}, ${v(h)}`},qu=a=>{const l=new Date(a);return l.setDate(l.getDate()-1),new Intl.DateTimeFormat("en-US-u-ca-islamic-umalqura",{day:"numeric",month:"long",year:"numeric"}).format(l)},Qu=(a,l)=>{const o=a.getMonth()+1,c=a.getDate(),d=`${String(o).padStart(2,"0")}-${String(c).padStart(2,"0")}`,p={"02-21":"Int'l Mother Language Day","03-17":"Sheikh Mujib's Birthday","03-26":"Independence Day","04-14":"Pohela Boishakh (Bengali New Year)","05-01":"May Day","08-15":"National Mourning Day","12-16":"Victory Day","12-25":"Christmas Day"};return p[d]?p[d]:l.includes("Ramadan 1,")?"Start of Ramadan":l.includes("Shawwal 1,")?"Eid ul-Fitr":l.includes("Dhu al-Hijjah 10,")?"Eid ul-Adha":l.includes("Rabi I 12,")?"Eid-e-Miladunnabi":l.includes("Muharram 10,")?"Ashura":l.includes("Rajab 27,")?"Shab-e-Meraj":l.includes("Shaban 15,")?"Shab-e-Barat":null},Vs=a=>{if(!a)return"N/A";if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a;const l=new Date(a);if(isNaN(l.getTime()))return a;const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`},Km=a=>{if(!a)return"N/A";if(/^\d{2}:\d{2}(:\d{2})?$/.test(a)){const[o,c]=a.split(":").map(Number),d=new Date;return d.setHours(o,c,0,0),d.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}const l=new Date(a);return isNaN(l.getTime())?a:l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})},$r=({title:a,value:l,icon:o,color:c})=>e.jsxs("div",{className:"bg-primary p-4 rounded-lg shadow-lg flex items-center",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center mr-4 ${c}`,children:e.jsx(o,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-secondary text-sm font-medium uppercase",children:a}),e.jsx("p",{className:"text-2xl font-bold text-text-primary",children:l})]})]}),uv=()=>{const{user:a}=qe(),[l,o]=x.useState(null),[c,d]=x.useState(!0),p=Ni(),[m,f]=x.useState(new Date),[h,v]=x.useState(null),y=oi.useMemo(()=>new Set(p.filter(P=>P.roles.includes("Student")).map(P=>P.href)),[p]);x.useEffect(()=>{a&&Om(a.id).then(P=>{o(P),d(!1)}).catch(P=>{console.error("Failed to load student profile",P),d(!1)})},[a]);const b=x.useMemo(()=>{const P=m.getFullYear(),q=m.getMonth();return new Date(P,q+1,0).getDate()},[m]),w=x.useMemo(()=>{const P=m.getFullYear(),q=m.getMonth();return new Date(P,q,1).getDay()},[m]),E=x.useMemo(()=>{const P=[],q=m.getFullYear(),k=m.getMonth();for(let D=0;D<w;D++)P.push(null);for(let D=1;D<=b;D++)P.push(new Date(q,k,D));return P},[m,b,w]),S=()=>f(new Date(m.getFullYear(),m.getMonth()-1,1)),N=()=>f(new Date(m.getFullYear(),m.getMonth()+1,1)),j=P=>{switch(P){case"Academic":return"bg-blue-500";case"Sports":return"bg-green-500";case"Cultural":return"bg-purple-500";case"Holiday":return"bg-red-500";default:return"bg-gray-500"}},M=P=>{const q=qu(P),k=Gu(P),D=Qu(P,q),_=Vs(P.toISOString()),O=l?.events.filter(K=>Vs(K.date)===_)||[];v({date:P,hijri:q,bengali:k,holiday:D,events:O})},I=x.useMemo(()=>{if(!l?.events)return[];const P=new Date;return P.setHours(0,0,0,0),l.events.filter(q=>new Date(q.date)>=P).sort((q,k)=>new Date(q.date).getTime()-new Date(k.date).getTime())},[l?.events]);if(c)return e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx("p",{className:"text-xl",children:"Loading Your Dashboard..."})});if(!l)return e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx("p",{className:"text-xl text-red-400",children:"Could not load your profile."})});const V=l.attendance.total>0?Math.round((l.attendance.present+(l.attendance.late||0))/l.attendance.total*100):100,$=y.size>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-text-primary",children:["Welcome, ",l.student.name,"!"]}),!$&&e.jsx("div",{className:"bg-primary p-6 rounded-lg shadow-lg text-center",children:e.jsx("p",{className:"text-text-secondary",children:"You currently don't have access to any modules. Please contact an administrator if you believe this is an error."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[y.has("/app/attendance")&&e.jsxs(e.Fragment,{children:[e.jsx($r,{title:"Attendance",value:`${V}%`,icon:jm,color:"bg-green-500"}),e.jsx($r,{title:"Days Absent",value:l.attendance.absent,icon:yf,color:"bg-red-500"})]}),y.has("/app/finance")&&e.jsx($r,{title:"Fees Status",value:l.fees.status,icon:vf,color:l.fees.status==="Paid"?"bg-blue-500":"bg-yellow-500"}),y.has("/app/attendance")&&e.jsx($r,{title:"Incidents",value:l.discipline.length,icon:qs,color:"bg-orange-500"})]}),e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary mb-6 flex items-center gap-2",children:[e.jsx(ni,{className:"w-5 h-5 text-accent"})," My Class & Instructors"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 border-r border-secondary/50 pr-8",children:[e.jsx("p",{className:"text-xs text-text-secondary uppercase font-bold tracking-wider mb-4",children:"Class Teacher"}),l.classTeacher?e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("img",{src:l.classTeacher.photo||at,alt:l.classTeacher.name,className:"w-24 h-24 rounded-2xl object-cover border-2 border-accent mb-4 shadow-xl shadow-accent/10"}),e.jsx("h4",{className:"text-lg font-bold text-text-primary",children:l.classTeacher.name}),e.jsx("p",{className:"text-sm text-accent font-medium mb-4",children:l.classTeacher.subject||"All Subjects"}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsxs("a",{href:`tel:${l.classTeacher.phone}`,className:"flex items-center justify-center gap-2 w-full py-2 bg-secondary/50 rounded-lg text-sm text-text-primary hover:bg-secondary transition-colors",children:[e.jsx(Iu,{className:"w-4 h-4 text-accent"})," ",l.classTeacher.phone]}),e.jsxs("a",{href:`https://wa.me/${l.classTeacher.phone.replace(/\D/g,"")}`,target:"_blank",className:"flex items-center justify-center gap-2 w-full py-2 bg-green-500/10 rounded-lg text-sm text-green-500 hover:bg-green-500/20 transition-colors",children:[e.jsx(zr,{className:"w-4 h-4"})," Message Instructor"]})]})]}):e.jsx("p",{className:"text-text-secondary italic text-sm",children:"Class teacher not assigned yet."})]}),e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("p",{className:"text-xs text-text-secondary uppercase font-bold tracking-wider mb-4",children:"Course Instructors"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar",children:(l.subjectTeachers?.length??0)>0?l.subjectTeachers?.map((P,q)=>e.jsxs("div",{className:"bg-secondary/30 p-3 rounded-xl border border-secondary/50 flex items-center gap-4 group hover:bg-secondary/50 transition-colors",children:[e.jsx("div",{className:"flex -space-x-3 overflow-hidden",children:P.teachers.length>0?P.teachers.map((k,D)=>e.jsx("img",{className:"inline-block h-10 w-10 rounded-full ring-2 ring-primary group-hover:ring-accent transition-all object-cover",src:k.photo||at,alt:k.name,title:k.name},D)):e.jsx("div",{className:"h-10 w-10 rounded-full bg-secondary flex items-center justify-center text-xs text-text-secondary border-2 border-primary",children:"?"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h5",{className:"text-sm font-bold text-text-primary truncate",children:P.subjectName}),e.jsx("p",{className:"text-[10px] text-text-secondary truncate",children:P.teachers.length>0?P.teachers.map(k=>k.name).join(", "):"No teacher assigned"})]})]},q)):e.jsx("p",{className:"text-text-secondary text-sm italic col-span-2",children:"No subjects found for this class."})})]})]})]}),l.transport&&e.jsxs("div",{className:"bg-gradient-to-r from-primary to-secondary/10 p-6 rounded-lg shadow-lg border-l-4 border-accent relative overflow-hidden",children:[e.jsx("div",{className:"absolute right-0 top-0 opacity-5 -mr-4 -mt-4",children:e.jsx(ja,{className:"w-48 h-48"})}),e.jsxs("div",{className:"flex justify-between items-start relative z-10",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-accent mb-2 flex items-center gap-2",children:[e.jsx(ja,{className:"w-5 h-5"})," Transport Assigned"]}),e.jsx("p",{className:"text-2xl font-bold text-text-primary mb-1",children:l.transport.vehicleNumber}),e.jsxs("div",{className:"flex items-center gap-2 text-text-secondary text-sm mb-4",children:[e.jsx(jf,{className:"w-4 h-4"})," ",l.transport.route]})]}),e.jsxs("div",{className:"text-right bg-primary/80 p-3 rounded-lg backdrop-blur-sm border border-secondary/50",children:[e.jsx("p",{className:"text-xs text-text-secondary uppercase mb-1",children:"Driver Details"}),e.jsxs("p",{className:"font-bold text-text-primary flex items-center justify-end gap-2",children:[e.jsx(ni,{className:"w-4 h-4"})," ",l.transport.driverName]}),e.jsxs("a",{href:`tel:${l.transport.driverContact}`,className:"text-accent hover:underline text-sm font-semibold flex items-center justify-end gap-2 mt-1",children:[e.jsx(Iu,{className:"w-3 h-3"})," ",l.transport.driverContact]})]})]})]}),y.has("/app/events")&&e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-secondary pb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-text-primary",children:[e.jsx(Cn,{className:"w-6 h-6 text-accent"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Academic Calendar"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:S,className:"text-text-secondary hover:text-accent font-bold text-xl",children:"<"}),e.jsx("span",{className:"text-lg font-bold text-text-primary w-40 text-center",children:m.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:N,className:"text-text-secondary hover:text-accent font-bold text-xl",children:">"})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-2 text-center mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(P=>e.jsx("div",{className:"font-bold text-text-secondary text-sm",children:P},P))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:E.map((P,q)=>{if(!P)return e.jsx("div",{className:"h-32 bg-transparent"},`empty-${q}`);const k=Vs(P.toISOString()),D=qu(P),_=D.split(",")[0],O=Gu(P),K=Qu(P,D),Q=l.events.filter(ne=>Vs(ne.date)===k),B=Q.length>0,G=P.toDateString()===new Date().toDateString(),T=P.getDay()===5;return e.jsxs("div",{onClick:()=>M(P),className:`h-32 p-1 rounded-md border border-secondary flex flex-col relative overflow-hidden transition-all hover:bg-secondary/50 cursor-pointer
                                    ${G?"ring-2 ring-accent bg-secondary/30":""}
                                    ${T?"bg-red-900/10":""}
                                `,children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:`font-bold text-lg ${T?"text-red-400":"text-text-primary"}`,children:P.getDate()}),B&&e.jsx("div",{className:"flex gap-0.5 pt-1",children:Q.slice(0,3).map((ne,le)=>e.jsx("div",{className:`w-2 h-2 rounded-full ${j(ne.type)}`,title:ne.title},le))})]}),e.jsxs("div",{className:"flex flex-col text-[10px] text-text-secondary leading-tight opacity-90 gap-0.5",children:[e.jsx("span",{className:"text-green-600/90 font-medium truncate",children:_}),e.jsx("span",{className:"font-bengali text-yellow-600/90 truncate",children:O.split(",")[0]})]}),(K||B)&&e.jsx("div",{className:"mt-auto pt-1 w-full text-[9px] text-center font-bold",children:K?e.jsx("span",{className:"text-red-300 bg-red-500/20 block rounded-sm px-1 py-0.5 truncate",children:K}):e.jsx("span",{className:"text-blue-300 bg-blue-500/20 block rounded-sm px-1 py-0.5 truncate",children:Q[0].title})})]},k)})}),e.jsxs("div",{className:"mt-4 flex gap-4 text-xs text-text-secondary justify-center flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})," Academic"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})," Sports"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"})," Cultural"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"})," Holiday"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-red-400 font-bold",children:"Fri"})," Weekend"]})]})]}),y.has("/app/academics")&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(mi,{className:"w-5 h-5 text-accent"}),"This Week's Timetable"]}),e.jsx(mv,{timetable:l.timetable})]}),e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(vm,{className:"w-5 h-5 text-accent"}),"Homework Assignments"]}),e.jsx(pv,{homework:l.homework})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[y.has("/app/exams")&&e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(ui,{className:"w-5 h-5 text-accent"}),"Upcoming Exams"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:(l.upcomingExams?.length??0)>0?l.upcomingExams.map(P=>e.jsx("div",{className:"bg-secondary p-3 rounded-md border-l-4 border-accent",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-text-primary",children:P.title}),e.jsx("p",{className:"text-sm text-text-secondary",children:P.subject})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-bold text-text-primary",children:Vs(P.date)}),e.jsx("p",{className:"text-xs text-text-secondary",children:Km(P.time)})]})]})},P.id)):e.jsx("p",{className:"text-text-secondary text-center py-4",children:"No upcoming exams scheduled."})})]}),y.has("/app/events")&&e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(Cn,{className:"w-5 h-5 text-accent"}),"Upcoming Events"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:I.length>0?I.map(P=>e.jsxs("div",{className:"bg-secondary p-3 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("p",{className:"font-semibold text-text-primary",children:P.title}),e.jsx("p",{className:"text-text-secondary",children:Vs(P.date)})]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:P.description})]},P.id)):e.jsx("p",{className:"text-text-secondary text-center py-4",children:"No upcoming events."})})]}),y.has("/app/attendance")&&e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary mb-4 flex items-center gap-2",children:[e.jsx(qs,{className:"w-5 h-5 text-accent"}),"Discipline Log"]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:l.discipline.length>0?l.discipline.map(P=>e.jsxs("div",{className:"bg-secondary p-3 rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("p",{className:"font-semibold text-text-primary",children:P.incidentType}),e.jsx("p",{className:"text-text-secondary",children:P.date})]}),e.jsxs("p",{className:"text-sm text-text-secondary mt-1",children:[P.description," ",e.jsxs("strong",{className:"text-text-primary",children:["(Action: ",P.actionTaken,")"]})]})]},P.id)):e.jsx("p",{className:"text-text-secondary text-center py-4",children:"No disciplinary incidents on record. Keep it up!"})})]})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-primary rounded-lg shadow-2xl w-full max-w-md border border-secondary",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-secondary",children:[e.jsx("h3",{className:"text-xl font-bold text-text-primary",children:"Date Details"}),e.jsx("button",{onClick:()=>v(null),className:"text-text-secondary hover:text-red-400",children:e.jsx(Bt,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"text-center bg-secondary p-4 rounded-lg",children:[e.jsx("h4",{className:"text-3xl font-bold text-accent",children:h.date.getDate()}),e.jsx("p",{className:"text-lg text-text-primary",children:h.date.toLocaleString("default",{month:"long",year:"numeric"})}),e.jsx("p",{className:"text-text-secondary",children:h.date.toLocaleString("default",{weekday:"long"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-secondary p-3 rounded-lg",children:[e.jsx("span",{className:"text-xs text-green-400 font-semibold block mb-1",children:"Hijri Date"}),e.jsx("p",{className:"text-sm text-text-primary",children:h.hijri})]}),e.jsxs("div",{className:"bg-secondary p-3 rounded-lg",children:[e.jsx("span",{className:"text-xs text-yellow-400 font-semibold block mb-1",children:"Bengali Date"}),e.jsx("p",{className:"text-sm text-text-primary font-bengali",children:h.bengali})]})]}),e.jsxs("div",{className:"border-t border-secondary pt-4",children:[e.jsx("h5",{className:"font-semibold text-text-primary mb-2",children:"Holidays & Events"}),h.holiday?e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500/50 rounded-lg mb-2",children:e.jsxs("p",{className:"text-red-400 font-bold flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-red-500"}),h.holiday]})}):h.events.length===0&&e.jsx("p",{className:"text-text-secondary text-sm italic",children:"No holidays or events for this day."}),h.events.map(P=>e.jsxs("div",{className:`p-3 rounded-lg mb-2 border ${j(P.type).replace("bg-","border-").replace("500","500/50")} bg-secondary`,children:[e.jsx("p",{className:"text-text-primary font-semibold",children:P.title}),e.jsx("p",{className:"text-xs text-text-secondary",children:P.description}),e.jsx("span",{className:`inline-block mt-1 text-[10px] px-2 py-0.5 rounded-full text-white ${j(P.type)}`,children:P.type})]},P.id))]})]})]})})]})},mv=({timetable:a})=>{const l=x.useMemo(()=>{const c={};for(const d of a)c[d.day]||(c[d.day]=[]),c[d.day]?.push(d);return Object.values(c).forEach(d=>{d&&d.sort((p,m)=>p.time.localeCompare(m.time))}),c},[a]),o=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return a.length===0?e.jsx("p",{className:"text-text-secondary text-center py-4",children:"Your timetable is not available."}):e.jsx("div",{className:"overflow-x-auto pb-2",children:e.jsx("div",{className:"flex space-x-4",children:o.filter(c=>l[c]?.length??!1).map(c=>e.jsxs("div",{className:"flex-shrink-0 w-60 bg-secondary p-3 rounded-lg",children:[e.jsx("h4",{className:"font-bold text-accent text-center mb-2",children:c}),e.jsx("div",{className:"space-y-2",children:l[c]?.map(d=>e.jsxs("div",{className:"bg-background p-2 rounded-md text-sm",children:[e.jsxs("p",{className:"font-semibold text-text-primary",children:[Km(d.time)," - ",d.subject]}),e.jsx("p",{className:"text-text-secondary",children:d.teacher})]},d.id))})]},c))})})},pv=({homework:a})=>a.length===0?e.jsx("p",{className:"text-text-secondary text-center py-4",children:"No homework assignments. Great job!"}):e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:a.map(l=>e.jsxs("div",{className:"bg-secondary p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-accent font-semibold",children:l.subject}),e.jsx("h4",{className:"font-semibold text-text-primary",children:l.title})]}),e.jsxs("p",{className:"text-text-secondary font-medium flex-shrink-0 pl-2",children:["Due: ",Vs(l.dueDate)]})]}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:l.description})]},l.id))}),xv=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-center bg-background p-4",children:[e.jsx(qs,{className:"w-24 h-24 text-red-500 mb-6"}),e.jsx("h1",{className:"text-4xl font-bold text-text-primary mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-lg text-text-secondary",children:"You do not have permission to view this page."}),e.jsx(kn,{to:"/app",className:"mt-6 bg-accent text-white font-semibold px-6 py-2 rounded-lg hover:bg-accent/90 transition-colors",children:"Go to My Dashboard"})]}),Yu=35*1024,hv=({isOpen:a,onClose:l,onSave:o})=>{const[c,d]=x.useState(mt());if(!a)return null;const p=h=>{const{name:v,value:y}=h.target;d(b=>({...b,[v]:y}))},m=h=>{const v=h.target.files?.[0];if(v){if(v.size>Yu){alert(`File is too large. Please select an image smaller than ${Yu/1024}KB to avoid errors.`);return}const y=new FileReader;y.onloadend=()=>{d(b=>({...b,logo:y.result}))},y.readAsDataURL(v)}},f=async h=>{h.preventDefault(),await ty(c),o(),l()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:"Edit Institution Details"}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:c.logo,alt:"logo preview",className:"w-20 h-20 rounded-full bg-white p-1"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"logo-upload",className:"block text-sm font-medium text-text-secondary",children:"Logo"}),e.jsx("input",{id:"logo-upload",type:"file",accept:"image/*",onChange:m,className:"text-sm text-text-secondary file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-accent file:text-white hover:file:bg-accent/90"})]})]}),e.jsx("input",{type:"text",name:"name",placeholder:"Madrasa Name",value:c.name,onChange:p,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"text",name:"tagline",placeholder:"Tagline",value:c.tagline,onChange:p,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsx("textarea",{name:"address",placeholder:"Address",value:c.address,onChange:p,rows:3,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"tel",name:"phone",placeholder:"Phone Number",value:c.phone,onChange:p,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsx("input",{type:"email",name:"email",placeholder:"Email Address",value:c.email,onChange:p,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:"Save Changes"})]})]})]})})},fv=({isOpen:a,onClose:l,onSave:o,initialData:c})=>{const[d,p]=x.useState({name:c?.name||"",startDate:c?.startDate||"",endDate:c?.endDate||""});if(!a)return null;const m=h=>{p({...d,[h.target.name]:h.target.value})},f=async h=>{h.preventDefault(),c?await Tf({...c,...d}):await Af(d),o()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[c?"Edit":"Add"," Academic Session"]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("input",{type:"text",name:"name",placeholder:"Session Name (e.g., 2024-2025)",value:d.name,onChange:m,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Start Date"}),e.jsx("input",{type:"date",name:"startDate",value:d.startDate,onChange:m,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"End Date"}),e.jsx("input",{type:"date",name:"endDate",value:d.endDate,onChange:m,className:"w-full bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:"Save Session"})]})]})]})})},gv=({users:a,onEdit:l,onDelete:o})=>e.jsx("div",{className:"overflow-x-auto bg-secondary rounded-lg",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-background/30",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"ID"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Username"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Email"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Role"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(c=>e.jsxs("tr",{className:"border-b border-primary hover:bg-primary/50",children:[e.jsx("td",{className:"px-6 py-4 font-mono text-xs",children:c.id}),e.jsxs("th",{scope:"row",className:"px-6 py-4 font-medium text-text-primary whitespace-nowrap flex items-center gap-3",children:[e.jsx("img",{src:c.photo||at,alt:c.name,className:"w-8 h-8 rounded-full object-cover border border-accent/30"}),c.name]}),e.jsx("td",{className:"px-6 py-4",children:c.username}),e.jsx("td",{className:"px-6 py-4",children:c.email||e.jsx("span",{className:"text-text-secondary opacity-50 italic",children:"No Email"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:"bg-background/50 px-2 py-1 rounded text-xs",children:c.role})}),e.jsxs("td",{className:"px-6 py-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>l(c),className:"p-1 hover:bg-background rounded",title:"Edit User",children:e.jsx(wt,{className:"w-4 h-4 text-yellow-400"})}),e.jsx("button",{onClick:()=>o(c),className:"p-1 hover:bg-background rounded",title:"Delete User",children:e.jsx(Re,{className:"w-4 h-4 text-red-500"})})]})]},c.id))})]})}),Ku=35*1024,yv=({isOpen:a,onClose:l,onSave:o,initialData:c})=>{const[d,p]=x.useState({name:"",username:"",password:"",role:"Student",photo:"",email:""}),[m,f]=x.useState(null);if(x.useEffect(()=>{c?(p({name:c.name,username:c.username,password:"",role:c.role,photo:c.photo||"",email:c.email||""}),f(c.photo)):(p({name:"",username:"",password:"",role:"Student",photo:"",email:""}),f(at))},[c]),!a)return null;const h=b=>{p({...d,[b.target.name]:b.target.value})},v=b=>{const w=b.target.files?.[0];if(w){if(w.size>Ku){alert(`File is too large. Please select an image smaller than ${Ku/1024}KB to avoid errors.`);return}const E=new FileReader;E.onloadend=()=>{const S=E.result;p(N=>({...N,photo:S})),f(S)},E.readAsDataURL(w)}},y=async b=>{b.preventDefault();const w={...d};if(c&&!w.password)delete w.password;else if(!c&&!w.password){alert("Password is required for new users.");return}c?await _f({...c,...w}):await zf(w),o()};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-primary rounded-lg p-8 shadow-2xl w-full max-w-2xl",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-text-primary",children:[c?"Edit":"Add New"," User"]}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-1/3 space-y-2",children:[e.jsx("img",{src:m||at,alt:"preview",className:"w-32 h-32 rounded-full object-cover mx-auto border-2 border-accent"}),e.jsxs("div",{className:"text-center",children:[e.jsx("input",{type:"file",id:"photo-upload",accept:"image/*",onChange:v,className:"hidden"}),e.jsx("label",{htmlFor:"photo-upload",className:"cursor-pointer text-sm text-accent hover:underline",children:"Change Photo"})]})]}),e.jsxs("div",{className:"w-2/3 grid grid-cols-1 gap-4",children:[e.jsx("input",{type:"text",name:"name",placeholder:"Full Name",value:d.name,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"text",name:"username",placeholder:"Username / Login ID",value:d.username,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0}),e.jsx("input",{type:"email",name:"email",placeholder:"Email Address (for 2FA)",value:d.email,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsx("input",{type:"password",name:"password",placeholder:c?"New Password (optional)":"Password",value:d.password,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent"}),e.jsxs("select",{name:"role",value:d.role,onChange:h,className:"bg-secondary p-3 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",disabled:!!c,children:[e.jsx("option",{value:"Student",children:"Student"}),e.jsx("option",{value:"Teacher",children:"Teacher"}),e.jsx("option",{value:"Admin",children:"Admin"}),e.jsx("option",{value:"Support Staff",children:"Support Staff"}),e.jsx("option",{value:"Librarian",children:"Librarian"}),e.jsx("option",{value:"IT Admin",children:"IT Admin"}),e.jsx("option",{value:"Finance Admin",children:"Finance Admin"}),e.jsx("option",{value:"Driver",children:"Driver"})]}),e.jsx("p",{className:"text-xs text-text-secondary -mt-2",children:"Role cannot be changed after creation."})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-6 py-2 rounded-md text-text-primary bg-secondary hover:bg-secondary/80",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 rounded-md text-white bg-accent hover:bg-accent/80 font-semibold",children:c?"Save Changes":"Create User"})]})]})]})})},Is=async a=>{const l=`website_${a}`,o=De(l);if(o&&o.length>0)return o;try{const c=await ae({action:"read",sheetName:a});if(Array.isArray(c)){const d=c;return Te(l,d),d}}catch(c){console.error(`Failed to fetch ${a}`,c)}return[]},Mn=async(a,l)=>{const c=(await Is(a)).findIndex(d=>d.id===l.id);l.id&&c!==-1?await ae({action:"update",sheetName:a,id:l.id,data:l}):await ae({action:"create",sheetName:a,data:l.id?l:{...l,id:Date.now().toString()}}),ue(`website_${a}`)},ki=async(a,l)=>{await ae({action:"delete",sheetName:a,id:l}),ue(`website_${a}`)},vv=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),e.jsx("path",{d:"M3 5V19A9 3 0 0 0 21 19V5"}),e.jsx("path",{d:"M3 12A9 3 0 0 0 21 12"})]}),bv=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"7 10 12 15 17 10"}),e.jsx("line",{x1:"12",x2:"12",y1:"15",y2:"3"})]}),jv=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("path",{d:"M12 8v4"}),e.jsx("path",{d:"M12 16h.01"})]}),Ju=a=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"12"}),e.jsx("line",{x1:"12",x2:"12.01",y1:"16",y2:"16"})]}),Xu=a=>{if(!a)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a;const l=new Date(a);if(isNaN(l.getTime()))return a;const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`},wv=()=>{const[a,l]=x.useState("general"),o=()=>{switch(a){case"general":return e.jsx(Nv,{});case"sessions":return e.jsx(Sv,{});case"users":return e.jsx(kv,{});case"exams":return e.jsx(Cv,{});case"website":return e.jsx(Dv,{});case"database":return e.jsx(Ev,{});default:return null}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Administration Panel"}),e.jsxs("div",{className:"bg-primary rounded-lg shadow-lg",children:[e.jsx("div",{className:"flex border-b border-secondary overflow-x-auto",children:["general","sessions","users","exams","website","database"].map(c=>e.jsx("button",{onClick:()=>l(c),className:`px-4 py-3 font-medium text-sm -mb-px border-b-2 ${a===c?"border-accent text-accent":"border-transparent text-text-secondary hover:text-text-primary"}`,children:c.charAt(0).toUpperCase()+c.slice(1).replace("-"," ")},c))}),e.jsx("div",{className:"p-6 min-h-[500px]",children:o()})]})]})},Nv=()=>{const[a,l]=x.useState(mt()),[o,c]=x.useState(!1),d=()=>{l({...Na})};return x.useEffect(()=>{const p=()=>d();return window.addEventListener("app:refresh",p),()=>window.removeEventListener("app:refresh",p)},[]),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary mb-4",children:"General Settings"}),e.jsxs("div",{className:"bg-secondary p-6 rounded-lg max-w-2xl",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("img",{src:a.logo,alt:"logo",className:"w-20 h-20 rounded-full mr-6 bg-white p-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-text-primary text-2xl",children:a.name}),e.jsx("p",{className:"text-text-secondary text-md",children:a.tagline})]})]}),e.jsxs("div",{className:"text-sm text-text-primary space-y-2 border-t border-background pt-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",a.address]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",a.phone]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",a.email]})]}),e.jsx("button",{onClick:()=>c(!0),className:"w-full mt-6 bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/80 transition-colors",children:"Edit Details"})]}),e.jsx(hv,{isOpen:o,onClose:()=>c(!1),onSave:d})]})},Sv=()=>{const[a,l]=x.useState([]),[o,c]=x.useState(!0),[d,p]=x.useState(!1),[m,f]=x.useState(null),h=x.useCallback(async()=>{c(!0),Pf().then(w=>{l(w),c(!1)})},[]);x.useEffect(()=>{h()},[h]),x.useEffect(()=>{const w=()=>h();return window.addEventListener("app:refresh",w),()=>window.removeEventListener("app:refresh",w)},[h]);const v=async w=>{await Lf(w),h()},y=async w=>{if(w.isActive){alert("You cannot delete an active session. Please set another session as active first.");return}if(window.confirm(`Are you sure you want to delete the session "${w.name}"?`))try{c(!0),await Ff(w.id),h()}catch(E){console.error("Failed to delete session",E)}finally{c(!1)}},b=(w=null)=>{f(w),p(!0)};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Academic Sessions"}),e.jsx("button",{onClick:()=>b(),className:"bg-accent text-white px-3 py-1.5 rounded-md font-semibold hover:bg-accent/90 text-sm",children:"Add New Session"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Session Name"}),e.jsx("th",{className:"px-4 py-2",children:"Start Date"}),e.jsx("th",{className:"px-4 py-2",children:"End Date"}),e.jsx("th",{className:"px-4 py-2",children:"Status"}),e.jsx("th",{className:"px-4 py-2",children:"Actions"})]})}),e.jsx("tbody",{children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center p-4",children:"Loading..."})}):a.map(w=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[e.jsx("td",{className:"px-4 py-2 font-medium text-text-primary",children:w.name}),e.jsx("td",{className:"px-4 py-2",children:Xu(w.startDate)}),e.jsx("td",{className:"px-4 py-2",children:Xu(w.endDate)}),e.jsx("td",{className:"px-4 py-2",children:w.isActive?e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded-full bg-green-500/20 text-green-400",children:"Active"}):e.jsx("button",{onClick:()=>v(w.id),className:"text-xs text-accent hover:underline",children:"Set Active"})}),e.jsxs("td",{className:"px-4 py-2 flex gap-2",children:[e.jsx("button",{onClick:()=>b(w),className:"p-1 hover:bg-background rounded",title:"Edit",children:e.jsx(wt,{className:"w-4 h-4 text-yellow-400"})}),e.jsx("button",{onClick:()=>y(w),className:"p-1 hover:bg-background rounded",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4 text-red-500"})})]})]},w.id))})]})}),d&&e.jsx(fv,{isOpen:d,onClose:()=>p(!1),onSave:()=>{h(),p(!1)},initialData:m})]})},kv=()=>{const{user:a}=qe(),[l,o]=x.useState([]),[c,d]=x.useState(!0),[p,m]=x.useState(!1),[f,h]=x.useState(null),v=x.useCallback(async()=>{try{d(!0);const S=await $f();o(S)}catch(S){console.error("Failed to fetch users",S)}finally{d(!1)}},[]);x.useEffect(()=>{v()},[v]),x.useEffect(()=>{const S=()=>v();return window.addEventListener("app:refresh",S),()=>window.removeEventListener("app:refresh",S)},[v]);const y=(S=null)=>{h(S),m(!0)},b=()=>{h(null),m(!1)},w=()=>{v(),b()},E=async S=>{if(S.id===a?.id){alert("You cannot delete your own account.");return}if(window.confirm(`Are you sure you want to delete user "${S.name}"? This action cannot be undone.`))try{d(!0),await Of(S.id),v()}catch(N){console.error("Failed to delete user",N)}finally{d(!1)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"User Management"}),e.jsxs("button",{onClick:()=>y(),className:"bg-accent text-white px-3 py-1.5 rounded-md font-semibold hover:bg-accent/90 text-sm flex items-center gap-2",children:[e.jsx(pi,{className:"w-4 h-4"})," Add New User"]})]}),c?e.jsx("p",{children:"Loading users..."}):e.jsx(gv,{users:l,onEdit:y,onDelete:E}),p&&e.jsx(yv,{isOpen:p,onClose:b,onSave:w,initialData:f})]})},Cv=()=>{const[a,l]=x.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Exam Management"}),e.jsxs("button",{onClick:()=>l(!0),className:"bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent/90 transition-colors flex items-center gap-2",children:[e.jsx(wt,{className:"w-4 h-4"})," Manage Exam Definitions"]})]}),e.jsxs("div",{className:"bg-secondary/20 p-6 rounded-lg border border-secondary",children:[e.jsx("h4",{className:"font-bold text-text-primary mb-2",children:"Notice"}),e.jsx("p",{className:"text-sm text-text-secondary",children:'Use this section to define exam names (e.g., "Mid Term 2025") and set the attendance date range. The date range will automatically filter the attendance data (Working Days, Present, Absent) on individual report cards and class result sheets.'})]}),a&&e.jsx(Ym,{onClose:()=>l(!1)})]})},Ev=()=>{const[a,l]=x.useState(!1),[o,c]=x.useState(""),[d,p]=x.useState(""),m=async()=>{try{l(!0);const v=await Wg();if(!v||Object.keys(v).length===0){alert("Database is empty or could not be retrieved.");return}let y=`<?xml version="1.0"?>
<?mso-application progid="Excel.Sheet"?>
<Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"
 xmlns:o="urn:schemas-microsoft-com:office:office"
 xmlns:x="urn:schemas-microsoft-com:office:excel"
 xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"
 xmlns:html="http://www.w3.org/TR/REC-html40">
 <Styles>
  <Style ss:ID="Default" ss:Name="Normal">
   <Alignment ss:Vertical="Bottom"/>
   <Borders/>
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#000000"/>
   <Interior/>
   <NumberFormat/>
   <Protection/>
  </Style>
  <Style ss:ID="Header">
   <Font ss:FontName="Calibri" x:Family="Swiss" ss:Size="11" ss:Color="#000000" ss:Bold="1"/>
   <Interior ss:Color="#E4E4E4" ss:Pattern="Solid"/>
  </Style>
 </Styles>`;const b=M=>{if(M==null)return"";let I="";if(typeof M=="object")try{I=JSON.stringify(M)}catch{I="[Complex Data]"}else I=String(M);return I.length>3e4&&(I=I.substring(0,3e4)+"... [TRUNCATED]"),I.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};Object.keys(v).forEach(M=>{const I=v[M],V=M.replace(/[\\/:*?\[\]]/g," ").substring(0,31);if(y+=`<Worksheet ss:Name="${V}">
<Table>
`,I&&I.length>0){const $=Object.keys(I[0]);y+=`<Row>
`,$.forEach(P=>{y+=`<Cell ss:StyleID="Header"><Data ss:Type="String">${b(P)}</Data></Cell>
`}),y+=`</Row>
`,I.forEach(P=>{y+=`<Row>
`,$.forEach(q=>{y+=`<Cell><Data ss:Type="String">${b(P[q])}</Data></Cell>
`}),y+=`</Row>
`})}else y+=`<Row><Cell><Data ss:Type="String">No Data</Data></Cell></Row>
`;y+=`</Table>
</Worksheet>
`}),y+="</Workbook>";const w=new Blob([y],{type:"application/vnd.ms-excel"}),E=URL.createObjectURL(w),S=document.createElement("a");S.href=E;const N=new Date,j=`${N.getFullYear()}-${String(N.getMonth()+1).padStart(2,"0")}-${String(N.getDate()).padStart(2,"0")}`;S.download=`Madrasa_Database_${j}.xls`,document.body.appendChild(S),S.click(),document.body.removeChild(S),URL.revokeObjectURL(E)}catch(v){console.error("Export failed",v),alert(`Export failed: ${v.message||"Please check your network connection."}`)}finally{l(!1)}},f=async(v,y)=>{if(window.confirm(`CRITICAL WARNING: Are you sure you want to PERMANENTLY DELETE all data in ${y}? This cannot be undone.`))try{l(!0),await Hg(v),alert(`${y} cleared successfully.`)}catch(b){console.error("Clear failed",b),alert("Failed to clear. Please try again.")}finally{l(!1)}},h=async()=>{if(!o||!d){alert("Please select both start and end dates.");return}if(window.confirm(`Are you sure you want to delete all attendance records from ${o} to ${d}?`))try{l(!0),await Vg(o,d),alert("Attendance records cleared successfully."),c(""),p("")}catch(v){console.error("Clear failed",v),alert("Failed to clear attendance. Please try again.")}finally{l(!1)}};return e.jsxs("div",{className:"space-y-8 pb-12",children:[e.jsxs("div",{className:"bg-secondary/20 p-6 rounded-lg border border-secondary",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(vv,{className:"w-6 h-6 text-accent"}),e.jsx("h3",{className:"text-xl font-bold text-text-primary",children:"Database Backup"})]}),e.jsx("p",{className:"text-sm text-text-secondary mb-6",children:"Download the complete database across all modules (Students, Exams, Finance, Attendance, etc.) as an MS Excel compatible file."}),e.jsxs("button",{onClick:m,disabled:a,className:"bg-accent text-white px-6 py-3 rounded-lg font-bold hover:bg-accent/90 transition-all flex items-center gap-2 disabled:bg-gray-500 shadow-lg",children:[e.jsx(bv,{className:"w-5 h-5"}),a?"Exporting...":"Download Full Database (Excel)"]})]}),e.jsxs("div",{className:"bg-red-500/10 p-6 rounded-lg border border-red-500/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(jv,{className:"w-6 h-6 text-red-500"}),e.jsx("h3",{className:"text-xl font-bold text-red-500",children:"Database Cleanup (Danger Zone)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-bold text-text-primary flex items-center gap-2",children:[e.jsx(Ju,{className:"w-4 h-4"})," Clear Exam Data"]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>f("ExamDefinitions","Exam Definitions"),disabled:a,className:"text-left w-full px-4 py-2 bg-secondary/40 hover:bg-red-500 hover:text-white rounded-md text-sm transition-colors border border-secondary",children:"Clear All Exam Definitions (Names/Dates)"}),e.jsx("button",{onClick:()=>f("Exams","Exams Schedule"),disabled:a,className:"text-left w-full px-4 py-2 bg-secondary/40 hover:bg-red-500 hover:text-white rounded-md text-sm transition-colors border border-secondary",children:"Clear All Scheduled Exams"}),e.jsx("button",{onClick:()=>f("Results","Exam Results"),disabled:a,className:"text-left w-full px-4 py-2 bg-secondary/40 hover:bg-red-500 hover:text-white rounded-md text-sm transition-colors border border-secondary",children:"Clear All Exam Results / Marks"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-bold text-text-primary flex items-center gap-2",children:[e.jsx(Ju,{className:"w-4 h-4"})," Clear Attendance (By Range)"]}),e.jsxs("div",{className:"bg-secondary/40 p-4 rounded-md border border-secondary",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary block mb-1",children:"From"}),e.jsx("input",{type:"date",value:o,onChange:v=>c(v.target.value),className:"w-full bg-background border border-secondary p-2 rounded text-sm text-text-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-text-secondary block mb-1",children:"To"}),e.jsx("input",{type:"date",value:d,onChange:v=>p(v.target.value),className:"w-full bg-background border border-secondary p-2 rounded text-sm text-text-primary"})]})]}),e.jsx("button",{onClick:h,disabled:a,className:"w-full bg-red-600/20 hover:bg-red-600 text-red-500 hover:text-white py-2 rounded font-bold transition-all text-sm border border-red-600/30",children:a?"Processing...":"Delete Selected Range Attendance"})]})]})]})]})]})},Dv=()=>{const[a,l]=x.useState("links");return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex gap-4 border-b border-secondary overflow-x-auto pb-2",children:["links","messages","about","committee","teachers","gallery","notices"].map(o=>e.jsx("button",{onClick:()=>l(o),className:`px-3 py-1 rounded-md text-sm font-medium transition-colors ${a===o?"bg-accent text-white":"text-text-secondary hover:bg-secondary/50"}`,children:o.charAt(0).toUpperCase()+o.slice(1)},o))}),e.jsxs("div",{className:"pt-4",children:[a==="links"&&e.jsx(Iv,{}),a==="messages"&&e.jsx(Mv,{}),a==="about"&&e.jsx(Tv,{}),a==="committee"&&e.jsx(Zu,{sheetName:"WebsiteCommittee",label:"Committee Member"}),a==="teachers"&&e.jsx(Pv,{}),a==="gallery"&&e.jsx(Zu,{sheetName:"WebsiteGallery",label:"Gallery Image",urlField:"url"}),a==="notices"&&e.jsx(Av,{})]})]})},Iv=()=>{const[a,l]=x.useState([]),[o,c]=x.useState(!1);x.useEffect(()=>{Is("WebsiteLinks").then(l)},[]);const d=async(m,f)=>{c(!0),await Mn("WebsiteLinks",{id:m,url:f}),Is("WebsiteLinks").then(l),c(!1),alert("Saved successfully!")},p=m=>a.find(f=>f.id===m)?.url||"";return e.jsxs("div",{className:"max-w-xl space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"App Download URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",defaultValue:p("app_download"),id:"app_link",className:"flex-1 bg-secondary border border-background p-2 rounded text-text-primary"}),e.jsx("button",{onClick:()=>d("app_download",document.getElementById("app_link").value),disabled:o,className:"bg-accent px-4 py-2 rounded text-white text-sm",children:"Save"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Prospectus PDF URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",defaultValue:p("prospectus"),id:"prospectus_link",className:"flex-1 bg-secondary border border-background p-2 rounded text-text-primary"}),e.jsx("button",{onClick:()=>d("prospectus",document.getElementById("prospectus_link").value),disabled:o,className:"bg-accent px-4 py-2 rounded text-white text-sm",children:"Save"})]})]})]})},Mv=()=>{const[a,l]=x.useState([]),[o,c]=x.useState(!1),d=()=>Is("WebsiteMessages").then(l);x.useEffect(()=>{d()},[]);const p=async h=>{const v=a.find(y=>y.id===h);v&&(c(!0),await Mn("WebsiteMessages",v),d(),c(!1),alert("Saved!"))},m=(h,v,y)=>{l(b=>b.find(E=>E.id===h)?b.map(E=>E.id===h?{...E,[v]:y}:E):[...b,{id:h,name:"",text:"",photo:"",[v]:y}])},f=h=>a.find(v=>v.id===h)||{id:h,name:"",text:"",photo:""};return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:["chairman","director"].map(h=>{const v=f(h);return e.jsxs("div",{className:"bg-secondary p-4 rounded-lg space-y-3",children:[e.jsxs("h4",{className:"font-bold text-accent uppercase",children:[h," Message"]}),e.jsx("input",{placeholder:"Name",value:v.name,onChange:y=>m(h,"name",y.target.value),className:"w-full bg-background border border-background p-2 rounded text-text-primary"}),e.jsx("input",{placeholder:"Photo URL",value:v.photo,onChange:y=>m(h,"photo",y.target.value),className:"w-full bg-background border border-background p-2 rounded text-text-primary"}),e.jsx("textarea",{placeholder:"Message Text",rows:4,value:v.text,onChange:y=>m(h,"text",y.target.value),className:"w-full bg-background border border-background p-2 rounded text-text-primary"}),e.jsx("button",{onClick:()=>p(h),disabled:o,className:"w-full bg-accent py-2 rounded text-white font-bold",children:o?"Saving...":`Update ${h}`})]},h)})})},Zu=({sheetName:a,label:l,urlField:o})=>{const[c,d]=x.useState([]),[p,m]=x.useState(!1),[f,h]=x.useState(!1),v=()=>Is(a).then(d);x.useEffect(()=>{v()},[]);const y=async b=>{confirm(`Delete this ${l}?`)&&(m(!0),await ki(a,b),v(),m(!1))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"font-bold text-text-primary",children:[l,"s"]}),e.jsxs("button",{onClick:()=>h(!0),className:"bg-accent text-white px-3 py-1 rounded flex items-center gap-1 text-sm",children:[e.jsx(qr,{className:"w-4 h-4"})," Add New"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:c.map(b=>e.jsxs("div",{className:"bg-secondary p-4 rounded-lg relative",children:[e.jsx("button",{onClick:()=>y(b.id),className:"absolute top-2 right-2 text-red-500 hover:text-red-700",children:e.jsx(Re,{className:"w-4 h-4"})}),b.photo||b.url?e.jsx("img",{src:b.photo||b.url,alt:b.name||b.caption,className:"w-full h-32 object-cover rounded mb-2 bg-background"}):e.jsx("div",{className:"w-full h-32 bg-background rounded mb-2 flex items-center justify-center text-xs text-text-secondary",children:"No Preview"}),e.jsx("p",{className:"font-bold text-text-primary text-sm",children:b.name||b.caption}),e.jsx("p",{className:"text-xs text-text-secondary",children:b.designation})]},b.id))}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-primary p-6 rounded-lg w-full max-w-md space-y-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-text-primary",children:["Add ",l]}),e.jsxs("form",{onSubmit:async b=>{b.preventDefault();const w=new FormData(b.currentTarget),E=Object.fromEntries(w.entries());m(!0),await Mn(a,E),h(!1),v(),m(!1)},className:"space-y-3",children:[o==="url"?e.jsxs(e.Fragment,{children:[e.jsx("input",{name:"url",placeholder:"Image URL",required:!0,className:"w-full bg-secondary p-2 rounded"}),e.jsx("input",{name:"caption",placeholder:"Caption",className:"w-full bg-secondary p-2 rounded"})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{name:"name",placeholder:"Name",required:!0,className:"w-full bg-secondary p-2 rounded"}),e.jsx("input",{name:"designation",placeholder:"Designation",className:"w-full bg-secondary p-2 rounded"}),e.jsx("input",{name:"photo",placeholder:"Photo URL",className:"w-full bg-secondary p-2 rounded"})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 bg-background p-2 rounded",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"flex-1 bg-accent text-white p-2 rounded font-bold",children:"Save"})]})]})]})})]})},Pv=()=>{const[a,l]=x.useState([]),[o,c]=x.useState(!1),[d,p]=x.useState(!1),m=()=>Is("WebsiteTeachers").then(l);x.useEffect(()=>{m()},[]);const f=async h=>{confirm("Delete this Teacher?")&&(c(!0),await ki("WebsiteTeachers",h),m(),c(!1))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-bold text-text-primary",children:"Website Teachers"}),e.jsxs("button",{onClick:()=>p(!0),className:"bg-accent text-white px-3 py-1 rounded flex items-center gap-1 text-sm",children:[e.jsx(qr,{className:"w-4 h-4"})," Add New"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(h=>e.jsxs("div",{className:"bg-secondary p-4 rounded-lg relative text-sm",children:[e.jsx("button",{onClick:()=>f(h.id),className:"absolute top-2 right-2 text-red-500 hover:text-red-700",children:e.jsx(Re,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("img",{src:h.photo,alt:h.name,className:"w-16 h-16 object-cover rounded-full bg-background"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-text-primary",children:h.name}),e.jsx("p",{className:"text-accent text-xs",children:h.designation}),e.jsx("p",{className:"text-text-secondary text-xs",children:h.subject})]})]})]},h.id))}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-primary p-6 rounded-lg w-full max-w-md space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold text-text-primary",children:"Add Teacher"}),e.jsxs("form",{onSubmit:async h=>{h.preventDefault();const v=new FormData(h.currentTarget),y=Object.fromEntries(v.entries());c(!0),await Mn("WebsiteTeachers",y),p(!1),m(),c(!1)},className:"space-y-3",children:[e.jsx("input",{name:"name",placeholder:"Name",required:!0,className:"w-full bg-secondary p-2 rounded"}),e.jsx("input",{name:"designation",placeholder:"Designation",defaultValue:" ",className:"w-full bg-secondary p-2 rounded"}),e.jsx("input",{name:"academic",placeholder:"Academic Qualification",className:"w-full bg-secondary p-2 rounded"}),e.jsx("input",{name:"subject",placeholder:"Subject",className:"w-full bg-secondary p-2 rounded"}),e.jsx("input",{name:"photo",placeholder:"Photo URL",className:"w-full bg-secondary p-2 rounded"}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 bg-background p-2 rounded",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:o,className:"flex-1 bg-accent text-white p-2 rounded font-bold",children:"Save"})]})]})]})})]})},Av=()=>{const[a,l]=x.useState([]),[o,c]=x.useState(!1),[d,p]=x.useState(!1),m=()=>Is("WebsiteNotices").then(l);x.useEffect(()=>{m()},[]);const f=async h=>{confirm("Delete this Notice?")&&(c(!0),await ki("WebsiteNotices",h),m(),c(!1))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-bold text-text-primary",children:"Website Notices"}),e.jsxs("button",{onClick:()=>p(!0),className:"bg-accent text-white px-3 py-1 rounded flex items-center gap-1 text-sm",children:[e.jsx(qr,{className:"w-4 h-4"})," Add New"]})]}),e.jsx("div",{className:"space-y-2",children:a.map(h=>e.jsxs("div",{className:"bg-secondary p-3 rounded-lg flex justify-between items-center text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-text-primary",children:h.title}),e.jsx("p",{className:"text-text-secondary text-xs",children:h.date})]}),e.jsx("button",{onClick:()=>f(h.id),className:"text-red-500 hover:text-red-700",children:e.jsx(Re,{className:"w-4 h-4"})})]},h.id))}),d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-primary p-6 rounded-lg w-full max-w-md space-y-4",children:[e.jsx("h3",{className:"text-xl font-bold text-text-primary",children:"Add Notice"}),e.jsxs("form",{onSubmit:async h=>{h.preventDefault();const v=new FormData(h.currentTarget),y=Object.fromEntries(v.entries());c(!0),await Mn("WebsiteNotices",y),p(!1),m(),c(!1)},className:"space-y-3",children:[e.jsx("input",{name:"title",placeholder:"Notice Title",required:!0,className:"w-full bg-secondary p-2 rounded"}),e.jsx("input",{name:"date",placeholder:"Date (e.g.,  , )",defaultValue:new Date().toLocaleDateString("bn-BD"),className:"w-full bg-secondary p-2 rounded"}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 bg-background p-2 rounded",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:o,className:"flex-1 bg-accent text-white p-2 rounded font-bold",children:"Save"})]})]})]})})]})},Tv=()=>{const[a,l]=x.useState([]),[o,c]=x.useState(!1),d=()=>Is("WebsiteAbout").then(l);x.useEffect(()=>{d()},[]);const p=async h=>{const v=a.find(y=>y.id===h);v&&(c(!0),await Mn("WebsiteAbout",v),d(),c(!1),alert("About section updated!"))},m=(h,v,y)=>{l(b=>b.find(E=>E.id===h)?b.map(E=>E.id===h?{...E,[v]:y}:E):[...b,{id:h,title:"",content:"",image:"",[v]:y}])},f=h=>a.find(v=>v.id===h)||{id:h,title:"",content:"",image:""};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-secondary p-4 rounded-lg space-y-3",children:[e.jsx("h4",{className:"font-bold text-accent uppercase",children:"Main About & Campus Photo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-xs text-text-secondary",children:"Campus Image URL"}),e.jsx("input",{value:f("main_about").image,onChange:h=>m("main_about","image",h.target.value),className:"w-full bg-background border border-background p-2 rounded text-text-primary text-sm"}),e.jsx("textarea",{placeholder:"About Description",rows:6,value:f("main_about").content,onChange:h=>m("main_about","content",h.target.value),className:"w-full bg-background border border-background p-2 rounded text-text-primary text-sm"})]}),e.jsx("div",{className:"flex items-center justify-center bg-background rounded border border-dashed border-secondary p-2",children:f("main_about").image?e.jsx("img",{src:f("main_about").image,alt:"Preview",className:"max-h-48 rounded shadow-sm"}):e.jsx("span",{className:"text-xs text-text-secondary",children:"No Image Preview"})})]}),e.jsx("button",{onClick:()=>p("main_about"),disabled:o,className:"w-full bg-accent py-2 rounded text-white font-bold text-sm",children:"Update Main About"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-secondary p-4 rounded-lg space-y-3",children:[e.jsx("h4",{className:"font-bold text-accent uppercase",children:"Mission"}),e.jsx("input",{placeholder:"Title (e.g. )",value:f("mission").title,onChange:h=>m("mission","title",h.target.value),className:"w-full bg-background border border-background p-2 rounded text-text-primary text-sm"}),e.jsx("textarea",{placeholder:"Mission Statement",rows:3,value:f("mission").content,onChange:h=>m("mission","content",h.target.value),className:"w-full bg-background border border-background p-2 rounded text-text-primary text-sm"}),e.jsx("button",{onClick:()=>p("mission"),disabled:o,className:"w-full bg-accent py-2 rounded text-white font-bold text-sm",children:"Update Mission"})]}),e.jsxs("div",{className:"bg-secondary p-4 rounded-lg space-y-3",children:[e.jsx("h4",{className:"font-bold text-accent uppercase",children:"Vision"}),e.jsx("input",{placeholder:"Title (e.g. )",value:f("vision").title,onChange:h=>m("vision","title",h.target.value),className:"w-full bg-background border border-background p-2 rounded text-text-primary text-sm"}),e.jsx("textarea",{placeholder:"Vision Statement",rows:3,value:f("vision").content,onChange:h=>m("vision","content",h.target.value),className:"w-full bg-background border border-background p-2 rounded text-text-primary text-sm"}),e.jsx("button",{onClick:()=>p("vision"),disabled:o,className:"w-full bg-accent py-2 rounded text-white font-bold text-sm",children:"Update Vision"})]})]})]})},em=a=>{if(!a)return"N/A";if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a;try{const l=new Date(a);if(isNaN(l.getTime()))return a;const o=l.getFullYear(),c=String(l.getMonth()+1).padStart(2,"0"),d=String(l.getDate()).padStart(2,"0");return`${o}-${c}-${d}`}catch{return a}},Lv=a=>{switch(a){case"Pending":return"bg-yellow-500/20 text-yellow-400";case"Approved":return"bg-green-500/20 text-green-400";case"Rejected":return"bg-red-500/20 text-red-400";default:return"bg-gray-500/20 text-gray-400"}},tm=({requests:a,isAdminView:l,onApprove:o,onReject:c,onDelete:d})=>a.length===0?e.jsx("p",{className:"text-text-secondary text-center py-4",children:l?"No leave requests found.":"You have no leave history."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-text-secondary",children:[e.jsx("thead",{className:"text-xs text-text-primary uppercase bg-secondary",children:e.jsxs("tr",{children:[l&&e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Staff Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Start Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"End Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Reason"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Status"}),l&&e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(p=>e.jsxs("tr",{className:"border-b border-secondary hover:bg-secondary/50",children:[l&&e.jsx("td",{className:"px-6 py-4 font-medium text-text-primary",children:p.staffName}),e.jsx("td",{className:"px-6 py-4",children:em(p.startDate)}),e.jsx("td",{className:"px-6 py-4",children:em(p.endDate)}),e.jsx("td",{className:"px-6 py-4 max-w-xs truncate",children:p.reason}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${Lv(p.status)}`,children:p.status})}),l&&e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[p.status==="Pending"&&o&&c&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o(p.id),className:"p-1.5 bg-green-500/20 text-green-400 rounded-full hover:bg-green-500/40",title:"Approve",children:e.jsx(Nm,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(p.id),className:"p-1.5 bg-red-500/20 text-red-400 rounded-full hover:bg-red-500/40",title:"Reject",children:e.jsx(Bt,{className:"w-4 h-4"})})]}),d&&e.jsx("button",{onClick:()=>d(p.id),className:"p-1.5 bg-secondary text-red-500 rounded-full hover:bg-secondary/80",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4"})})]})}),!l&&e.jsx("td",{className:"px-6 py-4",children:d&&e.jsx("button",{onClick:()=>d(p.id),className:"p-1.5 bg-secondary text-red-500 rounded-full hover:bg-secondary/80",title:"Delete",children:e.jsx(Re,{className:"w-4 h-4"})})})]},p.id))})]})}),Fv=()=>{const{user:a}=qe(),[l,o]=x.useState([]),[c,d]=x.useState(!0),[p,m]=x.useState(""),[f,h]=x.useState(""),[v,y]=x.useState(""),b=x.useCallback(async()=>{try{d(!0);const I=await Bm();o(I)}catch(I){console.error("Failed to fetch leave requests",I)}finally{d(!1)}},[]);x.useEffect(()=>{b()},[b]),x.useEffect(()=>{const I=()=>b();return window.addEventListener("app:refresh",I),()=>window.removeEventListener("app:refresh",I)},[b]);const w=async I=>{if(I.preventDefault(),!a||!p||!f||!v){alert("Please fill all fields.");return}await _g({staffId:a.id,staffName:a.name,startDate:p,endDate:f,reason:v}),m(""),h(""),y(""),b()},E=async(I,V)=>{await Og(I,V),b()},S=async I=>{if(window.confirm("Are you sure you want to delete this leave request?"))try{d(!0),await Bg(I),b()}catch(V){console.error("Failed to delete leave request",V),alert("Error deleting request.")}finally{d(!1)}},N=x.useMemo(()=>a?l.filter(I=>I.staffId===a.id):[],[l,a]);if(c)return e.jsx("div",{className:"text-center p-8",children:"Loading leave information..."});const j=a?.role==="Admin",M=a?.role!=="Student";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-text-primary",children:"Leave Management"}),j&&e.jsxs("div",{className:"bg-primary p-6 rounded-lg shadow-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary mb-4",children:"All Staff Leave Requests"}),e.jsx(tm,{requests:l,isAdminView:!0,onApprove:I=>E(I,"Approved"),onReject:I=>E(I,"Rejected"),onDelete:S})]}),M&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 bg-primary p-6 rounded-lg shadow-lg h-fit",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary mb-4",children:"Apply for Leave"}),e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Start Date"}),e.jsx("input",{type:"date",value:p,onChange:I=>m(I.target.value),className:"w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"End Date"}),e.jsx("input",{type:"date",value:f,onChange:I=>h(I.target.value),className:"w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-text-secondary mb-1 block",children:"Reason"}),e.jsx("textarea",{value:v,onChange:I=>y(I.target.value),rows:4,placeholder:"Reason for leave...",className:"w-full bg-secondary p-2 rounded-md text-text-primary focus:outline-none focus:ring-2 focus:ring-accent",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full bg-accent text-white font-semibold py-2.5 rounded-lg hover:bg-accent/90 transition-colors",children:"Submit Request"})]})]}),e.jsxs("div",{className:"lg:col-span-2 bg-primary p-6 rounded-lg shadow-lg",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary mb-4",children:"My Leave History"}),e.jsx(tm,{requests:N,isAdminView:!1,onDelete:S})]})]})]})},$v=()=>{const[a,l]=x.useState(!1);return e.jsxs("div",{className:"flex h-screen bg-background font-sans",children:[e.jsx(sy,{isOpen:a,onClose:()=>l(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(ny,{onMenuClick:()=>l(!0)}),e.jsx("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-background p-4 md:p-6 transition-all duration-300",children:e.jsx(di,{})})]})]})},Rv=()=>{const{user:a}=qe(),l=Ni(),o=c=>l.find(d=>d.href===c)?.roles||["Admin"];return e.jsxs(Kh,{children:[e.jsx($e,{path:"/",element:a?e.jsx(Gs,{to:"/app"}):e.jsx(iv,{})}),e.jsx($e,{path:"/login",element:a?e.jsx(Gs,{to:"/app"}):e.jsx(cv,{})}),e.jsx($e,{path:"/results",element:e.jsx(dv,{})}),e.jsx($e,{path:"/app",element:e.jsx(et,{roles:["Admin","Teacher","Student"],children:a?.role==="Student"?e.jsx(Gs,{to:"/app/student-dashboard"}):e.jsx(Gs,{to:"/app/dashboard"})})}),e.jsxs($e,{element:e.jsx(et,{roles:["Admin","Teacher"],children:e.jsx($v,{})}),children:[e.jsx($e,{path:"/app/dashboard",element:e.jsx(et,{roles:o("/app/dashboard"),children:e.jsx(ly,{})})}),e.jsx($e,{path:"/app/students",element:e.jsx(et,{roles:o("/app/students"),children:e.jsx(cy,{})})}),e.jsx($e,{path:"/app/classes",element:e.jsx(et,{roles:o("/app/classes"),children:e.jsx(ov,{})})}),e.jsx($e,{path:"/app/academics",element:e.jsx(et,{roles:o("/app/academics"),children:e.jsx(yy,{})})}),e.jsx($e,{path:"/app/attendance",element:e.jsx(et,{roles:o("/app/attendance"),children:e.jsx(Ny,{})})}),e.jsx($e,{path:"/app/communication",element:e.jsx(et,{roles:o("/app/communication"),children:e.jsx(Fy,{})})}),e.jsx($e,{path:"/app/exams",element:e.jsx(et,{roles:o("/app/exams"),children:e.jsx(Yy,{})})}),e.jsx($e,{path:"/app/events",element:e.jsx(et,{roles:o("/app/events"),children:e.jsx(ev,{})})}),e.jsx($e,{path:"/app/leave",element:e.jsx(et,{roles:o("/app/leave"),children:e.jsx(Fv,{})})}),e.jsx($e,{path:"/app/staff",element:e.jsx(et,{roles:o("/app/staff"),children:e.jsx(my,{})})}),e.jsx($e,{path:"/app/finance",element:e.jsx(et,{roles:o("/app/finance"),children:e.jsx(My,{})})}),e.jsx($e,{path:"/app/transport",element:e.jsx(et,{roles:o("/app/transport"),children:e.jsx(zy,{})})}),e.jsx($e,{path:"/app/inventory",element:e.jsx(et,{roles:o("/app/inventory"),children:e.jsx(By,{})})}),e.jsx($e,{path:"/app/id-cards",element:e.jsx(et,{roles:o("/app/id-cards"),children:e.jsx(sv,{})})}),e.jsx($e,{path:"/app/administration",element:e.jsx(et,{roles:o("/app/administration"),children:e.jsx(wv,{})})})]}),e.jsx($e,{element:e.jsx(et,{roles:["Student"],children:e.jsx(ry,{})}),children:e.jsx($e,{path:"/app/student-dashboard",element:e.jsx(uv,{})})}),e.jsx($e,{path:"/unauthorized",element:e.jsx(xv,{})}),e.jsx($e,{path:"*",element:e.jsx(Gs,{to:a?"/app":"/",replace:!0})})]})},zv=()=>{const[a,l]=x.useState(!0);return x.useEffect(()=>{(async()=>{try{await Promise.all([ey(),bi(),Um()])}catch(c){console.error("Initialization error:",c)}finally{l(!1)}})()},[]),a?e.jsx("div",{className:"flex justify-center items-center h-screen bg-background text-text-primary",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-accent border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-xl font-medium",children:"Preparing Environment..."})]})}):e.jsx(af,{children:e.jsx(Qg,{children:e.jsx(Yg,{children:e.jsx(Rv,{})})})})},Jm=document.getElementById("root");if(!Jm)throw new Error("Could not find root element to mount to");const _v=ah.createRoot(Jm);_v.render(e.jsx(oi.StrictMode,{children:e.jsx(zv,{})}));
